# ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÅ‡∏ö‡∏ö Modular Monolith

> ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö Monolith ‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏¢‡∏∏‡πà‡∏á‡πÄ‡∏´‡∏¢‡∏¥‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏Ç‡∏∂‡πâ‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡πÜ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‚Äî Modular Monolith ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
>

‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏•‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Monolith ‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ö‡∏ö **Modular Monolith** ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÑ‡∏õ‡∏™‡∏π‡πà Microservices ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÅ‡∏£‡∏Å

## ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç

- ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏∞‡πÑ‡∏£
- ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Web Server ‡πÉ‡∏´‡πâ‡∏î‡∏µ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÅ‡∏£‡∏Å
- ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å logic ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å routing ‡∏î‡πâ‡∏ß‡∏¢ Handlers
- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô
- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Layered Architecture ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢
- ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡πà‡∏≤‡∏¢
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏ö‡∏ö Reusable ‡∏î‡πâ‡∏ß‡∏¢ Notification Service
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏î‡πâ‡∏ß‡∏¢ Layered Architecture
- ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Database Transaction ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à Unit of Work ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á
- ‡∏ô‡∏≥‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Dependency Inversion ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á
- ‡πÅ‡∏õ‡∏•‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏õ‡∏™‡∏π‡πà Modular Architecture ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
- ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á Subdomain
- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `internal`
- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Service ‡πÉ‡∏ô Monolith ‡∏î‡πâ‡∏ß‡∏¢ Service Registry
- ‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Mono-Repository ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Public API Contract ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•
- ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏• (Data Isolation)
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏°‡∏î‡∏π‡∏• ‡∏î‡πâ‡∏ß‡∏¢ Feature-Based Structure + CQRS
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î Event-Driven Architecture

---

## ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏∞‡πÑ‡∏£

‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå Monolith App ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
2. ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
3. ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå

### ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

```markdown
+------------+        +----------------------+        +-----------+
|   Client   | <----> |    Monolith App      | <----> | Database  |
+------------+        |----------------------|        +-----------+
                      |  Modules:            |
                      |    - customer        |
                      |    - order           |
                      |    - email           |
                      +----------------------+

1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (POST /customers)
---------------------------------------
Client ----> Monolith: POST /customers {email, credit}
Monolith.customer --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö email ‡∏ã‡πâ‡∏≥?
  ‚îî‚îÄ ‡∏ã‡πâ‡∏≥ --> Monolith.customer --> Client: 409 Conflict (email already exists)
  ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥:
      Monolith.customer --> Database: INSERT INTO customers
      Monolith.email --> ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
      Monolith.customer --> Client: 201 Created

2. ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (POST /orders)
-------------------------------
Client ----> Monolith: POST /orders {customer_id, order_total}
Monolith.order --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer_id
  ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏û‡∏ö --> Monolith.order --> Client: 404 Not Found (customer not found)
  ‚îî‚îÄ ‡∏û‡∏ö:
      Monolith.order --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö credit ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠?
          ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏û‡∏≠ --> Monolith.order --> Client: 422 Unprocessable Entity (insufficient credit)
          ‚îî‚îÄ ‡∏û‡∏≠:
              Monolith.order --> Database: INSERT INTO orders, UPDATE credit (‡∏´‡∏±‡∏Å‡∏¢‡∏≠‡∏î)
              Monolith.email --> ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
              Monolith.order --> Client: 201 Created

3. ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (DELETE /orders/:orderID)
---------------------------------------------
Client ----> Monolith: DELETE /orders/:orderID
Monolith.order --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö orderID
  ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏û‡∏ö --> Monolith.order --> Client: 404 Not Found (order not found)
  ‚îî‚îÄ ‡∏û‡∏ö:
      Monolith.order --> Database: DELETE order, UPDATE credit (‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î)
      Monolith.order --> Client: 204 No Content
```

### API endpoint

‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏°‡∏µ 3 API endpoint

- `POST /customers` ‚Äì ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà

    | JSON Field | Type | Required | Description |
    | --- | --- | --- | --- |
    | `email` | string | ‚úÖ | ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ |
    | `credit` | integer | ‚úÖ | ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô |

    **Response**

    | Status Code | Description |
    | --- | --- |
    | `201` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à |
    | `400` | payload ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á `email` ‡∏´‡∏£‡∏∑‡∏≠ `email` ‡∏ú‡∏¥‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö |
    | `422` | ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô business rule ‡πÄ‡∏ä‡πà‡∏ô `credit` ‚â§ 0 |
    | `409` | ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (Conflict) |

- `POST /orders` ‚Äì ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå

    | JSON Field | Type | Required | Description |
    | --- | --- | --- | --- |
    | `customer_id` | integer | ‚úÖ | ID ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ |
    | `order_total` | integer | ‚úÖ | ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå |

    **Response**

    | Status Code | Description |
    | --- | --- |
    | `201` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ |
    | `400` | ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á `customer_id` ‡∏´‡∏£‡∏∑‡∏≠ `order_total` ‚â§ 0 |
    | `404` | ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (`customer_id` ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á) |
    | `422` | ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå |

- `DELETE /orders/:orderID` ‚Äì ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå

    | Path Param | Type | Required | Description |
    | --- | --- | --- | --- |
    | `orderID` | integer | ‚úÖ | ID ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå |

    **Response**

    | Status Code | Description |
    | --- | --- |
    | `204` | ‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (No Content) |
    | `404` | ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |

---

## ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Web Server ‡πÉ‡∏´‡πâ‡∏î‡∏µ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÅ‡∏£‡∏Å

> ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Web Server ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏¢‡∏≤‡∏¢ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏• ‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß
>

‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢

- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Web Server
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ route ‡∏Ç‡∏≠‡∏á fiber
- ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö Rest API ‡∏î‡πâ‡∏ß‡∏¢ REST Client
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Graceful Shutdown
- ‡∏™‡∏£‡πâ‡∏≤‡∏á Logger ‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πà‡∏ß‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Configurations
- ‡πÉ‡∏ä‡πâ Makefile ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
- Refactor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏î
- ‡∏Å‡∏≤‡∏£ Build Web Server

### ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Web Server

‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á Web Server ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô ‡πÇ‡∏î‡∏¢‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏†‡∏≤‡∏©‡∏≤ Go ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ Fiber v3

**‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠**

- [Go](https://go.dev/dl/) version 1.24.4 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ
- [VS Code](https://code.visualstudio.com/download) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏° [Go](https://marketplace.visualstudio.com/items?itemName=golang.Go), [Error Lens](https://marketplace.visualstudio.com/items?itemName=usernamehw.errorlens), [REST Client](https://marketplace.visualstudio.com/items?itemName=humao.rest-client)

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô**

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÉ‡∏´‡∏°‡πà

    ```bash
    mkdir go-mma
    cd go-mma
    git init
    go mod init go-mma
    touch main.go
    ```

- ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

    ```bash
    tree
    .
    ‚îú‚îÄ‚îÄ go.mod
    ‚îî‚îÄ‚îÄ main.go
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Web Server ‡∏î‡πâ‡∏ß‡∏¢ Fiber v3 ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `main.go`

    ```go
    package main
    
    import (
     "fmt"
    
     "github.com/gofiber/fiber/v3"
    )
    
    var (
     Version = "local-dev"
     Time    = "n/a"
    )
    
    func main() {
     app := fiber.New(fiber.Config{
      AppName: fmt.Sprintf("Go MMA version %s", Version),
     })
    
     app.Get("/", func(c fiber.Ctx) error {
       // ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ JSON
      return c.JSON(map[string]string{"version": Version, "time": Time})
     })
    
     app.Listen(":8090")
    }
    ```

- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `go mod tidy` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á package
- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `go run main.go` ‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°

    ```bash
    go run main.go
    
        _______ __             
       / ____(_) /_  ___  _____
      / /_  / / __ \/ _ \/ ___/
     / __/ / / /_/ /  __/ /    
    /_/   /_/_.___/\___/_/          v3.0.0-beta.4
    --------------------------------------------------
    INFO Server started on:         http://127.0.0.1:8090 (bound on host 0.0.0.0 and port 3000)
    INFO Application name:          Go MMA v0.0.1
    INFO Total handlers count:      1
    INFO Prefork:                   Disabled
    INFO PID:                       47664
    INFO Total process count:       1
    ```

- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏õ‡∏¥‡∏î <http://127.0.0.1:8090> ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå

    ```json
    {
    "time": "n/a",
    "version": "local-dev"
    }
    ```

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ route ‡∏Ç‡∏≠‡∏á fiber v3

‡∏Ñ‡∏ß‡∏£‡πÅ‡∏¢‡∏Å‡∏ß‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö Routing ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÅ‡∏¢‡∏Å concerns ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô middlewares ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `main.go`

    ```go
    package main
    
    import (
      "fmt"
      
     "github.com/gofiber/fiber/v3"
     "github.com/gofiber/fiber/v3/middleware/cors"
     "github.com/gofiber/fiber/v3/middleware/logger"
     "github.com/gofiber/fiber/v3/middleware/recover"
     "github.com/gofiber/fiber/v3/middleware/requestid"
    )
    
    var (
     Version = "local-dev"
     Time    = "n/a"
    )
    
    func main() {
     app := fiber.New(fiber.Config{
      AppName: fmt.Sprintf("Go MMA version %s", Version),
     })
    
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î global middleware
     app.Use(cors.New())      // CORS ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ OPTIONS request ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
     app.Use(requestid.New()) // ‡∏™‡∏£‡πâ‡∏≤‡∏á request id ‡πÉ‡∏ô request header ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ debug
     app.Use(recover.New())   // auto-recovers from panic (internal only)
     app.Use(logger.New())    // logs HTTP request
     
     app.Get("/", func(c fiber.Ctx) error {
      return c.JSON(map[string]string{"version": Version, "time": Time})
     })
    
      // ‡πÅ‡∏¢‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ routing ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
     v1 := app.Group("/api/v1")
    
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á customer
     customers := v1.Group("/customers")
     {
      customers.Post("", func(c fiber.Ctx) error {
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î status code ‡∏î‡πâ‡∏ß‡∏¢ Status()
       return c.Status(fiber.StatusCreated).JSON(fiber.Map{"id": 1})
      })
     }
    
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á order
     orders := v1.Group("/orders")
     {
      orders.Post("", func(c fiber.Ctx) error {
       return c.Status(fiber.StatusCreated).JSON(fiber.Map{"id": 1})
      })
    
      orders.Delete("/:orderID", func(c fiber.Ctx) error {
        // ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏Ñ‡πà status code ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
       return c.SendStatus(fiber.StatusNoContent)
      })
     }
    
     app.Listen(":8090")
    }
    ```

- ‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà `go run main.go`

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö Rest API ‡∏î‡πâ‡∏ß‡∏¢ REST Client

‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ VS Code Extensions ‡∏ä‡∏∑‡πà‡∏≠ [REST Client](https://marketplace.visualstudio.com/items?itemName=humao.rest-client)

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á [REST Client](https://marketplace.visualstudio.com/items?itemName=humao.rest-client) ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà 2 ‡πÑ‡∏ü‡∏•‡πå `test/customers.http` ‡∏Å‡∏±‡∏ö `test/orders.http`
- ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

    ```bash
    tree
    .
    ‚îú‚îÄ‚îÄ go.mod
    ‚îú‚îÄ‚îÄ main.go
    ‚îî‚îÄ‚îÄ test
      ‚îú‚îÄ‚îÄ customers.http
        ‚îî‚îÄ‚îÄ orders.http
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `test/customers.http`

    ```bash
    @host = http://localhost:8090
    @base_url = api/v1/customers
    ### Create Customer
    POST {{host}}/{{base_url}} HTTP/1.1
    content-type: application/json
    
    {
      "email": "cust@example.com",
      "credit": 1000
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `tests/orders.http`

    ```bash
    @host = http://localhost:8090
    @base_url = api/v1/orders
    @customer_id = 1
    @order_id = 1
    ### Create Order
    POST {{host}}/{{base_url}} HTTP/1.1
    content-type: application/json
    
    {
      "customer_id": {{customer_id}},
      "order_total": 100
    }
    
    ### Cancel Order
    DELETE {{host}}/{{base_url}}/{{order_id}} HTTP/1.1
    ```

- ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ `Send Request`

    ```bash
    @host = http://localhost:8090
    @base_url = api/v1/customers
    ### Create Customer
    Send Request
    POST {{host}}/{{base_url}} HTTP/1.1
    content-type: application/json
    
    {
      "email": "cust@example.com",
      "credit": 1000
    }
    ```

- ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

    ```bash
    HTTP/1.1 201 Created
    Date: Thu, 29 May 2025 04:07:11 GMT
    Content-Type: application/json
    Content-Length: 11
    Connection: close
    
    {
      "id": 1
    }
    ```

### ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Graceful Shutdown

‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Web Server ‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö production ‡∏™‡∏¥‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏°‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏∑‡∏≠ **Graceful Shutdown ‚Äî ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà**

> ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏Ñ‡∏∑‡∏≠: ‚Äú‡∏≠‡∏¢‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÉ‡∏´‡πâ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Å‡πà‡∏≠‡∏ô‚Äù
>

‡∏ó‡∏≥‡πÑ‡∏°‡∏ñ‡∏∂‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç?

- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÜ ‡∏Å‡∏•‡∏≤‡∏á‡πÜ
- ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞ service ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
- ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ deploy ‡∏´‡∏£‡∏∑‡∏≠ restart ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏≤‡∏ö‡∏£‡∏∑‡πà‡∏ô ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Graceful Shutdown ‡∏î‡πâ‡∏ß‡∏¢‡∏†‡∏≤‡∏©‡∏≤ Go

- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å **‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ start server** ‡πÑ‡∏õ‡∏£‡∏±‡∏ô‡πÉ‡∏ô goroutine ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ main thread ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì shutdown ‡πÑ‡∏î‡πâ

    ```go
    // ‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤ run server ‡πÉ‡∏ô goroutine
    go func() {
      if err := app.Listen(":8090"); err != nil && err != http.ErrServerClosed {
        log.Fatalf("Error starting server: %v", err)
      }
    }()
    ```

- ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô **‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì OS** ‡πÄ‡∏ä‡πà‡∏ô `SIGINT` ‡∏´‡∏£‡∏∑‡∏≠ `SIGTERM` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ shutdown

    ```go
    // ‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î
    stop := make(chan os.Signal, 1)
    signal.Notify(stop, os.Interrupt, syscall.SIGTERM)
    <-stop
    ```

- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏° **‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏±‡∏ö request ‡πÉ‡∏´‡∏°‡πà** ‡πÅ‡∏•‡πâ‡∏ß **‡∏£‡∏≠‡πÉ‡∏´‡πâ request ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à** ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô timeout ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡πÄ‡∏ä‡πà‡∏ô 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏õ‡∏¥‡∏î resource ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô DB connection

    ```go
    log.Println("Shutting down...")
    
    // **‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏±‡∏ö** request **‡πÉ‡∏´‡∏°‡πà** ‡πÅ‡∏•‡πâ‡∏ß **‡∏£‡∏≠‡πÉ‡∏´‡πâ** request **‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à** ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô timeout ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡πÄ‡∏ä‡πà‡∏ô 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
    ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
    defer cancel()
    if err := app.ShutdownWithContext(ctx); err != nil {
      log.Fatalf("Error shutting down server: %v", err)
    }
    
    // Optionally: ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏õ‡∏¥‡∏î resource ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô DB connection, cleanup, etc.
    
    log.Println("Shutdown complete.")
    ```

- ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ‡πÅ‡∏Å‡πâ endpoint ‡∏™‡∏£‡πâ‡∏≤‡∏á customer ‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

    ```go
    customers.Post("", func(c fiber.Ctx) error {
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö Graceful Shutdown
     time.Sleep(3 * time.Second)
     return c.Status(fiber.StatusCreated).JSON(fiber.Map{"id": 1})
    })
    ```

- ‡∏£‡∏±‡∏ô server ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `/customers` ‚Üí ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î `Ctrl+C` ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà request ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡∏ö ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ server **‡∏£‡∏≠‡∏à‡∏ô‡∏à‡∏ö** ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞ shutdown

    ```go
    2025/05/29 12:00:07 Shutting down...
    12:00:06 | 201 |  3.001456625s |       127.0.0.1 | POST    | /api/v1/customers       
    2025/05/29 12:00:09 Shutdown complete.
    ```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Logger ‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πà‡∏ß‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ

‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ log ‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ **‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö log ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô** ‡∏à‡∏∂‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á **centralized logger** ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/logger/logger.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î logger ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô
‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `zap` ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö `ecszap` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á log ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Elastic Stack ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

    ```go
    package logger
    
    import (
     "go.elastic.co/ecszap"
     "go.uber.org/zap"
    )
    
    type closeLog func() error
    
    var Log *zap.Logger
    
    func Init() (closeLog, error) {
     config := zap.NewDevelopmentConfig()
     // ‡πÉ‡∏ä‡πâ zap ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö ecszap ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á log ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Elastic Stack ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
     config.EncoderConfig = ecszap.ECSCompatibleEncoderConfig(config.EncoderConfig)
    
     var err error
     Log, err = config.Build(ecszap.WrapCoreOption())
    
     if err != nil {
      return nil, err
     }
    
     return func() error {
      return Log.Sync()
     }, nil
    }
    
    func With(fields ...zap.Field) *zap.Logger {
     return Log.With(fields...)
    }
    ```

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy`
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô logger ‡∏à‡∏≤‡∏Å `main.go` ‡πÇ‡∏î‡∏¢‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ `init` ‡πÅ‡∏•‡∏∞ `defer` ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö `log.Sync()`

    ```go
    func main() {
     closeLog, err := logger.Init()
     if err != nil {
      panic(err.Error())
     }
     defer closeLog()
    
     // ...
    }
    ```

- ‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ `log.Println` ‡∏´‡∏£‡∏∑‡∏≠ `log.Fatal` ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ `logger.Log` ‡πÅ‡∏ó‡∏ô ‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ö context ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ `logger.With(...)`

    ```go
     func main() {
     // ...
     
     // ‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤ run server ‡πÉ‡∏ô goroutine
     go func() {
       if err := app.Listen(":8090"); err != nil && err != http.ErrServerClosed {
         logger.Log.Fatal(fmt.Sprintf("Error starting server: %v", err))
       }
     }()
     
     // ‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î
     stop := make(chan os.Signal, 1)
     signal.Notify(stop, os.Interrupt, syscall.SIGTERM)
     <-stop
     
     logger.Log.Info("Shutting down...")
     
     // ‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏±‡∏ö request ‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡πÉ‡∏´‡πâ request ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô timeout ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡πÄ‡∏ä‡πà‡∏ô 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
     ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
     defer cancel()
     if err := app.ShutdownWithContext(ctx); err != nil {
       logger.Log.Fatal(fmt.Sprintf("Error shutting down server: %v", err))
     }
     
     // Optionally: ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏õ‡∏¥‡∏î resource ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô DB connection, cleanup, etc.
    
     logger.Log.Info("Shutdown complete.")
    }
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏° middleware `RequestLogger` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ log ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô HTTP ‡πÄ‡∏ä‡πà‡∏ô method, path, status code ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á log error ‡πÅ‡∏•‡∏∞ stack trace ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î panic ‡∏´‡∏£‡∏∑‡∏≠ unhandled error

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `application/middleware/request_logger.go`
    >

    ```go
    package middleware
    
    import (
     "fmt"
     "go-mma/util/logger"
     "runtime/debug"
     "time"
    
     "github.com/gofiber/fiber/v3"
     "go.uber.org/zap"
    )
    
    func RequestLogger() fiber.Handler {
     return func(c fiber.Ctx) error {
      start := time.Now()
    
      log := logger.With(
       zap.String("requestId", c.GetRespHeader("X-Request-ID")),
       zap.String("method", c.Method()),
       zap.String("path", c.Path()),
      )
    
        // catch panic
      defer func() {
       if r := recover(); r != nil {
        printAccessLog(log, c.Method(), c.Path(), start, fiber.StatusInternalServerError, r)
        panic(r) // throw panic to recover middleware
       }
      }()
    
      err := c.Next()
    
      status := c.Response().StatusCode()
      if err != nil {
       switch e := err.(type) {
       case *fiber.Error:
        status = e.Code
       default: // case error
        status = fiber.StatusInternalServerError
       }
      }
    
      printAccessLog(log, c.Method(), c.Path(), start, status, err)
    
      return err
     }
    }
    
    func printAccessLog(log *zap.Logger, method string, uri string, start time.Time, status int, err any) {
     if err != nil {
      // log unhandle error
      log.Error("an error occurred",
       zap.Any("error", err),
       zap.ByteString("stack", debug.Stack()),
      )
     }
    
     msg := fmt.Sprintf("%d - %s %s", status, method, uri)
    
     log.Info(msg,
      zap.Int("status", status),
      zap.Duration("latency", time.Since(start)))
    }
    
    ```

- ‡πÉ‡∏ô `main.go` ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ middleware `RequestLogger` ‡πÅ‡∏ó‡∏ô log ‡πÄ‡∏î‡∏¥‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å request ‡∏ñ‡∏π‡∏Å log ‡∏î‡πâ‡∏ß‡∏¢ format ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±

    ```go
    // global middleware
    app.Use(cors.New())                 // CORS ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ OPTIONS request ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
    app.Use(requestid.New())            // ‡∏™‡∏£‡πâ‡∏≤‡∏á request id ‡πÉ‡∏ô request header ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ debug
    app.Use(recover.New())              // auto-recovers from panic (internal only)
    app.Use(middleware.RequestLogger()) // logs HTTP request
    ```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏≠‡∏á‡∏£‡∏±‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ log ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ debug ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Configurations

‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏Ç‡∏≠‡∏á HTTP Server ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (graceful shutdown) ‡∏ã‡∏∂‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏ï‡∏≤‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞ environment ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ build ‡πÉ‡∏´‡∏°‡πà

‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏∑‡∏≠ ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ú‡πà‡∏≤‡∏ô environment variables ‡πÑ‡∏î‡πâ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£ deploy ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ environment variables ‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏à‡∏∂‡∏á‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á utility ‡∏ä‡∏∑‡πà‡∏≠ `env` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å environment variables ‡∏û‡∏£‡πâ‡∏≠‡∏° fallback ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ default ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/env/env.go`

    ```go
    package env
    
    import (
      "os"
      "strconv"
      "time"
    )
    
    func Get(key string) string {
      v, ok := os.LookupEnv(key)
      if !ok {
        return ""
      }
      return v
    }
    
    func GetDefault(key string, defaultValue string) string {
      v, ok := os.LookupEnv(key)
      if !ok {
        return defaultValue
      }
      return v
    }
    
    func GetInt(key string) int {
      v, err := strconv.Atoi(Get(key))
      if err != nil {
        return 0
      }
      return v
    }
    
    func GetIntDefault(key string, defaultValue int) int {
      v, err := strconv.Atoi(Get(key))
      if err != nil {
        return defaultValue
      }
      return v
    }
    func GetFloat(key string) float64 {
      v, err := strconv.ParseFloat(Get(key), 64)
      if err != nil {
        return 0.0
      }
      return v
    }
    
    func GetFloatDefault(key string, defaultValue float64) float64 {
      v, err := strconv.ParseFloat(Get(key), 64)
      if err != nil {
        return defaultValue
      }
      return v
    }
    
    func GetBool(key string) bool {
      v := Get(key)
      switch v {
      case "true", "yes":
        return true
      case "false", "no":
        return false
      default:
        return false
      }
    }
    func GetBoolDefault(key string, defaultValue bool) bool {
      v := Get(key)
      switch v {
      case "true", "yes":
        return true
      case "false", "no":
        return false
      default:
        return defaultValue
      }
    }
    
    func GetDuration(key string) time.Duration {
      v := Get(key)
      if len(v) == 0 {
        return 0
      }
      d, err := time.ParseDuration(v)
      if err != nil {
        return 0
      }
      return d
    }
    
    func GetDurationDefault(key string, defaultValue time.Duration) time.Duration {
      v := Get(key)
      if len(v) == 0 {
        return defaultValue
      }
      d, err := time.ParseDuration(v)
      if err != nil {
        return defaultValue
      }
      return d
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `main.go` ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å environment ‡πÅ‡∏ó‡∏ô

    ```go
    func main() {
     // ...
     go func() {
       // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î env ‡∏°‡∏≤‡πÉ‡∏´‡πâ default 8090
      if err := app.Listen(fmt.Sprintf(":%d", env.GetIntDefault("HTTP_PORT", 8090))); err != nil && err != http.ErrServerClosed {
       // ...
      }
     }()
     // ...
     
     // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î env ‡∏°‡∏≤‡πÉ‡∏´‡πâ default 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
     ctx, cancel := context.WithTimeout(context.Background(), env.GetDurationDefault("GRACEFUL_TIMEOUT", 5*time.Second))
     // ...
    }
    ```

- ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ú‡πà‡∏≤‡∏ô environment variables

    ```bash
    HTTP_PORT=8091 GRACEFUL_TIMEOUT=10s go run main.go
    ```

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏à‡∏∂‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á package `config` ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å environment ‡∏ú‡πà‡∏≤‡∏ô `env` ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (validation) ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ HTTP_PORT ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `config/config.go`

    ```go
    package config
    
    import (
     "errors"
     "go-mma/util/env"
     "time"
    )
    
    var (
     ErrInvalidHTTPPort = errors.New("HTTP_PORT must be a positive integer")
     ErrGracefulTimeout = errors.New("GRACEFUL_TIMEOUT must be a positive duration")
    )
    
    // ‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    type Config struct {
     HTTPPort        int
     GracefulTimeout time.Duration
    }
    
    func Load() (*Config, error) {
     config := &Config{
      HTTPPort:        env.GetIntDefault("HTTP_PORT", 8090),
      GracefulTimeout: env.GetDurationDefault("GRACEFUL_TIMEOUT", 5*time.Second),
     }
     err := config.Validate()
     if err != nil {
      return nil, err
     }
     return config, err
    }
    
    func (c *Config) Validate() error {
     if c.HTTPPort <= 0 {
      return ErrInvalidHTTPPort
     }
     if c.GracefulTimeout <= 0 {
      return ErrGracefulTimeout
     }
    
     return nil
    }
    ```

- ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô `config` ‡πÉ‡∏ô `main.go`

    ```go
    func main() {
      // logger
     config, err := config.Load()
     if err != nil {
      panic(err.Error())
     }
     
      // ...
      
     go func() {
      if err := app.Listen(fmt.Sprintf(":%d", config.HTTPPort)); err != nil && err != http.ErrServerClosed {
        // ...
      }
     }()
     
     // ...
     
     ctx, cancel := context.WithTimeout(context.Background(), config.GracefulTimeout)
     
     // ...
    }
    ```

### ‡πÉ‡∏ä‡πâ Makefile ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î environment variables ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ‡∏à‡∏∂‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Makefile ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `.env` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ç‡∏ì‡∏∞‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°

    ```
    HTTP_PORT=8090
    GRACEFUL_TIMEOUT=5s
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `.gitignore` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå `.env` ‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ git

    ```
    *.env
    ```

    <aside>
    üí°

    ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á config ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå `.env` ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô `.env.example` ‡πÅ‡∏ó‡∏ô ‡πÅ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

    </aside>

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `Makefile` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°

    ```makefile
    include .env
    export
    
    .PHONY: run
    run:
     go run main.go
    ```

- ‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `make run`

    ```bash
    make run
    
        _______ __             
       / ____(_) /_  ___  _____
      / /_  / / __ \/ _ \/ ___/
     / __/ / / /_/ /  __/ /    
    /_/   /_/_.___/\___/_/          v3.0.0-beta.4
    --------------------------------------------------
    INFO Server started on:         http://127.0.0.1:8090 (bound on host 0.0.0.0 and port 8090)
    INFO Application name:          Go MMA v0.0.1
    INFO Total handlers count:      6
    INFO Prefork:                   Disabled
    INFO PID:                       31427
    INFO Total process count:       1
    ```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏à‡∏≤‡∏Å `.env` ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ã‡πâ‡∏≥

### Refactor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏î

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏Ç‡∏∂‡πâ‡∏ô ‡πÑ‡∏ü‡∏•‡πå `main.go` ‡∏°‡∏±‡∏Å‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏°‡∏µ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `main.go` ‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `cmd/api/main.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å entrypoint ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å business logic
- ‡∏õ‡∏£‡∏±‡∏ö `Makefile` ‡πÉ‡∏´‡πâ‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á `main.go`

    ```makefile
    include .env
    export
    
    .PHONY: run
    run:
     go run cmd/api/main.go
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `build/build.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á build version ‡πÅ‡∏•‡∏∞ build time

    ```go
    package build
    
    var (
     Version = "local-dev"
     Time    = "n/a"
    )
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `application/http.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á HTTP server, middleware ‡πÅ‡∏•‡∏∞ route registration

    ```go
    package application
    
    import (
     "context"
     "fmt"
     "go-mma/application/middleware"
     "go-mma/build"
     "go-mma/config"
     "go-mma/util/logger"
     "net/http"
     "time"
    
     "github.com/gofiber/fiber/v3"
     "github.com/gofiber/fiber/v3/middleware/cors"
     "github.com/gofiber/fiber/v3/middleware/recover"
     "github.com/gofiber/fiber/v3/middleware/requestid"
    )
    
    type HTTPServer interface {
     Start()
     Shutdown() error
     RegisterRoutes()
    }
    
    type httpServer struct {
     config config.Config
     app    *fiber.App
    }
    
    func newHTTPServer(config config.Config) HTTPServer {
     return &httpServer{
      config: config,
      app:    newFiber(),
     }
    }
    
    func newFiber() *fiber.App {
     app := fiber.New(fiber.Config{
      AppName: fmt.Sprintf("Go MMA version %s", build.Version),
     })
    
     // global middleware
      app.Use(cors.New())                 // CORS ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ OPTIONS request ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
     app.Use(requestid.New())            // ‡∏™‡∏£‡πâ‡∏≤‡∏á request id ‡πÉ‡∏ô request header ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ debug
     app.Use(recover.New())              // auto-recovers from panic (internal only)
     app.Use(middleware.RequestLogger()) // logs HTTP request
     
     app.Get("/", func(c fiber.Ctx) error {
      return c.JSON(map[string]string{"version": build.Version, "time": build.Time})
     })
    
     return app
    }
    
    func (s *httpServer) Start() {
     go func() {
      logger.Log.Info(fmt.Sprintf("Starting server on port %d", s.config.HTTPPort))
      if err := s.app.Listen(fmt.Sprintf(":%d", s.config.HTTPPort)); err != nil && err != http.ErrServerClosed {
       logger.Log.Fatal(fmt.Sprintf("Error starting server: %v", err))
      }
     }()
    }
    
    func (s *httpServer) Shutdown() error {
     ctx, cancel := context.WithTimeout(context.Background(), s.config.GracefulTimeout)
     defer cancel()
     return s.app.ShutdownWithContext(ctx)
    }
    
    func (s *httpServer) RegisterRoutes() {
     v1 := s.app.Group("/api/v1")
    
     customers := v1.Group("/customers")
     {
      customers.Post("", func(c fiber.Ctx) error {
       time.Sleep(3 * time.Second)
       return c.Status(fiber.StatusCreated).JSON(fiber.Map{"id": 1})
      })
     }
    
     orders := v1.Group("/orders")
     {
      orders.Post("", func(c fiber.Ctx) error {
       return c.Status(fiber.StatusCreated).JSON(fiber.Map{"id": 1})
      })
    
      orders.Delete("/:orderID", func(c fiber.Ctx) error {
       return c.SendStatus(fiber.StatusNoContent)
      })
     }
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `application/application.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ lifecycle ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ (‡πÄ‡∏ä‡πà‡∏ô start/shutdown)

    ```go
    package application
    
    import (
     "go-mma/config"
     "log"
    )
    
    type Application struct {
     config     config.Config
     httpServer HTTPServer
    }
    
    func New(config config.Config) *Application {
     return &Application{
      config:     config,
      httpServer: newHTTPServer(config),
     }
    }
    
    func (app *Application) Run() error {
     app.httpServer.Start()
    
     return nil
    }
    
    func (app *Application) Shutdown() error {
     // Gracefully close fiber server
     logger.Log.Info("Shutting down server")
     if err := app.httpServer.Shutdown(); err != nil {
      logger.Log.Fatal(fmt.Sprintf("Error shutting down server: %v", err))
     }
     logger.Log.Info("Server stopped")
    
     return nil
    }
    
    func (app *Application) RegisterRoutes() {
     app.httpServer.RegisterRoutes()
    }
    ```

- ‡∏õ‡∏£‡∏±‡∏ö `main.go` ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£ bootstrap ‡∏£‡∏∞‡∏ö‡∏ö ‡πÄ‡∏ä‡πà‡∏ô init logger, ‡πÇ‡∏´‡∏•‡∏î config, start app, handle graceful shutdown

    ```go
    package main
    
    import (
     "go-mma/application"
     "go-mma/config"
     "log"
     "os"
     "os/signal"
     "syscall"
    )
    
    func main() {
     // logger
     // config
    
     app := application.New(*config)
     app.RegisterRoutes()
     app.Run()
    
     // Wait for shutdown signal
     // stop
     
     app.Shutdown()
    
     // Optionally: close DB, cleanup, etc.
    
     logger.Log.Info("Shutdown complete.")
    }
    ```

‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô `main.go` ‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å Single Responsibility Principle

### ‡∏Å‡∏≤‡∏£ Build Web Server

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÅ‡∏≠‡∏õ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á (deploy) ‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤ Go ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ build ‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡πá‡∏ô binary ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡∏£‡∏±‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á

- ‡∏õ‡∏£‡∏±‡∏ö `Makefile` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á build

    ```bash
    # ...
    
    ROOT_DIR := $(dir $(realpath $(lastword $(MAKEFILE_LIST))))
    # ‡∏ñ‡πâ‡∏≤ BUILD_VERSION ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏ã‡πá‡∏ï‡πÉ‡∏ô .env, ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ git tag ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ tag ‡∏à‡∏∞ fallback ‡πÄ‡∏õ‡πá‡∏ô "unknown")
    BUILD_VERSION := $(or ${BUILD_VERSION}, $(shell git describe --tags --abbrev=0 2>/dev/null || echo "unknown"))
    BUILD_TIME := $(shell date +"%Y-%m-%dT%H:%M:%S%z")
    
    .PHONY: build
    build:
     go build -ldflags \
     "-X 'go-mma/build.Version=${BUILD_VERSION}' \
     -X 'go-mma/build.Time=${BUILD_TIME}'" \
     -o app cmd/api/main.go
    ```

- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á build ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î build version

    ```bash
    BUILD_VERSION=0.0.1 make build
    ```

‡∏≠‡∏µ‡∏Å‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ package ‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡πá‡∏ô Docker image ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö isolated ‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏° deploy

- ‡∏™‡∏£‡πâ‡∏≤‡∏á `Dockerfile`

    ```docker
    FROM golang:1.24-alpine AS base
    WORKDIR /app
    COPY go.mod go.sum ./
    RUN go mod download
    COPY . .
    
    FROM base AS builder
    ENV GOARCH=amd64
    
    # ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ default ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö VERSION
    ARG VERSION=latest
    ENV IMAGE_VERSION=${VERSION}
    RUN echo "Build version: $IMAGE_VERSION"
    RUN go build -ldflags \
     "-X 'go-mma/build.Version=${IMAGE_VERSION}' \
     -X 'go-mma/build.Time=$(date +"%Y-%m-%dT%H:%M:%S%z")'" \
     -o app cmd/api/main.go
    
    FROM alpine:latest
    WORKDIR /root/
    EXPOSE 8090
    ENV TZ=Asia/Bangkok
    RUN apk --no-cache add ca-certificates tzdata
    
    COPY --from=builder /app/app .
    
    CMD ["./app"]
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á `.dockerignore` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ exclude ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ build

    ```
    .git
    .env
    Dockerfile
    Makefile
    *.md
    ```

- ‡∏õ‡∏£‡∏±‡∏ö `Makefile` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á image

    ```bash
    # build:
    
    .PHONY: image
    image:
     docker build \
     -t go-mma:${BUILD_VERSION} \
     --build-arg VERSION=${BUILD_VERSION} \
     .
    ```

- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á build ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î build version

    ```bash
    BUILD_VERSION=0.0.1 make image
    ```

- ‡∏£‡∏±‡∏ô container ‡∏à‡∏≤‡∏Å image

    ```bash
    docker run --name go-mma --env-file .env -p 8090:8090 go-mma:0.0.1
    ```

---

## ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å logic ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å routing ‡∏î‡πâ‡∏ß‡∏¢ Handlers

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å concerns ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á routing ‡πÅ‡∏•‡∏∞ business logic ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á handler ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° feature

- `handler/customer.go` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
- `handler/order.go` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå

### Customer Handler

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á customer handler

```markdown
‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (POST /customers)
---------------------------------------
Client ----> Routing: POST /customers {email, credit}
Handler.customer --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö email ‡∏ã‡πâ‡∏≥?
  ‚îî‚îÄ ‡∏ã‡πâ‡∏≥ --> Handler.customer --> Client: 409 Conflict (email already exists)
  ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥:
      Handler.customer --> Database: INSERT INTO customers
      Module.email --> ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
      Handler.customer --> Client: 201 Created
```

‡∏™‡∏£‡πâ‡∏≤‡∏á customer handler

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `handler/customer.go`

    ```go
    package handler
    
    import (
     "fmt"
     "go-mma/util/logger"
     "net/mail"
    
     "github.com/gofiber/fiber/v3"
    )
    
    type CustomerHandler struct {
    }
    
    func NewCustomerHandler() *CustomerHandler {
     return &CustomerHandler{}
    }
    
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î payload structure (DTO: Request)
     type CreateCustomerRequest struct {
      Email  string `json:"email"`
      Credit int    `json:"credit"`
     }
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á error 400
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": err.Error()})
     }
    
     logger.Log.Info(fmt.Sprintf("Received customer: %v", req))
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if req.Email == "" {
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": "email is required"})
     }
     if _, err := mail.ParseAddress(req.Email); err != nil {
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": "email is invalid"})
     }
     if req.Credit <= 0 {
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": "credit must be greater than 0"})
     }
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // TODO: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö email ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     // if exists {
     //  return c.Status(fiber.StatusConflict).JSON(fiber.Map{"error": "email already exists"})
     // }
    
     // TODO: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     var id int64 // id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ (DTO: Response)
     type CreateCustomerResponse struct {
      ID int64 `json:"id"`
     }
     resp := &CreateCustomerResponse{ID: id}
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    ```

- ‡πÅ‡∏Å‡πâ `application/http.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ bind handler

    ```go
    customers := v1.Group("/customers")
    {
     hdl := handler.NewCustomerHandler()
     customers.Post("", hdl.CreateCustomer)
    }
    ```

### Order Handler

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á order handler

```markdown
‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (POST /orders)
-------------------------------
Client ----> Routing: POST /orders {customer_id, order_total}
Handler.order --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer_id
  ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏û‡∏ö --> Handler.order --> Client: 404 Not Found (customer not found)
  ‚îî‚îÄ ‡∏û‡∏ö:
      Handler.order --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö credit ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠?
          ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏û‡∏≠ --> Monolith.order --> Client: 422 Unprocessable Entity (insufficient credit)
          ‚îî‚îÄ ‡∏û‡∏≠:
              Handler.order --> Database: INSERT INTO orders, UPDATE credit (‡∏´‡∏±‡∏Å‡∏¢‡∏≠‡∏î)
              Module.email --> ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
              Handler.order --> Client: 201 Created

‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (DELETE /orders/:orderID)
---------------------------------------------
Client ----> Routing: DELETE /orders/:orderID
Handler.order --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö orderID
  ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏û‡∏ö --> Handler.order --> Client: 404 Not Found (order not found)
  ‚îî‚îÄ ‡∏û‡∏ö:
      Handler.order --> Database: DELETE order, UPDATE credit (‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î)
      Handler.order --> Client: 204 No Content
```

‡∏™‡∏£‡πâ‡∏≤‡∏á order handler

- ‡πÉ‡∏ô `handler/order.go`

    ```go
    package handler
    
    import (
     "fmt"
     "go-mma/util/logger"
     "strconv"
    
     "github.com/gofiber/fiber/v3"
    )
    
    type OrderHandler struct {
    }
    
    func NewOrderHandler() *OrderHandler {
     return &OrderHandler{}
    }
    
    func (h *OrderHandler) CreateOrder(c fiber.Ctx) error {
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î payload structure (DTO: Request)
     type CreateOrderRequest struct {
      CustomerID string `json:"customer_id"`
      OrderTotal int    `json:"order_total"`
     }
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req CreateOrderRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á error 400
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": err.Error()})
     }
    
     logger.Log.Info(fmt.Sprintf("Received Order: %v", req))
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if req.CustomerID == "" {
      return c.Status(fiber.StatusUnprocessableEntity).JSON(fiber.Map{"error": "customer_id is required"})
     }
     if req.OrderTotal <= 0 {
      return c.Status(fiber.StatusUnprocessableEntity).JSON(fiber.Map{"error": "order_total must be greater than 0"})
     }
    
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // TODO: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ customer id ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
     // customer := getCustomer(order.CustomerID)
     // if customer == nil {
     //  return return c.Status(fiber.StatusNotFound).JSON(fiber.Map{"error": "the customer with given id was not found"})
     // }
     
     // TODO: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö credit ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
     // if credit < payload.OrderTotal {
     //  return c.Status(fiber.StatusUnprocessableEntity).JSON(fiber.Map{"error": "insufficient credit"})
     // }
    
     // TODO: ‡∏´‡∏±‡∏Å‡∏¢‡∏≠‡∏î credit ‡∏Ç‡∏≠‡∏á customer
    
     // TODO: update customer's credit balance ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    
     // TODO: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     var id int64
    
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ (DTO: Response)
     type CreateOrderResponse struct {
      ID int6464 `json:"id"`
     }
     resp := &CreateOrderResponse{ID: id}
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    
    func (h *OrderHandler) CancelOrder(c fiber.Ctx) error {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á orderID
     orderID, err := strconv.Atoi(c.Params("orderID"))
     if err != nil {
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á error 400
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": "invalid order id"})
     }
    
     logger.Log.Info(fmt.Sprintf("Cancelling order: %v", orderID))
    
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // TODO: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö orderID ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     // order := getOrder(orderID)
     // if order == nil {
     //  return c.Status(fiber.StatusNotFound).JSON(fiber.Map{"error": "the order with given id was not found"})
     // }
    
     // TODO: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ customer ‡∏à‡∏≤‡∏Å customerID ‡∏Ç‡∏≠‡∏á order
     // customer := getCustomer(order.CustomerID)
     // if customer == nil {
     //  return return c.Status(fiber.StatusNotFound).JSON(fiber.Map{"error": "the customer with given id was not found"})
     // }
    
     // TODO: ‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit ‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏´‡πâ customer
     // creditLimit += CreateOrderRequest.OrderTotal
    
     // TODO: update customer's credit balance ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    
     // TODO: update ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á order ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô cancel
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 204 (no content)
     return c.SendStatus(fiber.StatusNoContent)
    }
    ```

- ‡πÅ‡∏Å‡πâ `application/http.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ bind handler

    ```go
    orders := v1.Group("/orders")
    {
     hdl := handler.NewOrderHandler()
     orders.Post("", hdl.CreateOrder)
     orders.Delete("/:orderID", hdl.CancelOrder)
    }
    ```

## ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô

‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏£‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á PostgreSQL ‡∏î‡πâ‡∏ß‡∏¢ Docker
- ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Schema ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Schema ‡∏î‡πâ‡∏ß‡∏¢ Migration Tool
- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Database Connection ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Gen ID
- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Database ‡∏î‡πâ‡∏ß‡∏¢ Dependency Injection
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Insert Customer)

### ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á PostgreSQL ‡∏î‡πâ‡∏ß‡∏¢ Docker

‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ PostgreSQL ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏î‡πâ‡∏ß‡∏¢ docker

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `docker-compose.yml` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á postgres service

    ```yaml
    services:
      db:
        image: postgres:17-alpine
        container_name: go-mma-db
        volumes:
          - pg_data:/var/lib/postgresql/data
    
    volumes:
      pg_data:
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `docker-compose.dev.yml` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î environtment ‡∏Ç‡∏≠‡∏á `dev`

    ```yaml
    services:
      db:
        environment:
          POSTGRES_DB: go-mma-db
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: postgres
        ports:
          - 5433:5432
    ```

    <aside>
    üí°

    ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö environtment ‡∏Ç‡∏≠‡∏á `test` ‡πÅ‡∏•‡∏∞ `production` ‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á

    </aside>

- ‡∏£‡∏±‡∏ô PostgreSQL Server ‡∏î‡πâ‡∏ß‡∏¢ `Makefile` ‡πÇ‡∏î‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

    ```bash
    # ...
    
    .PHONY: devup
    devup:
     docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d
    
    .PHONY: devdown
    devdown:
     docker compose -f docker-compose.yml -f docker-compose.dev.yml down
    ```

- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `make devup`

### ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Schema ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°

```sql
+------------------+           +------------------+
|   customers      |           |     orders       |
+------------------+           +------------------+
| id (PK)          |<--------+ | id (PK)          |
| email (UNIQUE)   |         | | customer_id (FK) |
| credit           |         | | order_total      |
| created_at       |         | | created_at       |
| updated_at       |         | | canceled_at       |
+------------------+         | +------------------+
                             |
      [1] ---------------- [*]
     1 customer      ‚Üí   many orders
```

### ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Schema ‡∏î‡πâ‡∏ß‡∏¢ Migration Tool

**Database Migration** ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏≤‡∏£‡∏≤‡∏á, ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå, ‡∏î‡∏±‡∏ä‡∏ô‡∏µ ‡∏Ø‡∏•‡∏Ø) ‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° (dev, staging, production) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏≤‡∏ö‡∏£‡∏∑‡πà‡∏ô

- ‡πÄ‡∏û‡∏¥‡πà‡∏° Environment Variable ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠

    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ `DB_DSN` ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `.env` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö connection string ‡∏Ç‡∏≠‡∏á PostgreSQL

    ```
    DB_DSN=postgres://postgres:postgres@localhost:5433/go-mma-db?sslmode=disable
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Migration ‡πÉ‡∏ô Makefile
‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `Makefile` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô migration ‡∏ú‡πà‡∏≤‡∏ô Docker

    ```makefile
    # ...
    
    .PHONY: mgc
    # Example: make mgc filename=create_customer
    mgc:
     docker run --rm -v $(ROOT_DIR)migrations:/migrations migrate/migrate -verbose create -ext sql -dir /migrations $(filename)
    
    .PHONY: mgu
    mgu:
     docker run --rm --network host -v $(ROOT_DIR)migrations:/migrations migrate/migrate -verbose -path=/migrations/ -database "$(DB_DSN)" up
    
    .PHONY: mgd
    mgd:
     docker run --rm --network host -v $(ROOT_DIR)migrations:/migrations migrate/migrate -verbose -path=/migrations/ -database $(DB_DSN) down 1
    ```

    <aside>
    üí°

    ‡∏´‡∏≤‡∏Å‡πÉ‡∏ä‡πâ Docker Desktop ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô host networking ‡πÇ‡∏î‡∏¢‡πÑ‡∏õ‡∏ó‡∏µ‡πà `Settings ‚Üí Resources ‚Üí Network` ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Enable host networking" ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î Apply & Restart

    </aside>

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Migration ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Customer
‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á migration ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á `customers`

    ```bash
    make mgc filename=create_customer
    ```

    ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå 2 ‡πÑ‡∏ü‡∏•‡πå

    ```bash
    ./migrations/20250529103238_create_customer.up.sql
    ./migrations/20250529103238_create_customer.down.sql
    ```

    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `create_customer.up.sql`

    ```sql
    CREATE TABLE public.customers (
     id BIGINT NOT NULL,
     email text NOT NULL,
     credit int4 NOT NULL,
     created_at timestamp DEFAULT CURRENT_TIMESTAMP NULL,
     updated_at timestamp DEFAULT CURRENT_TIMESTAMP NULL,
     CONSTRAINT customers_pkey PRIMARY KEY (id),
     CONSTRAINT customers_unique UNIQUE (email)
    );
    ```

    ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå `create_customer.down.sql`

    ```sql
    drop table public.customers;
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Migration ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Order
‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

    ```bash
    make mgc filename=create_order
    ```

    ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏ü‡∏•‡πå

    ```bash
    ./migrations/20250529103715_create_order.up.sql
    ./migrations/20250529103715_create_order.down.sql
    ```

    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `create_order.up.sql`

    ```sql
    CREATE TABLE public.orders (
     id BIGINT NOT NULL,
     customer_id BIGINT NOT NULL,
     order_total int4 NOT NULL,
     created_at timestamp DEFAULT CURRENT_TIMESTAMP NULL,
     canceled_at timestamp NULL,
     CONSTRAINT orders_pkey PRIMARY KEY (id),
     CONSTRAINT fk_customer FOREIGN KEY (customer_id) REFERENCES public.customers(id)
    );
    ```

    ‡πÅ‡∏•‡∏∞ `create_order.down.sql`

    ```sql
    drop table public.orders;
    ```

- ‡∏£‡∏±‡∏ô Migration ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

    ```bash
    make mgu
    ```

    ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô migration ‡πÄ‡∏ä‡πà‡∏ô

    ```bash
    2025/05/29 10:39:20 Start buffering 20250529103238/u create_customer
    2025/05/29 10:39:20 Start buffering 20250529103715/u create_order
    2025/05/29 10:39:20 Read and execute 20250529103238/u create_customer
    2025/05/29 10:39:20 Finished 20250529103238/u create_customer (read 906.667¬µs, ran 2.125583ms)
    2025/05/29 10:39:20 Read and execute 20250529103715/u create_order
    2025/05/29 10:39:20 Finished 20250529103715/u create_order (read 3.458625ms, ran 1.860583ms)
    2025/05/29 10:39:20 Finished after 7.190625ms
    2025/05/29 10:39:20 Closing source and database
    ```

### ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Database Connection ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤ API ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PostgreSQL ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å `DB_DSN` ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `config/config.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

    ```go
    package config
    
    import (
     "errors"
     "go-mma/util/env"
     "time"
    )
    
    var (
     ErrInvalidHTTPPort = errors.New("HTTP_PORT must be a positive integer")
     ErrGracefulTimeout = errors.New("GRACEFUL_TIMEOUT must be a positive duration")
     ErrDSN             = errors.New("DB_DSN must be set") // ‡πÄ‡∏û‡∏¥‡πà‡∏°
    )
    
    type Config struct {
     HTTPPort        int
     GracefulTimeout time.Duration
     DSN             string  // ‡πÄ‡∏û‡∏¥‡πà‡∏°
    }
    
    func Load() (*Config, error) {
     config := &Config{
      HTTPPort:        env.GetIntDefault("HTTP_PORT", 8090),
      GracefulTimeout: env.GetDurationDefault("GRACEFUL_TIMEOUT", 5*time.Second),
      DSN:             env.Get("DB_DSN"),  // ‡πÄ‡∏û‡∏¥‡πà‡∏°
     }
     err := config.Validate()
     if err != nil {
      return nil, err
     }
     return config, err
    }
    
    func (c *Config) Validate() error {
     if c.HTTPPort <= 0 {
      return ErrInvalidHTTPPort
     }
     if c.GracefulTimeout <= 0 {
      return ErrGracefulTimeout
     }
     // ‡πÄ‡∏û‡∏¥‡πà‡∏°
     if len(c.DSN) == 0 {
      return ErrDSN
     }
    
     return nil
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/storage/sqldb/sqldb.go` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PostgreSQL ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `sqlx`

    ```go
    package sqldb
    
    import (
     "github.com/jmoiron/sqlx"
     _ "github.com/lib/pq"
    )
    
    type closeDB func() error
    
    type DBContext interface {
     DB() *sqlx.DB
    }
    
    type dbContext struct {
     db *sqlx.DB
    }
    
    var _ DBContext = (*dbContext)(nil)
    
    func NewDBContext(dsn string) (DBContext, closeDB, error) {
     // this Pings the database trying to connect
     db, err := sqlx.Connect("postgres", dsn)
     if err != nil {
      return nil, nil, err
     }
     return &dbContext{db: db},
      func() error {
       return db.Close()
      },
      nil
    }
    
    func (c *dbContext) DB() *sqlx.DB {
     return c.db
    }
    ```

- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `go mod tidy` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á dependencies ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÑ‡∏ü‡∏•‡πå `application/application.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏¥‡∏ô‡∏™‡πÅ‡∏ï‡∏ô‡∏ã‡πå‡∏Ç‡∏≠‡∏á database connection

    ```go
    type Application struct {
     config     config.Config
     httpServer HTTPServer
     dbCtx      sqldb.DBContext
    }
    
    func New(config config.Config, dbCtx sqldb.DBContext) *Application {
     return &Application{
      config:     config,
      httpServer: newHTTPServer(config),
      dbCtx:         dbCtx,
     }
    }
    ```

- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô `cmd/api/main.go` ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô Application

    ```go
    func main() {
     // config
     
     dbCtx, closeDB, err := sqldb.NewDBContext(config.DSN)
     if err != nil {
      panic(err.Error())
     }
     defer func() { // ‡πÉ‡∏ä‡πà‡∏ó‡πà‡∏≤ IIFE ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á error ‡∏ñ‡πâ‡∏≤‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
      if err := closeDB(); err != nil {
       logger.Log.Error(fmt.Sprintf("Error closing database: %v", err))
      }
     }()
    
     app := application.New(*config, dbCtx)
     // ...
    }
    ```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Gen ID

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏´‡∏£‡∏∑‡∏≠ entity ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ) ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô ‡∏à‡∏∂‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ generate ID ‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô utility

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/idgen/idgen.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡πÄ‡∏ä‡πà‡∏ô
  - `GenerateTimeRandomID`: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏ö‡∏ö `int64` ‡πÇ‡∏î‡∏¢‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å timestamp (‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ)
  - `GenerateTimeID`: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç `int` ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
  - `GenerateTimeRandomIDBase36`: ‡πÅ‡∏õ‡∏•‡∏á ID ‡πÄ‡∏õ‡πá‡∏ô string ‡πÅ‡∏ö‡∏ö base36
  - `GenerateUUIDLikeID`: ‡∏™‡∏£‡πâ‡∏≤‡∏á string ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢ UUID

    ```go
    package idgen
    
    import (
     "fmt"
     "math/rand"
     "strconv"
     "strings"
     "time"
    )
    
    // GenerateTimeRandomID ‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡πÅ‡∏ö‡∏ö int64
    func GenerateTimeRandomID() int64 {
     timestamp := time.Now().UnixNano() >> 32
     randomPart := rand.Int63() & 0xFFFFFFFF
     return (timestamp << 32) | randomPart
    }
    
    // GenerateTimeID ‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡πÅ‡∏ö‡∏ö int (‡πÉ‡∏ä‡πâ timestamp ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å)
    func GenerateTimeID() int {
     // ‡πÉ‡∏ä‡πâ timestamp Unix ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (int64) ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô int (int32/64 ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö)
     return int(time.Now().Unix())
    }
    
    // GenerateTimeRandomIDBase36 ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ ID ‡πÄ‡∏õ‡πá‡∏ô base36 string
    func GenerateTimeRandomIDBase36() string {
     id := GenerateTimeRandomID()
     return strconv.FormatInt(id, 36) // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏•‡∏Ç‡∏ê‡∏≤‡∏ô 10 -> 36
    }
    
    // GenerateUUIDLikeID ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô string ‡πÅ‡∏ö‡∏ö UUID-like (‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà UUID ‡∏à‡∏£‡∏¥‡∏á)
    func GenerateUUIDLikeID() string {
     id := GenerateTimeRandomID()
    
     // ‡πÅ‡∏õ‡∏•‡∏á int64 ‡πÄ‡∏õ‡πá‡∏ô hex string ‡∏¢‡∏≤‡∏ß 16 ‡∏ï‡∏±‡∏ß (64 bit)
     hex := fmt.Sprintf("%016x", uint64(id))
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á UUID-like string ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö 8-4-4-4-12
     // ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡πÅ‡∏Ñ‡πà 16 hex chars ‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ: 8-4-4 (‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏à‡∏£‡∏¥‡∏á‡πÜ)
     // ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏° random ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö 32 hex (128 bit) ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô UUID
    
     randPart := fmt.Sprintf("%016x", rand.Uint64())
    
     uuidLike := strings.Join([]string{
      hex[0:8],
      hex[8:12],
      hex[12:16],
      randPart[0:4],
      randPart[4:16],
     }, "-")
    
     return uuidLike
    }
    
    // ‡∏Å‡πà‡∏≠‡∏ô Go 1.20 ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
    // func init() {
    //  rand.Seed(time.Now().UnixNano())
    // }
    ```

### ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Database ‡∏î‡πâ‡∏ß‡∏¢ Dependency Injection

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Dependency Injection (DI) ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á database connection ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á handler

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handlers/customer.go` ‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á `CustomerHandler` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö `DBContext` ‡∏ú‡πà‡∏≤‡∏ô constructor

    ```go
    type CustomerHandler struct {
     dbCtx sqldb.DBContext
    }
    
    func NewCustomerHandler(db sqldb.DBContext) *CustomerHandler {
     return &CustomerHandler{dbCtx: db}
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `application/http.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á `DBContext` ‡πÑ‡∏õ‡∏¢‡∏±‡∏á handler

    ```go
    type HTTPServer interface {
     Start()
     Shutdown() error
     RegisterRoutes(dbCtx sqldb.DBContext)
    }
    
    // ...
    
    func (s *httpServer) RegisterRoutes(dbCtx sqldb.DBContext) {
     v1 := s.app.Group("/api/v1")
    
     customers := v1.Group("/customers")
     {
      hdlr := handlers.NewCustomerHandler(dbCtx)
      customers.Post("", hdlr.CreateCustomer)
     }
    
     // orders
    }
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ò‡∏≠‡∏î `RegisterRoutes()` ‡πÉ‡∏ô `application/application.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á HTTP ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏á db context ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ

    ```go
    func (app *Application) RegisterRoutes() {
     app.httpServer.RegisterRoutes(app.db)
    }
    ```

### ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Insert Customer)

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô HTTP POST

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handlers/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á customers

    ```go
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î payload structure (DTO: Request)
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // Rule: email ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     query := "SELECT 1 FROM public.customers where email = $1 LIMIT 1"
     ctx, cancel := context.WithTimeout(c.Context(), 5*time.Second)
     defer cancel()
    
     var exists int
     if err := h.dbCtx.DB().QueryRowxContext(ctx, query, req.Email).Scan(&exists); err != nil {
      if err != sql.ErrNoRows {
       logger.Log.Error(fmt.Sprintf("error checking email: %v", err))
       return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"error": "an error occurred while checking email"})
      }
     }
     if exists == 1 {
      return c.Status(fiber.StatusConflict).JSON(fiber.Map{"error": "email already exists"})
     }
    
     // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     var id int64
     query = "INSERT INTO customers (id, email, credit) VALUES ($1, $2, $3) RETURNING id"
     ctxIns, cancelIns := context.WithTimeout(c.Context(), 10*time.Second)
     defer cancelIns()
     if err := h.dbCtx.DB().QueryRowxContext(ctxIns, query, idgen.GenerateTimeRandomID(), req.Email, req.Credit).Scan(&id); err != nil {
      logger.Log.Error(fmt.Sprintf("error insert customer: %v", err))
      return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"error": "an error occurred while inserting customer"})
     }
    
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ (DTO: Response)
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
    }
    
    ```

## ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Layered Architecture ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢

‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ API ‡∏´‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP request ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô handler ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö scale ‡πÑ‡∏î‡πâ‡∏¢‡∏≤‡∏Å ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏≥‡∏ö‡∏≤‡∏Å ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠ bug ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î

**‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Layered Architecture** ‡∏ã‡∏∂‡πà‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÅ‡∏•‡∏∞‡∏î‡∏π‡πÅ‡∏•‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢

‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢

- Layered Architecture ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£
- Repository Layer ‚Äì ‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- Service Layer ‚Äì ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à
- Presentation Layer ‚Äì ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP Request/Response
- ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

### Layered Architecture ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£

**Layered Architecture** ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏ä‡∏±‡πâ‡∏ô‚Äù ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‚Äù ‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, business logic ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP Request/Response ‡πÇ‡∏î‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

**‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Layered Architecture ‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ**

```
Client/UI Layer        ‚Üê ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö
‚Üì
Presentation Layer     ‚Üê Controller, API (‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ)
‚Üì ‚Üê DTO
Service Layer          ‚Üê Business Logic (‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à)
‚Üì ‚Üê Model
Repository/Data Layer  ‚Üê ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, external APIs
‚Üì
Database/External APIs
```

**‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏°‡∏≤ implement ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤**

```
project/
‚îÇ
‚îú‚îÄ‚îÄ handler/          ‚Üê Presentation Layer (HTTP handlers)
‚îú‚îÄ‚îÄ dto/              ‚Üê ‡∏£‡∏±‡∏ö/‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á handler ‚Üî service
‚îú‚îÄ‚îÄ service/          ‚Üê Business Logic (core logic)
‚îú‚îÄ‚îÄ model/            ‚Üê ‡πÉ‡∏ä‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö service ‚Üî repository
‚îú‚îÄ‚îÄ repository/       ‚Üê Data Access (DB queries)
‚îî‚îÄ‚îÄ main.go           ‚Üê Entry point (setup DI, server, etc)
```

### Repository Layer ‚Äì ‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

**Repository Layer** ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏´‡∏•‡πà‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÇ‡∏î‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å Service Layer ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà CRUD (Create, Read, Update, Delete) ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏î (Postgres, MySQL, Redis ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏°‡πâ‡πÅ‡∏ï‡πà API)

- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Model ‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏∑‡πà‡∏≠ `model/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

    ```go
    package model
    
    import (
     "go-mma/util/idgen"
     "time"
    )
    
    type Customer struct {
     ID          int64     `db:"id"` // tag db ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö StructScan() ‡∏Ç‡∏≠‡∏á sqlx
     Email       string    `db:"email"`
     Credit      int       `db:"credit"`
     CreatedAt   time.Time `db:"created_at"`
     UpdatedAt   time.Time `db:"updated_at"`
    }
    
    func NewCustomer(email string, credit int) *Customer {
     return &Customer{
      ID:     idgen.GenerateTimeRandomID(),
      Email:  email,
      Credit: credit,
     }
    }
    ```

    <aside>
    üí°

    ‡∏™‡∏£‡πâ‡∏≤‡∏á Model ‡πÅ‡∏ö‡∏ö [Rich Model](https://somprasongd.work/blog/architecture/anemic-vs-rich-model-ddd)

    </aside>

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Repository ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå `repository/customer.go`

    ```go
    package repository
    
    import (
     "context"
     "database/sql"
     "fmt"
     "go-mma/model"
     "go-mma/util/storage/sqldb"
     "time"
    )
    
    type CustomerRepository struct {
     dbCtx sqldb.DBContext // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô database ‡∏ú‡πà‡∏≤‡∏ô DBContext interface
    }
    
    func NewCustomerRepository(dbCtx sqldb.DBContext) *CustomerRepository {
     return &CustomerRepository{
      dbCtx: dbCtx, // inject DBContext instance into CustomerRepository
     }
    }
    
    func (r *CustomerRepository) Create(ctx context.Context, customer *model.Customer) error {
     query := `
     INSERT INTO public.customers (id, email, credit)
     VALUES ($1, $2, $3)
     RETURNING *
     `
    
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î timeout ‡∏Ç‡∏≠‡∏á query
     ctx, cancel := context.WithTimeout(ctx, 10*time.Second)
     defer cancel()
    
     err := r.dbCtx.DB().
      QueryRowxContext(ctx, query, customer.ID, customer.Email, customer.Credit).
      StructScan(customer) // ‡∏ô‡∏≥‡∏Ñ‡πà‡∏≤ created_at, updated_at ‡πÉ‡∏™‡πà‡πÉ‡∏ô struct customer
     if err != nil {
      return fmt.Errorf("an error occurred while inserting customer: %w", err)
     }
     return nil
    }
    
    func (r *CustomerRepository) ExistsByEmail(ctx context.Context, email string) (bool, error) {
     query := `SELECT 1 FROM public.customers WHERE email = $1 LIMIT 1`
    
     ctx, cancel := context.WithTimeout(ctx, 5*time.Second)
     defer cancel()
    
     var exists int
     err := r.dbCtx.DB().
      QueryRowxContext(ctx, query, email).
      Scan(&exists)
     if err != nil {
      if err == sql.ErrNoRows { // ‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ email ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß
       return false, nil
      }
      return false, fmt.Errorf("an error occurred while checking email: %w", err)
     }
     return true, nil // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà error ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏°‡∏µ email ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß
    }
    ```

    <aside>
    üí°

    ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `context.WithTimeout` ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠ external service

    </aside>

### Service Layer ‚Äì ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à

**Service Layer** ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Controller (‡∏´‡∏£‡∏∑‡∏≠ Handler) ‡∏Å‡∏±‡∏ö Repository

‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á Service Layer ‡∏Ñ‡∏∑‡∏≠ ‡∏£‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Business Logic ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- **‡∏£‡∏±‡∏ö DTO**: ‡∏£‡∏±‡∏ö DTO ‡∏à‡∏≤‡∏Å Handler ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
- **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° **"‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à"** (Business Logic/Semantic Validation) ‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- **‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•**: ‡πÅ‡∏õ‡∏•‡∏á DTO ‚Üí Model
- **‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Repository**: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ CRUD (Create, Read, Update, Delete) ‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
- **‡∏™‡πà‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå**: ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å Repository ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô DTO Response
- **‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error**: ‡πÅ‡∏™‡∏î‡∏á error log ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏´‡πâ Controller (‡∏´‡∏£‡∏∑‡∏≠ Handler) ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Service Layer**

- ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO (Data Transfer Object) ‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‚Äì‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ä‡∏±‡πâ‡∏ô Handler ‚Üî Service

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `dto/customer_request.go`

    ```go
    package dto
    
    type CreateCustomerRequest struct {
     Email  string `json:"email"`
     Credit int    `json:"credit"`
    }
    ```

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `dto/customer_response.go`

    ```go
    package dto
    
    type CreateCustomerResponse struct {
     ID int64 `json:"id"`
    }
    
    func NewCreateCustomerResponse(id int64) *CreateCustomerResponse {
     return &CreateCustomerResponse{ID: id}
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Service ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Business Logic ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `service/customer.go`

    ```go
    package service
    
    import (
     "context"
     "errors"
     "go-mma/dto"
     "go-mma/model"
     "go-mma/repository"
     "go-mma/util/logger"
    )
    
    var (
     ErrEmailExists = errors.New("email already exists")
    )
    
    type CustomerService struct {
     custRepo *repository.CustomerRepository
    }
    
    func NewCustomerService(custRepo *repository.CustomerRepository) *CustomerService {
     return &CustomerService{
      custRepo: custRepo,
     }
    }
    
    func (s *CustomerService) CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error) {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // Rule: email ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     exists, err := s.custRepo.ExistsByEmail(ctx, req.Email)
     if err != nil {
      // error logging
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     if exists {
      return nil, ErrEmailExists
     }
    
     // ‡πÅ‡∏õ‡∏•‡∏á DTO ‚Üí Model
     customer := model.NewCustomer(req.Email, req.Credit)
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Repository Layer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     if err := s.custRepo.Create(ctx, customer); err != nil {
      // error logging
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO Response
     resp := dto.NewCreateCustomerResponse(customer.ID)
    
     return resp, nil
    }
    ```

### Presentation Layer ‚Äì ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP Request/Response

**Presentation Layer (HTTP Handlers)** ‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ö‡∏ö Layered Architecture ‡πÇ‡∏î‡∏¢‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Client) ‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‚Äù ‡∏ú‡πà‡∏≤‡∏ô‡πÇ‡∏õ‡∏£‡πÇ‡∏ï‡∏Ñ‡∏≠‡∏• ‡πÄ‡∏ä‡πà‡∏ô HTTP ‡∏´‡∏£‡∏∑‡∏≠ WebSocket

‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á Presentation Layer (‡∏´‡∏£‡∏∑‡∏≠ HTTP Handler)

- **‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠:** ‡∏£‡∏±‡∏ö HTTP Request ‡∏à‡∏≤‡∏Å Client
- **‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:** ‡πÅ‡∏õ‡∏•‡∏á JSON ‚Üí DTO (‡πÉ‡∏ä‡πâ `BodyParser`, `Bind`, ‡∏´‡∏£‡∏∑‡∏≠ Unmarshal)
- **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á **"‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö"** ‡πÅ‡∏•‡∏∞ **"‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á"** ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ (Input/Syntax Validation) ‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á, ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•, ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- **‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Service:** ‡∏™‡πà‡∏á DTO ‡πÄ‡∏Ç‡πâ‡∏≤ Service Layer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
- **‡∏™‡πà‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å Service ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON Response ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏´‡πâ client
- **‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error**: ‡πÅ‡∏õ‡∏•‡∏á error ‡∏à‡∏≤‡∏Å Service ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô HTTP response code ‡πÄ‡∏ä‡πà‡∏ô `400`, `500`

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Presentation Layer (HTTP Handlers)**

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `dto/customer_request.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° validation ‡πÄ‡∏ä‡πà‡∏ô credit ‡∏ï‡πâ‡∏≠‡∏á ‚â• 0 ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ Service

    ```go
    package dto
    
    import (
     "errors"
     "net/mail"
    )
    
    // struct
    
    func (r *CreateCustomerRequest) Validate() error {
     var errs error
     if r.Email == "" {
      errs = errors.Join(errs, errors.New("email is required"))
     }
     if _, err := mail.ParseAddress(r.Email); err != nil {
      errs = errors.Join(errs, errors.New("email is invalid"))
     }
     if r.Credit <= 0 {
      errs = errors.Join(errs, errors.New("credit must be greater than 0"))
     }
     return errs
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á Presentation Layer

    ```go
    package handler
    
    import (
     "fmt"
     "go-mma/dto"
     "go-mma/service"
     "go-mma/util/logger"
    
     "github.com/gofiber/fiber/v3"
    )
    
    type CustomerHandler struct {
     custService *service.CustomerService
    }
    
    func NewCustomerHandler(custService *service.CustomerService) *CustomerHandler {
     return &CustomerHandler{
      custService: custService,
     }
    }
    
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req dto.CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á error 400
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": err.Error()})
     }
    
     logger.Log.Info(fmt.Sprintf("Received customer: %v", req))
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if err := req.Validate(); err != nil {
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": err.Error()})
     }
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     resp, err := h.custService.CreateCustomer(c.Context(), &req)
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      return c.Status(500).JSON(fiber.Map{"error": err.Error()})
     }
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    ```

### ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤‡πÅ‡∏¢‡∏Å‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ ‚Äú‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‚Äù ‡∏´‡∏£‡∏∑‡∏≠ ‚Äúwire‚Äù ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `application/http.go` ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Dependency Injection ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ

```go
func (s *httpServer) RegisterRoutes(db sqldb.DBContext) {
 v1 := s.app.Group("/api/v1")

 customers := v1.Group("/customers")
 {
   // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î dependency ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå
  repo := repository.NewCustomerRepository(dbCtx)
  // ‡∏™‡πà‡∏á instance ‡∏Ç‡∏≠‡∏á repository ‡πÄ‡∏Ç‡πâ‡∏≤ service
  svc := service.NewCustomerService(repo)
  // ‡∏™‡πà‡∏á service ‡πÄ‡∏Ç‡πâ‡∏≤ handler
  hdlr := handler.NewCustomerHandler(svc)
  // Register routes ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö HTTP server
  customers.Post("", hdlr.CreateCustomer)
 }

 // orders
}
```

## ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡πà‡∏≤‡∏¢

‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏£‡∏Å ‡πÄ‡∏£‡∏≤‡∏°‡∏±‡∏Å return error ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á client ‡∏î‡πâ‡∏ß‡∏¢ HTTP status code ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÄ‡∏ä‡πà‡∏ô `500 Internal Server Error` ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó error ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡∏ó‡∏≥‡πÉ‡∏´‡πâ client ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏¢‡∏Å‡πÅ‡∏¢‡∏∞‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£‡∏Ç‡∏∂‡πâ‡∏ô ‡πÄ‡∏ä‡πà‡∏ô input ‡∏ú‡∏¥‡∏î ‡∏´‡∏£‡∏∑‡∏≠ server ‡∏û‡∏±‡∏á

**‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏°‡∏≤‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏ö error handling ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á developer ‡πÅ‡∏•‡∏∞ client ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°**

- ‡∏ß‡∏≤‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô HTTP Status Code ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö
- ‡∏™‡∏£‡πâ‡∏≤‡∏á Custome Error
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏ô Repository Layer
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏ô Service Layer
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏ô Presentation Layer
- ‡∏™‡∏£‡πâ‡∏≤‡∏á ErrorHandler Middleware

### ‡∏ß‡∏≤‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô HTTP Status Code ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö

‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤ error ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏à‡∏∞ map ‡∏Å‡∏±‡∏ö status code ‡∏≠‡∏∞‡πÑ‡∏£

| ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
| --- | --- | --- | --- |
| Input Validation | 400 Bad Request | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö, ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ú‡∏¥‡∏î | ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å **Client-Side**
‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Handler / DTO |
| Authorization | 401 Unauthorized | ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà login / token ‡∏ú‡∏¥‡∏î | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Middleware |
|  | 403 Forbidden | login ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Middleware |
| Business Logic | 404 Not Found | ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Service |
|  | 409 Conflict | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô, ‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á ‡πÄ‡∏ä‡πà‡∏ô email ‡∏ã‡πâ‡∏≥, order ‡∏ñ‡∏π‡∏Å cancel ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Service |
|  | 422 Unprocessable Entity | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å ‡πÅ‡∏ï‡πà logic ‡∏ú‡∏¥‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏°‡πà‡∏û‡∏≠, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Service |
| Database | 500 Internal Server Error | ‡πÄ‡∏Å‡∏¥‡∏î database connection error | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Repository |
| Exception | 500 Internal Server Error | ‡πÄ‡∏Å‡∏¥‡∏î exception ‡∏´‡∏£‡∏∑‡∏≠ panic ‡πÉ‡∏ô server code | ‡πÄ‡∏Å‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà |

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Custome Error

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ error ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏±‡πâ‡∏ô ‡∏Å‡πá‡∏°‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á custome error ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/errs/types.go` ‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó error ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô

    ```go
    package errs
    
    type ErrorType string
    
    const (
     ErrInputValidation   ErrorType = "input_validation_error"   // Invalid input (e.g., missing fields, format issues)
     ErrAuthentication    ErrorType = "authentication_error"     // Wrong credentials, not logged in
     ErrAuthorization     ErrorType = "authorization_error"      // No permission to access resource
     ErrResourceNotFound  ErrorType = "resource_not_found"       // Entity does not exist
     ErrConflict          ErrorType = "conflict"                 // Conflict, already exists
     ErrBusinessRule      ErrorType = "business_rule_error"      // Business rule violation
     ErrDataIntegrity     ErrorType = "data_integrity_error"     // Foreign key, constraint violations
     ErrDatabaseFailure   ErrorType = "database_failure"         // Generic DB error
     ErrOperationFailed   ErrorType = "operation_failed"         // General failure case
     ErrServiceDependency ErrorType = "service_dependency_error" // External service unavailable
    )
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Custom Error ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/errs/errs.go`

    ```go
    package errs
    
    import "fmt"
    
    type AppError struct {
     Type    ErrorType `json:"type"`    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö client
     Message string    `json:"message"` // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö client
     Err     error     `json:"-"`       // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö log ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
    }
    
    func (e *AppError) Error() string {
     if e.Err != nil {
      return fmt.Sprintf("[%s] %s - %v", e.Type, e.Message, e.Err)
     }
     return fmt.Sprintf("[%s] %s", e.Type, e.Message)
    }
    
    // Unwrap allows for errors.Is and errors.As compatibility
    func (e *AppError) Unwrap() error {
     return e.Err
    }
    
    func New(errorType ErrorType, message string, err ...error) *AppError {
     var underlyingErr error
     if len(err) > 0 {
      underlyingErr = err[0]
     }
     return &AppError{
      Type:    errorType,
      Message: message,
      Err:     underlyingErr,
     }
    }
    
    // Helper functions for each error type
    func InputValidationError(message string, err ...error) *AppError {
     return New(ErrInputValidation, message, err...)
    }
    
    func AuthenticationError(message string, err ...error) *AppError {
     return New(ErrAuthentication, message, err...)
    }
    
    func NewAuthorizationError(message string, err ...error) *AppError {
     return New(ErrAuthorization, message, err...)
    }
    
    func ResourceNotFoundError(message string, err ...error) *AppError {
     return New(ErrResourceNotFound, message, err...)
    }
    
    func ConflictError(message string, err ...error) *AppError {
     return New(ErrConflict, message, err...)
    }
    
    func BusinessRuleError(message string, err ...error) *AppError {
     return New(ErrBusinessRule, message, err...)
    }
    
    func DataIntegrityError(message string, err ...error) *AppError {
     return New(ErrDataIntegrity, message, err...)
    }
    
    func DatabaseFailureError(message string, err ...error) *AppError {
     return New(ErrDatabaseFailure, message, err...)
    }
    
    func OperationFailedError(message string, err ...error) *AppError {
     return New(ErrOperationFailed, message, err...)
    }
    
    func ServiceDependencyError(message string, err ...error) *AppError {
     return New(ErrServiceDependency, message, err...)
    }
    ```

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏ô Repository Layer

‡πÉ‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡∏≠‡∏á repository ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PostgreSQL ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î error ‡πÑ‡∏î‡πâ ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- 23502: Not null violation ‚Üí **ErrDataIntegrity**
- 23503: Foreign key violation ‚Üí **ErrDataIntegrity**
- 23505: Unique constraint violation ‚Üí **ErrConflict**
- ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‚Üí **ErrDatabaseFailure**

‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ implement

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/errs/helpers.go` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢ Map error code ‡∏Å‡∏±‡∏ö error type

    ```go
    package errs
    
    import (
     "github.com/lib/pq"
    )
    
    // HandleDBError maps PostgreSQL errors to custom application errors
    func HandleDBError(err error) *AppError {
     if pgErr, ok := err.(*pq.Error); ok {
      switch pgErr.Code {
      case "23505": // Unique constraint violation
       return New(ErrConflict, "duplicate entry detected: "+pgErr.Message)
      case "23503": // Foreign key violation
       return New(ErrDataIntegrity, "foreign key constraint violation: "+pgErr.Message)
      case "23502": // Not null violation
       return New(ErrDataIntegrity, "not null constraint violation: "+pgErr.Message)
      default:
       return New(ErrDatabaseFailure, "database error: "+pgErr.Message)
      }
     }
     // Fallback for unknown DB errors
     return New(ErrDatabaseFailure, err.Error())
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå `repository/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô `HandleDBError`

    ```go
    func (r *CustomerRepository) Create(ctx context.Context, customer *model.Customer) error {
     // ...
     if err != nil {
       // ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      return errs.HandleDBError(fmt.Errorf("an error occurred while inserting customer: %w", err))
     }
     return nil // Return nil if the operation is successful
    }
    
    func (r *CustomerRepository) ExistsByEmail(ctx context.Context, email string) (bool, error) {
     // ...
     if err != nil {
      if err == sql.ErrNoRows {
       return false, nil
      }
      // ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      return false, errs.HandleDBError(fmt.Errorf("an error occurred while checking email: %w", err))
     }
     return true, nil
    }
    ```

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏ô Service Layer

Service layer ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤ error ‡πÑ‡∏´‡∏ô‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏π‡∏Å‡∏´‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢ custom error ‡∏≠‡∏∞‡πÑ‡∏£

‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô error ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å repository layer ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏Å‡∏•‡∏±‡∏ö error ‡∏ô‡∏±‡πâ‡∏ô‡πÜ ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß

‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `service/customer.go` ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà error ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à business logic ‡∏´‡πâ‡∏≤‡∏°‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ã‡πâ‡∏≥‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

```go
var (
 ErrEmailExists = errs.ConflictError("email already exists")
)
```

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏ô Presentation Layer

‡πÉ‡∏ô handler ‡∏à‡∏∞‡∏°‡∏µ error ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- **‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á JSON ‚Üí DTO**: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ AppError
- **‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö DTO**: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ AppError
- **Error ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≤‡∏à‡∏≤‡∏Å Service Layer**: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢

‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ implement

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ `AppError`

    ```go
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req dto.CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á error 400
      errResp := errs.InputValidationError(err.Error()) // <-- ‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô AppError
      return c.Status(fiber.StatusBadRequest).JSON(errResp)
     }
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if err := req.Validate(); err != nil {
      errResp := errs.InputValidationError(err.Error()) // <-- ‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô AppError
      return c.Status(fiber.StatusBadRequest).JSON(errResp)
     }
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
    }
    ```

- ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ status code ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å AppError ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á helper function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ñ‡∏≠‡∏î status code ‡∏°‡∏≤ ‡πÇ‡∏î‡∏¢‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `util/errs/helpers.go` ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ

    ```go
    // GetErrorType extracts the error type from an errorAdd commentMore actions
    func GetErrorType(err error) ErrorType {
     var appErr *AppError
     if errors.As(err, &appErr) {
      return appErr.Type
     }
     return ErrOperationFailed // Default error type if not recognized
    }
    
    // Map error type to HTTP status code
    func GetHTTPStatus(err error) int {
     switch GetErrorType(err) {
     case ErrInputValidation:
      return fiber.StatusBadRequest // 400
     case ErrAuthentication:
      return fiber.StatusUnauthorized // 401
     case ErrAuthorization:
      return fiber.StatusForbidden // 403
     case ErrResourceNotFound:
      return fiber.StatusNotFound // 404
     case ErrConflict:
      return fiber.StatusConflict // 409
     case ErrBusinessRule:
      return fiber.StatusUnprocessableEntity // 422
     case ErrDataIntegrity, ErrDatabaseFailure:
      return fiber.StatusInternalServerError // 500
     case ErrOperationFailed:
      return fiber.StatusInternalServerError // 500
     case ErrServiceDependency:
      return fiber.StatusServiceUnavailable // 503
     default: // Default: Unknown errors, fallback to internal server error
      return fiber.StatusInternalServerError // 500
     }
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ status code ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

    ```go
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req dto.CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á error 400
      errResp := errs.InputValidationError(err.Error())
      return c.Status(
       errs.GetHTTPStatus(errResp), // <-- ‡∏î‡∏∂‡∏á status code ‡∏à‡∏≤‡∏Å AppError
      ).JSON(errResp)
     }
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if err := req.Validate(); err != nil {
      errResp := errs.InputValidationError(err.Error())
      return c.Status(
       errs.GetHTTPStatus(errResp), // <-- ‡∏î‡∏∂‡∏á status code ‡∏à‡∏≤‡∏Å AppError
      ).JSON(errResp)
     }
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Standard Error Response ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á error response ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/response/response.go`

    ```go
    package response
    
    import (
     "errors"
     "go-mma/util/errs"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func JSONError(c fiber.Ctx, err error) error {
     // Convert non-AppError to AppError with type ErrOperationFailed
     appErr, ok := err.(*errs.AppError)
     if !ok {
      appErr = errs.New(
       errs.ErrOperationFailed,
       err.Error(),
       err,
      )
     }
    
     // Get the appropriate HTTP status code
     statusCode := errs.GetHTTPStatus(err)
     
     // Retrieve the custom status code if it's a *fiber.Error
     var e *fiber.Error
     if errors.As(err, &e) {
      statusCode = e.Code
     }
    
     // Return structured response with error type and message
     return c.Status(statusCode).JSON(appErr)
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `JSONError`

    ```go
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // 1. ‡∏£‡∏±‡∏ö request body ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô DTO
     var req dto.CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      return response.JSONError(c, errs.InputValidationError(err.Error()))
     }
    
     // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (validate)
     if err := req.Validate(); err != nil {
      return response.JSONError(c, errs.InputValidationError(strings.Join(strings.Split(err.Error(), "\n"), ", ")))
     }
    
     // 3. ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     resp, err := h.custService.CreateCustomer(c.Context(), &req)
    
     // 4. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      return response.JSONError(c, err)
     }
    
     // 5. ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö client
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    ```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Middleware ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö Error

‡∏≠‡∏µ‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö error ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `response.JSONError` ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ ‡∏ó‡∏µ‡πà ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î error ‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô handler ‡∏Ñ‡∏∑‡∏≠ ‡πÉ‡∏´‡πâ `return error` ‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á middleware ‡πÉ‡∏´‡∏°‡πà ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ó‡∏ô ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `application/middleware/response_error.go`

    ```go
    package middleware
    
    import (
     "errors"
     "go-mma/util/errs"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func ResponseError() fiber.Handler {
     return func(c fiber.Ctx) error {
      err := c.Next()
      if err == nil {
       return nil
      }
    
      return jsonError(c, err)
     }
    }
    
    // ‡∏¢‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å util/response ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÅ‡∏ó‡∏ô ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏ô‡∏µ‡πâ
    func jsonError(c fiber.Ctx, err error) error {
     // Convert non-AppError to AppError with type ErrOperationFailed
     appErr, ok := err.(*errs.AppError)
     if !ok {
      appErr = errs.New(
       errs.ErrOperationFailed,
       err.Error(),
       err,
      )
     }
    
     // Get the appropriate HTTP status code
     statusCode := errs.GetHTTPStatus(err)
    
     // Retrieve the custom status code if it's a *fiber.Error
     var e *fiber.Error
     if errors.As(err, &e) {
      statusCode = e.Code
     }
    
     // Return structured response with error type and message
     return c.Status(statusCode).JSON(appErr)
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `application/http.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ middleware `ResponseError`

    ```go
    func newFiber() *fiber.App {
     app := fiber.New(fiber.Config{
      AppName: fmt.Sprintf("Go MMA version %s", build.Version),
     })
    
     // global middleware
     app.Use(cors.New())                 // CORS ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ OPTIONS request ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
     app.Use(requestid.New())            // ‡∏™‡∏£‡πâ‡∏≤‡∏á request id ‡πÉ‡∏ô request header ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ debug
     app.Use(recover.New())              // auto-recovers from panic (internal only)
     app.Use(middleware.RequestLogger()) // logs HTTP request
     app.Use(middleware.ResponseError()) // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    
     app.Get("/", func(c fiber.Ctx) error {
      return c.JSON(map[string]string{"version": build.Version, "time": build.Time})
     })
    
     return app
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡πÉ‡∏´‡πâ `return errror` ‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÉ‡∏´‡πâ middleware ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£

    ```go
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req dto.CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      // <-- return error ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
      return errs.InputValidationError(err.Error())
     }
    
     logger.Log.Info(fmt.Sprintf("Received customer: %v", req))
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if err := req.Validate(); err != nil {
      // <-- return error ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
      return errs.InputValidationError(err.Error())
     }
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     resp, err := h.custService.CreateCustomer(c.Context(), &req)
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      // <-- return error ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
      return err
     }
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    ```

## ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏ö‡∏ö Reusable ‡∏î‡πâ‡∏ß‡∏¢ Notification Service

‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå **‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö** ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏•‡∏∞‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏• ‡πÄ‡∏£‡∏≤‡∏à‡∏∞ **‡πÅ‡∏¢‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Service ‡πÄ‡∏â‡∏û‡∏≤‡∏∞** ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ `NotificationService` ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏™‡∏£‡πâ‡∏≤‡∏á NotificationService ‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á service ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `service/notification.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

    ```go
    package service
    
    import (
     "fmt"
     "go-mma/util/logger"
    )
    
    type NotificationService struct {
    }
    
    func NewNotificationService() *NotificationService {
     return &NotificationService{}
    }
    
    func (s *NotificationService) SendEmail(to string, subject string, payload map[string]any) error {
     // implement email sending logic here
     logger.Log.Info(fmt.Sprintf("Sending email to %s with subject: %s and payload: %v", to, subject, payload))
     return nil
    }
    
    ```

- Inject NotificationService ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô CustomerService
‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `CustomerService` ‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå `service/customer.go` ‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `NotificationService` ‡πÑ‡∏î‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà

    ```go
    package service
    
    // ...
    
    type CustomerService struct {
     custRepo *repository.CustomerRepository
     notiSvc  *NotificationService // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    }
    
    func NewCustomerService(custRepo *repository.CustomerRepository, 
     notiSvc *NotificationService, // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     ) *CustomerService {
     return &CustomerService{
      custRepo: custRepo,
      notiSvc:  notiSvc, // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     }
    }
    
    func (s *CustomerService) CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error) {
     // Rule: email ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     // ‡πÅ‡∏õ‡∏•‡∏á DTO ‚Üí Model
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Repository Layer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    
      // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö 
     if err := s.notiSvc.SendEmail(customer.Email, "Welcome to our service!", map[string]any{
      "message": "Thank you for joining us! We are excited to have you as a member.",
     }); err != nil {
      // error logging
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO Response
    }
    ```

- Wiring Dependencies ‡πÉ‡∏ô Layer ‡∏Ç‡∏≠‡∏á Application
‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå `application/http.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ dependency injection ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö `NotificationService` ‡πÅ‡∏•‡∏∞ `CustomerService` ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ

    ```go
    func (s *httpServer) RegisterRoutes(db sqldb.DBContext) {
     v1 := s.app.Group("/api/v1")
    
     customers := v1.Group("/customers")
     {
      repo := repository.NewCustomerRepository(db)
      svcNoti := service.NewNotificationService()      // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      svc := service.NewCustomerService(repo, svcNoti) // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      hdlr := handler.NewCustomerHandler(svc)
      customers.Post("", hdlr.CreateCustomer)
     }
     // orders
    }
    ```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å notification logic ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô service ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ

- Code **‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö (separation of concerns)** ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥‡πÉ‡∏ô module ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏ä‡πà‡∏ô order
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å log ‚Üí SMTP ‚Üí SendGrid ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö business logic

## ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏î‡πâ‡∏ß‡∏¢ Layered Architecture

‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ö‡∏ö Layered Architecture ‡∏ã‡∏∂‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

### Repository Layer

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏• `Order` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÅ‡∏•‡∏∞‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `model/order.go`
    >

    ```go
    package model
    
    import (
     "go-mma/util/idgen"
     "time"
    )
    
    type Order struct {
     ID         int64      `db:"id"`
     CustomerID int64      `db:"customer_id"`
     OrderTotal int        `db:"order_total"`
     CreatedAt  time.Time  `db:"created_at"`
     CanceledAt *time.Time `db:"canceled_at"` // nullable
    }
    
    func NewOrder(customerID int64, orderTotal int) *Order {
     return &Order{
      ID:     idgen.GenerateTimeRandomID(),
      CustomerID: customerID,
      OrderTotal: orderTotal,
     }
    }
    ```

- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏• `Customer` ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ credit ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î (`ReserveCredit`) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î (`ReleaseCredit`) ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á ([Rich Model](https://somprasongd.work/blog/architecture/anemic-vs-rich-model))

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `model/customer.go`
    >

    ```go
    func (c *Customer) ReserveCredit(v int) error {
     newCredit := c.Credit - v
     if newCredit < 0 { // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤ credit ‡πÑ‡∏°‡πà‡∏û‡∏≠
      return errs.BusinessRuleError("insufficient credit limit")
     }
     c.Credit = newCredit
     return nil
    }
    
    func (c *Customer) ReleaseCredit(v int) {
     if c.Credit <= 0 { // reset ‡∏¢‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏•‡∏ö
      c.Credit = 0
     }
     c.Credit = c.Credit + v
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á `OrderRepository` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SQL ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÅ‡∏•‡∏∞‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `repository/order.go`
    >

    ```go
    package repository
    
    import (
     "context"
     "database/sql"
     "fmt"
     "go-mma/model"
     "go-mma/util/errs"
     "go-mma/util/storage/sqldb"
     "time"
    )
    
    type OrderRepository struct {
     dbCtx sqldb.DBContext
    }
    
    func NewOrderRepository(dbCtx sqldb.DBContext) *OrderRepository {
     return &OrderRepository{
      dbCtx: dbCtx,
     }
    }
    
    func (r *OrderRepository) Create(ctx context.Context, m *model.Order) error {
     query := `
     INSERT INTO public.orders (
       id, customer_id, order_total
     )
     VALUES ($1, $2, $3)
     RETURNING *
     `
    
     ctx, cancel := context.WithTimeout(ctx, 5*time.Second)
     defer cancel()
    
     err := r.dbCtx.DB().QueryRowxContext(ctx, query, m.ID, m.CustomerID, m.OrderTotal).StructScan(m)
     if err != nil {
      return errs.HandleDBError(fmt.Errorf("an error occurred while inserting an order: %w", err))
     }
     return nil
    }
    
    func (r *OrderRepository) FindByID(ctx context.Context, id int64) (*model.Order, error) {
     query := `
     SELECT *
     FROM public.orders
     WHERE id = $1
     AND canceled_at IS NULL -- ‡∏£‡∏≤‡∏¢‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
    `
     ctx, cancel := context.WithTimeout(ctx, 5*time.Second)
     defer cancel()
    
     var order model.Order
     err := r.dbCtx.DB().QueryRowxContext(ctx, query, id).StructScan(&order)
     if err != nil {
      if err == sql.ErrNoRows {
       return nil, nil
      }
      return nil, errs.HandleDBError(fmt.Errorf("an error occurred while finding a order by id: %w", err))
     }
     return &order, nil
    }
    
    func (r *OrderRepository) Cancel(ctx context.Context, id int64) error {
     query := `
     UPDATE public.orders
     SET canceled_at = current_timestamp -- soft delete record
     WHERE id = $1
    `
     ctx, cancel := context.WithTimeout(ctx, 5*time.Second)
     defer cancel()
     _, err := r.dbCtx.DB().ExecContext(ctx, query, id)
     if err != nil {
      return errs.HandleDBError(fmt.Errorf("failed to cancel order: %w", err))
     }
     return nil
    }
    ```

- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö `CustomerRepository` ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `FindByID` ‡πÅ‡∏•‡∏∞ `UpdateCredit` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `repository/customer.go`
    >

    ```go
    func (r *CustomerRepository) FindByID(ctx context.Context, id int64) (*model.Customer, error) {
     query := `
     SELECT *
     FROM public.customers
     WHERE id = $1
    `
     ctx, cancel := context.WithTimeout(ctx, 20*time.Second)
     defer cancel()
    
     var customer model.Customer
     err := r.dbCtx.DB().QueryRowxContext(ctx, query, id).StructScan(&customer)
     if err != nil {
      if err == sql.ErrNoRows {
       return nil, nil
      }
      return nil, errs.HandleDBError(fmt.Errorf("an error occurred while finding customer by id: %w", err))
     }
    
     return &customer, nil
    }
    
    func (r *CustomerRepository) UpdateCredit(ctx context.Context, m *model.Customer) error {
     query := `
     UPDATE public.customers
     SET credit = $2
     WHERE id = $1
     RETURNING *
    `
     ctx, cancel := context.WithTimeout(ctx, 20*time.Second)
     defer cancel()
    
     err := r.dbCtx.DB().QueryRowxContext(ctx, query, m.ID, m.Credit).StructScan(m)
     if err != nil {
      return errs.HandleDBError(fmt.Errorf("an error occurred while updating customer credit: %w", err))
     }
     return nil
    }
    ```

### Service Layer

- ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å‡∏ù‡∏±‡πà‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `Validate` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `dto/order_request.go`
    >

    ```go
    package dto
    
    import "fmt"
    
    type CreateOrderRequest struct {
     CustomerID int64 `json:"customer_id"`
     OrderTotal int   `json:"order_total"`
    }
    
    func (r *CreateOrderRequest) Validate() error {
     if r.CustomerID <= 0 {
      return fmt.Errorf("customer_id is required")
     }
     if r.OrderTotal <= 0 {
      return fmt.Errorf("order_total must be greater than 0")
     }
     return nil
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á response ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `dto/order_response.go`
    >

    ```go
    package dto
    
    type CreateOrderResponse struct {
     ID int64 `json:"id"`
    }
    
    func NewCreateOrderResponse(id int64) *CreateOrderResponse {
     return &CreateOrderResponse{ID: id}
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á `OrderService` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏° business logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö credit ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î
  - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏¢‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  - ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
  - ‡∏´‡∏≤‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `service/order.go`
    >

    ```go
    package service
    
    import (
     "context"
     "go-mma/dto"
     "go-mma/model"
     "go-mma/repository"
     "go-mma/util/errs"
     "go-mma/util/logger"
    )
    
    var (
     ErrNoCustomerID    = errs.ResourceNotFoundError("the customer with given id was not found")
     ErrNoOrderID       = errs.ResourceNotFoundError("the order with given id was not found")
    )
    
    type OrderService struct {
     custRepo  *repository.CustomerRepository
     orderRepo *repository.OrderRepository
     notiSvc   *NotificationService
    }
    
    func NewOrderService(custRepo *repository.CustomerRepository, orderRepo *repository.OrderRepository, notiSvc *NotificationService) *OrderService {
     return &OrderService{
      custRepo:  custRepo,
      orderRepo: orderRepo,
      notiSvc:   notiSvc,
     }
    }
    
    func (s *OrderService) CreateOrder(ctx context.Context, req *dto.CreateOrderRequest) (*dto.CreateOrderResponse, error) {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // Business Logic: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     customer, err := s.custRepo.FindByID(ctx, req.CustomerID)
     if err != nil {
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     if customer == nil {
      return nil, ErrNoCustomerID
     }
    
     // Business Logic: ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÉ‡∏´‡πâ error
     if err := customer.ReserveCredit(req.OrderTotal); err != nil {
      return nil, err
     }
    
     // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á customer
     if err := s.custRepo.UpdateCredit(ctx, customer); err != nil {
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á order ‡πÉ‡∏´‡∏°‡πà DTO -> Model
     order := model.NewOrder(req.CustomerID, req.OrderTotal)
     
     // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     err = s.orderRepo.Create(ctx, order)
     if err != nil {
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
     err = s.notiSvc.SendEmail(customer.Email, "Order Created", map[string]any{
      "order_id": order.ID,
      "total":    order.OrderTotal,
     })
     if err != nil {
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO Response
     resp := dto.NewCreateOrderResponse(order.ID)
     return resp, nil
    }
    
    func (s *OrderService) CancelOrder(ctx context.Context, id int64) error {
     // Business Logic: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö order id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     order, err := s.orderRepo.FindByID(ctx, id)
     if err != nil {
      logger.Log.Error(err.Error())
      return err
     }
    
     if order == nil {
      return ErrNoOrderID
     }
    
     // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å order
     if err := s.orderRepo.Cancel(ctx, order.ID); err != nil {
      logger.Log.Error(err.Error())
      return err
     }
    
     // Business Logic: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer id
     customer, err := s.custRepo.FindByID(ctx, order.CustomerID)
     if err != nil {
      logger.Log.Error(err.Error())
      return err
     }
    
     if customer == nil {
      return ErrNoCustomerID
     }
    
     // Business Logic: ‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit
     customer.ReleaseCredit(order.OrderTotal)
    
     // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit
     if err := s.custRepo.UpdateCredit(ctx, customer); err != nil {
      logger.Log.Error(err.Error())
      return err
     }
    
     return nil
    }
    ```

### Presentation Layer

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Handler
‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `handler/order.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠ HTTP ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Service Layer ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ response/error ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°

    ```go
    package handler
    
    import (
     "fmt"
     "go-mma/dto"
     "go-mma/service"
     "go-mma/util/errs"
     "go-mma/util/logger"
     "strconv"
    
     "github.com/gofiber/fiber/v3"
    )
    
    type OrderHandler struct {
     orderSvc *service.OrderService
    }
    
    func NewOrderHandler(orderSvc *service.OrderService) *OrderHandler {
     return &OrderHandler{orderSvc: orderSvc}
    }
    
    func (h *OrderHandler) CreateOrder(c fiber.Ctx) error {
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> struct
     var req dto.CreateOrderRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return errs.InputValidationError(err.Error())
     }
    
     logger.Log.Info(fmt.Sprintf("Received Order: %v", req))
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if err := req.Validate(); err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return errs.InputValidationError(err.Error())
     }
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     resp, err := h.orderSvc.CreateOrder(c.Context(), &req)
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return err
     }
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    
    func (h *OrderHandler) CancelOrder(c fiber.Ctx) error {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö orderID
     orderID, err := strconv.Atoi(c.Params("orderID"))
     if err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return errs.InputValidationError("invalid order id")
     }
    
     logger.Log.Info(fmt.Sprintf("Cancelling order: %v", orderID))
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     err = h.orderSvc.CancelOrder(c.Context(), int64(orderID))
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return err
     }
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 204 (no content)
     return c.SendStatus(fiber.StatusNoContent)
    }
    ```

### ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡πà‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ Dependency Injection

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `application/http.go`

    ```go
    func (s *httpServer) RegisterRoutes(db sqldb.DBContext) {
     v1 := s.app.Group("/api/v1")
    
     // customers
    
     orders := v1.Group("/orders")
     {
      repoCust := repository.NewCustomerRepository(dbCtx)
      repoOrder := repository.NewOrderRepository(dbCtx)
      svcNoti := service.NewNotificationService()
      svcOrder := service.NewOrderService(repoCust, repoOrder, svcNoti)
      hdlr := handler.NewOrderHandler(svcOrder)
      orders.Post("", hdlr.CreateOrder)
      orders.Delete("/:orderID", hdlr.CancelOrder)
     }
    }
    ```

## ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Database Transaction ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô repository ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÄ‡∏ä‡πà‡∏ô

1. ‡∏´‡∏±‡∏Å‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (order)

‡∏´‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏£‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡∏Å‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏°‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô

```go
+------------------+        +-------------------+        +------------------+
| OrderService     |        | CustomerRepo      |        | OrderRepo        |
|------------------|        |-------------------|        |------------------|
| CreateOrder()    |        | FindCustomerByID()|        | SaveOrder()      |
|                  |        | ReserveCredit()   |        |                  |
+--------+---------+        +--------+----------+        +--------+---------+
         |                           |                            |
         | Find Customer By ID       |                            |
         +-------------------------> |                            |
         |                           |                            |
         |     Reserve Credit        |                            |
         +-------------------------> |                            |
         |                           |                            |
         |   Save Order              |                            |
         +------------------------------------------------------->|
         |                           |                            |
         |   ‚ùå FAIL (DB Error)      |                            |
         |<-------------------------------------------------------+
         |                           |                            |
         |                           |                            |
         |                           |                            |
         |                           |      ‚ö†Ô∏è CREDIT ALREADY DEDUCTED
         |                           |      ‚ùå ORDER NOT CREATED
         |                           |
         |  ‚ùå Inconsistent state!
```

### Database Transaction ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**Database Transaction** ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (‡πÄ‡∏ä‡πà‡∏ô `INSERT`, `UPDATE`, `DELETE`) ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏°‡∏≠‡∏á‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô **"‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡πà‡∏á‡πÅ‡∏¢‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ"**

‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥ **ACID** ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:

- **Atomicity (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏¢):** ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Transaction ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ **Commit**) ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÅ‡∏°‡πâ‡πÅ‡∏ï‡πà‡∏≠‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ **Rollback**) ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
- **Consistency (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á):** Transaction ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡∏µ‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏™‡∏°‡∏≠ ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏¥‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÜ ‡∏Å‡∏•‡∏≤‡∏á‡πÜ
- **Isolation (‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ï‡∏±‡∏ß):** Transaction ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡∏≠‡∏±‡∏ô ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏Å‡∏ß‡∏ô‡∏Å‡∏±‡∏ô ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏ß‡πà‡∏≤ Transaction ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡∏•‡∏∞‡∏≠‡∏±‡∏ô
- **Durability (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏á‡∏ó‡∏ô):** ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Transaction ‡∏ñ‡∏π‡∏Å Commit ‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏≤‡∏ß‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢‡πÑ‡∏õ ‡πÅ‡∏°‡πâ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡πÑ‡∏ü‡∏î‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πà‡∏°‡∏Å‡πá‡∏ï‡∏≤‡∏°

**‡∏™‡∏£‡∏∏‡∏õ:** Database Transaction ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡πÑ‡∏Å‡πÉ‡∏ô **‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•** ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô/‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

### Unit of Work ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**Unit of Work (UoW)** ‡πÄ‡∏õ‡πá‡∏ô **Design Pattern** ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô **Service Layer** ‡πÉ‡∏ä‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏´‡∏•‡∏≤‡∏¢‡πÜ operation (insert, update, delete) ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô **transaction ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô** ‡πÇ‡∏î‡∏¢‡∏°‡∏∏‡πà‡∏á‡πÄ‡∏ô‡πâ‡∏ô‡∏ó‡∏µ‡πà **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Consistency)** ‡πÅ‡∏•‡∏∞ **‡∏Å‡∏≤‡∏£ rollback ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î**

**‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á Unit of Work**

1. Start / Begin: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô transaction
2. Register Changes: ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ operation ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥ (insert, update, delete)
3. Commit: ‡∏ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ú‡πà‡∏≤‡∏ô ‚Üí commit DB
4. Rollback: ‡∏ñ‡πâ‡∏≤ error ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‚Üí ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (rollback)
5. Post-Commit Hook: ‡∏£‡∏±‡∏ô side effects (‡πÄ‡∏ä‡πà‡∏ô send email) **‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å** commit ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Transactor(Unit of Work) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Database Transaction

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢ repository ‡πÉ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á business flow (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå) ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏° atomic ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ **Transactor** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° transaction ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥ rollback ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î error

<aside>
üí°

‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏î‡∏±‡∏î‡πÅ‡∏õ‡∏•‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å <https://github.com/Thiht/transactor>

</aside>

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Interface ‡∏Å‡∏•‡∏≤‡∏á `DBTX` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ repository ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á `*sqlx.DB` ‡πÅ‡∏•‡∏∞ `*sqlx.Tx`

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/storage/sqldb/transactor/types.go`
    >

    ```go
    package transactor
    
    import (
     "context"
     "database/sql"
    
     "github.com/jmoiron/sqlx"
    )
    
    // DBTX is the common interface between *[sqlx.DB] and *[sqlx.Tx].
    type DBTX interface {
     // database/sql methods
    
     ExecContext(ctx context.Context, query string, args ...any) (sql.Result, error)
     PrepareContext(ctx context.Context, query string) (*sql.Stmt, error)
     QueryContext(ctx context.Context, query string, args ...any) (*sql.Rows, error)
     QueryRowContext(ctx context.Context, query string, args ...any) *sql.Row
    
     Exec(query string, args ...any) (sql.Result, error)
     Prepare(query string) (*sql.Stmt, error)
     Query(query string, args ...any) (*sql.Rows, error)
     QueryRow(query string, args ...any) *sql.Row
    
     // sqlx methods
    
     GetContext(ctx context.Context, dest any, query string, args ...any) error
     MustExecContext(ctx context.Context, query string, args ...any) sql.Result
     NamedExecContext(ctx context.Context, query string, arg any) (sql.Result, error)
     PrepareNamedContext(ctx context.Context, query string) (*sqlx.NamedStmt, error)
     PreparexContext(ctx context.Context, query string) (*sqlx.Stmt, error)
     QueryRowxContext(ctx context.Context, query string, args ...any) *sqlx.Row
     QueryxContext(ctx context.Context, query string, args ...any) (*sqlx.Rows, error)
     SelectContext(ctx context.Context, dest any, query string, args ...any) error
    
     Get(dest any, query string, args ...any) error
     MustExec(query string, args ...any) sql.Result
     NamedExec(query string, arg any) (sql.Result, error)
     NamedQuery(query string, arg any) (*sqlx.Rows, error)
     PrepareNamed(query string) (*sqlx.NamedStmt, error)
     Preparex(query string) (*sqlx.Stmt, error)
     QueryRowx(query string, args ...any) *sqlx.Row
     Queryx(query string, args ...any) (*sqlx.Rows, error)
     Select(dest any, query string, args ...any) error
    
     Rebind(query string) string
     BindNamed(query string, arg any) (string, []any, error)
     DriverName() string
    }
    
    type sqlxDB interface {
     DBTX
     BeginTxx(ctx context.Context, opts *sql.TxOptions) (*sqlx.Tx, error)
    }
    
    type sqlxTx interface {
     Commit() error
     Rollback() error
    }
    
    var (
     _ DBTX   = &sqlx.DB{}
     _ DBTX   = &sqlx.Tx{}
     _ sqlxDB = &sqlx.DB{}
     _ sqlxTx = &sqlx.Tx{}
    )
    
    type (
     transactorKey struct{}
     // DBTXContext is used to get the current DB handler from the context.
     // It returns the current transaction if there is one, otherwise it will return the original DB.
     DBTXContext func(context.Context) DBTX
    )
    
    func txToContext(ctx context.Context, tx sqlxDB) context.Context {
     return context.WithValue(ctx, transactorKey{}, tx)
    }
    
    func txFromContext(ctx context.Context) sqlxDB {
     if tx, ok := ctx.Value(transactorKey{}).(sqlxDB); ok {
      return tx
     }
     return nil
    }
    ```

    `DBTX` ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å inject ‡∏ú‡πà‡∏≤‡∏ô context ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ repository ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πâ DB ‡∏´‡∏£‡∏∑‡∏≠ Tx ‡∏≠‡∏¢‡∏π‡πà

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Nested Transactions
‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ nested transactions ‡πÑ‡∏î‡πâ 2 ‡πÅ‡∏ö‡∏ö
  - **‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö** (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° transaction flow ‡πÄ‡∏≠‡∏á)

        > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/storage/sqldb/transactor/nested_transactions_none.go`
        >

        ```go
        package transactor
        
        import (
         "context"
         "database/sql"
         "errors"
        
         "github.com/jmoiron/sqlx"
        )
        
        // NestedTransactionsNone is an implementation that prevents using nested transactions.
        func NestedTransactionsNone(db sqlxDB, tx *sqlx.Tx) (sqlxDB, sqlxTx) {
         switch typedDB := db.(type) {
         case *sqlx.DB:
          return &nestedTransactionNone{tx}, tx
        
         case *nestedTransactionNone:
          return typedDB, typedDB
        
         default:
          panic("unsupported type")
         }
        }
        
        type nestedTransactionNone struct {
         *sqlx.Tx
        }
        
        func (t *nestedTransactionNone) BeginTxx(_ context.Context, _ *sql.TxOptions) (*sqlx.Tx, error) {
         return nil, errors.New("nested transactions are not supported")
        }
        
        func (t *nestedTransactionNone) Commit() error {
         return errors.New("nested transactions are not supported")
        }
        
        func (t *nestedTransactionNone) Rollback() error {
         return errors.New("nested transactions are not supported")
        }
        
        ```

  - **‡πÉ‡∏ä‡πâ Savepoints** (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏ã‡πâ‡∏≠‡∏ô transaction ‡πÑ‡∏î‡πâ)

        > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/storage/sqldb/transactor/nested_transactions_savepoint.go`
        >

        ```go
        package transactor
        
        import (
         "context"
         "database/sql"
         "fmt"
         "strconv"
         "sync/atomic"
        
         "github.com/jmoiron/sqlx"
        )
        
        // NestedTransactionsSavepoints is a nested transactions implementation using savepoints.
        // It's compatible with PostgreSQL, MySQL, MariaDB, and SQLite.
        func NestedTransactionsSavepoints(db sqlxDB, tx *sqlx.Tx) (sqlxDB, sqlxTx) {
         switch typedDB := db.(type) {
         case *sqlx.DB:
          return &nestedTransactionSavepoints{Tx: tx}, tx
        
         case *nestedTransactionSavepoints:
          nestedTransaction := &nestedTransactionSavepoints{
           Tx:    tx,
           depth: typedDB.depth + 1,
          }
          return nestedTransaction, nestedTransaction
        
         default:
          panic("unsupported type")
         }
        }
        
        type nestedTransactionSavepoints struct {
         *sqlx.Tx
         depth int64
         done  atomic.Bool
        }
        
        func (t *nestedTransactionSavepoints) BeginTxx(ctx context.Context, _ *sql.TxOptions) (*sqlx.Tx, error) {
         if _, err := t.ExecContext(ctx, "SAVEPOINT sp_"+strconv.FormatInt(t.depth+1, 10)); err != nil {
          return nil, fmt.Errorf("failed to create savepoint: %w", err)
         }
        
         return t.Tx, nil
        }
        
        func (t *nestedTransactionSavepoints) Commit() error {
         if !t.done.CompareAndSwap(false, true) {
          return sql.ErrTxDone
         }
        
         if _, err := t.Exec("RELEASE SAVEPOINT sp_" + strconv.FormatInt(t.depth, 10)); err != nil {
          return fmt.Errorf("failed to release savepoint: %w", err)
         }
        
         return nil
        }
        
        func (t *nestedTransactionSavepoints) Rollback() error {
         if !t.done.CompareAndSwap(false, true) {
          return sql.ErrTxDone
         }
        
         if _, err := t.Exec("ROLLBACK TO SAVEPOINT sp_" + strconv.FormatInt(t.depth, 10)); err != nil {
          return fmt.Errorf("failed to rollback to savepoint: %w", err)
         }
        
         return nil
        }
        ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Transactor ‡∏ã‡∏∂‡πà‡∏á‡∏ï‡∏±‡∏ß `Transactor` ‡∏à‡∏∞‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° transaction, inject context, ‡πÅ‡∏•‡∏∞ commit/rollback ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/storage/sqldb/transactor/transactor.go`
    >

    ```go
    // Ref: https://github.com/Thiht/transactor/blob/main/sqlx/transactor.go
    package transactor
    
    import (
     "context"
     "fmt"
     "go-mma/util/logger"
    
     "github.com/jmoiron/sqlx"
    )
    
    type PostCommitHook func(ctx context.Context) error
    
    type Transactor interface {
     WithinTransaction(ctx context.Context, txFunc func(ctxWithTx context.Context, registerPostCommitHook func(PostCommitHook)) error) error
    }
    
    type (
     sqlxDBGetter               func(context.Context) sqlxDB
     nestedTransactionsStrategy func(sqlxDB, *sqlx.Tx) (sqlxDB, sqlxTx)
    )
    
    type sqlTransactor struct {
     sqlxDBGetter
     nestedTransactionsStrategy
    }
    
    type Option func(*sqlTransactor)
    
    func New(db *sqlx.DB, opts ...Option) (Transactor, DBTXContext) {
     t := &sqlTransactor{
      sqlxDBGetter: func(ctx context.Context) sqlxDB {
       if tx := txFromContext(ctx); tx != nil {
        return tx
       }
       return db
      },
      nestedTransactionsStrategy: NestedTransactionsNone, // Default strategy
     }
    
     for _, opt := range opts {
      opt(t)
     }
    
     dbGetter := func(ctx context.Context) DBTX {
      if tx := txFromContext(ctx); tx != nil {
       return tx
      }
    
      return db
     }
    
     return t, dbGetter
    }
    
    func WithNestedTransactionStrategy(strategy nestedTransactionsStrategy) Option {
     return func(t *sqlTransactor) {
      t.nestedTransactionsStrategy = strategy
     }
    }
    
    func (t *sqlTransactor) WithinTransaction(ctx context.Context, txFunc func(ctxWithTx context.Context, registerPostCommitHook func(PostCommitHook)) error) error {
     currentDB := t.sqlxDBGetter(ctx)
    
     tx, err := currentDB.BeginTxx(ctx, nil)
     if err != nil {
      return fmt.Errorf("failed to begin transaction: %w", err)
     }
    
     var hooks []PostCommitHook
    
     registerPostCommitHook := func(hook PostCommitHook) {
      hooks = append(hooks, hook)
     }
    
     newDB, currentTX := t.nestedTransactionsStrategy(currentDB, tx)
     defer func() {
      _ = currentTX.Rollback() // If rollback fails, there's nothing to do, the transaction will expire by itself
     }()
     ctxWithTx := txToContext(ctx, newDB)
    
     if err := txFunc(ctxWithTx, registerPostCommitHook); err != nil {
      return err
     }
    
     if err := currentTX.Commit(); err != nil {
      return fmt.Errorf("failed to commit transaction: %w", err)
     }
    
     // ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å commit ‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏±‡∏ô hook ‡πÅ‡∏ö‡∏ö isolated
     go func() {
      for _, hook := range hooks {
       func(h PostCommitHook) {
        defer func() {
         if r := recover(); r != nil {
          // Log panic ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡πÉ‡∏ô hook
          logger.Log.Error(fmt.Sprintf("post-commit hook panic: %v", r))
         }
        }()
        if err := h(ctx); err != nil {
         logger.Log.Error(fmt.Sprintf("post-commit hook error: %v", err))
        }
       }(hook)
      }
     }()
    
     return nil
    }
    
    func IsWithinTransaction(ctx context.Context) bool {
     return ctx.Value(transactorKey{}) != nil
    }
    ```

**‡∏™‡∏£‡∏∏‡∏õ**

- ‡πÉ‡∏ä‡πâ `Transactor` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏´‡∏•‡∏≤‡∏¢ DB operation ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô atomic unit
- Inject `DBTX` ‡∏ú‡πà‡∏≤‡∏ô context ‡∏ó‡∏≥‡πÉ‡∏´‡πâ repository ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô transaction ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö nested transactions ‡∏î‡πâ‡∏ß‡∏¢ savepoint ‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

### ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Repository Layer

‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô layer ‡∏Ç‡∏≠‡∏á repository ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô transaction ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏¢ repository ‡πÇ‡∏î‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ inject ‡∏ï‡∏±‡∏ß database connection (`*sql.DB` ‡∏´‡∏£‡∏∑‡∏≠ `sqldb.DBContext`) ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ interface ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ `transactor.DBContext`

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á**

- ‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ä‡πâ `dbCtx sqldb.DBContext`
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô `dbCtx transactor.DBContext`
- ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `db.QueryContext(...)`, `db.ExecContext(...)` ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á `sql.DB` ‡∏´‡∏£‡∏∑‡∏≠ `sql.Tx` ‡∏à‡∏≤‡∏Å `context.Context` ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `r.dbCtx(ctx)` ‡πÅ‡∏ó‡∏ô

**‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÇ‡∏Ñ‡πâ‡∏î**

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `repository/customer.go`

    ```go
    package repository
    
    import (
     "context"
     "database/sql"
     "fmt"
     "go-mma/model"
     "go-mma/util/errs"
     "go-mma/util/storage/sqldb/transactor"
     "time"
    )
    
    type CustomerRepository struct {
     dbCtx transactor.DBTXContext // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    }
    
    func NewCustomerRepository(dbCtx transactor.DBTXContext) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    *CustomerRepository {
     // ...
    }
    
    func (r *CustomerRepository) Create(ctx context.Context, customer *model.Customer) error {
     // ...
    
     err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    
    func (r *CustomerRepository) ExistsByEmail(ctx context.Context, email string) (bool, error) {
     // ...
     
     err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    
    func (r *CustomerRepository) FindByID(ctx context.Context, id int64) (*model.Customer, error) {
     // ...
     
     err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    
    func (r *CustomerRepository) UpdateCredit(ctx context.Context, m *model.Customer) error {
     // ...
    
     err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `repository/order.go`

    ```go
    package repository
    
    import (
     "context"
     "database/sql"
     "fmt"
     "go-mma/model"
     "go-mma/util/errs"
     "go-mma/util/storage/sqldb/transactor"
     "time"
    )
    
    type OrderRepository struct {
     dbCtx transactor.DBTXContext  // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    }
    
    func NewOrderRepository(dbCtx transactor.DBTXContext) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    *OrderRepository {
     // ...
    }
    
    func (r *OrderRepository) Create(ctx context.Context, m *model.Order) error {
     // ...
    
     err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    
    func (r *OrderRepository) FindByID(ctx context.Context, id int64) (*model.Order, error) {
     // ...
     
     err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    
    func (r *OrderRepository) Cancel(ctx context.Context, id int64) error {
     // ...
     
     _, err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    ```

**‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á**

- ‡πÉ‡∏ä‡πâ `transactor.DBTXContext` ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á `sql.DB` ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
- `dbCtx(ctx)` ‡∏à‡∏∞ return `sql.Tx` ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ transaction, ‡∏´‡∏£‡∏∑‡∏≠ `sql.DB` ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ repository ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô transaction ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πâ `sql.Tx` ‡∏´‡∏£‡∏∑‡∏≠ `sql.DB`

### ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Service Layer

‡πÉ‡∏ô‡∏ä‡∏±‡πâ‡∏ô `service` ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏£‡∏±‡∏ö `transactor.Transactor` ‡∏°‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Service ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡πÉ‡∏ä‡πâ `WithinTransaction()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡∏π‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ transaction ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ rollback ‡πÑ‡∏î‡πâ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏î‡πÜ

**‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÇ‡∏Ñ‡πâ‡∏î**

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `service/customer.go` ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‡∏Å‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `WithinTransaction`

    ```go
    package service
    
    // ...
    
    type CustomerService struct {
     transactor transactor.Transactor // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     custRepo   *repository.CustomerRepository
     notiSvc    *NotificationService
    }
    
    func NewCustomerService(
     transactor transactor.Transactor, // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     custRepo *repository.CustomerRepository,
     notiSvc *NotificationService,
    ) *CustomerService {
     return &CustomerService{
      transactor: transactor, // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      custRepo:   custRepo,
      notiSvc:    notiSvc,
     }
    }
    
    func (s *CustomerService) CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error) {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // Business Logic: email ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     
     // ‡πÅ‡∏õ‡∏•‡∏á DTO ‚Üí Model
     customer := model.NewCustomer(req.Email, req.Credit)
     
      // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     // ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô WithinTransaction
     err = s.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
         
      // Unit of Work: register change
      if err := s.custRepo.Create(ctx, customer); err != nil {
       // error logging
       logger.Log.Error(err.Error())
       return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      }
    
      // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
      if err := s.notiSvc.SendEmail(customer.Email, "Welcome to our service!", map[string]any{
       "message": "Thank you for joining us! We are excited to have you as a member.",
      }); err != nil {
       // error logging
       logger.Log.Error(err.Error())
       return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      }
    
        // Unit of Work: commit ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á func ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      return nil
     })
    
     if err != nil {
      return nil, err
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO Response
     // ...
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `service/order.go` ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `WithinTransaction`

    ```go
    package service
    
    // ...
    
    type OrderService struct {
     transactor transactor.Transactor // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     custRepo   *repository.CustomerRepository
     orderRepo  *repository.OrderRepository
     notiSvc    *NotificationService
    }
    
    func NewOrderService(
     transactor transactor.Transactor, // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     custRepo *repository.CustomerRepository,
     orderRepo *repository.OrderRepository,
     notiSvc *NotificationService) *OrderService {
     return &OrderService{
      transactor: transactor, // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      custRepo:   custRepo,
      orderRepo:  orderRepo,
      notiSvc:    notiSvc,
     }
    }
    
    func (s *OrderService) CreateOrder(ctx context.Context, req *dto.CreateOrderRequest) (*dto.CreateOrderResponse, error) {
     // Business Logic: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     // ...
    
        // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     // ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô WithinTransaction
     var order *model.Order
     err = s.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
       
       // Business Logic Rule: ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÉ‡∏´‡πâ error
      if err := customer.ReserveCredit(req.OrderTotal); err != nil {
       return err
      }
     
        // Unit of Work: register change
      // ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á customer
      if err := s.custRepo.UpdateCredit(ctx, customer); err != nil {
       logger.Log.Error(err.Error())
       return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      }
    
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á order ‡πÉ‡∏´‡∏°‡πà DTO -> Model
      order = model.NewOrder(req.CustomerID, req.OrderTotal)
      // Unit of Work: register change
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      err = s.orderRepo.Create(ctx, order)
      if err != nil {
       logger.Log.Error(err.Error())
       return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      }
    
      // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
      err = s.notiSvc.SendEmail(customer.Email, "Order Created", map[string]any{
       "order_id": order.ID,
       "total":    order.OrderTotal,
      })
      if err != nil {
       logger.Log.Error(err.Error())
       return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      }
        
        // Unit of Work: commit ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á func ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      return nil
     })
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å‡πÉ‡∏ô transactor
     if err != nil {
      return nil, err
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO Response
     // ...
    }
    ```

### Post-Commit Hook

‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£‡πÅ‡∏¢‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î side effects ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•, call external service ‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô**‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å** commit ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤ data persist ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å rollback ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ external failure

**‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**

```go
// service/customer.go
// func (s *customerService) CreateCustomer(...)
err = s.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(PostCommitHook)) error {
     
  // Unit of Work: register change
  if err := s.custRepo.Create(ctx, customer); err != nil {
   // error logging
   logger.Log.Error(err.Error())
   return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
  }

  // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö <-- side-effect
  if err := s.notiSvc.SendEmail(customer.Email, "Welcome to our service!", map[string]any{
   "message": "Thank you for joining us! We are excited to have you as a member.",
  }); err != nil {
   // error logging
   logger.Log.Error(err.Error())
   return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
  }

    // Unit of Work: commit ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á func ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
  return nil
 })
```

**‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**

```go
// service/customer.go
// func (s *customerService) CreateCustomer(...)
err = s.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(PostCommitHook)) error {
     
  // Unit of Work: register change
  if err := s.custRepo.Create(ctx, customer); err != nil {
   // error logging
   logger.Log.Error(err.Error())
   return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
  }

  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô hook ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  registerPostCommitHook(func(ctx context.Context) error {
   return s.notiSvc.SendEmail(customer.Email, "Welcome to our service!", map[string]any{
    "message": "Thank you for joining us! We are excited to have you as a member."})
  })

    // Unit of Work: commit ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á func ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
  return nil
 })
```

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà `func (s *orderService) CreateOrder(‚Ä¶)` ‡∏î‡πâ‡∏ß‡∏¢

### ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Dependency Injection

‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ inject `transactor.Transactor` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô Service Layer

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `application/http.go`

    ```go
    func (s *httpServer) RegisterRoutes(dbCtx sqldb.DBContext) {
     v1 := s.app.Group("/api/v1")
    
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á transactor ‡∏Å‡∏±‡∏ö dbCtx ‡∏à‡∏≤‡∏Å transactor
     transactor, dbtxCtx := transactor.New(dbCtx.DB()) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     customers := v1.Group("/customers")
     {
      repo := repository.NewCustomerRepository(dbtxCtx) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      svcNoti := service.NewNotificationService()
      svc := service.NewCustomerService(transactor, repo, svcNoti) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      hdl := handler.NewCustomerHandler(svc)
      customers.Post("", hdl.CreateCustomer)
     }
    
     orders := v1.Group("/orders")
     {
      repoCust := repository.NewCustomerRepository(dbtxCtx) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      repoOrder := repository.NewOrderRepository(dbtxCtx) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      svcNoti := service.NewNotificationService()
      svcOrder := service.NewOrderService(transactor, repoCust, repoOrder, svcNoti) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      hdl := handler.NewOrderHandler(svcOrder)
      orders.Post("", hdlr.CreateOrder)
      orders.Delete("/:orderID", hdl.CancelOrder)
     }
    }
    ```

## ‡∏ô‡∏≥‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Dependency Inversion ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á

**Dependency Inversion** ‡∏Ñ‡∏∑‡∏≠ ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏ä‡πà‡∏ô Handler, Service) ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡πà‡∏≤‡∏á (‡πÄ‡∏ä‡πà‡∏ô Repository ‡πÅ‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á), ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö Interface ‡πÅ‡∏ó‡∏ô

‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡∏Ñ‡∏∑‡∏≠

- ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏î (loose coupling)
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô implementation ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å PostgreSQL ‚Üí MongoDB
- ‡∏ó‡∏≥ unit test ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ mock ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å interface

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ Dependency Inversion

```go
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Handler   ‚îÇ ‚Üê struct: CustomerHandler
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ depends on interface
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Service   ‚îÇ  ‚Üê interface: CustomerService
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ implemented by
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ServiceImp         ‚îÇ ‚Üê struct: customerService
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ depends on interface
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Repository ‚îÇ  ‚Üê interface: CustomerRepository
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ implemented by
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PostgresRepository ‚îÇ ‚Üê struct: customerRepository
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Repository Layer

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `repository/customer.go`

    ```go
    package repository
    
    // ...
    
    // --> Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á interface
    type CustomerRepository interface {
     Create(ctx context.Context, customer *model.Customer) error
     ExistsByEmail(ctx context.Context, email string) (bool, error)
     FindByID(ctx context.Context, id int64) (*model.Customer, error)
     UpdateCredit(ctx context.Context, customer *model.Customer) error
    }
    
    type customerRepository struct { // --> Step 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
     dbCtx transactor.DBTXContext
    }
    
    // --> Step 3: return ‡πÄ‡∏õ‡πá‡∏ô interface
    func NewCustomerRepository(dbCtx transactor.DBTXContext) CustomerRepository {
     return &customerRepository{ // --> Step 4: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
      dbCtx: dbCtx,
     }
    }
    
    // --> Step 5: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *customerRepository) Create(ctx context.Context, customer *model.Customer) error {
     // ...
    }
    
    // --> Step 6: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *customerRepository) ExistsByEmail(ctx context.Context, email string) (bool, error) {
     // ...
    }
    
    // --> Step 7: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *customerRepository) FindByID(ctx context.Context, id int64) (*model.Customer, error) {
     // ...
    }
    
    // --> Step 8: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *customerRepository) UpdateCredit(ctx context.Context, m *model.Customer) error {
     // ...
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `repository/order.go`

    ```go
    package repository
    
    // ...
    
    // --> Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á interface
    type OrderRepository interface {
     Create(ctx context.Context, order *model.Order) error
     FindByID(ctx context.Context, id int64) (*model.Order, error)
     Cancel(ctx context.Context, id int64) error
    }
    
    type orderRepository struct { // --> Step 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
     dbCtx transactor.DBTXContext
    }
    
    // --> Step 3: return ‡πÄ‡∏õ‡πá‡∏ô interface
    func NewOrderRepository(dbCtx transactor.DBTXContext) OrderRepository {
     return &orderRepository{ // --> Step 4: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
      dbCtx: dbCtx,
     }
    }
    
    // --> Step 5: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *orderRepository) Create(ctx context.Context, m *model.Order) error {
     // ...
    }
    
    // --> Step 6: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *orderRepository) FindByID(ctx context.Context, id int64) (*model.Order, error) {
     // ...
    }
    
    // --> Step 7: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *orderRepository) Cancel(ctx context.Context, id int64) error {
     // ...
    }
    ```

### Service Layer

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `service/notification.go`

    ```go
    package service
    
    import (
     "fmt"
     "go-mma/util/logger"
    )
    
    // --> Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á interface
    type NotificationService interface {
     SendEmail(to string, subject string, payload map[string]any) error
    }
    
    // --> Step 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    type notificationService struct {
    }
    
    // --> Step 3: return ‡πÄ‡∏õ‡πá‡∏ô interface
    func NewNotificationService() NotificationService {
     return &notificationService{} // --> Step 4: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    }
    
    // --> Step 5: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (s *notificationService) SendEmail(to string, subject string, payload map[string]any) error {
     // ...
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `service/customer.go`

    ```go
    package service
    
    // ...
    
    // --> Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á interface
    type CustomerService interface {
     CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error)
    }
    
    // --> Step 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    type customerService struct {
     transactor transactor.Transactor
     custRepo   repository.CustomerRepository // --> step 3: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     notiSvc    NotificationService // --> step 4: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
    }
    
    func NewCustomerService(
     transactor transactor.Transactor,
     custRepo repository.CustomerRepository, // --> step 5: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     notiSvc NotificationService, // --> step 6: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
    ) CustomerService {            // --> Step 7: return ‡πÄ‡∏õ‡πá‡∏ô interface
     return &customerService{     // --> Step 8: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
      transactor: transactor,
      custRepo:   custRepo,
      notiSvc:    notiSvc,
     }
    }
    
    // --> Step 9: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (s *customerService) CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error) {
     // ...
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `service/order.go`

    ```go
    package service
    
    // ...
    
    // --> Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á interface
    type OrderService interface {
     CreateOrder(ctx context.Context, req *dto.CreateOrderRequest) (*dto.CreateOrderResponse, error)
     CancelOrder(ctx context.Context, id int64) error
    }
    
    // --> Step 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    type orderService struct {
     transactor transactor.Transactor
     custRepo   repository.CustomerRepository // --> step 3: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     orderRepo  repository.OrderRepository // --> step 4: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     notiSvc    NotificationService // --> step 5: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
    }
    
    func NewOrderService(
     transactor transactor.Transactor,
     custRepo repository.CustomerRepository, // --> step 6: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     orderRepo repository.OrderRepository, // --> step 7: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     notiSvc NotificationService, // --> step 8: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     ) OrderService {            // --> Step 9: return ‡πÄ‡∏õ‡πá‡∏ô interface
     return &orderService{       // --> Step 10: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
      transactor: transactor,
      custRepo:   custRepo,
      orderRepo:  orderRepo,
      notiSvc:    notiSvc,
     }
    }
    
    // --> Step 11: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (s *orderService) CreateOrder(ctx context.Context, req *dto.CreateOrderRequest) (*dto.CreateOrderResponse, error) {
     // ...
    }
    
    // --> Step 12: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (s *orderService) CancelOrder(ctx context.Context, id int) error {
     // ...
    }
    ```

### Presentation Layer

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö service ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô interface

    ```go
    package handler
    
    // ...
    
    type CustomerHandler struct {
     custService service.CustomerService // <-- Step1: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
    }
    
    func NewCustomerHandler(custService service.CustomerService, // <-- Step2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     ) *CustomerHandler {
     return &CustomerHandler{
      custService: custService,
     }
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/order.go` ‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö service ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô interface

    ```go
    package handler
    
    // ...
    
    type OrderHandler struct {
     orderSvc service.OrderService // <-- Step1: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
    }
    
    func NewOrderHandler(orderSvc service.OrderService, // <-- Step1: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
    ) *OrderHandler {
     return &OrderHandler{orderSvc: orderSvc}
    }
    ```

## ‡πÅ‡∏õ‡∏•‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏õ‡∏™‡∏π‡πà Modular Architecture ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô

‡∏ñ‡∏±‡∏î‡∏°‡∏≤‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏°‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° "layer" (‡πÄ‡∏ä‡πà‡∏ô handler, service, repository) ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° "feature ‡∏´‡∏£‡∏∑‡∏≠ use case‚Äù ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á [Vertical Slice Architecture](https://somprasongd.work/blog/architecture/vertical-slice) ‡∏Ñ‡∏∑‡∏≠

- ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå ‡πÄ‡∏ä‡πà‡∏ô `customer`, `order`, `notification`
- ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏°‡∏µ‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô‡πÄ‡∏≠‡∏á: `handler`, `dto`, `service`, `model`, `repository`, `test`
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ ‡πÅ‡∏¢‡∏Å‡∏≠‡∏¥‡∏™‡∏£‡∏∞, ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏Ç‡πâ‡∏≤‡∏° slice, ‡πÄ‡∏û‡∏¥‡πà‡∏° modularity

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà

```bash
.
‚îú‚îÄ‚îÄ cmd
‚îÇ   ‚îî‚îÄ‚îÄ api
‚îÇ       ‚îî‚îÄ‚îÄ main.go         # bootstraps all modules
‚îú‚îÄ‚îÄ config
‚îÇ   ‚îî‚îÄ‚îÄ config.go
‚îú‚îÄ‚îÄ modules                 
‚îÇ   ‚îú‚îÄ‚îÄ customer
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ module.go       # wiring
‚îÇ   ‚îú‚îÄ‚îÄ notification
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ module.go 
‚îÇ   ‚îî‚îÄ‚îÄ order
‚îÇ       ‚îú‚îÄ‚îÄ handler
‚îÇ       ‚îú‚îÄ‚îÄ dto
‚îÇ       ‚îú‚îÄ‚îÄ model
‚îÇ       ‚îú‚îÄ‚îÄ repository
‚îÇ       ‚îú‚îÄ‚îÄ service
‚îÇ       ‚îî‚îÄ‚îÄ module.go
‚îú‚îÄ‚îÄ application
‚îÇ   ‚îú‚îÄ‚îÄ application.go      # register all modules
‚îÇ   ‚îú‚îÄ‚îÄ http.go             # remove register all routes
‚îÇ   ‚îî‚îÄ‚îÄ middleware
‚îÇ       ‚îú‚îÄ‚îÄ request_logger.go
‚îÇ       ‚îî‚îÄ‚îÄ response_error.go
‚îú‚îÄ‚îÄ migrations
‚îÇ   ‚îî‚îÄ‚îÄ ...sql
‚îú‚îÄ‚îÄ util
‚îÇ   ‚îú‚îÄ‚îÄ module              # new
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ module.go       # module interface
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ go.mod
```

### Notification Module

‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö notification ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/notification`

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `service/notification.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/notification/service/notification.go`

### Customer Module

‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö customer ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer`

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `model/customer.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/model/customer.go`
- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `dto/customer_*.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/dto/customer_*.go`
- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `repository/customer.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/repository/customer.go`

    ```go
    package repository
    
    import (
     "context"
     "database/sql"
     "fmt"
     "go-mma/modules/customer/model" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/util/errs"
     "go-mma/util/storage/sqldb/transactor"
     "time"
    )
    ```

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `service/customer.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/service/customer.go`

    ```go
    package service
    
    import (
     "context"
     "go-mma/modules/customer/dto"        // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/modules/customer/model"      // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/modules/customer/repository" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/util/errs"
     "go-mma/util/logger"
     "go-mma/util/storage/sqldb/transactor"
    
     notiService "go-mma/modules/notification/service" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
    )
    
    // ...
    
    type customerService struct {
     transactor transactor.Transactor
     custRepo   repository.CustomerRepository
     notiSvc    notiService.NotificationService // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
    }
    
    func NewCustomerService(
     transactor transactor.Transactor,
     custRepo repository.CustomerRepository,
     notiSvc notiService.NotificationService, // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
    ) CustomerService {
     // ...
    }
    ```

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/handler/customer.go`

    ```go
    package handler
    
    import (
     "go-mma/modules/customer/dto"     // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/modules/customer/service" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/util/errs"
     "strings"
    
     "github.com/gofiber/fiber/v3"
    )
    ```

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `tests/customer.http` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/test/customer.http`

### Order Module

‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö order ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/order`

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `model/order.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/model/order.go`
- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `dto/order*.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/dto/order*.go`
- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `repository/order.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/repository/order.go`

    ```go
    package repository
    
    import (
     "context"
     "database/sql"
     "fmt"
     "go-mma/modules/order/model" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/util/errs"
     "go-mma/util/storage/sqldb/transactor"
     "time"
    )
    ```

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `service/order.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/service/order.go`

    ```go
    package service
    
    import (
     "context"
     "go-mma/modules/order/dto"        // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/modules/order/model"      // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/modules/order/repository" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/util/errs"
     "go-mma/util/logger"
     "go-mma/util/storage/sqldb/transactor"
    
     custRepository "go-mma/modules/customer/repository" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     notiService "go-mma/modules/notification/service"   // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
    )
    
    // ...
    
    type orderService struct {
     transactor transactor.Transactor
     custRepo   custRepository.CustomerRepository // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     orderRepo  repository.OrderRepository
     notiSvc    notiService.NotificationService   // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
    }
    
    func NewOrderService(
     transactor transactor.Transactor,
     custRepo custRepository.CustomerRepository,   // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     orderRepo repository.OrderRepository,
     notiSvc notiService.NotificationService       // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     ) OrderService {
     // ...
    }
    ```

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `handler/order.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/handler/order.go`

    ```go
    package handler
    
    import (
     "go-mma/modules/order/dto"      // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/modules/order/service"  // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/util/errs"
     "strconv"
     "strings"
    
     "github.com/gofiber/fiber/v3"
    )
    ```

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `tests/order.http` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/test/order.http`

### Feature-level constructor

‡∏Ñ‡∏∑‡∏≠ ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ *constructor function* ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "feature" ‡∏´‡∏£‡∏∑‡∏≠ "module" ‡∏´‡∏ô‡∏∂‡πà‡∏á ‡πÜ ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö dependencies ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á "feature" ‡∏´‡∏£‡∏∑‡∏≠ "module" ‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á interface ‡∏´‡∏£‡∏∑‡∏≠ struct ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô**

```go
// module/customer/module.go
func NewCustomerModule(mCtx *module.ModuleContext) module.Module {
 repo := repository.NewCustomerRepository(mCtx.DBCtx)
 svc := service.NewCustomerService(repo)
 hdl := handler.NewCustomerHandler(svc)

 return &customerModule{
  handler: hdl,
 }
}
```

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á**

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Module Interface

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/module/module.go`
    >

    ```go
    package module
    
    import (
     "go-mma/util/storage/sqldb/transactor"
    
     "github.com/gofiber/fiber/v3"
    )
    
    type Module interface {
     APIVersion() string
     RegisterRoutes(r fiber.Router)
    }
    
    type ModuleContext struct {
     Transactor transactor.Transactor
     DBCtx      transactor.DBTXContext
    }
    
    func NewModuleContext(transactor transactor.Transactor, dbCtx transactor.DBTXContext) *ModuleContext {
     return &ModuleContext{
      Transactor: transactor,
      DBCtx:      dbCtx,
     }
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Notification Module ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Factory pattern

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `modules/notification/module.go`
    >

    ```go
    package notification
    
    import (
     "go-mma/util/module"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx}
    }
    
    type moduleImp struct {
     mCtx *module.ModuleContext
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ routes
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Customer Module ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Factory pattern ‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ wiring component ‡∏ï‡πà‡∏≤‡∏á ‡πÜ (‡πÄ‡∏ä‡πà‡∏ô repository, service, handler) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö customer ‡∏à‡∏≤‡∏Å `application/http.go` ‡∏°‡∏≤‡πÉ‡∏™‡πà `RegisterRoutes()`

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `modules/customer/module.go`

    ```go
    package customer
    
    import (
     "go-mma/modules/customer/handler"
     "go-mma/modules/customer/repository"
     "go-mma/modules/customer/service"
     "go-mma/util/module"
    
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx}
    }
    
    type moduleImp struct {
     mCtx *module.ModuleContext
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // wiring dependencies
     repo := repository.NewCustomerRepository(m.mCtx.DBCtx)
     svcNoti := notiService.NewNotificationService()
     svc := service.NewCustomerService(m.mCtx.Transactor, repo, svcNoti)
     hdl := handler.NewCustomerHandler(svc)
    
     customers := router.Group("/customers")
     customers.Post("", hdl.CreateCustomer)
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Order Module ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Factory pattern ‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ wiring component ‡∏ï‡πà‡∏≤‡∏á ‡πÜ (‡πÄ‡∏ä‡πà‡∏ô repository, service, handler) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö order ‡∏à‡∏≤‡∏Å `application/http.go` ‡∏°‡∏≤‡πÉ‡∏™‡πà `RegisterRoutes()`

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `modules/order/module.go`

    ```go
    package order
    
    import (
     "go-mma/modules/order/handler"
     "go-mma/modules/order/repository"
     "go-mma/modules/order/service"
     "go-mma/util/module"
    
     custRepository "go-mma/modules/customer/repository"
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx}
    }
    
    type moduleImp struct {
     mCtx *module.ModuleContext
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // wiring dependencies
     repoCust := custRepository.NewCustomerRepository(m.mCtx.DBCtx)
     repoOrder := repository.NewOrderRepository(m.mCtx.DBCtx)
     svcNoti := notiService.NewNotificationService()
     svc := service.NewOrderService(m.mCtx.Transactor, repoCust, repoOrder, svcNoti)
     hdl := handler.NewOrderHandler(svc)
    
     orders := router.Group("/orders")
     orders.Post("", hdl.CreateOrder)
     orders.Delete("/:orderID", hdl.CancelOrder)
    }
    ```

- ‡∏•‡∏ö `RegisterRoutes()` ‡πÉ‡∏ô `application/http.go` ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ

    ```go
    type HTTPServer interface {
     Start()
     Shutdown() error
     Group(prefix string) fiber.Router  // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    }
    
    // ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á base url router ‡πÄ‡∏ä‡πà‡∏ô /api/v1
    func (s *httpServer) Group(prefix string) fiber.Router {
     return s.app.Group(prefix)
    }
    ```

- ‡∏•‡∏ö `RegisterRoutes()` ‡πÉ‡∏ô `application/application.go` ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° `RegisterModules()` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÅ‡∏ó‡∏ô

    ```go
    func (app *Application) RegisterModules(modules ...module.Module) error {
     for _, m := range modules {
      app.registerModuleRoutes(m)
     }
    
     return nil
    }
    
    // ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏≤‡∏° single-responsibility principle (SRP)
    func (app *Application) registerModuleRoutes(m module.Module) {
     prefix := app.buildGroupPrefix(m)
     group := app.httpServer.Group(prefix)
     m.RegisterRoutes(group)
    }
    
    func (app *Application) buildGroupPrefix(m module.Module) string {
     apiBase := "/api"
     version := m.APIVersion()
     if version != "" {
      return fmt.Sprintf("%s/%s", apiBase, version)
     }
     return apiBase
    }
    ```

- ‡∏•‡∏ö `app.RegisterRoutes()` ‡πÉ‡∏ô `cmd/api/main.go` ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•

    ```go
    package main
    
    import (
     "fmt"
     "go-mma/application"
     "go-mma/config"
     "go-mma/data/sqldb"
     "go-mma/modules/customer"
     "go-mma/modules/notification"
     "go-mma/modules/order"
     "go-mma/util/logger"
     "go-mma/util/module"
     "go-mma/util/transactor"
     "os"
     "os/signal"
     "syscall"
    )
    
    func main() {
     // log
     // config
     // db
    
     app := application.New(*config, dbCtx)
    
     transactor, dbtxCtx := transactor.New(dbCtx.DB())
     mCtx := module.NewModuleContext(transactor, dbtxCtx)
     app.RegisterModules(
      notification.NewModule(mCtx),
      customer.NewModule(mCtx),
      order.NewModule(mCtx),
     )
    
     app.Run()
    
     // ...
    }
    ```

## ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á Subdomain

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£ **‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ subdomain** (‡πÄ‡∏ä‡πà‡∏ô `Customer`, `Order`, `Notification`) ‡πÑ‡∏ß‡πâ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á **‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (Facade)**

**Facade** ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô "‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤" ‡πÉ‡∏´‡πâ module ‡∏≠‡∏∑‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô subdomain ‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏°‡∏µ‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏á

### ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏ô?

- ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ **‡πÅ‡∏ï‡πà‡∏•‡∏∞ module ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô** (Bounded Context)
- ‡∏•‡∏î‡∏Å‡∏≤‡∏£ **‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏ã‡∏∂‡πà‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á** ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á module
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á subdomain ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞ **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô**

<aside>
üí°

**‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡πâ‡∏ô ‡πÜ:** **Facade = ‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß** ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ module ‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å functionality ‡∏Ç‡∏≠‡∏á subdomain ‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢ **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô**

</aside>

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

‡∏Å‡πà‡∏≠‡∏ô: ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á

```
Order Handler
     ‚îÇ
     ‚ñº
Order Service
     ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Order Repository
     ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Customer Repository
```

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

```go
// OrderService ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å CustomerRepository ‡∏ï‡∏£‡∏á ‡πÜ
customer, err := customerRepo.FindByID(ctx, order.CustomerID)
if customer.Credit < order.Total {
    return errors.New("insufficient credit")
}
```

- `Order Service` ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏±‡πâ‡∏á `OrderRepo` ‡πÅ‡∏•‡∏∞ `CustomerRepo` ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á

‡∏´‡∏•‡∏±‡∏á: ‡πÉ‡∏ä‡πâ Encapsulation

```
Order Handler
     ‚îÇ
     ‚ñº
Order Service
     ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Order Repository
     ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Customer Service
                             ‚îÇ
                             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Customer Repository

```

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

```go
// OrderService ‡πÉ‡∏ä‡πâ CustomerFacade ‡πÅ‡∏ó‡∏ô
ok, err := customerService.HasSufficientCredit(ctx, order.CustomerID, order.Total)
if !ok {
    return errors.New("insufficient credit")
}
```

- `CustomerService`  ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢ logic ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô subdomain customer
- ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô facade ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ repository, validation, business rule ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏≠‡∏á

### ‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Ç‡∏≠‡∏á Customer

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô OrderService ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `model` ‡πÅ‡∏•‡∏∞ `repository` ‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏• customer ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏ó‡∏≥‡πÑ‡∏î‡πâ ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ customer ‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏à‡∏≤‡∏Å CustomerService ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å id

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `module/customer/dto/customer_info.go`
    >

    ```go
    package dto
    
    type CustomerInfo struct {
     ID     int64  `json:"id"`
     Email  string `json:"email"`
     Credit int    `json:"credit"`
    }
    
    func NewCustomerInfo(id int64, email string, credit int) *CustomerInfo {
     return &CustomerInfo{ID: id, Email: email, Credit: credit}
    }
    ```

- ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å id

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `module/customer/service/customer.go`
    >

    ```go
    var (
     ErrEmailExists      = errs.ConflictError("email already exists")
     ErrCustomerNotFound = errs.ResourceNotFoundError("the customer with given id was not found") // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    )
    
    type CustomerService interface {
     CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error)
     GetCustomerByID(ctx context.Context, id int64) (*dto.CustomerInfo, error) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    }
    
    // ...
    
    // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    func (s *customerService) GetCustomerByID(ctx context.Context, id int64) (*dto.CustomerInfo, error) {
     customer, err := s.custRepo.FindByID(ctx, id)
     if err != nil {
      // error logging
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     if customer == nil {
      return nil, ErrCustomerNotFound
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO Response
     return dto.NewCustomerInfo(
      customer.ID, 
      customer.Email, 
      customer.Credit), nil
    }
    ```

- ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `module/customer/service/customer.go`
    >

    ```go
    var (
     ErrEmailExists                  = errs.ConflictError("email already exists")
     ErrCustomerNotFound             = errs.ResourceNotFoundError("the customer with given id was not found")
     ErrOrderTotalExceedsCreditLimit = errs.BusinessRuleError("order total exceeds credit limit") // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    )
    
    type CustomerService interface {
     // ...
     // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     ReserveCredit(ctx context.Context, id int64, amount int) error
     ReleaseCredit(ctx context.Context, id int64, amount int) error
    }
    
    // ...
    
    // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    func (s *customerService) ReserveCredit(ctx context.Context, id int64, amount int) error {
     err := s.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
      customer, err := s.custRepo.FindByID(ctx, id)
      if err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      if customer == nil {
       return ErrCustomerNotFound
      }
    
      if err := customer.ReserveCredit(amount); err != nil {
       return ErrOrderTotalExceedsCreditLimit
      }
    
      if err := s.custRepo.UpdateCredit(ctx, customer); err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      return nil
     })
     return err
    }
    
    func (s *customerService) ReleaseCredit(ctx context.Context, id int64, amount int) error {
     err := s.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
      customer, err := s.custRepo.FindByID(ctx, id)
      if err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      if customer == nil {
       return ErrCustomerNotFound
      }
    
      customer.ReleaseCredit(amount)
    
      if err := s.custRepo.UpdateCredit(ctx, customer); err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      return nil
     })
    
     return err
    }
    ```

### ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ CustomerService ‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏• Order

- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ `OrderService` ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô `CustomerService` ‡πÅ‡∏ó‡∏ô `CustomerRepository`

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `module/order/service/order.go`
    >

    ```go
    package service
    
    import (
     "context"
     "go-mma/modules/order/dto"
     "go-mma/modules/order/model"
     "go-mma/modules/order/repository"
     "go-mma/util/errs"
     "go-mma/util/logger"
     "go-mma/util/transactor"
    
     custService "go-mma/modules/customer/service" // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     notiService "go-mma/modules/notification/service"
    )
    
    var (
     ErrNoOrderID = errs.ResourceNotFoundError("the order with given id was not found") // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    )
    
    // ...
    
    type orderService struct {
     transactor transactor.Transactor
     custSvc    custService.CustomerService // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     orderRepo  repository.OrderRepository
     notiSvc    notiService.NotificationService
    }
    
    func NewOrderService(
     transactor transactor.Transactor,
     custSvc custService.CustomerService, // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     orderRepo repository.OrderRepository,
     notiSvc notiService.NotificationService) OrderService {
     // ...
    }
    
    func (s *orderService) CreateOrder(ctx context.Context, req *dto.CreateOrderRequest) (*dto.CreateOrderResponse, error) {
     // Business Logic Rule: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     customer, err := s.custSvc.GetCustomerByID(ctx, req.CustomerID)
     if err != nil {
      return nil, err
     }
     // ...
     // ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô WithinTransaction
     var order *model.Order
     err = s.transactor.WithinTransaction(ctx, func(ctx context.Context) error {
    
      // ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á customer
      // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      if err := s.custSvc.ReserveCredit(ctx, customer.ID, req.OrderTotal); err != nil { 
       return err
      }
    
      // ...
     })
    
     // ...
    }
    
    func (s *orderService) CancelOrder(ctx context.Context, id int64) error {
     // Business Logic Rule: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö order id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     order, err := s.orderRepo.FindByID(ctx, id)
     if err != nil {
      logger.Log.Error(err.Error())
      return err
     }
    
     if order == nil {
      return ErrNoOrderID
     }
    
     err = s.transactor.WithinTransaction(ctx, func(ctx context.Context) error {
    
      // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å order
      if err := s.orderRepo.Cancel(ctx, order.ID); err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      // Business Logic: ‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit
      // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      err = s.custSvc.ReleaseCredit(ctx, order.CustomerID, order.OrderTotal)
      if err != nil {
       return err
      }
    
      return nil
     })
    
     return err
    }
    ```

- ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏ô `RegisterRoutes` ‡∏™‡πà‡∏á `CustomerService` ‡πÑ‡∏õ‡πÅ‡∏ó‡∏ô `CustomerRepository`

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `module/order/module.go`
    >

    ```go
    package order
    
    import (
     "go-mma/modules/order/handler"
     "go-mma/modules/order/repository"
     "go-mma/modules/order/service"
     "go-mma/util/module"
    
     custRepository "go-mma/modules/customer/repository"
     custService "go-mma/modules/customer/service" // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    // ...
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // wiring dependencies
     svcNoti := notiService.NewNotificationService()
    
     repoCust := custRepository.NewCustomerRepository(m.mCtx.DBCtx)
     svcCust := custService.NewCustomerService(m.mCtx.Transactor, repoCust, svcNoti) // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    
     repoOrder := repository.NewOrderRepository(m.mCtx.DBCtx)
    
      // ‡∏™‡πà‡∏á svcCust ‡πÅ‡∏ó‡∏ô repoCust
     svc := service.NewOrderService(m.mCtx.Transactor, svcCust, repoOrder, svcNoti)
     hdl := handler.NewOrderHandler(svc)
    
     orders := router.Group("/orders")
     orders.Post("", hdl.CreateOrder)
     orders.Delete("/:orderID", hdl.CancelOrder)
    }
    
    ```

### Nested Transactions

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö error ‡∏ß‡πà‡∏≤

```go
HTTP/1.1 500 Internal Server Error
Date: Fri, 06 Jun 2025 03:50:32 GMT
Content-Type: application/json
Content-Length: 106
X-Request-Id: 771c27c3-7528-4b93-bc6d-e1696c4727ae
Connection: close

{
  "type": "operation_failed",
  "message": "failed to begin transaction: nested transactions are not supported"
}
```

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit ‡πÉ‡∏ô `CustomerService` ‡∏ô‡∏±‡πâ‡∏ô ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô transaction ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà ‡∏ã‡∏∂‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô transaction ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å `OrderService`

‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á `transactor` ‡πÉ‡∏ô `main.go` ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô nested transactions

```go
// src/app/cmd/api/main.go

func main() {
 // ...

 app := application.New(*config)

 transactor, dbCtx := transactor.New(
  db.DB(),
  // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô nested transaction strategy ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ Savepoints
  transactor.WithNestedTransactionStrategy(transactor.NestedTransactionsSavepoints))
 mCtx := module.NewModuleContext(transactor, dbCtx)
 
 // ...
}
```

## ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Service ‡πÉ‡∏ô Monolith ‡∏î‡πâ‡∏ß‡∏¢ Service Registry

‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÄ‡∏£‡∏≤‡∏°‡∏±‡∏Å‡∏à‡∏∞ **‡∏™‡∏£‡πâ‡∏≤‡∏á service ‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥ ‡πÜ** ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏• ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏£‡πâ‡∏≤‡∏á `NotificationService` ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏ó‡∏±‡πâ‡∏á `Customer` ‡πÅ‡∏•‡∏∞ `Order` ‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î **Service Registry** ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡∏Ñ‡∏•‡∏±‡∏á‡πÄ‡∏Å‡πá‡∏ö service‚Äù ‡πÑ‡∏ß‡πâ‡∏£‡∏ß‡∏° service ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

### **‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Service Registry**

- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á service ‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡∏µ‡πà
- ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ inject dependency
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ service ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Service Registry

Service Registry ‡∏Ñ‡∏∑‡∏≠ struct ‡∏´‡∏£‡∏∑‡∏≠ container ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà **‡πÄ‡∏Å‡πá‡∏ö instance ‡∏Ç‡∏≠‡∏á service ‡∏ï‡πà‡∏≤‡∏á ‡πÜ** ‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á new ‡∏ã‡πâ‡∏≥

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Service Registry

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/registry/service_registry.go`
    >

    ```go
    package registry
    
    import "fmt"
    
    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î key ‡∏Ç‡∏≠‡∏á service ‡∏ó‡∏µ‡πà‡∏à‡∏∞ export
    type ServiceKey string
    
    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö map key ‡∏Å‡∏±‡∏ö service ‡∏ó‡∏µ‡πà‡∏à‡∏∞ export
    type ProvidedService struct {
     Key   ServiceKey
     Value any
    }
    
    type ServiceRegistry interface {
     Register(key ServiceKey, svc any)
     Resolve(key ServiceKey) (any, error)
    }
    
    type serviceRegistry struct {
     services map[ServiceKey]any
    }
    
    func NewServiceRegistry() ServiceRegistry {
     return &serviceRegistry{
      services: make(map[ServiceKey]any),
     }
    }
    
    func (r *serviceRegistry) Register(key ServiceKey, svc any) {
     r.services[key] = svc
    }
    
    func (r *serviceRegistry) Resolve(key ServiceKey) (any, error) {
     svc, ok := r.services[key]
     if !ok {
      return nil, fmt.Errorf("service not found: %s", key)
     }
     return svc, nil
    }
    
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏õ‡∏•‡∏á Service ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/registry/helper.go`
    >

    ```go
    package registry
    
    import "fmt"
    
    func ResolveAs[T any](r ServiceRegistry, key ServiceKey) (T, error) {
     var zero T
     svc, err := r.Resolve(key)
     if err != nil {
      return zero, err
     }
     typedSvc, ok := svc.(T)
     if !ok {
      return zero, fmt.Errorf("service registered under key %s does not implement the expected type", key)
     }
     return typedSvc, nil
    }
    ```

### ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Module Interface

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ Module ‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡πÄ‡∏û‡∏¥‡πà‡∏° service ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Registry

> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `util/module/module.go`
>

```go
package module

import (
 "go-mma/util/registry"    // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
 "go-mma/util/transactor"

 "github.com/gofiber/fiber/v3"
)

type Module interface {
 APIVersion() string
 Init(reg registry.ServiceRegistry) error // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
 RegisterRoutes(r fiber.Router)
}

// <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
// ‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ß‡πà‡∏≤ ‡∏ö‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á export service
type ServiceProvider interface {
 Services() []registry.ProvidedService
}
```

### ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Application

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Application ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö service registry

> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `application/application.go`
>

```go
package application

import (
 "fmt"
 "go-mma/config"
 "go-mma/data/sqldb"
 "go-mma/util/logger"
 "go-mma/util/module"
 "go-mma/util/registry"  // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
)

type Application struct {
 config          config.Config
 httpServer      HTTPServer
 serviceRegistry registry.ServiceRegistry // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
}

func New(config config.Config, db sqldb.DBContext) *Application {
 return &Application{
  config:          config,
  httpServer:      newHTTPServer(config),
  serviceRegistry: registry.NewServiceRegistry(), // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
 }
}

// ...

func (app *Application) RegisterModules(modules ...module.Module) error {
 for _, m := range modules {
  // Initialize each module
  if err := app.initModule(m); err != nil {
   return fmt.Errorf("failed to init module [%T]: %w", m, err)
  }

  // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô ServiceProvider ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤ service ‡∏°‡∏≤‡∏•‡∏á registry
  if sp, ok := m.(module.ServiceProvider); ok {
   for _, p := range sp.Services() {
    app.serviceRegistry.Register(p.Key, p.Value)
   }
  }

  // Register routes for each module
  app.registerModuleRoutes(m)
 }

 return nil
}

func (app *Application) initModule(m module.Module) error {
 return m.Init(app.serviceRegistry)
}

// ...
```

### ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ Initialize ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•

‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏° `Init()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á service ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `modules/notification/module.go`

    ```go
    package notification
    
    import (
     "go-mma/modules/notification/service"
     "go-mma/util/module"
     "go-mma/util/registry"
    
     "github.com/gofiber/fiber/v3"
    )
    
    const (
     NotificationServiceKey registry.ServiceKey = "NotificationService"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx: mCtx}
    }
    
    type moduleImp struct {
     mCtx    *module.ModuleContext
     notiSvc service.NotificationService
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) Init(reg registry.ServiceRegistry) error {
     m.notiSvc = service.NewNotificationService()
    
     return nil
    }
    
    func (m *moduleImp) Services() []registry.ProvidedService {
     return []registry.ProvidedService{
      {Key: NotificationServiceKey, Value: m.notiSvc},
     }
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ routes
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `modules/customer/module.go`

    ```go
    package customer
    
    import (
     "go-mma/modules/customer/handler"
     "go-mma/modules/customer/repository"
     "go-mma/modules/customer/service"
     "go-mma/util/module"
     "go-mma/util/registry"
    
     notiModule "go-mma/modules/notification"
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    const (
     CustomerServiceKey registry.ServiceKey = "CustomerService"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx: mCtx}
    }
    
    type moduleImp struct {
     mCtx    *module.ModuleContext
     custSvc service.CustomerService
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) Init(reg registry.ServiceRegistry) error {
     // Resolve NotificationService from the registry
     notiSvc, err := registry.ResolveAs[notiService.NotificationService](reg, notiModule.NotificationServiceKey)
     if err != nil {
      return err
     }
    
     repo := repository.NewCustomerRepository(m.mCtx.DBCtx)
     m.custSvc = service.NewCustomerService(m.mCtx.Transactor, repo, notiSvc)
    
     return nil
    }
    
    func (m *moduleImp) Services() []registry.ProvidedService {
     return []registry.ProvidedService{
      {Key: CustomerServiceKey, Value: m.custSvc},
     }
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // wiring dependencies
     hdl := handler.NewCustomerHandler(m.custSvc)
    
     customers := router.Group("/customers")
     customers.Post("", hdl.CreateCustomer)
    }
    ```

    <aside>
    üí°

    ‡∏ó‡∏≥‡πÑ‡∏°‡∏ñ‡∏∂‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á handler ‡πÉ‡∏ô `RegisterRoutes`

  - ‡πÅ‡∏¢‡∏Å concern ‡∏ä‡∏±‡∏î: `RegisterRoutes` ‡∏î‡∏π‡πÅ‡∏• ‚Äútransport layer‚Äù ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
  - ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢: ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞ handler ‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  - ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß: ‡πÑ‡∏°‡πà‡∏°‡∏µ state ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô `moduleImp`
    </aside>

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `modules/order/module.go`

    ```go
    package order
    
    import (
     "go-mma/modules/order/handler"
     "go-mma/modules/order/repository"
     "go-mma/modules/order/service"
     "go-mma/util/module"
     "go-mma/util/registry"
    
     custModule "go-mma/modules/customer"
     custService "go-mma/modules/customer/service"
     notiModule "go-mma/modules/notification"
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx: mCtx}
    }
    
    type moduleImp struct {
     mCtx     *module.ModuleContext
     orderSvc service.OrderService
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) Init(reg registry.ServiceRegistry) error {
     // Resolve CustomerService from the registry
     custSvc, err := registry.ResolveAs[custService.CustomerService](reg, custModule.CustomerServiceKey)
     if err != nil {
      return err
     }
    
     // Resolve NotificationService from the registry
     notiSvc, err := registry.ResolveAs[notiService.NotificationService](reg, notiModule.NotificationServiceKey)
     if err != nil {
      return err
     }
    
     repo := repository.NewOrderRepository(m.mCtx.DBCtx)
     m.orderSvc = service.NewOrderService(m.mCtx.Transactor, custSvc, repo, notiSvc)
    
     return nil
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // wiring dependencies
     hdl := handler.NewOrderHandler(m.orderSvc)
    
     orders := router.Group("/orders")
     orders.Post("", hdl.CreateOrder)
     orders.Delete("/:orderID", hdl.CancelOrder)
    }
    ```

## ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `internal`

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤ ‡πÅ‡∏¢‡∏Å‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ sub-domain (Encapsulation) ‡πÅ‡∏•‡πâ‡∏ß ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏∑‡∏≠ ‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏• order ‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ `import` `model` ‡∏´‡∏£‡∏∑‡∏≠ `repository` ‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏• customer ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏ô‡∏±‡πà‡∏ô‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï (boundary) ‡∏Ç‡∏≠‡∏á‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤ (coupling) ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏û‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤ Go ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà ‚Äú‡∏´‡πâ‡∏≤‡∏°‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‚Äù ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå **`internal`** ‡πÑ‡∏î‡πâ ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏≠‡∏°‡πÑ‡∏û‡πÄ‡∏•‡∏≠‡∏£‡πå‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ path ‡∏ô‡∏≠‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏°‡πà (root) ‡∏Ç‡∏≠‡∏á `internal` ‡∏ó‡∏≥ `import` ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢

```go
customer/
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ model/        // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞ customer
‚îÇ   ‚îî‚îÄ‚îÄ repository/   // DB logic ‡∏Ç‡∏≠‡∏á customer
‚îî‚îÄ‚îÄ service/          // business logic (export)
```

‡∏ñ‡πâ‡∏≤‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô ‡πÄ‡∏ä‡πà‡∏ô `order` ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° `import "go-mma/modules/customer/internal/repository"` ‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

```go
could not import go-mma/modules/customer/internal/repository (invalid use of internal package "go-mma/modules/customer/internal/repository")
```
