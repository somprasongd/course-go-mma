# ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÅ‡∏ö‡∏ö Modular Monolith

> ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö Monolith ‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏¢‡∏∏‡πà‡∏á‡πÄ‡∏´‡∏¢‡∏¥‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏Ç‡∏∂‡πâ‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡πÜ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‚Äî Modular Monolith ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
>

‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏•‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Monolith ‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ö‡∏ö **Modular Monolith** ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÑ‡∏õ‡∏™‡∏π‡πà Microservices ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÅ‡∏£‡∏Å

## ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç

- [‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏∞‡πÑ‡∏£](#‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏∞‡πÑ‡∏£)
- [‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Web Server ‡πÉ‡∏´‡πâ‡∏î‡∏µ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÅ‡∏£‡∏Å](#‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö-web-server-‡πÉ‡∏´‡πâ‡∏î‡∏µ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÅ‡∏£‡∏Å)
- [‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å logic ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å routing ‡∏î‡πâ‡∏ß‡∏¢ Handlers](#‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å-logic-‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å-routing-‡∏î‡πâ‡∏ß‡∏¢-handlers)
- [‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô](#‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô)
- [‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Layered Architecture ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢](#‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢-layered-architecture-‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢)
- [‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡πà‡∏≤‡∏¢](#‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£-error-‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡πà‡∏≤‡∏¢)
- [‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏ö‡∏ö Reusable ‡∏î‡πâ‡∏ß‡∏¢ Notification Service](#‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏ö‡∏ö-reusable-‡∏î‡πâ‡∏ß‡∏¢-notification-service)
- [‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏î‡πâ‡∏ß‡∏¢ Layered Architecture](#‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏î‡πâ‡∏ß‡∏¢-layered-architecture)
- [‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Database Transaction ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á](#‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô-database-transaction-‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
- [‡∏ô‡∏≥‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Dependency Inversion ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á](#‡∏ô‡∏≥‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£-dependency-inversion-‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á)
- [‡πÅ‡∏õ‡∏•‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏õ‡∏™‡∏π‡πà Modular Architecture ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô](#‡πÅ‡∏õ‡∏•‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏õ‡∏™‡∏π‡πà-modular-architecture-‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô)
- [‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á Subdomain](#‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á-subdomain)
- [‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Service ‡πÉ‡∏ô Monolith ‡∏î‡πâ‡∏ß‡∏¢ Service Registry](#‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£-service-‡πÉ‡∏ô-monolith-‡∏î‡πâ‡∏ß‡∏¢-service-registry)
- [‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `internal`](#‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå-internal)
- [‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Mono-Repository ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö](#‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô-mono-repository-‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)
- [‡∏Å‡∏≥‡∏´‡∏ô‡∏î Public API Contract ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•](#‡∏Å‡∏≥‡∏´‡∏ô‡∏î-public-api-contract-‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•)
- [‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏• (Data Isolation)](#‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•-data-isolation)
- [‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ Feature-Based Structure ‡πÅ‡∏•‡∏∞ CQRS](#‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢-feature-based-structure-‡πÅ‡∏•‡∏∞-cqrs)
- [‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î Event-Driven Architecture](#‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î-event-driven-architecture)
- ‡∏ö‡∏ó‡πÄ‡∏™‡∏£‡∏¥‡∏°
  - [‡∏™‡∏£‡πâ‡∏≤‡∏á API Document ‡∏î‡πâ‡∏ß‡∏¢ Swagger](#‡∏™‡∏£‡πâ‡∏≤‡∏á-api-document-‡∏î‡πâ‡∏ß‡∏¢-swagger)

---

## ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏∞‡πÑ‡∏£

‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå Monolith App ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
2. ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
3. ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå

### ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

```markdown
+------------+        +----------------------+        +-----------+
|   Client   | <----> |    Monolith App      | <----> | Database  |
+------------+        |----------------------|        +-----------+
                      |  Modules:            |
                      |    - customer        |
                      |    - order           |
                      |    - email           |
                      +----------------------+

1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (POST /customers)
---------------------------------------
Client ----> Monolith: POST /customers {email, credit}
Monolith.customer --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö email ‡∏ã‡πâ‡∏≥?
  ‚îî‚îÄ ‡∏ã‡πâ‡∏≥ --> Monolith.customer --> Client: 409 Conflict (email already exists)
  ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥:
      Monolith.customer --> Database: INSERT INTO customers
      Monolith.email --> ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
      Monolith.customer --> Client: 201 Created

2. ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (POST /orders)
-------------------------------
Client ----> Monolith: POST /orders {customer_id, order_total}
Monolith.order --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer_id
  ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏û‡∏ö --> Monolith.order --> Client: 404 Not Found (customer not found)
  ‚îî‚îÄ ‡∏û‡∏ö:
      Monolith.order --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö credit ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠?
          ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏û‡∏≠ --> Monolith.order --> Client: 422 Unprocessable Entity (insufficient credit)
          ‚îî‚îÄ ‡∏û‡∏≠:
              Monolith.order --> Database: INSERT INTO orders, UPDATE credit (‡∏´‡∏±‡∏Å‡∏¢‡∏≠‡∏î)
              Monolith.email --> ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
              Monolith.order --> Client: 201 Created

3. ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (DELETE /orders/:orderID)
---------------------------------------------
Client ----> Monolith: DELETE /orders/:orderID
Monolith.order --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö orderID
  ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏û‡∏ö --> Monolith.order --> Client: 404 Not Found (order not found)
  ‚îî‚îÄ ‡∏û‡∏ö:
      Monolith.order --> Database: DELETE order, UPDATE credit (‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î)
      Monolith.order --> Client: 204 No Content
```

### API endpoint

‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏°‡∏µ 3 API endpoint

- `POST /customers` ‚Äì ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà

    | JSON Field | Type | Required | Description |
    | --- | --- | --- | --- |
    | `email` | string | ‚úÖ | ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ |
    | `credit` | integer | ‚úÖ | ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô |

    **Response**

    | Status Code | Description |
    | --- | --- |
    | `201` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à |
    | `400` | payload ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á `email` ‡∏´‡∏£‡∏∑‡∏≠ `email` ‡∏ú‡∏¥‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö |
    | `422` | ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô business rule ‡πÄ‡∏ä‡πà‡∏ô `credit` ‚â§ 0 |
    | `409` | ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (Conflict) |

- `POST /orders` ‚Äì ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå

    | JSON Field | Type | Required | Description |
    | --- | --- | --- | --- |
    | `customer_id` | integer | ‚úÖ | ID ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ |
    | `order_total` | integer | ‚úÖ | ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå |

    **Response**

    | Status Code | Description |
    | --- | --- |
    | `201` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ |
    | `400` | ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á `customer_id` ‡∏´‡∏£‡∏∑‡∏≠ `order_total` ‚â§ 0 |
    | `404` | ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (`customer_id` ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á) |
    | `422` | ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå |

- `DELETE /orders/:orderID` ‚Äì ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå

    | Path Param | Type | Required | Description |
    | --- | --- | --- | --- |
    | `orderID` | integer | ‚úÖ | ID ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå |

    **Response**

    | Status Code | Description |
    | --- | --- |
    | `204` | ‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (No Content) |
    | `404` | ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |

---

## ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Web Server ‡πÉ‡∏´‡πâ‡∏î‡∏µ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÅ‡∏£‡∏Å

> ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Web Server ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏¢‡∏≤‡∏¢ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏• ‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß
>

‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢

- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Web Server
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ route ‡∏Ç‡∏≠‡∏á fiber
- ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö Rest API ‡∏î‡πâ‡∏ß‡∏¢ REST Client
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Graceful Shutdown
- ‡∏™‡∏£‡πâ‡∏≤‡∏á Logger ‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πà‡∏ß‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Configurations
- ‡πÉ‡∏ä‡πâ Makefile ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
- Refactor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏î
- ‡∏Å‡∏≤‡∏£ Build Web Server

### ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Web Server

‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á Web Server ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô ‡πÇ‡∏î‡∏¢‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏†‡∏≤‡∏©‡∏≤ Go ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ Fiber v3

**‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠**

- [Go](https://go.dev/dl/) version 1.24.4 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ
- [VS Code](https://code.visualstudio.com/download) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏° [Go](https://marketplace.visualstudio.com/items?itemName=golang.Go), [Error Lens](https://marketplace.visualstudio.com/items?itemName=usernamehw.errorlens), [REST Client](https://marketplace.visualstudio.com/items?itemName=humao.rest-client)

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô**

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÉ‡∏´‡∏°‡πà

    ```bash
    mkdir go-mma
    cd go-mma
    git init
    go mod init go-mma
    touch main.go
    ```

- ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

    ```bash
    tree
    .
    ‚îú‚îÄ‚îÄ go.mod
    ‚îî‚îÄ‚îÄ main.go
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Web Server ‡∏î‡πâ‡∏ß‡∏¢ Fiber v3 ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `main.go`

    ```go
    package main
    
    import (
     "fmt"
    
     "github.com/gofiber/fiber/v3"
    )
    
    var (
     Version = "local-dev"
     Time    = "n/a"
    )
    
    func main() {
     app := fiber.New(fiber.Config{
      AppName: fmt.Sprintf("Go MMA version %s", Version),
     })
    
     app.Get("/", func(c fiber.Ctx) error {
       // ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ JSON
      return c.JSON(map[string]string{"version": Version, "time": Time})
     })
    
     app.Listen(":8090")
    }
    ```

- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `go mod tidy` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á package
- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `go run main.go` ‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°

    ```bash
    go run main.go
    
        _______ __             
       / ____(_) /_  ___  _____
      / /_  / / __ \/ _ \/ ___/
     / __/ / / /_/ /  __/ /    
    /_/   /_/_.___/\___/_/          v3.0.0-beta.4
    --------------------------------------------------
    INFO Server started on:         http://127.0.0.1:8090 (bound on host 0.0.0.0 and port 3000)
    INFO Application name:          Go MMA v0.0.1
    INFO Total handlers count:      1
    INFO Prefork:                   Disabled
    INFO PID:                       47664
    INFO Total process count:       1
    ```

- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏õ‡∏¥‡∏î <http://127.0.0.1:8090> ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå

    ```json
    {
    "time": "n/a",
    "version": "local-dev"
    }
    ```

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ route ‡∏Ç‡∏≠‡∏á fiber v3

‡∏Ñ‡∏ß‡∏£‡πÅ‡∏¢‡∏Å‡∏ß‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö Routing ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÅ‡∏¢‡∏Å concerns ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô middlewares ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `main.go`

    ```go
    package main
    
    import (
      "fmt"
      
     "github.com/gofiber/fiber/v3"
     "github.com/gofiber/fiber/v3/middleware/cors"
     "github.com/gofiber/fiber/v3/middleware/logger"
     "github.com/gofiber/fiber/v3/middleware/recover"
     "github.com/gofiber/fiber/v3/middleware/requestid"
    )
    
    var (
     Version = "local-dev"
     Time    = "n/a"
    )
    
    func main() {
     app := fiber.New(fiber.Config{
      AppName: fmt.Sprintf("Go MMA version %s", Version),
     })
    
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î global middleware
     app.Use(cors.New())      // CORS ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ OPTIONS request ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
     app.Use(requestid.New()) // ‡∏™‡∏£‡πâ‡∏≤‡∏á request id ‡πÉ‡∏ô request header ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ debug
     app.Use(recover.New())   // auto-recovers from panic (internal only)
     app.Use(logger.New())    // logs HTTP request
     
     app.Get("/", func(c fiber.Ctx) error {
      return c.JSON(map[string]string{"version": Version, "time": Time})
     })
    
      // ‡πÅ‡∏¢‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ routing ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
     v1 := app.Group("/api/v1")
    
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á customer
     customers := v1.Group("/customers")
     {
      customers.Post("", func(c fiber.Ctx) error {
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î status code ‡∏î‡πâ‡∏ß‡∏¢ Status()
       return c.Status(fiber.StatusCreated).JSON(fiber.Map{"id": 1})
      })
     }
    
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á order
     orders := v1.Group("/orders")
     {
      orders.Post("", func(c fiber.Ctx) error {
       return c.Status(fiber.StatusCreated).JSON(fiber.Map{"id": 1})
      })
    
      orders.Delete("/:orderID", func(c fiber.Ctx) error {
        // ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏Ñ‡πà status code ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
       return c.SendStatus(fiber.StatusNoContent)
      })
     }
    
     app.Listen(":8090")
    }
    ```

- ‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà `go run main.go`

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö Rest API ‡∏î‡πâ‡∏ß‡∏¢ REST Client

‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ VS Code Extensions ‡∏ä‡∏∑‡πà‡∏≠ [REST Client](https://marketplace.visualstudio.com/items?itemName=humao.rest-client)

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á [REST Client](https://marketplace.visualstudio.com/items?itemName=humao.rest-client) ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà 2 ‡πÑ‡∏ü‡∏•‡πå `test/customers.http` ‡∏Å‡∏±‡∏ö `test/orders.http`
- ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

    ```bash
    tree
    .
    ‚îú‚îÄ‚îÄ go.mod
    ‚îú‚îÄ‚îÄ main.go
    ‚îî‚îÄ‚îÄ test
      ‚îú‚îÄ‚îÄ customers.http
        ‚îî‚îÄ‚îÄ orders.http
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `test/customers.http`

    ```bash
    @host = http://localhost:8090
    @base_url = api/v1/customers
    ### Create Customer
    POST {{host}}/{{base_url}} HTTP/1.1
    content-type: application/json
    
    {
      "email": "cust@example.com",
      "credit": 1000
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `tests/orders.http`

    ```bash
    @host = http://localhost:8090
    @base_url = api/v1/orders
    @customer_id = 1
    @order_id = 1
    ### Create Order
    POST {{host}}/{{base_url}} HTTP/1.1
    content-type: application/json
    
    {
      "customer_id": {{customer_id}},
      "order_total": 100
    }
    
    ### Cancel Order
    DELETE {{host}}/{{base_url}}/{{order_id}} HTTP/1.1
    ```

- ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ `Send Request`

    ```bash
    @host = http://localhost:8090
    @base_url = api/v1/customers
    ### Create Customer
    Send Request
    POST {{host}}/{{base_url}} HTTP/1.1
    content-type: application/json
    
    {
      "email": "cust@example.com",
      "credit": 1000
    }
    ```

- ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

    ```bash
    HTTP/1.1 201 Created
    Date: Thu, 29 May 2025 04:07:11 GMT
    Content-Type: application/json
    Content-Length: 11
    Connection: close
    
    {
      "id": 1
    }
    ```

### ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Graceful Shutdown

‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Web Server ‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö production ‡∏™‡∏¥‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏°‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏∑‡∏≠ **Graceful Shutdown ‚Äî ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà**

> ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏Ñ‡∏∑‡∏≠: ‚Äú‡∏≠‡∏¢‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÉ‡∏´‡πâ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Å‡πà‡∏≠‡∏ô‚Äù
>

‡∏ó‡∏≥‡πÑ‡∏°‡∏ñ‡∏∂‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç?

- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÜ ‡∏Å‡∏•‡∏≤‡∏á‡πÜ
- ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞ service ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
- ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ deploy ‡∏´‡∏£‡∏∑‡∏≠ restart ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏≤‡∏ö‡∏£‡∏∑‡πà‡∏ô ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Graceful Shutdown ‡∏î‡πâ‡∏ß‡∏¢‡∏†‡∏≤‡∏©‡∏≤ Go

- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å **‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ start server** ‡πÑ‡∏õ‡∏£‡∏±‡∏ô‡πÉ‡∏ô goroutine ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ main thread ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì shutdown ‡πÑ‡∏î‡πâ

    ```go
    // ‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤ run server ‡πÉ‡∏ô goroutine
    go func() {
      if err := app.Listen(":8090"); err != nil && err != http.ErrServerClosed {
        log.Fatalf("Error starting server: %v", err)
      }
    }()
    ```

- ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô **‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì OS** ‡πÄ‡∏ä‡πà‡∏ô `SIGINT` ‡∏´‡∏£‡∏∑‡∏≠ `SIGTERM` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ shutdown

    ```go
    // ‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î
    stop := make(chan os.Signal, 1)
    signal.Notify(stop, os.Interrupt, syscall.SIGTERM)
    <-stop
    ```

- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏° **‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏±‡∏ö request ‡πÉ‡∏´‡∏°‡πà** ‡πÅ‡∏•‡πâ‡∏ß **‡∏£‡∏≠‡πÉ‡∏´‡πâ request ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à** ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô timeout ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡πÄ‡∏ä‡πà‡∏ô 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏õ‡∏¥‡∏î resource ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô DB connection

    ```go
    log.Println("Shutting down...")
    
    // **‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏±‡∏ö** request **‡πÉ‡∏´‡∏°‡πà** ‡πÅ‡∏•‡πâ‡∏ß **‡∏£‡∏≠‡πÉ‡∏´‡πâ** request **‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à** ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô timeout ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡πÄ‡∏ä‡πà‡∏ô 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
    ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
    defer cancel()
    if err := app.ShutdownWithContext(ctx); err != nil {
      log.Fatalf("Error shutting down server: %v", err)
    }
    
    // Optionally: ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏õ‡∏¥‡∏î resource ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô DB connection, cleanup, etc.
    
    log.Println("Shutdown complete.")
    ```

- ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ‡πÅ‡∏Å‡πâ endpoint ‡∏™‡∏£‡πâ‡∏≤‡∏á customer ‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

    ```go
    customers.Post("", func(c fiber.Ctx) error {
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö Graceful Shutdown
     time.Sleep(3 * time.Second)
     return c.Status(fiber.StatusCreated).JSON(fiber.Map{"id": 1})
    })
    ```

- ‡∏£‡∏±‡∏ô server ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `/customers` ‚Üí ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î `Ctrl+C` ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà request ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡∏ö ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ server **‡∏£‡∏≠‡∏à‡∏ô‡∏à‡∏ö** ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞ shutdown

    ```go
    2025/05/29 12:00:07 Shutting down...
    12:00:06 | 201 |  3.001456625s |       127.0.0.1 | POST    | /api/v1/customers       
    2025/05/29 12:00:09 Shutdown complete.
    ```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Logger ‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πà‡∏ß‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ

‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ log ‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ **‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö log ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô** ‡∏à‡∏∂‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á **centralized logger** ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/logger/logger.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î logger ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô
‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `zap` ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö `ecszap` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á log ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Elastic Stack ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

    ```go
    package logger
    
    import (
     "go.elastic.co/ecszap"
     "go.uber.org/zap"
    )
    
    type closeLog func() error
    
    var Log *zap.Logger
    
    func Init() (closeLog, error) {
     config := zap.NewDevelopmentConfig()
     // ‡πÉ‡∏ä‡πâ zap ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö ecszap ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á log ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Elastic Stack ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
     config.EncoderConfig = ecszap.ECSCompatibleEncoderConfig(config.EncoderConfig)
    
     var err error
     Log, err = config.Build(ecszap.WrapCoreOption())
    
     if err != nil {
      return nil, err
     }
    
     return func() error {
      return Log.Sync()
     }, nil
    }
    
    func With(fields ...zap.Field) *zap.Logger {
     return Log.With(fields...)
    }
    ```

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy`
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô logger ‡∏à‡∏≤‡∏Å `main.go` ‡πÇ‡∏î‡∏¢‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ `init` ‡πÅ‡∏•‡∏∞ `defer` ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö `log.Sync()`

    ```go
    func main() {
     closeLog, err := logger.Init()
     if err != nil {
      panic(err.Error())
     }
     defer closeLog()
    
     // ...
    }
    ```

- ‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ `log.Println` ‡∏´‡∏£‡∏∑‡∏≠ `log.Fatal` ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ `logger.Log` ‡πÅ‡∏ó‡∏ô ‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ö context ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ `logger.With(...)`

    ```go
     func main() {
     // ...
     
     // ‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤ run server ‡πÉ‡∏ô goroutine
     go func() {
       if err := app.Listen(":8090"); err != nil && err != http.ErrServerClosed {
         logger.Log.Fatal(fmt.Sprintf("Error starting server: %v", err))
       }
     }()
     
     // ‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î
     stop := make(chan os.Signal, 1)
     signal.Notify(stop, os.Interrupt, syscall.SIGTERM)
     <-stop
     
     logger.Log.Info("Shutting down...")
     
     // ‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏±‡∏ö request ‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡πÉ‡∏´‡πâ request ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô timeout ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡πÄ‡∏ä‡πà‡∏ô 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
     ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
     defer cancel()
     if err := app.ShutdownWithContext(ctx); err != nil {
       logger.Log.Fatal(fmt.Sprintf("Error shutting down server: %v", err))
     }
     
     // Optionally: ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏õ‡∏¥‡∏î resource ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô DB connection, cleanup, etc.
    
     logger.Log.Info("Shutdown complete.")
    }
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏° middleware `RequestLogger` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ log ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô HTTP ‡πÄ‡∏ä‡πà‡∏ô method, path, status code ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á log error ‡πÅ‡∏•‡∏∞ stack trace ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î panic ‡∏´‡∏£‡∏∑‡∏≠ unhandled error

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `application/middleware/request_logger.go`
    >

    ```go
    package middleware
    
    import (
     "fmt"
     "go-mma/util/logger"
     "runtime/debug"
     "time"
    
     "github.com/gofiber/fiber/v3"
     "go.uber.org/zap"
    )
    
    func RequestLogger() fiber.Handler {
     return func(c fiber.Ctx) error {
      start := time.Now()
    
      log := logger.With(
       zap.String("requestId", c.GetRespHeader("X-Request-ID")),
       zap.String("method", c.Method()),
       zap.String("path", c.Path()),
      )
    
        // catch panic
      defer func() {
       if r := recover(); r != nil {
        printAccessLog(log, c.Method(), c.Path(), start, fiber.StatusInternalServerError, r)
        panic(r) // throw panic to recover middleware
       }
      }()
    
      err := c.Next()
    
      status := c.Response().StatusCode()
      if err != nil {
       switch e := err.(type) {
       case *fiber.Error:
        status = e.Code
       default: // case error
        status = fiber.StatusInternalServerError
       }
      }
    
      printAccessLog(log, c.Method(), c.Path(), start, status, err)
    
      return err
     }
    }
    
    func printAccessLog(log *zap.Logger, method string, uri string, start time.Time, status int, err any) {
     if err != nil {
      // log unhandle error
      log.Error("an error occurred",
       zap.Any("error", err),
       zap.ByteString("stack", debug.Stack()),
      )
     }
    
     msg := fmt.Sprintf("%d - %s %s", status, method, uri)
    
     log.Info(msg,
      zap.Int("status", status),
      zap.Duration("latency", time.Since(start)))
    }
    
    ```

- ‡πÉ‡∏ô `main.go` ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ middleware `RequestLogger` ‡πÅ‡∏ó‡∏ô log ‡πÄ‡∏î‡∏¥‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å request ‡∏ñ‡∏π‡∏Å log ‡∏î‡πâ‡∏ß‡∏¢ format ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±

    ```go
    // global middleware
    app.Use(cors.New())                 // CORS ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ OPTIONS request ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
    app.Use(requestid.New())            // ‡∏™‡∏£‡πâ‡∏≤‡∏á request id ‡πÉ‡∏ô request header ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ debug
    app.Use(recover.New())              // auto-recovers from panic (internal only)
    app.Use(middleware.RequestLogger()) // logs HTTP request
    ```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏≠‡∏á‡∏£‡∏±‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ log ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ debug ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Configurations

‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏Ç‡∏≠‡∏á HTTP Server ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (graceful shutdown) ‡∏ã‡∏∂‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏ï‡∏≤‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞ environment ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ build ‡πÉ‡∏´‡∏°‡πà

‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏∑‡∏≠ ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ú‡πà‡∏≤‡∏ô environment variables ‡πÑ‡∏î‡πâ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£ deploy ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ environment variables ‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏à‡∏∂‡∏á‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á utility ‡∏ä‡∏∑‡πà‡∏≠ `env` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å environment variables ‡∏û‡∏£‡πâ‡∏≠‡∏° fallback ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ default ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/env/env.go`

    ```go
    package env
    
    import (
      "os"
      "strconv"
      "time"
    )
    
    func Get(key string) string {
      v, ok := os.LookupEnv(key)
      if !ok {
        return ""
      }
      return v
    }
    
    func GetDefault(key string, defaultValue string) string {
      v, ok := os.LookupEnv(key)
      if !ok {
        return defaultValue
      }
      return v
    }
    
    func GetInt(key string) int {
      v, err := strconv.Atoi(Get(key))
      if err != nil {
        return 0
      }
      return v
    }
    
    func GetIntDefault(key string, defaultValue int) int {
      v, err := strconv.Atoi(Get(key))
      if err != nil {
        return defaultValue
      }
      return v
    }
    func GetFloat(key string) float64 {
      v, err := strconv.ParseFloat(Get(key), 64)
      if err != nil {
        return 0.0
      }
      return v
    }
    
    func GetFloatDefault(key string, defaultValue float64) float64 {
      v, err := strconv.ParseFloat(Get(key), 64)
      if err != nil {
        return defaultValue
      }
      return v
    }
    
    func GetBool(key string) bool {
      v := Get(key)
      switch v {
      case "true", "yes":
        return true
      case "false", "no":
        return false
      default:
        return false
      }
    }
    func GetBoolDefault(key string, defaultValue bool) bool {
      v := Get(key)
      switch v {
      case "true", "yes":
        return true
      case "false", "no":
        return false
      default:
        return defaultValue
      }
    }
    
    func GetDuration(key string) time.Duration {
      v := Get(key)
      if len(v) == 0 {
        return 0
      }
      d, err := time.ParseDuration(v)
      if err != nil {
        return 0
      }
      return d
    }
    
    func GetDurationDefault(key string, defaultValue time.Duration) time.Duration {
      v := Get(key)
      if len(v) == 0 {
        return defaultValue
      }
      d, err := time.ParseDuration(v)
      if err != nil {
        return defaultValue
      }
      return d
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `main.go` ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å environment ‡πÅ‡∏ó‡∏ô

    ```go
    func main() {
     // ...
     go func() {
       // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î env ‡∏°‡∏≤‡πÉ‡∏´‡πâ default 8090
      if err := app.Listen(fmt.Sprintf(":%d", env.GetIntDefault("HTTP_PORT", 8090))); err != nil && err != http.ErrServerClosed {
       // ...
      }
     }()
     // ...
     
     // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î env ‡∏°‡∏≤‡πÉ‡∏´‡πâ default 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
     ctx, cancel := context.WithTimeout(context.Background(), env.GetDurationDefault("GRACEFUL_TIMEOUT", 5*time.Second))
     // ...
    }
    ```

- ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ú‡πà‡∏≤‡∏ô environment variables

    ```bash
    HTTP_PORT=8091 GRACEFUL_TIMEOUT=10s go run main.go
    ```

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏à‡∏∂‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á package `config` ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å environment ‡∏ú‡πà‡∏≤‡∏ô `env` ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (validation) ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ HTTP_PORT ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `config/config.go`

    ```go
    package config
    
    import (
     "errors"
     "go-mma/util/env"
     "time"
    )
    
    var (
     ErrInvalidHTTPPort = errors.New("HTTP_PORT must be a positive integer")
     ErrGracefulTimeout = errors.New("GRACEFUL_TIMEOUT must be a positive duration")
    )
    
    // ‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    type Config struct {
     HTTPPort        int
     GracefulTimeout time.Duration
    }
    
    func Load() (*Config, error) {
     config := &Config{
      HTTPPort:        env.GetIntDefault("HTTP_PORT", 8090),
      GracefulTimeout: env.GetDurationDefault("GRACEFUL_TIMEOUT", 5*time.Second),
     }
     err := config.Validate()
     if err != nil {
      return nil, err
     }
     return config, err
    }
    
    func (c *Config) Validate() error {
     if c.HTTPPort <= 0 {
      return ErrInvalidHTTPPort
     }
     if c.GracefulTimeout <= 0 {
      return ErrGracefulTimeout
     }
    
     return nil
    }
    ```

- ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô `config` ‡πÉ‡∏ô `main.go`

    ```go
    func main() {
      // logger
     config, err := config.Load()
     if err != nil {
      panic(err.Error())
     }
     
      // ...
      
     go func() {
      if err := app.Listen(fmt.Sprintf(":%d", config.HTTPPort)); err != nil && err != http.ErrServerClosed {
        // ...
      }
     }()
     
     // ...
     
     ctx, cancel := context.WithTimeout(context.Background(), config.GracefulTimeout)
     
     // ...
    }
    ```

### ‡πÉ‡∏ä‡πâ Makefile ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î environment variables ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ‡∏à‡∏∂‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Makefile ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `.env` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ç‡∏ì‡∏∞‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°

    ```
    HTTP_PORT=8090
    GRACEFUL_TIMEOUT=5s
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `.gitignore` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå `.env` ‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ git

    ```
    *.env
    ```

    <aside>
    üí°

    ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á config ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå `.env` ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô `.env.example` ‡πÅ‡∏ó‡∏ô ‡πÅ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

    </aside>

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `Makefile` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°

    ```makefile
    include .env
    export
    
    .PHONY: run
    run:
     go run main.go
    ```

- ‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `make run`

    ```bash
    make run
    
        _______ __             
       / ____(_) /_  ___  _____
      / /_  / / __ \/ _ \/ ___/
     / __/ / / /_/ /  __/ /    
    /_/   /_/_.___/\___/_/          v3.0.0-beta.4
    --------------------------------------------------
    INFO Server started on:         http://127.0.0.1:8090 (bound on host 0.0.0.0 and port 8090)
    INFO Application name:          Go MMA v0.0.1
    INFO Total handlers count:      6
    INFO Prefork:                   Disabled
    INFO PID:                       31427
    INFO Total process count:       1
    ```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏à‡∏≤‡∏Å `.env` ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ã‡πâ‡∏≥

### Refactor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏î

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏Ç‡∏∂‡πâ‡∏ô ‡πÑ‡∏ü‡∏•‡πå `main.go` ‡∏°‡∏±‡∏Å‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏°‡∏µ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `main.go` ‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `cmd/api/main.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å entrypoint ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å business logic
- ‡∏õ‡∏£‡∏±‡∏ö `Makefile` ‡πÉ‡∏´‡πâ‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á `main.go`

    ```makefile
    include .env
    export
    
    .PHONY: run
    run:
     go run cmd/api/main.go
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `build/build.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á build version ‡πÅ‡∏•‡∏∞ build time

    ```go
    package build
    
    var (
     Version = "local-dev"
     Time    = "n/a"
    )
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `application/http.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á HTTP server, middleware ‡πÅ‡∏•‡∏∞ route registration

    ```go
    package application
    
    import (
     "context"
     "fmt"
     "go-mma/application/middleware"
     "go-mma/build"
     "go-mma/config"
     "go-mma/util/logger"
     "net/http"
     "time"
    
     "github.com/gofiber/fiber/v3"
     "github.com/gofiber/fiber/v3/middleware/cors"
     "github.com/gofiber/fiber/v3/middleware/recover"
     "github.com/gofiber/fiber/v3/middleware/requestid"
    )
    
    type HTTPServer interface {
     Start()
     Shutdown() error
     RegisterRoutes()
    }
    
    type httpServer struct {
     config config.Config
     app    *fiber.App
    }
    
    func newHTTPServer(config config.Config) HTTPServer {
     return &httpServer{
      config: config,
      app:    newFiber(),
     }
    }
    
    func newFiber() *fiber.App {
     app := fiber.New(fiber.Config{
      AppName: fmt.Sprintf("Go MMA version %s", build.Version),
     })
    
     // global middleware
      app.Use(cors.New())                 // CORS ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ OPTIONS request ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
     app.Use(requestid.New())            // ‡∏™‡∏£‡πâ‡∏≤‡∏á request id ‡πÉ‡∏ô request header ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ debug
     app.Use(recover.New())              // auto-recovers from panic (internal only)
     app.Use(middleware.RequestLogger()) // logs HTTP request
     
     app.Get("/", func(c fiber.Ctx) error {
      return c.JSON(map[string]string{"version": build.Version, "time": build.Time})
     })
    
     return app
    }
    
    func (s *httpServer) Start() {
     go func() {
      logger.Log.Info(fmt.Sprintf("Starting server on port %d", s.config.HTTPPort))
      if err := s.app.Listen(fmt.Sprintf(":%d", s.config.HTTPPort)); err != nil && err != http.ErrServerClosed {
       logger.Log.Fatal(fmt.Sprintf("Error starting server: %v", err))
      }
     }()
    }
    
    func (s *httpServer) Shutdown() error {
     ctx, cancel := context.WithTimeout(context.Background(), s.config.GracefulTimeout)
     defer cancel()
     return s.app.ShutdownWithContext(ctx)
    }
    
    func (s *httpServer) RegisterRoutes() {
     v1 := s.app.Group("/api/v1")
    
     customers := v1.Group("/customers")
     {
      customers.Post("", func(c fiber.Ctx) error {
       time.Sleep(3 * time.Second)
       return c.Status(fiber.StatusCreated).JSON(fiber.Map{"id": 1})
      })
     }
    
     orders := v1.Group("/orders")
     {
      orders.Post("", func(c fiber.Ctx) error {
       return c.Status(fiber.StatusCreated).JSON(fiber.Map{"id": 1})
      })
    
      orders.Delete("/:orderID", func(c fiber.Ctx) error {
       return c.SendStatus(fiber.StatusNoContent)
      })
     }
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `application/application.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ lifecycle ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ (‡πÄ‡∏ä‡πà‡∏ô start/shutdown)

    ```go
    package application
    
    import (
     "go-mma/config"
     "log"
    )
    
    type Application struct {
     config     config.Config
     httpServer HTTPServer
    }
    
    func New(config config.Config) *Application {
     return &Application{
      config:     config,
      httpServer: newHTTPServer(config),
     }
    }
    
    func (app *Application) Run() error {
     app.httpServer.Start()
    
     return nil
    }
    
    func (app *Application) Shutdown() error {
     // Gracefully close fiber server
     logger.Log.Info("Shutting down server")
     if err := app.httpServer.Shutdown(); err != nil {
      logger.Log.Fatal(fmt.Sprintf("Error shutting down server: %v", err))
     }
     logger.Log.Info("Server stopped")
    
     return nil
    }
    
    func (app *Application) RegisterRoutes() {
     app.httpServer.RegisterRoutes()
    }
    ```

- ‡∏õ‡∏£‡∏±‡∏ö `main.go` ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£ bootstrap ‡∏£‡∏∞‡∏ö‡∏ö ‡πÄ‡∏ä‡πà‡∏ô init logger, ‡πÇ‡∏´‡∏•‡∏î config, start app, handle graceful shutdown

    ```go
    package main
    
    import (
     "go-mma/application"
     "go-mma/config"
     "log"
     "os"
     "os/signal"
     "syscall"
    )
    
    func main() {
     // logger
     // config
    
     app := application.New(*config)
     app.RegisterRoutes()
     app.Run()
    
     // Wait for shutdown signal
     // stop
     
     app.Shutdown()
    
     // Optionally: close DB, cleanup, etc.
    
     logger.Log.Info("Shutdown complete.")
    }
    ```

‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô `main.go` ‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å Single Responsibility Principle

### ‡∏Å‡∏≤‡∏£ Build Web Server

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÅ‡∏≠‡∏õ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á (deploy) ‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤ Go ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ build ‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡πá‡∏ô binary ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡∏£‡∏±‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á

- ‡∏õ‡∏£‡∏±‡∏ö `Makefile` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á build

    ```bash
    # ...
    
    ROOT_DIR := $(dir $(realpath $(lastword $(MAKEFILE_LIST))))
    # ‡∏ñ‡πâ‡∏≤ BUILD_VERSION ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏ã‡πá‡∏ï‡πÉ‡∏ô .env, ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ git tag ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ tag ‡∏à‡∏∞ fallback ‡πÄ‡∏õ‡πá‡∏ô "unknown")
    BUILD_VERSION := $(or ${BUILD_VERSION}, $(shell git describe --tags --abbrev=0 2>/dev/null || echo "unknown"))
    BUILD_TIME := $(shell date +"%Y-%m-%dT%H:%M:%S%z")
    
    .PHONY: build
    build:
     go build -ldflags \
     "-s -w \
     -X 'go-mma/build.Version=${BUILD_VERSION}' \
     -X 'go-mma/build.Time=${BUILD_TIME}'" \
     -o app cmd/api/main.go
    ```

    > `-ldflags="-s -w"` ‡∏Ñ‡∏∑‡∏≠ flag ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö `go build` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ **strip debugging information** ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å binary ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á

- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á build ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î build version

    ```bash
    BUILD_VERSION=0.0.1 make build
    ```

‡∏≠‡∏µ‡∏Å‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ package ‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡πá‡∏ô Docker image ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö isolated ‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏° deploy

- ‡∏™‡∏£‡πâ‡∏≤‡∏á `Dockerfile`

    ```docker
    # Builder stage
    FROM golang:1.24-alpine AS builder
    WORKDIR /app
    COPY go.mod go.sum ./
    RUN go mod download
    COPY . .

    # ‡∏õ‡∏¥‡∏î cgo (CGO_ENABLED=0)
    ENV CGO_ENABLED=0 \
        GOOS=linux \
        GOARCH=amd64

    # ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ default ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö VERSION
    ARG VERSION=latest
    ENV IMAGE_VERSION=${VERSION}
    RUN echo "Build version: $IMAGE_VERSION"
    RUN go build -ldflags \
    # strip debugging information ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å binary ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á
        "-s -w \
        -X 'go-mma/build.Version=${IMAGE_VERSION}' \
        -X 'go-mma/build.Time=$(date +"%Y-%m-%dT%H:%M:%S%z")'" \
        -o /app/app cmd/api/main.go

    # Final stage
    FROM alpine:3.22
    RUN apk add --no-cache ca-certificates tzdata && \
            # ‡∏™‡∏£‡πâ‡∏≤‡∏á non-root user
        addgroup -S appgroup && adduser -S appuser -G appgroup 
        
    WORKDIR /app
    COPY --from=builder /app/app .
    USER appuser
    EXPOSE 8090
    ENV TZ=Asia/Bangkok

    # ‡πÉ‡∏ä‡πâ ENTRYPOINT ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏´‡∏ô
    ENTRYPOINT ["./app"]
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á `.dockerignore` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ exclude ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ build

    ```
    .git
    .env
    Dockerfile
    Makefile
    *.md
    ```

- ‡∏õ‡∏£‡∏±‡∏ö `Makefile` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á image

    ```bash
    # build:
    
    .PHONY: image
    image:
     docker build \
     -t go-mma:${BUILD_VERSION} \
     --build-arg VERSION=${BUILD_VERSION} \
     .
    ```

- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á build ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î build version

    ```bash
    BUILD_VERSION=0.0.1 make image
    ```

- ‡∏£‡∏±‡∏ô container ‡∏à‡∏≤‡∏Å image

    ```bash
    docker run --name go-mma --env-file .env -p 8090:8090 go-mma:0.0.1
    ```

---

## ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å logic ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å routing ‡∏î‡πâ‡∏ß‡∏¢ Handlers

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å concerns ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á routing ‡πÅ‡∏•‡∏∞ business logic ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á handler ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° feature

- `handler/customer.go` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
- `handler/order.go` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå

### Customer Handler

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á customer handler

```markdown
‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (POST /customers)
---------------------------------------
Client ----> Routing: POST /customers {email, credit}
Handler.customer --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö email ‡∏ã‡πâ‡∏≥?
  ‚îî‚îÄ ‡∏ã‡πâ‡∏≥ --> Handler.customer --> Client: 409 Conflict (email already exists)
  ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥:
      Handler.customer --> Database: INSERT INTO customers
      Module.email --> ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
      Handler.customer --> Client: 201 Created
```

‡∏™‡∏£‡πâ‡∏≤‡∏á customer handler

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `handler/customer.go`

    ```go
    package handler
    
    import (
     "fmt"
     "go-mma/util/logger"
     "net/mail"
    
     "github.com/gofiber/fiber/v3"
    )
    
    type CustomerHandler struct {
    }
    
    func NewCustomerHandler() *CustomerHandler {
     return &CustomerHandler{}
    }
    
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î payload structure (DTO: Request)
     type CreateCustomerRequest struct {
      Email  string `json:"email"`
      Credit int    `json:"credit"`
     }
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á error 400
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": err.Error()})
     }
    
     logger.Log.Info(fmt.Sprintf("Received customer: %v", req))
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if req.Email == "" {
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": "email is required"})
     }
     if _, err := mail.ParseAddress(req.Email); err != nil {
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": "email is invalid"})
     }
     if req.Credit <= 0 {
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": "credit must be greater than 0"})
     }
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // TODO: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö email ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     // if exists {
     //  return c.Status(fiber.StatusConflict).JSON(fiber.Map{"error": "email already exists"})
     // }
    
     // TODO: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     var id int64 // id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ (DTO: Response)
     type CreateCustomerResponse struct {
      ID int64 `json:"id"`
     }
     resp := &CreateCustomerResponse{ID: id}
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    ```

- ‡πÅ‡∏Å‡πâ `application/http.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ bind handler

    ```go
    customers := v1.Group("/customers")
    {
     hdl := handler.NewCustomerHandler()
     customers.Post("", hdl.CreateCustomer)
    }
    ```

    ```go
    package handler
    
    import (
     "fmt"
     "go-mma/util/logger"
     "strconv"
    
     "github.com/gofiber/fiber/v3"
    )
    
    type OrderHandler struct {
    }
    
    func NewOrderHandler() *OrderHandler {
     return &OrderHandler{}
    }
    
    func (h *OrderHandler) CreateOrder(c fiber.Ctx) error {
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î payload structure (DTO: Request)
     type CreateOrderRequest struct {
      CustomerID string `json:"customer_id"`
      OrderTotal int    `json:"order_total"`
     }
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req CreateOrderRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á error 400
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": err.Error()})
     }
    
     logger.Log.Info(fmt.Sprintf("Received Order: %v", req))
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if req.CustomerID == "" {
      return c.Status(fiber.StatusUnprocessableEntity).JSON(fiber.Map{"error": "customer_id is required"})
     }
     if req.OrderTotal <= 0 {
      return c.Status(fiber.StatusUnprocessableEntity).JSON(fiber.Map{"error": "order_total must be greater than 0"})
     }
    
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // TODO: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ customer id ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
     // customer := getCustomer(order.CustomerID)
     // if customer == nil {
     //  return return c.Status(fiber.StatusNotFound).JSON(fiber.Map{"error": "the customer with given id was not found"})
     // }
     
     // TODO: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö credit ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
     // if credit < payload.OrderTotal {
     //  return c.Status(fiber.StatusUnprocessableEntity).JSON(fiber.Map{"error": "insufficient credit"})
     // }
    
     // TODO: ‡∏´‡∏±‡∏Å‡∏¢‡∏≠‡∏î credit ‡∏Ç‡∏≠‡∏á customer
    
     // TODO: update customer's credit balance ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    
     // TODO: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     var id int64
    
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ (DTO: Response)
     type CreateOrderResponse struct {
      ID int6464 `json:"id"`
     }
     resp := &CreateOrderResponse{ID: id}
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    
    func (h *OrderHandler) CancelOrder(c fiber.Ctx) error {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á orderID
     orderID, err := strconv.Atoi(c.Params("orderID"))
     if err != nil {
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á error 400
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": "invalid order id"})
     }
    
     logger.Log.Info(fmt.Sprintf("Cancelling order: %v", orderID))
    
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // TODO: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö orderID ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     // order := getOrder(orderID)
     // if order == nil {
     //  return c.Status(fiber.StatusNotFound).JSON(fiber.Map{"error": "the order with given id was not found"})
     // }
    
     // TODO: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ customer ‡∏à‡∏≤‡∏Å customerID ‡∏Ç‡∏≠‡∏á order
     // customer := getCustomer(order.CustomerID)
     // if customer == nil {
     //  return return c.Status(fiber.StatusNotFound).JSON(fiber.Map{"error": "the customer with given id was not found"})
     // }
    
     // TODO: ‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit ‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏´‡πâ customer
     // creditLimit += CreateOrderRequest.OrderTotal
    
     // TODO: update customer's credit balance ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    
     // TODO: update ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á order ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô cancel
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 204 (no content)
     return c.SendStatus(fiber.StatusNoContent)
    }
    ```

### Order Handler

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á order handler

```markdown
‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (POST /orders)
-------------------------------
Client ----> Routing: POST /orders {customer_id, order_total}
Handler.order --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer_id
  ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏û‡∏ö --> Handler.order --> Client: 404 Not Found (customer not found)
  ‚îî‚îÄ ‡∏û‡∏ö:
      Handler.order --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö credit ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠?
          ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏û‡∏≠ --> Monolith.order --> Client: 422 Unprocessable Entity (insufficient credit)
          ‚îî‚îÄ ‡∏û‡∏≠:
              Handler.order --> Database: INSERT INTO orders, UPDATE credit (‡∏´‡∏±‡∏Å‡∏¢‡∏≠‡∏î)
              Module.email --> ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
              Handler.order --> Client: 201 Created

‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (DELETE /orders/:orderID)
---------------------------------------------
Client ----> Routing: DELETE /orders/:orderID
Handler.order --> Database: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö orderID
  ‚îî‚îÄ ‡πÑ‡∏°‡πà‡∏û‡∏ö --> Handler.order --> Client: 404 Not Found (order not found)
  ‚îî‚îÄ ‡∏û‡∏ö:
      Handler.order --> Database: DELETE order, UPDATE credit (‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î)
      Handler.order --> Client: 204 No Content
```

‡∏™‡∏£‡πâ‡∏≤‡∏á order handler

- ‡πÉ‡∏ô `handler/order.go`
- ‡πÅ‡∏Å‡πâ `application/http.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ bind handler

    ```go
    orders := v1.Group("/orders")
    {
     hdl := handler.NewOrderHandler()
     orders.Post("", hdl.CreateOrder)
     orders.Delete("/:orderID", hdl.CancelOrder)
    }
    ```

## ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô

‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏£‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á PostgreSQL ‡∏î‡πâ‡∏ß‡∏¢ Docker
- ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Schema ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Schema ‡∏î‡πâ‡∏ß‡∏¢ Migration Tool
- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Database Connection ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Gen ID
- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Database ‡∏î‡πâ‡∏ß‡∏¢ Dependency Injection
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Insert Customer)

### ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á PostgreSQL ‡∏î‡πâ‡∏ß‡∏¢ Docker

‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ PostgreSQL ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏î‡πâ‡∏ß‡∏¢ docker

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `docker-compose.yml` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á postgres service

    ```yaml
    services:
      db:
        image: postgres:17-alpine
        container_name: go-mma-db
        volumes:
          - pg_data:/var/lib/postgresql/data
    
    volumes:
      pg_data:
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `docker-compose.dev.yml` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î environtment ‡∏Ç‡∏≠‡∏á `dev`

    ```yaml
    services:
      db:
        environment:
          POSTGRES_DB: go-mma-db
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: postgres
        ports:
          - 5433:5432
    ```

    <aside>
    üí°

    ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö environtment ‡∏Ç‡∏≠‡∏á `test` ‡πÅ‡∏•‡∏∞ `production` ‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á

    </aside>

- ‡∏£‡∏±‡∏ô PostgreSQL Server ‡∏î‡πâ‡∏ß‡∏¢ `Makefile` ‡πÇ‡∏î‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

    ```bash
    # ...
    
    .PHONY: devup
    devup:
     docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d
    
    .PHONY: devdown
    devdown:
     docker compose -f docker-compose.yml -f docker-compose.dev.yml down
    ```

- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `make devup`

### ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Schema ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°

```sql
+------------------+           +------------------+
|   customers      |           |     orders       |
+------------------+           +------------------+
| id (PK)          |<--------+ | id (PK)          |
| email (UNIQUE)   |         | | customer_id (FK) |
| credit           |         | | order_total      |
| created_at       |         | | created_at       |
| updated_at       |         | | canceled_at       |
+------------------+         | +------------------+
                             |
      [1] ---------------- [*]
     1 customer      ‚Üí   many orders
```

### ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Schema ‡∏î‡πâ‡∏ß‡∏¢ Migration Tool

**Database Migration** ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏≤‡∏£‡∏≤‡∏á, ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå, ‡∏î‡∏±‡∏ä‡∏ô‡∏µ ‡∏Ø‡∏•‡∏Ø) ‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° (dev, staging, production) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏≤‡∏ö‡∏£‡∏∑‡πà‡∏ô

- ‡πÄ‡∏û‡∏¥‡πà‡∏° Environment Variable ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠

    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ `DB_DSN` ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `.env` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö connection string ‡∏Ç‡∏≠‡∏á PostgreSQL

    ```
    DB_DSN=postgres://postgres:postgres@localhost:5433/go-mma-db?sslmode=disable
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Migration ‡πÉ‡∏ô Makefile
‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `Makefile` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô migration ‡∏ú‡πà‡∏≤‡∏ô Docker

    ```makefile
    # ...
    
    .PHONY: mgc
    # Example: make mgc filename=create_customer
    mgc:
     docker run --rm -v $(ROOT_DIR)migrations:/migrations migrate/migrate -verbose create -ext sql -dir /migrations $(filename)
    
    .PHONY: mgu
    mgu:
     docker run --rm --network host -v $(ROOT_DIR)migrations:/migrations migrate/migrate -verbose -path=/migrations/ -database "$(DB_DSN)" up
    
    .PHONY: mgd
    mgd:
     docker run --rm --network host -v $(ROOT_DIR)migrations:/migrations migrate/migrate -verbose -path=/migrations/ -database $(DB_DSN) down 1
    ```

    <aside>
    üí°

    ‡∏´‡∏≤‡∏Å‡πÉ‡∏ä‡πâ Docker Desktop ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô host networking ‡πÇ‡∏î‡∏¢‡πÑ‡∏õ‡∏ó‡∏µ‡πà `Settings ‚Üí Resources ‚Üí Network` ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Enable host networking" ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î Apply & Restart

    </aside>

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Migration ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Customer
‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á migration ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á `customers`

    ```bash
    make mgc filename=create_customer
    ```

    ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå 2 ‡πÑ‡∏ü‡∏•‡πå

    ```bash
    ./migrations/20250529103238_create_customer.up.sql
    ./migrations/20250529103238_create_customer.down.sql
    ```

    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `create_customer.up.sql`

    ```sql
    CREATE TABLE public.customers (
     id BIGINT NOT NULL,
     email text NOT NULL,
     credit int4 NOT NULL,
     created_at timestamp DEFAULT CURRENT_TIMESTAMP NULL,
     updated_at timestamp DEFAULT CURRENT_TIMESTAMP NULL,
     CONSTRAINT customers_pkey PRIMARY KEY (id),
     CONSTRAINT customers_unique UNIQUE (email)
    );
    ```

    ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå `create_customer.down.sql`

    ```sql
    drop table public.customers;
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Migration ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Order
‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

    ```bash
    make mgc filename=create_order
    ```

    ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏ü‡∏•‡πå

    ```bash
    ./migrations/20250529103715_create_order.up.sql
    ./migrations/20250529103715_create_order.down.sql
    ```

    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `create_order.up.sql`

    ```sql
    CREATE TABLE public.orders (
     id BIGINT NOT NULL,
     customer_id BIGINT NOT NULL,
     order_total int4 NOT NULL,
     created_at timestamp DEFAULT CURRENT_TIMESTAMP NULL,
     canceled_at timestamp NULL,
     CONSTRAINT orders_pkey PRIMARY KEY (id),
     CONSTRAINT fk_customer FOREIGN KEY (customer_id) REFERENCES public.customers(id)
    );
    ```

    ‡πÅ‡∏•‡∏∞ `create_order.down.sql`

    ```sql
    drop table public.orders;
    ```

- ‡∏£‡∏±‡∏ô Migration ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

    ```bash
    make mgu
    ```

    ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô migration ‡πÄ‡∏ä‡πà‡∏ô

    ```bash
    2025/05/29 10:39:20 Start buffering 20250529103238/u create_customer
    2025/05/29 10:39:20 Start buffering 20250529103715/u create_order
    2025/05/29 10:39:20 Read and execute 20250529103238/u create_customer
    2025/05/29 10:39:20 Finished 20250529103238/u create_customer (read 906.667¬µs, ran 2.125583ms)
    2025/05/29 10:39:20 Read and execute 20250529103715/u create_order
    2025/05/29 10:39:20 Finished 20250529103715/u create_order (read 3.458625ms, ran 1.860583ms)
    2025/05/29 10:39:20 Finished after 7.190625ms
    2025/05/29 10:39:20 Closing source and database
    ```

### ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Database Connection ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤ API ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PostgreSQL ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å `DB_DSN` ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `config/config.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

    ```go
    package config
    
    import (
     "errors"
     "go-mma/util/env"
     "time"
    )
    
    var (
     ErrInvalidHTTPPort = errors.New("HTTP_PORT must be a positive integer")
     ErrGracefulTimeout = errors.New("GRACEFUL_TIMEOUT must be a positive duration")
     ErrDSN             = errors.New("DB_DSN must be set") // ‡πÄ‡∏û‡∏¥‡πà‡∏°
    )
    
    type Config struct {
     HTTPPort        int
     GracefulTimeout time.Duration
     DSN             string  // ‡πÄ‡∏û‡∏¥‡πà‡∏°
    }
    
    func Load() (*Config, error) {
     config := &Config{
      HTTPPort:        env.GetIntDefault("HTTP_PORT", 8090),
      GracefulTimeout: env.GetDurationDefault("GRACEFUL_TIMEOUT", 5*time.Second),
      DSN:             env.Get("DB_DSN"),  // ‡πÄ‡∏û‡∏¥‡πà‡∏°
     }
     err := config.Validate()
     if err != nil {
      return nil, err
     }
     return config, err
    }
    
    func (c *Config) Validate() error {
     if c.HTTPPort <= 0 {
      return ErrInvalidHTTPPort
     }
     if c.GracefulTimeout <= 0 {
      return ErrGracefulTimeout
     }
     // ‡πÄ‡∏û‡∏¥‡πà‡∏°
     if len(c.DSN) == 0 {
      return ErrDSN
     }
    
     return nil
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/storage/sqldb/sqldb.go` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PostgreSQL ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `sqlx`

    ```go
    package sqldb
    
    import (
     "github.com/jmoiron/sqlx"
     _ "github.com/lib/pq"
    )
    
    type closeDB func() error
    
    type DBContext interface {
     DB() *sqlx.DB
    }
    
    type dbContext struct {
     db *sqlx.DB
    }
    
    var _ DBContext = (*dbContext)(nil)
    
    func NewDBContext(dsn string) (DBContext, closeDB, error) {
     // this Pings the database trying to connect
     db, err := sqlx.Connect("postgres", dsn)
     if err != nil {
      return nil, nil, err
     }
     return &dbContext{db: db},
      func() error {
       return db.Close()
      },
      nil
    }
    
    func (c *dbContext) DB() *sqlx.DB {
     return c.db
    }
    ```

- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `go mod tidy` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á dependencies ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÑ‡∏ü‡∏•‡πå `application/application.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏¥‡∏ô‡∏™‡πÅ‡∏ï‡∏ô‡∏ã‡πå‡∏Ç‡∏≠‡∏á database connection

    ```go
    type Application struct {
     config     config.Config
     httpServer HTTPServer
     dbCtx      sqldb.DBContext
    }
    
    func New(config config.Config, dbCtx sqldb.DBContext) *Application {
     return &Application{
      config:     config,
      httpServer: newHTTPServer(config),
      dbCtx:         dbCtx,
     }
    }
    ```

- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô `cmd/api/main.go` ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô Application

    ```go
    func main() {
     // config
     
     dbCtx, closeDB, err := sqldb.NewDBContext(config.DSN)
     if err != nil {
      panic(err.Error())
     }
     defer func() { // ‡πÉ‡∏ä‡πà‡∏ó‡πà‡∏≤ IIFE ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á error ‡∏ñ‡πâ‡∏≤‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
      if err := closeDB(); err != nil {
       logger.Log.Error(fmt.Sprintf("Error closing database: %v", err))
      }
     }()
    
     app := application.New(*config, dbCtx)
     // ...
    }
    ```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Gen ID

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏´‡∏£‡∏∑‡∏≠ entity ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ) ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô ‡∏à‡∏∂‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ generate ID ‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô utility

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/idgen/idgen.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡πÄ‡∏ä‡πà‡∏ô
  - `GenerateTimeRandomID`: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏ö‡∏ö `int64` ‡πÇ‡∏î‡∏¢‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å timestamp (‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ)
  - `GenerateTimeID`: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç `int` ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
  - `GenerateTimeRandomIDBase36`: ‡πÅ‡∏õ‡∏•‡∏á ID ‡πÄ‡∏õ‡πá‡∏ô string ‡πÅ‡∏ö‡∏ö base36
  - `GenerateUUIDLikeID`: ‡∏™‡∏£‡πâ‡∏≤‡∏á string ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢ UUID

    ```go
    package idgen
    
    import (
     "fmt"
     "math/rand"
     "strconv"
     "strings"
     "time"
    )
    
    // GenerateTimeRandomID ‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡πÅ‡∏ö‡∏ö int64
    func GenerateTimeRandomID() int64 {
     timestamp := time.Now().UnixNano() >> 32
     randomPart := rand.Int63() & 0xFFFFFFFF
     return (timestamp << 32) | randomPart
    }
    
    // GenerateTimeID ‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡πÅ‡∏ö‡∏ö int (‡πÉ‡∏ä‡πâ timestamp ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å)
    func GenerateTimeID() int {
     // ‡πÉ‡∏ä‡πâ timestamp Unix ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (int64) ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô int (int32/64 ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö)
     return int(time.Now().Unix())
    }
    
    // GenerateTimeRandomIDBase36 ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ ID ‡πÄ‡∏õ‡πá‡∏ô base36 string
    func GenerateTimeRandomIDBase36() string {
     id := GenerateTimeRandomID()
     return strconv.FormatInt(id, 36) // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏•‡∏Ç‡∏ê‡∏≤‡∏ô 10 -> 36
    }
    
    // GenerateUUIDLikeID ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô string ‡πÅ‡∏ö‡∏ö UUID-like (‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà UUID ‡∏à‡∏£‡∏¥‡∏á)
    func GenerateUUIDLikeID() string {
     id := GenerateTimeRandomID()
    
     // ‡πÅ‡∏õ‡∏•‡∏á int64 ‡πÄ‡∏õ‡πá‡∏ô hex string ‡∏¢‡∏≤‡∏ß 16 ‡∏ï‡∏±‡∏ß (64 bit)
     hex := fmt.Sprintf("%016x", uint64(id))
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á UUID-like string ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö 8-4-4-4-12
     // ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡πÅ‡∏Ñ‡πà 16 hex chars ‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ: 8-4-4 (‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏à‡∏£‡∏¥‡∏á‡πÜ)
     // ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏° random ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö 32 hex (128 bit) ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô UUID
    
     randPart := fmt.Sprintf("%016x", rand.Uint64())
    
     uuidLike := strings.Join([]string{
      hex[0:8],
      hex[8:12],
      hex[12:16],
      randPart[0:4],
      randPart[4:16],
     }, "-")
    
     return uuidLike
    }
    
    // ‡∏Å‡πà‡∏≠‡∏ô Go 1.20 ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
    // func init() {
    //  rand.Seed(time.Now().UnixNano())
    // }
    ```

### ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Database ‡∏î‡πâ‡∏ß‡∏¢ Dependency Injection

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Dependency Injection (DI) ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á database connection ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á handler

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handlers/customer.go` ‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á `CustomerHandler` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö `DBContext` ‡∏ú‡πà‡∏≤‡∏ô constructor

    ```go
    type CustomerHandler struct {
     dbCtx sqldb.DBContext
    }
    
    func NewCustomerHandler(db sqldb.DBContext) *CustomerHandler {
     return &CustomerHandler{dbCtx: db}
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `application/http.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á `DBContext` ‡πÑ‡∏õ‡∏¢‡∏±‡∏á handler

    ```go
    type HTTPServer interface {
     Start()
     Shutdown() error
     RegisterRoutes(dbCtx sqldb.DBContext)
    }
    
    // ...
    
    func (s *httpServer) RegisterRoutes(dbCtx sqldb.DBContext) {
     v1 := s.app.Group("/api/v1")
    
     customers := v1.Group("/customers")
     {
      hdlr := handlers.NewCustomerHandler(dbCtx)
      customers.Post("", hdlr.CreateCustomer)
     }
    
     // orders
    }
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ò‡∏≠‡∏î `RegisterRoutes()` ‡πÉ‡∏ô `application/application.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á HTTP ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏á db context ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ

    ```go
    func (app *Application) RegisterRoutes() {
     app.httpServer.RegisterRoutes(app.db)
    }
    ```

### ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Insert Customer)

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô HTTP POST

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handlers/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á customers

    ```go
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î payload structure (DTO: Request)
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // Rule: email ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     query := "SELECT 1 FROM public.customers where email = $1 LIMIT 1"
     ctx, cancel := context.WithTimeout(c.Context(), 5*time.Second)
     defer cancel()
    
     var exists int
     if err := h.dbCtx.DB().QueryRowxContext(ctx, query, req.Email).Scan(&exists); err != nil {
      if err != sql.ErrNoRows {
       logger.Log.Error(fmt.Sprintf("error checking email: %v", err))
       return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"error": "an error occurred while checking email"})
      }
     }
     if exists == 1 {
      return c.Status(fiber.StatusConflict).JSON(fiber.Map{"error": "email already exists"})
     }
    
     // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     var id int64
     query = "INSERT INTO customers (id, email, credit) VALUES ($1, $2, $3) RETURNING id"
     ctxIns, cancelIns := context.WithTimeout(c.Context(), 10*time.Second)
     defer cancelIns()
     if err := h.dbCtx.DB().QueryRowxContext(ctxIns, query, idgen.GenerateTimeRandomID(), req.Email, req.Credit).Scan(&id); err != nil {
      logger.Log.Error(fmt.Sprintf("error insert customer: %v", err))
      return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"error": "an error occurred while inserting customer"})
     }
    
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ (DTO: Response)
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
    }
    
    ```

## ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Layered Architecture ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢

‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ API ‡∏´‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP request ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô handler ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö scale ‡πÑ‡∏î‡πâ‡∏¢‡∏≤‡∏Å ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏≥‡∏ö‡∏≤‡∏Å ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠ bug ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î

**‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Layered Architecture** ‡∏ã‡∏∂‡πà‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÅ‡∏•‡∏∞‡∏î‡∏π‡πÅ‡∏•‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢

‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢

- Layered Architecture ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£
- Repository Layer ‚Äì ‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- Service Layer ‚Äì ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à
- Presentation Layer ‚Äì ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP Request/Response
- ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

### Layered Architecture ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£

**Layered Architecture** ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏ä‡∏±‡πâ‡∏ô‚Äù ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‚Äù ‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, business logic ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP Request/Response ‡πÇ‡∏î‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

**‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Layered Architecture ‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ**

```
Client/UI Layer        ‚Üê ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö
‚Üì
Presentation Layer     ‚Üê Controller, API (‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ)
‚Üì ‚Üê DTO
Service Layer          ‚Üê Business Logic (‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à)
‚Üì ‚Üê Model
Repository/Data Layer  ‚Üê ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, external APIs
‚Üì
Database/External APIs
```

**‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏°‡∏≤ implement ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤**

```
project/
‚îÇ
‚îú‚îÄ‚îÄ handler/          ‚Üê Presentation Layer (HTTP handlers)
‚îú‚îÄ‚îÄ dto/              ‚Üê ‡∏£‡∏±‡∏ö/‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á handler ‚Üî service
‚îú‚îÄ‚îÄ service/          ‚Üê Business Logic (core logic)
‚îú‚îÄ‚îÄ model/            ‚Üê ‡πÉ‡∏ä‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö service ‚Üî repository
‚îú‚îÄ‚îÄ repository/       ‚Üê Data Access (DB queries)
‚îî‚îÄ‚îÄ main.go           ‚Üê Entry point (setup DI, server, etc)
```

### Repository Layer ‚Äì ‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

**Repository Layer** ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏´‡∏•‡πà‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÇ‡∏î‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å Service Layer ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà CRUD (Create, Read, Update, Delete) ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏î (Postgres, MySQL, Redis ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏°‡πâ‡πÅ‡∏ï‡πà API)

- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Model ‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏∑‡πà‡∏≠ `model/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

    ```go
    package model
    
    import (
     "go-mma/util/idgen"
     "time"
    )
    
    type Customer struct {
     ID          int64     `db:"id"` // tag db ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö StructScan() ‡∏Ç‡∏≠‡∏á sqlx
     Email       string    `db:"email"`
     Credit      int       `db:"credit"`
     CreatedAt   time.Time `db:"created_at"`
     UpdatedAt   time.Time `db:"updated_at"`
    }
    
    func NewCustomer(email string, credit int) *Customer {
     return &Customer{
      ID:     idgen.GenerateTimeRandomID(),
      Email:  email,
      Credit: credit,
     }
    }
    ```

    <aside>
    üí°

    ‡∏™‡∏£‡πâ‡∏≤‡∏á Model ‡πÅ‡∏ö‡∏ö [Rich Model](https://somprasongd.work/blog/architecture/anemic-vs-rich-model-ddd)

    </aside>

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Repository ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå `repository/customer.go`

    ```go
    package repository
    
    import (
     "context"
     "database/sql"
     "fmt"
     "go-mma/model"
     "go-mma/util/storage/sqldb"
     "time"
    )
    
    type CustomerRepository struct {
     dbCtx sqldb.DBContext // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô database ‡∏ú‡πà‡∏≤‡∏ô DBContext interface
    }
    
    func NewCustomerRepository(dbCtx sqldb.DBContext) *CustomerRepository {
     return &CustomerRepository{
      dbCtx: dbCtx, // inject DBContext instance into CustomerRepository
     }
    }
    
    func (r *CustomerRepository) Create(ctx context.Context, customer *model.Customer) error {
     query := `
     INSERT INTO public.customers (id, email, credit)
     VALUES ($1, $2, $3)
     RETURNING *
     `
    
     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î timeout ‡∏Ç‡∏≠‡∏á query
     ctx, cancel := context.WithTimeout(ctx, 10*time.Second)
     defer cancel()
    
     err := r.dbCtx.DB().
      QueryRowxContext(ctx, query, customer.ID, customer.Email, customer.Credit).
      StructScan(customer) // ‡∏ô‡∏≥‡∏Ñ‡πà‡∏≤ created_at, updated_at ‡πÉ‡∏™‡πà‡πÉ‡∏ô struct customer
     if err != nil {
      return fmt.Errorf("an error occurred while inserting customer: %w", err)
     }
     return nil
    }
    
    func (r *CustomerRepository) ExistsByEmail(ctx context.Context, email string) (bool, error) {
     query := `SELECT 1 FROM public.customers WHERE email = $1 LIMIT 1`
    
     ctx, cancel := context.WithTimeout(ctx, 5*time.Second)
     defer cancel()
    
     var exists int
     err := r.dbCtx.DB().
      QueryRowxContext(ctx, query, email).
      Scan(&exists)
     if err != nil {
      if err == sql.ErrNoRows { // ‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ email ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß
       return false, nil
      }
      return false, fmt.Errorf("an error occurred while checking email: %w", err)
     }
     return true, nil // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà error ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏°‡∏µ email ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß
    }
    ```

    <aside>
    üí°

    ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `context.WithTimeout` ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠ external service

    </aside>

### Service Layer ‚Äì ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à

**Service Layer** ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Controller (‡∏´‡∏£‡∏∑‡∏≠ Handler) ‡∏Å‡∏±‡∏ö Repository

‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á Service Layer ‡∏Ñ‡∏∑‡∏≠ ‡∏£‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Business Logic ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- **‡∏£‡∏±‡∏ö DTO**: ‡∏£‡∏±‡∏ö DTO ‡∏à‡∏≤‡∏Å Handler ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
- **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° **"‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à"** (Business Logic/Semantic Validation) ‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- **‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•**: ‡πÅ‡∏õ‡∏•‡∏á DTO ‚Üí Model
- **‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Repository**: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ CRUD (Create, Read, Update, Delete) ‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
- **‡∏™‡πà‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå**: ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å Repository ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô DTO Response
- **‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error**: ‡πÅ‡∏™‡∏î‡∏á error log ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏´‡πâ Controller (‡∏´‡∏£‡∏∑‡∏≠ Handler) ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Service Layer**

- ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO (Data Transfer Object) ‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‚Äì‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ä‡∏±‡πâ‡∏ô Handler ‚Üî Service

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `dto/customer_request.go`

    ```go
    package dto
    
    type CreateCustomerRequest struct {
     Email  string `json:"email"`
     Credit int    `json:"credit"`
    }
    ```

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `dto/customer_response.go`

    ```go
    package dto
    
    type CreateCustomerResponse struct {
     ID int64 `json:"id"`
    }
    
    func NewCreateCustomerResponse(id int64) *CreateCustomerResponse {
     return &CreateCustomerResponse{ID: id}
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Service ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Business Logic ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `service/customer.go`

    ```go
    package service
    
    import (
     "context"
     "errors"
     "go-mma/dto"
     "go-mma/model"
     "go-mma/repository"
     "go-mma/util/logger"
    )
    
    var (
     ErrEmailExists = errors.New("email already exists")
    )
    
    type CustomerService struct {
     custRepo *repository.CustomerRepository
    }
    
    func NewCustomerService(custRepo *repository.CustomerRepository) *CustomerService {
     return &CustomerService{
      custRepo: custRepo,
     }
    }
    
    func (s *CustomerService) CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error) {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // Rule: email ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     exists, err := s.custRepo.ExistsByEmail(ctx, req.Email)
     if err != nil {
      // error logging
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     if exists {
      return nil, ErrEmailExists
     }
    
     // ‡πÅ‡∏õ‡∏•‡∏á DTO ‚Üí Model
     customer := model.NewCustomer(req.Email, req.Credit)
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Repository Layer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     if err := s.custRepo.Create(ctx, customer); err != nil {
      // error logging
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO Response
     resp := dto.NewCreateCustomerResponse(customer.ID)
    
     return resp, nil
    }
    ```

### Presentation Layer ‚Äì ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP Request/Response

**Presentation Layer (HTTP Handlers)** ‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ö‡∏ö Layered Architecture ‡πÇ‡∏î‡∏¢‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Client) ‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‚Äù ‡∏ú‡πà‡∏≤‡∏ô‡πÇ‡∏õ‡∏£‡πÇ‡∏ï‡∏Ñ‡∏≠‡∏• ‡πÄ‡∏ä‡πà‡∏ô HTTP ‡∏´‡∏£‡∏∑‡∏≠ WebSocket

‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á Presentation Layer (‡∏´‡∏£‡∏∑‡∏≠ HTTP Handler)

- **‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠:** ‡∏£‡∏±‡∏ö HTTP Request ‡∏à‡∏≤‡∏Å Client
- **‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:** ‡πÅ‡∏õ‡∏•‡∏á JSON ‚Üí DTO (‡πÉ‡∏ä‡πâ `BodyParser`, `Bind`, ‡∏´‡∏£‡∏∑‡∏≠ Unmarshal)
- **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á **"‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö"** ‡πÅ‡∏•‡∏∞ **"‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á"** ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ (Input/Syntax Validation) ‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á, ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•, ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- **‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Service:** ‡∏™‡πà‡∏á DTO ‡πÄ‡∏Ç‡πâ‡∏≤ Service Layer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
- **‡∏™‡πà‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å Service ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON Response ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏´‡πâ client
- **‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error**: ‡πÅ‡∏õ‡∏•‡∏á error ‡∏à‡∏≤‡∏Å Service ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô HTTP response code ‡πÄ‡∏ä‡πà‡∏ô `400`, `500`

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Presentation Layer (HTTP Handlers)**

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `dto/customer_request.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° validation ‡πÄ‡∏ä‡πà‡∏ô credit ‡∏ï‡πâ‡∏≠‡∏á ‚â• 0 ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ Service

    ```go
    package dto
    
    import (
     "errors"
     "net/mail"
    )
    
    // struct
    
    func (r *CreateCustomerRequest) Validate() error {
     var errs error
     if r.Email == "" {
      errs = errors.Join(errs, errors.New("email is required"))
     }
     if _, err := mail.ParseAddress(r.Email); err != nil {
      errs = errors.Join(errs, errors.New("email is invalid"))
     }
     if r.Credit <= 0 {
      errs = errors.Join(errs, errors.New("credit must be greater than 0"))
     }
     return errs
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á Presentation Layer

    ```go
    package handler
    
    import (
     "fmt"
     "go-mma/dto"
     "go-mma/service"
     "go-mma/util/logger"
    
     "github.com/gofiber/fiber/v3"
    )
    
    type CustomerHandler struct {
     custService *service.CustomerService
    }
    
    func NewCustomerHandler(custService *service.CustomerService) *CustomerHandler {
     return &CustomerHandler{
      custService: custService,
     }
    }
    
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req dto.CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á error 400
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": err.Error()})
     }
    
     logger.Log.Info(fmt.Sprintf("Received customer: %v", req))
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if err := req.Validate(); err != nil {
      return c.Status(fiber.StatusBadRequest).JSON(fiber.Map{"error": err.Error()})
     }
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     resp, err := h.custService.CreateCustomer(c.Context(), &req)
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      return c.Status(500).JSON(fiber.Map{"error": err.Error()})
     }
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    ```

### ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤‡πÅ‡∏¢‡∏Å‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ ‚Äú‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‚Äù ‡∏´‡∏£‡∏∑‡∏≠ ‚Äúwire‚Äù ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `application/http.go` ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Dependency Injection ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ

```go
func (s *httpServer) RegisterRoutes(db sqldb.DBContext) {
 v1 := s.app.Group("/api/v1")

 customers := v1.Group("/customers")
 {
   // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î dependency ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå
  repo := repository.NewCustomerRepository(dbCtx)
  // ‡∏™‡πà‡∏á instance ‡∏Ç‡∏≠‡∏á repository ‡πÄ‡∏Ç‡πâ‡∏≤ service
  svc := service.NewCustomerService(repo)
  // ‡∏™‡πà‡∏á service ‡πÄ‡∏Ç‡πâ‡∏≤ handler
  hdlr := handler.NewCustomerHandler(svc)
  // Register routes ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö HTTP server
  customers.Post("", hdlr.CreateCustomer)
 }

 // orders
}
```

## ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡πà‡∏≤‡∏¢

‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏£‡∏Å ‡πÄ‡∏£‡∏≤‡∏°‡∏±‡∏Å return error ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á client ‡∏î‡πâ‡∏ß‡∏¢ HTTP status code ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÄ‡∏ä‡πà‡∏ô `500 Internal Server Error` ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó error ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡∏ó‡∏≥‡πÉ‡∏´‡πâ client ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏¢‡∏Å‡πÅ‡∏¢‡∏∞‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£‡∏Ç‡∏∂‡πâ‡∏ô ‡πÄ‡∏ä‡πà‡∏ô input ‡∏ú‡∏¥‡∏î ‡∏´‡∏£‡∏∑‡∏≠ server ‡∏û‡∏±‡∏á

**‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏°‡∏≤‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏ö error handling ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á developer ‡πÅ‡∏•‡∏∞ client ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°**

- ‡∏ß‡∏≤‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô HTTP Status Code ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö
- ‡∏™‡∏£‡πâ‡∏≤‡∏á Custome Error
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏ô Repository Layer
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏ô Service Layer
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏ô Presentation Layer
- ‡∏™‡∏£‡πâ‡∏≤‡∏á ErrorHandler Middleware

### ‡∏ß‡∏≤‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô HTTP Status Code ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö

‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤ error ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏à‡∏∞ map ‡∏Å‡∏±‡∏ö status code ‡∏≠‡∏∞‡πÑ‡∏£

| ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
| --- | --- | --- | --- |
| Input Validation | 400 Bad Request | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö, ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ú‡∏¥‡∏î | ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å **Client-Side**
‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Handler / DTO |
| Authorization | 401 Unauthorized | ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà login / token ‡∏ú‡∏¥‡∏î | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Middleware |
|  | 403 Forbidden | login ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Middleware |
| Business Logic | 404 Not Found | ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Service |
|  | 409 Conflict | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô, ‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á ‡πÄ‡∏ä‡πà‡∏ô email ‡∏ã‡πâ‡∏≥, order ‡∏ñ‡∏π‡∏Å cancel ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Service |
|  | 422 Unprocessable Entity | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å ‡πÅ‡∏ï‡πà logic ‡∏ú‡∏¥‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏°‡πà‡∏û‡∏≠, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Service |
| Database | 500 Internal Server Error | ‡πÄ‡∏Å‡∏¥‡∏î database connection error | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Repository |
| Exception | 500 Internal Server Error | ‡πÄ‡∏Å‡∏¥‡∏î exception ‡∏´‡∏£‡∏∑‡∏≠ panic ‡πÉ‡∏ô server code | ‡πÄ‡∏Å‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà |

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Custome Error

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ error ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏±‡πâ‡∏ô ‡∏Å‡πá‡∏°‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á custome error ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/errs/types.go` ‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó error ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô

    ```go
    package errs
    
    type ErrorType string
    
    const (
     ErrInputValidation   ErrorType = "input_validation_error"   // Invalid input (e.g., missing fields, format issues)
     ErrAuthentication    ErrorType = "authentication_error"     // Wrong credentials, not logged in
     ErrAuthorization     ErrorType = "authorization_error"      // No permission to access resource
     ErrResourceNotFound  ErrorType = "resource_not_found"       // Entity does not exist
     ErrConflict          ErrorType = "conflict"                 // Conflict, already exists
     ErrBusinessRule      ErrorType = "business_rule_error"      // Business rule violation
     ErrDataIntegrity     ErrorType = "data_integrity_error"     // Foreign key, constraint violations
     ErrDatabaseFailure   ErrorType = "database_failure"         // Generic DB error
     ErrOperationFailed   ErrorType = "operation_failed"         // General failure case
     ErrServiceDependency ErrorType = "service_dependency_error" // External service unavailable
    )
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Custom Error ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/errs/errs.go`

    ```go
    package errs
    
    import "fmt"
    
    type AppError struct {
     Type    ErrorType `json:"type"`    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö client
     Message string    `json:"message"` // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö client
     Err     error     `json:"-"`       // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö log ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
    }
    
    func (e *AppError) Error() string {
     if e.Err != nil {
      return fmt.Sprintf("[%s] %s - %v", e.Type, e.Message, e.Err)
     }
     return fmt.Sprintf("[%s] %s", e.Type, e.Message)
    }
    
    // Unwrap allows for errors.Is and errors.As compatibility
    func (e *AppError) Unwrap() error {
     return e.Err
    }
    
    func New(errorType ErrorType, message string, err ...error) *AppError {
     var underlyingErr error
     if len(err) > 0 {
      underlyingErr = err[0]
     }
     return &AppError{
      Type:    errorType,
      Message: message,
      Err:     underlyingErr,
     }
    }
    
    // Helper functions for each error type
    func InputValidationError(message string, err ...error) *AppError {
     return New(ErrInputValidation, message, err...)
    }
    
    func AuthenticationError(message string, err ...error) *AppError {
     return New(ErrAuthentication, message, err...)
    }
    
    func NewAuthorizationError(message string, err ...error) *AppError {
     return New(ErrAuthorization, message, err...)
    }
    
    func ResourceNotFoundError(message string, err ...error) *AppError {
     return New(ErrResourceNotFound, message, err...)
    }
    
    func ConflictError(message string, err ...error) *AppError {
     return New(ErrConflict, message, err...)
    }
    
    func BusinessRuleError(message string, err ...error) *AppError {
     return New(ErrBusinessRule, message, err...)
    }
    
    func DataIntegrityError(message string, err ...error) *AppError {
     return New(ErrDataIntegrity, message, err...)
    }
    
    func DatabaseFailureError(message string, err ...error) *AppError {
     return New(ErrDatabaseFailure, message, err...)
    }
    
    func OperationFailedError(message string, err ...error) *AppError {
     return New(ErrOperationFailed, message, err...)
    }
    
    func ServiceDependencyError(message string, err ...error) *AppError {
     return New(ErrServiceDependency, message, err...)
    }
    ```

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏ô Repository Layer

‡πÉ‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡∏≠‡∏á repository ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PostgreSQL ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î error ‡πÑ‡∏î‡πâ ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- 23502: Not null violation ‚Üí **ErrDataIntegrity**
- 23503: Foreign key violation ‚Üí **ErrDataIntegrity**
- 23505: Unique constraint violation ‚Üí **ErrConflict**
- ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‚Üí **ErrDatabaseFailure**

‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ implement

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/errs/helpers.go` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢ Map error code ‡∏Å‡∏±‡∏ö error type

    ```go
    package errs
    
    import (
     "github.com/lib/pq"
    )
    
    // HandleDBError maps PostgreSQL errors to custom application errors
    func HandleDBError(err error) *AppError {
     if pgErr, ok := err.(*pq.Error); ok {
      switch pgErr.Code {
      case "23505": // Unique constraint violation
       return New(ErrConflict, "duplicate entry detected: "+pgErr.Message)
      case "23503": // Foreign key violation
       return New(ErrDataIntegrity, "foreign key constraint violation: "+pgErr.Message)
      case "23502": // Not null violation
       return New(ErrDataIntegrity, "not null constraint violation: "+pgErr.Message)
      default:
       return New(ErrDatabaseFailure, "database error: "+pgErr.Message)
      }
     }
     // Fallback for unknown DB errors
     return New(ErrDatabaseFailure, err.Error())
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå `repository/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô `HandleDBError`

    ```go
    func (r *CustomerRepository) Create(ctx context.Context, customer *model.Customer) error {
     // ...
     if err != nil {
       // ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      return errs.HandleDBError(fmt.Errorf("an error occurred while inserting customer: %w", err))
     }
     return nil // Return nil if the operation is successful
    }
    
    func (r *CustomerRepository) ExistsByEmail(ctx context.Context, email string) (bool, error) {
     // ...
     if err != nil {
      if err == sql.ErrNoRows {
       return false, nil
      }
      // ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      return false, errs.HandleDBError(fmt.Errorf("an error occurred while checking email: %w", err))
     }
     return true, nil
    }
    ```

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏ô Service Layer

Service layer ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤ error ‡πÑ‡∏´‡∏ô‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏π‡∏Å‡∏´‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢ custom error ‡∏≠‡∏∞‡πÑ‡∏£

‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô error ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å repository layer ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏Å‡∏•‡∏±‡∏ö error ‡∏ô‡∏±‡πâ‡∏ô‡πÜ ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß

‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `service/customer.go` ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà error ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à business logic ‡∏´‡πâ‡∏≤‡∏°‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ã‡πâ‡∏≥‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

```go
var (
 ErrEmailExists = errs.ConflictError("email already exists")
)
```

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏ô Presentation Layer

‡πÉ‡∏ô handler ‡∏à‡∏∞‡∏°‡∏µ error ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- **‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á JSON ‚Üí DTO**: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ AppError
- **‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö DTO**: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ AppError
- **Error ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≤‡∏à‡∏≤‡∏Å Service Layer**: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢

‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ implement

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ `AppError`

    ```go
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req dto.CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á error 400
      errResp := errs.InputValidationError(err.Error()) // <-- ‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô AppError
      return c.Status(fiber.StatusBadRequest).JSON(errResp)
     }
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if err := req.Validate(); err != nil {
      errResp := errs.InputValidationError(err.Error()) // <-- ‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô AppError
      return c.Status(fiber.StatusBadRequest).JSON(errResp)
     }
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
    }
    ```

- ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ status code ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å AppError ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á helper function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ñ‡∏≠‡∏î status code ‡∏°‡∏≤ ‡πÇ‡∏î‡∏¢‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `util/errs/helpers.go` ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ

    ```go
    // GetErrorType extracts the error type from an errorAdd commentMore actions
    func GetErrorType(err error) ErrorType {
     var appErr *AppError
     if errors.As(err, &appErr) {
      return appErr.Type
     }
     return ErrOperationFailed // Default error type if not recognized
    }
    
    // Map error type to HTTP status code
    func GetHTTPStatus(err error) int {
     switch GetErrorType(err) {
     case ErrInputValidation:
      return fiber.StatusBadRequest // 400
     case ErrAuthentication:
      return fiber.StatusUnauthorized // 401
     case ErrAuthorization:
      return fiber.StatusForbidden // 403
     case ErrResourceNotFound:
      return fiber.StatusNotFound // 404
     case ErrConflict:
      return fiber.StatusConflict // 409
     case ErrBusinessRule:
      return fiber.StatusUnprocessableEntity // 422
     case ErrDataIntegrity, ErrDatabaseFailure:
      return fiber.StatusInternalServerError // 500
     case ErrOperationFailed:
      return fiber.StatusInternalServerError // 500
     case ErrServiceDependency:
      return fiber.StatusServiceUnavailable // 503
     default: // Default: Unknown errors, fallback to internal server error
      return fiber.StatusInternalServerError // 500
     }
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ status code ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

    ```go
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req dto.CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á error 400
      errResp := errs.InputValidationError(err.Error())
      return c.Status(
       errs.GetHTTPStatus(errResp), // <-- ‡∏î‡∏∂‡∏á status code ‡∏à‡∏≤‡∏Å AppError
      ).JSON(errResp)
     }
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if err := req.Validate(); err != nil {
      errResp := errs.InputValidationError(err.Error())
      return c.Status(
       errs.GetHTTPStatus(errResp), // <-- ‡∏î‡∏∂‡∏á status code ‡∏à‡∏≤‡∏Å AppError
      ).JSON(errResp)
     }
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Standard Error Response ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á error response ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/response/response.go`

    ```go
    package response
    
    import (
     "errors"
     "go-mma/util/errs"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func JSONError(c fiber.Ctx, err error) error {
     // Convert non-AppError to AppError with type ErrOperationFailed
     appErr, ok := err.(*errs.AppError)
     if !ok {
      appErr = errs.New(
       errs.ErrOperationFailed,
       err.Error(),
       err,
      )
     }
    
     // Get the appropriate HTTP status code
     statusCode := errs.GetHTTPStatus(err)
     
     // Retrieve the custom status code if it's a *fiber.Error
     var e *fiber.Error
     if errors.As(err, &e) {
      statusCode = e.Code
     }
    
     // Return structured response with error type and message
     return c.Status(statusCode).JSON(appErr)
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `JSONError`

    ```go
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // 1. ‡∏£‡∏±‡∏ö request body ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô DTO
     var req dto.CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      return response.JSONError(c, errs.InputValidationError(err.Error()))
     }
    
     // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (validate)
     if err := req.Validate(); err != nil {
      return response.JSONError(c, errs.InputValidationError(strings.Join(strings.Split(err.Error(), "\n"), ", ")))
     }
    
     // 3. ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     resp, err := h.custService.CreateCustomer(c.Context(), &req)
    
     // 4. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      return response.JSONError(c, err)
     }
    
     // 5. ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö client
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    ```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Middleware ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö Error

‡∏≠‡∏µ‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö error ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `response.JSONError` ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ ‡∏ó‡∏µ‡πà ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î error ‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô handler ‡∏Ñ‡∏∑‡∏≠ ‡πÉ‡∏´‡πâ `return error` ‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á middleware ‡πÉ‡∏´‡∏°‡πà ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ó‡∏ô ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `application/middleware/response_error.go`

    ```go
    package middleware
    
    import (
     "errors"
     "go-mma/util/errs"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func ResponseError() fiber.Handler {
     return func(c fiber.Ctx) error {
      err := c.Next()
      if err == nil {
       return nil
      }
    
      return jsonError(c, err)
     }
    }
    
    // ‡∏¢‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å util/response ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÅ‡∏ó‡∏ô ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏ô‡∏µ‡πâ
    func jsonError(c fiber.Ctx, err error) error {
     // Convert non-AppError to AppError with type ErrOperationFailed
     appErr, ok := err.(*errs.AppError)
     if !ok {
      appErr = errs.New(
       errs.ErrOperationFailed,
       err.Error(),
       err,
      )
     }
    
     // Get the appropriate HTTP status code
     statusCode := errs.GetHTTPStatus(err)
    
     // Retrieve the custom status code if it's a *fiber.Error
     var e *fiber.Error
     if errors.As(err, &e) {
      statusCode = e.Code
     }
    
     // Return structured response with error type and message
     return c.Status(statusCode).JSON(appErr)
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `application/http.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ middleware `ResponseError`

    ```go
    func newFiber() *fiber.App {
     app := fiber.New(fiber.Config{
      AppName: fmt.Sprintf("Go MMA version %s", build.Version),
     })
    
     // global middleware
     app.Use(cors.New())                 // CORS ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ OPTIONS request ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠
     app.Use(requestid.New())            // ‡∏™‡∏£‡πâ‡∏≤‡∏á request id ‡πÉ‡∏ô request header ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ debug
     app.Use(recover.New())              // auto-recovers from panic (internal only)
     app.Use(middleware.RequestLogger()) // logs HTTP request
     app.Use(middleware.ResponseError()) // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    
     app.Get("/", func(c fiber.Ctx) error {
      return c.JSON(map[string]string{"version": build.Version, "time": build.Time})
     })
    
     return app
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡πÉ‡∏´‡πâ `return errror` ‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÉ‡∏´‡πâ middleware ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£

    ```go
    func (h *CustomerHandler) CreateCustomer(c fiber.Ctx) error {
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req dto.CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      // <-- return error ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
      return errs.InputValidationError(err.Error())
     }
    
     logger.Log.Info(fmt.Sprintf("Received customer: %v", req))
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if err := req.Validate(); err != nil {
      // <-- return error ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
      return errs.InputValidationError(err.Error())
     }
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     resp, err := h.custService.CreateCustomer(c.Context(), &req)
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      // <-- return error ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
      return err
     }
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    ```

## ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏ö‡∏ö Reusable ‡∏î‡πâ‡∏ß‡∏¢ Notification Service

‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå **‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö** ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏•‡∏∞‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏• ‡πÄ‡∏£‡∏≤‡∏à‡∏∞ **‡πÅ‡∏¢‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Service ‡πÄ‡∏â‡∏û‡∏≤‡∏∞** ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ `NotificationService` ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏™‡∏£‡πâ‡∏≤‡∏á NotificationService ‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á service ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `service/notification.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

    ```go
    package service
    
    import (
     "fmt"
     "go-mma/util/logger"
    )
    
    type NotificationService struct {
    }
    
    func NewNotificationService() *NotificationService {
     return &NotificationService{}
    }
    
    func (s *NotificationService) SendEmail(to string, subject string, payload map[string]any) error {
     // implement email sending logic here
     logger.Log.Info(fmt.Sprintf("Sending email to %s with subject: %s and payload: %v", to, subject, payload))
     return nil
    }
    
    ```

- Inject NotificationService ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô CustomerService
‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `CustomerService` ‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå `service/customer.go` ‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `NotificationService` ‡πÑ‡∏î‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà

    ```go
    package service
    
    // ...
    
    type CustomerService struct {
     custRepo *repository.CustomerRepository
     notiSvc  *NotificationService // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    }
    
    func NewCustomerService(custRepo *repository.CustomerRepository, 
     notiSvc *NotificationService, // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     ) *CustomerService {
     return &CustomerService{
      custRepo: custRepo,
      notiSvc:  notiSvc, // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     }
    }
    
    func (s *CustomerService) CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error) {
     // Rule: email ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     // ‡πÅ‡∏õ‡∏•‡∏á DTO ‚Üí Model
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Repository Layer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    
      // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö 
     if err := s.notiSvc.SendEmail(customer.Email, "Welcome to our service!", map[string]any{
      "message": "Thank you for joining us! We are excited to have you as a member.",
     }); err != nil {
      // error logging
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO Response
    }
    ```

- Wiring Dependencies ‡πÉ‡∏ô Layer ‡∏Ç‡∏≠‡∏á Application
‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå `application/http.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ dependency injection ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö `NotificationService` ‡πÅ‡∏•‡∏∞ `CustomerService` ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ

    ```go
    func (s *httpServer) RegisterRoutes(db sqldb.DBContext) {
     v1 := s.app.Group("/api/v1")
    
     customers := v1.Group("/customers")
     {
      repo := repository.NewCustomerRepository(db)
      svcNoti := service.NewNotificationService()      // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      svc := service.NewCustomerService(repo, svcNoti) // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      hdlr := handler.NewCustomerHandler(svc)
      customers.Post("", hdlr.CreateCustomer)
     }
     // orders
    }
    ```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å notification logic ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô service ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ

- Code **‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö (separation of concerns)** ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥‡πÉ‡∏ô module ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏ä‡πà‡∏ô order
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å log ‚Üí SMTP ‚Üí SendGrid ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö business logic

## ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏î‡πâ‡∏ß‡∏¢ Layered Architecture

‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ö‡∏ö Layered Architecture ‡∏ã‡∏∂‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

### Repository Layer

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏• `Order` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÅ‡∏•‡∏∞‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `model/order.go`
    >

    ```go
    package model
    
    import (
     "go-mma/util/idgen"
     "time"
    )
    
    type Order struct {
     ID         int64      `db:"id"`
     CustomerID int64      `db:"customer_id"`
     OrderTotal int        `db:"order_total"`
     CreatedAt  time.Time  `db:"created_at"`
     CanceledAt *time.Time `db:"canceled_at"` // nullable
    }
    
    func NewOrder(customerID int64, orderTotal int) *Order {
     return &Order{
      ID:     idgen.GenerateTimeRandomID(),
      CustomerID: customerID,
      OrderTotal: orderTotal,
     }
    }
    ```

- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏• `Customer` ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ credit ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î (`ReserveCredit`) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î (`ReleaseCredit`) ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á ([Rich Model](https://somprasongd.work/blog/architecture/anemic-vs-rich-model))

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `model/customer.go`
    >

    ```go
    func (c *Customer) ReserveCredit(v int) error {
     newCredit := c.Credit - v
     if newCredit < 0 { // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤ credit ‡πÑ‡∏°‡πà‡∏û‡∏≠
      return errs.BusinessRuleError("insufficient credit limit")
     }
     c.Credit = newCredit
     return nil
    }
    
    func (c *Customer) ReleaseCredit(v int) {
     if c.Credit <= 0 { // reset ‡∏¢‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏•‡∏ö
      c.Credit = 0
     }
     c.Credit = c.Credit + v
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á `OrderRepository` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SQL ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÅ‡∏•‡∏∞‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `repository/order.go`
    >

    ```go
    package repository
    
    import (
     "context"
     "database/sql"
     "fmt"
     "go-mma/model"
     "go-mma/util/errs"
     "go-mma/util/storage/sqldb"
     "time"
    )
    
    type OrderRepository struct {
     dbCtx sqldb.DBContext
    }
    
    func NewOrderRepository(dbCtx sqldb.DBContext) *OrderRepository {
     return &OrderRepository{
      dbCtx: dbCtx,
     }
    }
    
    func (r *OrderRepository) Create(ctx context.Context, m *model.Order) error {
     query := `
     INSERT INTO public.orders (
       id, customer_id, order_total
     )
     VALUES ($1, $2, $3)
     RETURNING *
     `
    
     ctx, cancel := context.WithTimeout(ctx, 5*time.Second)
     defer cancel()
    
     err := r.dbCtx.DB().QueryRowxContext(ctx, query, m.ID, m.CustomerID, m.OrderTotal).StructScan(m)
     if err != nil {
      return errs.HandleDBError(fmt.Errorf("an error occurred while inserting an order: %w", err))
     }
     return nil
    }
    
    func (r *OrderRepository) FindByID(ctx context.Context, id int64) (*model.Order, error) {
     query := `
     SELECT *
     FROM public.orders
     WHERE id = $1
     AND canceled_at IS NULL -- ‡∏£‡∏≤‡∏¢‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
    `
     ctx, cancel := context.WithTimeout(ctx, 5*time.Second)
     defer cancel()
    
     var order model.Order
     err := r.dbCtx.DB().QueryRowxContext(ctx, query, id).StructScan(&order)
     if err != nil {
      if err == sql.ErrNoRows {
       return nil, nil
      }
      return nil, errs.HandleDBError(fmt.Errorf("an error occurred while finding a order by id: %w", err))
     }
     return &order, nil
    }
    
    func (r *OrderRepository) Cancel(ctx context.Context, id int64) error {
     query := `
     UPDATE public.orders
     SET canceled_at = current_timestamp -- soft delete record
     WHERE id = $1
    `
     ctx, cancel := context.WithTimeout(ctx, 5*time.Second)
     defer cancel()
     _, err := r.dbCtx.DB().ExecContext(ctx, query, id)
     if err != nil {
      return errs.HandleDBError(fmt.Errorf("failed to cancel order: %w", err))
     }
     return nil
    }
    ```

- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö `CustomerRepository` ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `FindByID` ‡πÅ‡∏•‡∏∞ `UpdateCredit` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `repository/customer.go`
    >

    ```go
    func (r *CustomerRepository) FindByID(ctx context.Context, id int64) (*model.Customer, error) {
     query := `
     SELECT *
     FROM public.customers
     WHERE id = $1
    `
     ctx, cancel := context.WithTimeout(ctx, 20*time.Second)
     defer cancel()
    
     var customer model.Customer
     err := r.dbCtx.DB().QueryRowxContext(ctx, query, id).StructScan(&customer)
     if err != nil {
      if err == sql.ErrNoRows {
       return nil, nil
      }
      return nil, errs.HandleDBError(fmt.Errorf("an error occurred while finding customer by id: %w", err))
     }
    
     return &customer, nil
    }
    
    func (r *CustomerRepository) UpdateCredit(ctx context.Context, m *model.Customer) error {
     query := `
     UPDATE public.customers
     SET credit = $2
     WHERE id = $1
     RETURNING *
    `
     ctx, cancel := context.WithTimeout(ctx, 20*time.Second)
     defer cancel()
    
     err := r.dbCtx.DB().QueryRowxContext(ctx, query, m.ID, m.Credit).StructScan(m)
     if err != nil {
      return errs.HandleDBError(fmt.Errorf("an error occurred while updating customer credit: %w", err))
     }
     return nil
    }
    ```

### Service Layer

- ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å‡∏ù‡∏±‡πà‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `Validate` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `dto/order_request.go`
    >

    ```go
    package dto
    
    import "fmt"
    
    type CreateOrderRequest struct {
     CustomerID int64 `json:"customer_id"`
     OrderTotal int   `json:"order_total"`
    }
    
    func (r *CreateOrderRequest) Validate() error {
     if r.CustomerID <= 0 {
      return fmt.Errorf("customer_id is required")
     }
     if r.OrderTotal <= 0 {
      return fmt.Errorf("order_total must be greater than 0")
     }
     return nil
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á response ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `dto/order_response.go`
    >

    ```go
    package dto
    
    type CreateOrderResponse struct {
     ID int64 `json:"id"`
    }
    
    func NewCreateOrderResponse(id int64) *CreateOrderResponse {
     return &CreateOrderResponse{ID: id}
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á `OrderService` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏° business logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö credit ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î
  - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏¢‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  - ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
  - ‡∏´‡∏≤‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `service/order.go`
    >

    ```go
    package service
    
    import (
     "context"
     "go-mma/dto"
     "go-mma/model"
     "go-mma/repository"
     "go-mma/util/errs"
     "go-mma/util/logger"
    )
    
    var (
     ErrNoCustomerID    = errs.ResourceNotFoundError("the customer with given id was not found")
     ErrNoOrderID       = errs.ResourceNotFoundError("the order with given id was not found")
    )
    
    type OrderService struct {
     custRepo  *repository.CustomerRepository
     orderRepo *repository.OrderRepository
     notiSvc   *NotificationService
    }
    
    func NewOrderService(custRepo *repository.CustomerRepository, orderRepo *repository.OrderRepository, notiSvc *NotificationService) *OrderService {
     return &OrderService{
      custRepo:  custRepo,
      orderRepo: orderRepo,
      notiSvc:   notiSvc,
     }
    }
    
    func (s *OrderService) CreateOrder(ctx context.Context, req *dto.CreateOrderRequest) (*dto.CreateOrderResponse, error) {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // Business Logic: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     customer, err := s.custRepo.FindByID(ctx, req.CustomerID)
     if err != nil {
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     if customer == nil {
      return nil, ErrNoCustomerID
     }
    
     // Business Logic: ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÉ‡∏´‡πâ error
     if err := customer.ReserveCredit(req.OrderTotal); err != nil {
      return nil, err
     }
    
     // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á customer
     if err := s.custRepo.UpdateCredit(ctx, customer); err != nil {
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á order ‡πÉ‡∏´‡∏°‡πà DTO -> Model
     order := model.NewOrder(req.CustomerID, req.OrderTotal)
     
     // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     err = s.orderRepo.Create(ctx, order)
     if err != nil {
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
     err = s.notiSvc.SendEmail(customer.Email, "Order Created", map[string]any{
      "order_id": order.ID,
      "total":    order.OrderTotal,
     })
     if err != nil {
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO Response
     resp := dto.NewCreateOrderResponse(order.ID)
     return resp, nil
    }
    
    func (s *OrderService) CancelOrder(ctx context.Context, id int64) error {
     // Business Logic: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö order id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     order, err := s.orderRepo.FindByID(ctx, id)
     if err != nil {
      logger.Log.Error(err.Error())
      return err
     }
    
     if order == nil {
      return ErrNoOrderID
     }
    
     // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å order
     if err := s.orderRepo.Cancel(ctx, order.ID); err != nil {
      logger.Log.Error(err.Error())
      return err
     }
    
     // Business Logic: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer id
     customer, err := s.custRepo.FindByID(ctx, order.CustomerID)
     if err != nil {
      logger.Log.Error(err.Error())
      return err
     }
    
     if customer == nil {
      return ErrNoCustomerID
     }
    
     // Business Logic: ‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit
     customer.ReleaseCredit(order.OrderTotal)
    
     // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit
     if err := s.custRepo.UpdateCredit(ctx, customer); err != nil {
      logger.Log.Error(err.Error())
      return err
     }
    
     return nil
    }
    ```

### Presentation Layer

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Handler
‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `handler/order.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠ HTTP ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Service Layer ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ response/error ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°

    ```go
    package handler
    
    import (
     "fmt"
     "go-mma/dto"
     "go-mma/service"
     "go-mma/util/errs"
     "go-mma/util/logger"
     "strconv"
    
     "github.com/gofiber/fiber/v3"
    )
    
    type OrderHandler struct {
     orderSvc *service.OrderService
    }
    
    func NewOrderHandler(orderSvc *service.OrderService) *OrderHandler {
     return &OrderHandler{orderSvc: orderSvc}
    }
    
    func (h *OrderHandler) CreateOrder(c fiber.Ctx) error {
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> struct
     var req dto.CreateOrderRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return errs.InputValidationError(err.Error())
     }
    
     logger.Log.Info(fmt.Sprintf("Received Order: %v", req))
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if err := req.Validate(); err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return errs.InputValidationError(err.Error())
     }
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     resp, err := h.orderSvc.CreateOrder(c.Context(), &req)
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return err
     }
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    
    func (h *OrderHandler) CancelOrder(c fiber.Ctx) error {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö orderID
     orderID, err := strconv.Atoi(c.Params("orderID"))
     if err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return errs.InputValidationError("invalid order id")
     }
    
     logger.Log.Info(fmt.Sprintf("Cancelling order: %v", orderID))
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Service Layer
     err = h.orderSvc.CancelOrder(c.Context(), int64(orderID))
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å Service Layer ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return err
     }
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 204 (no content)
     return c.SendStatus(fiber.StatusNoContent)
    }
    ```

### ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡πà‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ Dependency Injection

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `application/http.go`

    ```go
    func (s *httpServer) RegisterRoutes(db sqldb.DBContext) {
     v1 := s.app.Group("/api/v1")
    
     // customers
    
     orders := v1.Group("/orders")
     {
      repoCust := repository.NewCustomerRepository(dbCtx)
      repoOrder := repository.NewOrderRepository(dbCtx)
      svcNoti := service.NewNotificationService()
      svcOrder := service.NewOrderService(repoCust, repoOrder, svcNoti)
      hdlr := handler.NewOrderHandler(svcOrder)
      orders.Post("", hdlr.CreateOrder)
      orders.Delete("/:orderID", hdlr.CancelOrder)
     }
    }
    ```

## ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Database Transaction ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô repository ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÄ‡∏ä‡πà‡∏ô

1. ‡∏´‡∏±‡∏Å‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (order)

‡∏´‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏£‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡∏Å‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏°‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô

```go
+------------------+        +-------------------+        +------------------+
| OrderService     |        | CustomerRepo      |        | OrderRepo        |
|------------------|        |-------------------|        |------------------|
| CreateOrder()    |        | FindCustomerByID()|        | SaveOrder()      |
|                  |        | ReserveCredit()   |        |                  |
+--------+---------+        +--------+----------+        +--------+---------+
         |                           |                            |
         | Find Customer By ID       |                            |
         +-------------------------> |                            |
         |                           |                            |
         |     Reserve Credit        |                            |
         +-------------------------> |                            |
         |                           |                            |
         |   Save Order              |                            |
         +------------------------------------------------------->|
         |                           |                            |
         |   ‚ùå FAIL (DB Error)      |                            |
         |<-------------------------------------------------------+
         |                           |                            |
         |                           |                            |
         |                           |                            |
         |                           |      ‚ö†Ô∏è CREDIT ALREADY DEDUCTED
         |                           |      ‚ùå ORDER NOT CREATED
         |                           |
         |  ‚ùå Inconsistent state!
```

### Database Transaction ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**Database Transaction** ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (‡πÄ‡∏ä‡πà‡∏ô `INSERT`, `UPDATE`, `DELETE`) ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏°‡∏≠‡∏á‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô **"‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡πà‡∏á‡πÅ‡∏¢‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ"**

‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥ **ACID** ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:

- **Atomicity (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏¢):** ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Transaction ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ **Commit**) ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÅ‡∏°‡πâ‡πÅ‡∏ï‡πà‡∏≠‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ **Rollback**) ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
- **Consistency (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á):** Transaction ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡∏µ‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏™‡∏°‡∏≠ ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏¥‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÜ ‡∏Å‡∏•‡∏≤‡∏á‡πÜ
- **Isolation (‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ï‡∏±‡∏ß):** Transaction ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡∏≠‡∏±‡∏ô ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏Å‡∏ß‡∏ô‡∏Å‡∏±‡∏ô ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏ß‡πà‡∏≤ Transaction ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡∏•‡∏∞‡∏≠‡∏±‡∏ô
- **Durability (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏á‡∏ó‡∏ô):** ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Transaction ‡∏ñ‡∏π‡∏Å Commit ‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏≤‡∏ß‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢‡πÑ‡∏õ ‡πÅ‡∏°‡πâ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡πÑ‡∏ü‡∏î‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πà‡∏°‡∏Å‡πá‡∏ï‡∏≤‡∏°

**‡∏™‡∏£‡∏∏‡∏õ:** Database Transaction ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡πÑ‡∏Å‡πÉ‡∏ô **‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•** ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô/‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

### Unit of Work ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**Unit of Work (UoW)** ‡πÄ‡∏õ‡πá‡∏ô **Design Pattern** ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô **Service Layer** ‡πÉ‡∏ä‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏´‡∏•‡∏≤‡∏¢‡πÜ operation (insert, update, delete) ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô **transaction ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô** ‡πÇ‡∏î‡∏¢‡∏°‡∏∏‡πà‡∏á‡πÄ‡∏ô‡πâ‡∏ô‡∏ó‡∏µ‡πà **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Consistency)** ‡πÅ‡∏•‡∏∞ **‡∏Å‡∏≤‡∏£ rollback ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î**

**‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á Unit of Work**

1. Start / Begin: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô transaction
2. Register Changes: ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ operation ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥ (insert, update, delete)
3. Commit: ‡∏ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ú‡πà‡∏≤‡∏ô ‚Üí commit DB
4. Rollback: ‡∏ñ‡πâ‡∏≤ error ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‚Üí ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (rollback)
5. Post-Commit Hook: ‡∏£‡∏±‡∏ô side effects (‡πÄ‡∏ä‡πà‡∏ô send email) **‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å** commit ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Transactor(Unit of Work) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Database Transaction

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢ repository ‡πÉ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á business flow (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå) ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏° atomic ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ **Transactor** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° transaction ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥ rollback ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î error

<aside>
üí°

‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏î‡∏±‡∏î‡πÅ‡∏õ‡∏•‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å <https://github.com/Thiht/transactor>

</aside>

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Interface ‡∏Å‡∏•‡∏≤‡∏á `DBTX` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ repository ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á `*sqlx.DB` ‡πÅ‡∏•‡∏∞ `*sqlx.Tx`

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/storage/sqldb/transactor/types.go`
    >

    ```go
    package transactor
    
    import (
     "context"
     "database/sql"
    
     "github.com/jmoiron/sqlx"
    )
    
    // DBTX ‡∏Ñ‡∏∑‡∏≠ interface ‡∏Å‡∏•‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á *sqlx.DB ‡πÅ‡∏•‡∏∞ *sqlx.Tx
    // ‡∏£‡∏ß‡∏° method ‡∏Ç‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á database/sql ‡πÅ‡∏•‡∏∞ sqlx ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ interchangeably ‡πÑ‡∏î‡πâ
    type DBTX interface {
     // database/sql methods
     ExecContext(ctx context.Context, query string, args ...any) (sql.Result, error)
     PrepareContext(ctx context.Context, query string) (*sql.Stmt, error)
     QueryContext(ctx context.Context, query string, args ...any) (*sql.Rows, error)
     QueryRowContext(ctx context.Context, query string, args ...any) *sql.Row
    
     Exec(query string, args ...any) (sql.Result, error)
     Prepare(query string) (*sql.Stmt, error)
     Query(query string, args ...any) (*sql.Rows, error)
     QueryRow(query string, args ...any) *sql.Row
    
     // sqlx methods
     GetContext(ctx context.Context, dest any, query string, args ...any) error
     MustExecContext(ctx context.Context, query string, args ...any) sql.Result
     NamedExecContext(ctx context.Context, query string, arg any) (sql.Result, error)
     PrepareNamedContext(ctx context.Context, query string) (*sqlx.NamedStmt, error)
     PreparexContext(ctx context.Context, query string) (*sqlx.Stmt, error)
     QueryRowxContext(ctx context.Context, query string, args ...any) *sqlx.Row
     QueryxContext(ctx context.Context, query string, args ...any) (*sqlx.Rows, error)
     SelectContext(ctx context.Context, dest any, query string, args ...any) error
    
     Get(dest any, query string, args ...any) error
     MustExec(query string, args ...any) sql.Result
     NamedExec(query string, arg any) (sql.Result, error)
     NamedQuery(query string, arg any) (*sqlx.Rows, error)
     PrepareNamed(query string) (*sqlx.NamedStmt, error)
     Preparex(query string) (*sqlx.Stmt, error)
     QueryRowx(query string, args ...any) *sqlx.Row
     Queryx(query string, args ...any) (*sqlx.Rows, error)
     Select(dest any, query string, args ...any) error
    
     Rebind(query string) string
     BindNamed(query string, arg any) (string, []any, error)
     DriverName() string
    }
    
    // ‡∏Ç‡∏¢‡∏≤‡∏¢ interface DBTX ‡πÇ‡∏î‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏° method ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏° transaction
    type sqlxDB interface {
     DBTX
     BeginTxx(ctx context.Context, opts *sql.TxOptions) (*sqlx.Tx, error)
    }
    
    // interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ transaction lifecycle
    type sqlxTx interface {
     Commit() error
     Rollback() error
    }
    
    // compile-time check ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ type ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ implement interface ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    var (
     _ DBTX   = &sqlx.DB{}
     _ DBTX   = &sqlx.Tx{}
     _ sqlxDB = &sqlx.DB{}
     _ sqlxTx = &sqlx.Tx{}
    )
    
    type (
     // ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö context value ‡∏Ç‡∏≠‡∏á transactor
     transactorKey struct{}
    
     // DBTXContext ‡πÉ‡∏ä‡πâ‡∏î‡∏∂‡∏á DBTX ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏≤‡∏Å context (‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô transaction ‡∏´‡∏£‡∏∑‡∏≠ db ‡∏õ‡∏Å‡∏ï‡∏¥)
     DBTXContext func(context.Context) DBTX
    )
    
    // ‡∏ù‡∏±‡∏á sqlxDB (‡πÄ‡∏ä‡πà‡∏ô tx) ‡∏•‡∏á‡πÉ‡∏ô context ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô logic ‡∏ï‡πà‡∏≠‡πÑ‡∏õ
    func txToContext(ctx context.Context, tx sqlxDB) context.Context {
     return context.WithValue(ctx, transactorKey{}, tx)
    }
    
    // ‡∏î‡∏∂‡∏á sqlxDB ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å context ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
    func txFromContext(ctx context.Context) sqlxDB {
     if tx, ok := ctx.Value(transactorKey{}).(sqlxDB); ok {
      return tx
     }
     return nil
    }
    ```

    `DBTX` ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å inject ‡∏ú‡πà‡∏≤‡∏ô context ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ repository ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πâ DB ‡∏´‡∏£‡∏∑‡∏≠ Tx ‡∏≠‡∏¢‡∏π‡πà

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Nested Transactions
‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ nested transactions ‡πÑ‡∏î‡πâ 2 ‡πÅ‡∏ö‡∏ö
  - **‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö** (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° transaction flow ‡πÄ‡∏≠‡∏á)

        > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/storage/sqldb/transactor/nested_transactions_none.go`
        >

        ```go
        package transactor
        
        import (
         "context"
         "database/sql"
         "errors"
        
         "github.com/jmoiron/sqlx"
        )
        
        // NestedTransactionsNone ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î nested transaction
        // ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ nested tx ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô logic ‡∏ã‡πâ‡∏≠‡∏ô‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
        func NestedTransactionsNone(db sqlxDB, tx *sqlx.Tx) (sqlxDB, sqlxTx) {
         switch typedDB := db.(type) {
         case *sqlx.DB:
          // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô root DB -> wrap tx ‡∏î‡πâ‡∏ß‡∏¢ nestedTransactionNone ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô nested
          return &nestedTransactionNone{tx}, tx
        
         case *nestedTransactionNone:
          // ‡∏ñ‡πâ‡∏≤ tx ‡∏ñ‡∏π‡∏Å wrap ‡πÅ‡∏•‡πâ‡∏ß -> ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏õ (‡∏Å‡∏±‡∏ô nested)
          return typedDB, typedDB
        
         default:
          panic("unsupported type") // ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö type ‡∏≠‡∏∑‡πà‡∏ô
         }
        }
        
        // nestedTransactionNone ‡πÄ‡∏õ‡πá‡∏ô struct ‡∏ó‡∏µ‡πà wrap *sqlx.Tx
        // ‡πÅ‡∏•‡∏∞ override method ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°/commit/rollback transaction
        // ‡πÉ‡∏´‡πâ return error ‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏û‡∏∑‡πà‡∏≠ block ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ nested transaction
        type nestedTransactionNone struct {
         *sqlx.Tx
        }
        
        // Override BeginTxx ‡πÄ‡∏û‡∏∑‡πà‡∏≠ block nested tx
        func (t *nestedTransactionNone) BeginTxx(_ context.Context, _ *sql.TxOptions) (*sqlx.Tx, error) {
         return nil, errors.New("nested transactions are not supported")
        }
        
        // Override Commit ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ commit nested tx
        func (t *nestedTransactionNone) Commit() error {
         return errors.New("nested transactions are not supported")
        }
        
        // Override Rollback ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ rollback nested tx
        func (t *nestedTransactionNone) Rollback() error {
         return errors.New("nested transactions are not supported")
        }
        ```

  - **‡πÉ‡∏ä‡πâ Savepoints** (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏ã‡πâ‡∏≠‡∏ô transaction ‡πÑ‡∏î‡πâ)

        > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/storage/sqldb/transactor/nested_transactions_savepoint.go`
        >

        ```go
        package transactor
        
        import (
         "context"
         "database/sql"
         "fmt"
         "strconv"
         "sync/atomic"
        
         "github.com/jmoiron/sqlx"
        )
        
        // NestedTransactionsSavepoints ‡πÉ‡∏ä‡πâ savepoint ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥‡∏•‡∏≠‡∏á nested transaction
        // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö DB ‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô savepoint ‡πÄ‡∏ä‡πà‡∏ô PostgreSQL, MySQL, MariaDB, SQLite
        func NestedTransactionsSavepoints(db sqlxDB, tx *sqlx.Tx) (sqlxDB, sqlxTx) {
         switch typedDB := db.(type) {
         case *sqlx.DB:
          // ‡πÄ‡∏£‡∏¥‡πà‡∏° nested transaction ‡∏à‡∏≤‡∏Å root db
          return &nestedTransactionSavepoints{Tx: tx}, tx
        
         case *nestedTransactionSavepoints:
          // ‡∏ã‡πâ‡∏≠‡∏ô nested ‡∏≠‡∏µ‡∏Å‡∏ä‡∏±‡πâ‡∏ô (‡πÄ‡∏û‡∏¥‡πà‡∏° depth)
          nestedTransaction := &nestedTransactionSavepoints{
           Tx:    tx,
           depth: typedDB.depth + 1,
          }
          return nestedTransaction, nestedTransaction
        
         default:
          panic("unsupported type") // ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö type ‡∏≠‡∏∑‡πà‡∏ô
         }
        }
        
        // struct ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ nested transaction ‡∏î‡πâ‡∏ß‡∏¢ savepoint
        type nestedTransactionSavepoints struct {
         *sqlx.Tx
         depth int64       // ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á nested level (‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ savepoint)
         done  atomic.Bool // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ Commit() ‡∏´‡∏£‡∏∑‡∏≠ Rollback() ‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ã‡πâ‡∏≥
        }
        
        // BeginTxx ‡∏™‡∏£‡πâ‡∏≤‡∏á savepoint ‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö depth
        func (t *nestedTransactionSavepoints) BeginTxx(ctx context.Context, _ *sql.TxOptions) (*sqlx.Tx, error) {
         if _, err := t.ExecContext(ctx, "SAVEPOINT sp_"+strconv.FormatInt(t.depth+1, 10)); err != nil {
          return nil, fmt.Errorf("failed to create savepoint: %w", err)
         }
         return t.Tx, nil
        }
        
        // Commit ‡∏à‡∏∞ release savepoint ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö level ‡∏ô‡∏µ‡πâ
        // ‡πÉ‡∏ä‡πâ CompareAndSwap ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ commit ‡∏ã‡πâ‡∏≥
        func (t *nestedTransactionSavepoints) Commit() error {
         if !t.done.CompareAndSwap(false, true) {
          return sql.ErrTxDone // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ commit ‡∏ã‡πâ‡∏≥
         }
         if _, err := t.Exec("RELEASE SAVEPOINT sp_" + strconv.FormatInt(t.depth, 10)); err != nil {
          return fmt.Errorf("failed to release savepoint: %w", err)
         }
         return nil
        }
        
        // Rollback ‡∏à‡∏∞ rollback ‡πÑ‡∏õ‡∏¢‡∏±‡∏á savepoint ‡∏Ç‡∏≠‡∏á level ‡∏ô‡∏µ‡πâ
        // ‡πÅ‡∏•‡∏∞ mark ‡∏ß‡πà‡∏≤ transaction ‡∏ô‡∏µ‡πâ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß
        func (t *nestedTransactionSavepoints) Rollback() error {
         if !t.done.CompareAndSwap(false, true) {
          return sql.ErrTxDone // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô rollback ‡∏ã‡πâ‡∏≥
         }
         if _, err := t.Exec("ROLLBACK TO SAVEPOINT sp_" + strconv.FormatInt(t.depth, 10)); err != nil {
          return fmt.Errorf("failed to rollback to savepoint: %w", err)
         }
         return nil
        }
        ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Transactor ‡∏ã‡∏∂‡πà‡∏á‡∏ï‡∏±‡∏ß `Transactor` ‡∏à‡∏∞‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° transaction, inject context, ‡πÅ‡∏•‡∏∞ commit/rollback ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/storage/sqldb/transactor/transactor.go`
    >

    ```go
    // Ref: https://github.com/Thiht/transactor/blob/main/sqlx/transactor.go
    package transactor
    
    import (
     "context"
     "fmt"
     "go-mma/util/logger"
    
     "github.com/jmoiron/sqlx"
    )
    
    // PostCommitHook ‡∏Ñ‡∏∑‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Commit ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
    type PostCommitHook func(ctx context.Context) error
    
    // Transactor ‡∏Ñ‡∏∑‡∏≠ interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Transaction
    type Transactor interface {
     // WithinTransaction ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô Transaction
     // ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô PostCommitHook ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Commit ‡πÑ‡∏î‡πâ
     WithinTransaction(
      ctx context.Context,
      txFunc func(ctxWithTx context.Context, registerPostCommitHook func(PostCommitHook)) error,
     ) error
    }
    
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î alias ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠ inject dependencies
    type (
     sqlxDBGetter               func(context.Context) sqlxDB // ‡∏î‡∏∂‡∏á *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏à‡∏≤‡∏Å context
     nestedTransactionsStrategy func(sqlxDB, *sqlx.Tx) (sqlxDB, sqlxTx) // ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ nested transaction
    )
    
    // sqlxTransactor ‡∏Ñ‡∏∑‡∏≠ implementation ‡∏Ç‡∏≠‡∏á Transactor
    type sqlxTransactor struct {
     sqlxDBGetter               // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡∏∂‡∏á DB/Tx ‡∏à‡∏≤‡∏Å context
     nestedTransactionsStrategy // ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ nested transaction
    }
    
    // Option ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ sqlxTransactor ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå nested transaction
    type Option func(*sqlxTransactor)
    
    // New ‡∏™‡∏£‡πâ‡∏≤‡∏á instance ‡∏Ç‡∏≠‡∏á Transactor ‡πÅ‡∏•‡∏∞ DBTXContext
    func New(db *sqlx.DB, opts ...Option) (Transactor, DBTXContext) {
     t := &sqlxTransactor{
      // default: ‡∏ñ‡πâ‡∏≤ context ‡∏°‡∏µ tx ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ tx, ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô‡πÉ‡∏ä‡πâ db
      sqlxDBGetter: func(ctx context.Context) sqlxDB {
       if tx := txFromContext(ctx); tx != nil {
        return tx
       }
       return db
      },
      nestedTransactionsStrategy: NestedTransactionsNone, // default strategy: ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö nested transaction
     }
    
     // apply ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
     for _, opt := range opts {
      opt(t)
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á DBTX ‡∏à‡∏≤‡∏Å context
     dbGetter := func(ctx context.Context) DBTX {
      if tx := txFromContext(ctx); tx != nil {
       return tx
      }
      return db
     }
    
     return t, dbGetter
    }
    
    // WithNestedTransactionStrategy ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå nested transaction (‡πÄ‡∏ä‡πà‡∏ô Savepoints)
    func WithNestedTransactionStrategy(strategy nestedTransactionsStrategy) Option {
     return func(t *sqlxTransactor) {
      t.nestedTransactionsStrategy = strategy
     }
    }
    
    // WithinTransaction ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô transaction context
    func (t *sqlxTransactor) WithinTransaction(
     ctx context.Context,
     txFunc func(ctxWithTx context.Context, registerPostCommitHook func(PostCommitHook)) error,
    ) error {
     // ‡∏î‡∏∂‡∏á database ‡∏´‡∏£‡∏∑‡∏≠ transaction object ‡∏à‡∏≤‡∏Å context
     currentDB := t.sqlxDBGetter(ctx)
    
     // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô transaction ‡πÉ‡∏´‡∏°‡πà
     tx, err := currentDB.BeginTxx(ctx, nil)
     if err != nil {
      return fmt.Errorf("failed to begin transaction: %w", err)
     }
    
     var hooks []PostCommitHook // ‡πÄ‡∏Å‡πá‡∏ö hook ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å commit
    
     // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô post-commit hook
     registerPostCommitHook := func(hook PostCommitHook) {
      hooks = append(hooks, hook)
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á nested transaction context ‡πÉ‡∏´‡∏°‡πà (‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ)
     newDB, currentTX := t.nestedTransactionsStrategy(currentDB, tx)
    
     // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏ì‡∏µ panic ‡∏´‡∏£‡∏∑‡∏≠ error ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ commit ‚Äî ‡∏à‡∏∞ rollback ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
     defer func() {
      _ = currentTX.Rollback()
     }()
    
     // inject transaction object ‡πÄ‡∏Ç‡πâ‡∏≤ context ‡πÉ‡∏´‡∏°‡πà
     ctxWithTx := txToContext(ctx, newDB)
    
     // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö context + hook registration
     if err := txFunc(ctxWithTx, registerPostCommitHook); err != nil {
      return err // ‡∏ñ‡πâ‡∏≤ error, transaction ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å rollback ‡πÉ‡∏ô defer
     }
    
     // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° commit
     if err := currentTX.Commit(); err != nil {
      return fmt.Errorf("failed to commit transaction: %w", err)
     }
    
     // ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å commit ‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ run post-commit hooks ‡πÅ‡∏ö‡∏ö async
     go func() {
      for _, hook := range hooks {
       func(h PostCommitHook) {
        defer func() {
         // ‡∏î‡∏±‡∏Å panic ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ crash ‡πÅ‡∏•‡∏∞ log ‡πÑ‡∏ß‡πâ
         if r := recover(); r != nil {
          logger.Log.Error(fmt.Sprintf("post-commit hook panic: %v", r))
         }
        }()
        // ‡∏ñ‡πâ‡∏≤ error ‡∏à‡∏≤‡∏Å hook ‡∏Å‡πá log ‡πÑ‡∏ß‡πâ
        if err := h(ctx); err != nil {
         logger.Log.Error(fmt.Sprintf("post-commit hook error: %v", err))
        }
       }(hook)
      }
     }()
    
     return nil
    }
    
    // IsWithinTransaction ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ context ‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô transaction ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    func IsWithinTransaction(ctx context.Context) bool {
     return ctx.Value(transactorKey{}) != nil
    }
    
    ```

    **‡∏™‡∏£‡∏∏‡∏õ**

  - ‡πÉ‡∏ä‡πâ `Transactor` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏´‡∏•‡∏≤‡∏¢ DB operation ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô atomic unit
  - Inject `DBTX` ‡∏ú‡πà‡∏≤‡∏ô context ‡∏ó‡∏≥‡πÉ‡∏´‡πâ repository ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô transaction ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö nested transactions ‡∏î‡πâ‡∏ß‡∏¢ savepoint ‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

### ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Repository Layer

‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô layer ‡∏Ç‡∏≠‡∏á repository ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô transaction ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏¢ repository ‡πÇ‡∏î‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ inject ‡∏ï‡∏±‡∏ß database connection (`*sql.DB` ‡∏´‡∏£‡∏∑‡∏≠ `sqldb.DBContext`) ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ interface ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ `transactor.DBContext`

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á**

- ‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ä‡πâ `dbCtx sqldb.DBContext`
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô `dbCtx transactor.DBContext`
- ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `db.QueryContext(...)`, `db.ExecContext(...)` ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á `sql.DB` ‡∏´‡∏£‡∏∑‡∏≠ `sql.Tx` ‡∏à‡∏≤‡∏Å `context.Context` ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `r.dbCtx(ctx)` ‡πÅ‡∏ó‡∏ô

**‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÇ‡∏Ñ‡πâ‡∏î**

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `repository/customer.go`

    ```go
    package repository
    
    import (
     "context"
     "database/sql"
     "fmt"
     "go-mma/model"
     "go-mma/util/errs"
     "go-mma/util/storage/sqldb/transactor"
     "time"
    )
    
    type CustomerRepository struct {
     dbCtx transactor.DBTXContext // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    }
    
    func NewCustomerRepository(dbCtx transactor.DBTXContext) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    *CustomerRepository {
     // ...
    }
    
    func (r *CustomerRepository) Create(ctx context.Context, customer *model.Customer) error {
     // ...
    
     err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    
    func (r *CustomerRepository) ExistsByEmail(ctx context.Context, email string) (bool, error) {
     // ...
     
     err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    
    func (r *CustomerRepository) FindByID(ctx context.Context, id int64) (*model.Customer, error) {
     // ...
     
     err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    
    func (r *CustomerRepository) UpdateCredit(ctx context.Context, m *model.Customer) error {
     // ...
    
     err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `repository/order.go`

    ```go
    package repository
    
    import (
     "context"
     "database/sql"
     "fmt"
     "go-mma/model"
     "go-mma/util/errs"
     "go-mma/util/storage/sqldb/transactor"
     "time"
    )
    
    type OrderRepository struct {
     dbCtx transactor.DBTXContext  // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    }
    
    func NewOrderRepository(dbCtx transactor.DBTXContext) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    *OrderRepository {
     // ...
    }
    
    func (r *OrderRepository) Create(ctx context.Context, m *model.Order) error {
     // ...
    
     err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    
    func (r *OrderRepository) FindByID(ctx context.Context, id int64) (*model.Order, error) {
     // ...
     
     err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    
    func (r *OrderRepository) Cancel(ctx context.Context, id int64) error {
     // ...
     
     _, err := r.dbCtx(ctx). // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô *sqlx.DB ‡∏´‡∏£‡∏∑‡∏≠ *sqlx.Tx ‡∏Å‡πá‡πÑ‡∏î‡πâ
     
     // ...
    }
    ```

**‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á**

- ‡πÉ‡∏ä‡πâ `transactor.DBTXContext` ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á `sql.DB` ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
- `dbCtx(ctx)` ‡∏à‡∏∞ return `sql.Tx` ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ transaction, ‡∏´‡∏£‡∏∑‡∏≠ `sql.DB` ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ repository ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô transaction ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πâ `sql.Tx` ‡∏´‡∏£‡∏∑‡∏≠ `sql.DB`

### ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Service Layer

‡πÉ‡∏ô‡∏ä‡∏±‡πâ‡∏ô `service` ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏£‡∏±‡∏ö `transactor.Transactor` ‡∏°‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Service ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡πÉ‡∏ä‡πâ `WithinTransaction()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡∏π‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ transaction ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ rollback ‡πÑ‡∏î‡πâ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏î‡πÜ

**‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÇ‡∏Ñ‡πâ‡∏î**

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `service/customer.go` ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‡∏Å‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `WithinTransaction`

    ```go
    package service
    
    // ...
    
    type CustomerService struct {
     transactor transactor.Transactor // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     custRepo   *repository.CustomerRepository
     notiSvc    *NotificationService
    }
    
    func NewCustomerService(
     transactor transactor.Transactor, // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     custRepo *repository.CustomerRepository,
     notiSvc *NotificationService,
    ) *CustomerService {
     return &CustomerService{
      transactor: transactor, // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      custRepo:   custRepo,
      notiSvc:    notiSvc,
     }
    }
    
    func (s *CustomerService) CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error) {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° "‡∏Å‡∏é‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à" (Business Logic/Semantic Validation)
     // Business Logic: email ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     
     // ‡πÅ‡∏õ‡∏•‡∏á DTO ‚Üí Model
     customer := model.NewCustomer(req.Email, req.Credit)
     
      // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     // ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô WithinTransaction
     err = s.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
         
      // Unit of Work: register change
      if err := s.custRepo.Create(ctx, customer); err != nil {
       // error logging
       logger.Log.Error(err.Error())
       return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      }
    
      // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
      if err := s.notiSvc.SendEmail(customer.Email, "Welcome to our service!", map[string]any{
       "message": "Thank you for joining us! We are excited to have you as a member.",
      }); err != nil {
       // error logging
       logger.Log.Error(err.Error())
       return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      }
    
        // Unit of Work: commit ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á func ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      return nil
     })
    
     if err != nil {
      return nil, err
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO Response
     // ...
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `service/order.go` ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `WithinTransaction`

    ```go
    package service
    
    // ...
    
    type OrderService struct {
     transactor transactor.Transactor // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     custRepo   *repository.CustomerRepository
     orderRepo  *repository.OrderRepository
     notiSvc    *NotificationService
    }
    
    func NewOrderService(
     transactor transactor.Transactor, // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     custRepo *repository.CustomerRepository,
     orderRepo *repository.OrderRepository,
     notiSvc *NotificationService) *OrderService {
     return &OrderService{
      transactor: transactor, // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      custRepo:   custRepo,
      orderRepo:  orderRepo,
      notiSvc:    notiSvc,
     }
    }
    
    func (s *OrderService) CreateOrder(ctx context.Context, req *dto.CreateOrderRequest) (*dto.CreateOrderResponse, error) {
     // Business Logic: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     // ...
    
        // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     // ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô WithinTransaction
     var order *model.Order
     err = s.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
       
       // Business Logic Rule: ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÉ‡∏´‡πâ error
      if err := customer.ReserveCredit(req.OrderTotal); err != nil {
       return err
      }
     
        // Unit of Work: register change
      // ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á customer
      if err := s.custRepo.UpdateCredit(ctx, customer); err != nil {
       logger.Log.Error(err.Error())
       return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      }
    
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á order ‡πÉ‡∏´‡∏°‡πà DTO -> Model
      order = model.NewOrder(req.CustomerID, req.OrderTotal)
      // Unit of Work: register change
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      err = s.orderRepo.Create(ctx, order)
      if err != nil {
       logger.Log.Error(err.Error())
       return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      }
    
      // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
      err = s.notiSvc.SendEmail(customer.Email, "Order Created", map[string]any{
       "order_id": order.ID,
       "total":    order.OrderTotal,
      })
      if err != nil {
       logger.Log.Error(err.Error())
       return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      }
        
        // Unit of Work: commit ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á func ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      return nil
     })
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å‡πÉ‡∏ô transactor
     if err != nil {
      return nil, err
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO Response
     // ...
    }
    ```

### Post-Commit Hook

‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£‡πÅ‡∏¢‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î side effects ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•, call external service ‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô**‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å** commit ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤ data persist ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å rollback ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ external failure

**‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**

```go
// service/customer.go
// func (s *customerService) CreateCustomer(...)
err = s.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(PostCommitHook)) error {
     
  // Unit of Work: register change
  if err := s.custRepo.Create(ctx, customer); err != nil {
   // error logging
   logger.Log.Error(err.Error())
   return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
  }

  // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö <-- side-effect
  if err := s.notiSvc.SendEmail(customer.Email, "Welcome to our service!", map[string]any{
   "message": "Thank you for joining us! We are excited to have you as a member.",
  }); err != nil {
   // error logging
   logger.Log.Error(err.Error())
   return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
  }

    // Unit of Work: commit ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á func ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
  return nil
 })
```

**‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**

```go
// service/customer.go
// func (s *customerService) CreateCustomer(...)
err = s.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(PostCommitHook)) error {
     
  // Unit of Work: register change
  if err := s.custRepo.Create(ctx, customer); err != nil {
   // error logging
   logger.Log.Error(err.Error())
   return err // Unit of Work: rollback ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
  }

  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô hook ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  registerPostCommitHook(func(ctx context.Context) error {
   return s.notiSvc.SendEmail(customer.Email, "Welcome to our service!", map[string]any{
    "message": "Thank you for joining us! We are excited to have you as a member."})
  })

    // Unit of Work: commit ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á func ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
  return nil
 })
```

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà `func (s *orderService) CreateOrder(‚Ä¶)` ‡∏î‡πâ‡∏ß‡∏¢

### ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Dependency Injection

‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ inject `transactor.Transactor` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô Service Layer

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `application/http.go`

    ```go
    func (s *httpServer) RegisterRoutes(dbCtx sqldb.DBContext) {
     v1 := s.app.Group("/api/v1")
    
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á transactor ‡∏Å‡∏±‡∏ö dbCtx ‡∏à‡∏≤‡∏Å transactor
     transactor, dbtxCtx := transactor.New(dbCtx.DB()) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     customers := v1.Group("/customers")
     {
      repo := repository.NewCustomerRepository(dbtxCtx) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      svcNoti := service.NewNotificationService()
      svc := service.NewCustomerService(transactor, repo, svcNoti) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      hdl := handler.NewCustomerHandler(svc)
      customers.Post("", hdl.CreateCustomer)
     }
    
     orders := v1.Group("/orders")
     {
      repoCust := repository.NewCustomerRepository(dbtxCtx) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      repoOrder := repository.NewOrderRepository(dbtxCtx) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      svcNoti := service.NewNotificationService()
      svcOrder := service.NewOrderService(transactor, repoCust, repoOrder, svcNoti) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      hdl := handler.NewOrderHandler(svcOrder)
      orders.Post("", hdlr.CreateOrder)
      orders.Delete("/:orderID", hdl.CancelOrder)
     }
    }
    ```

## ‡∏ô‡∏≥‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Dependency Inversion ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á

**Dependency Inversion** ‡∏Ñ‡∏∑‡∏≠ ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏ä‡πà‡∏ô Handler, Service) ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡πà‡∏≤‡∏á (‡πÄ‡∏ä‡πà‡∏ô Repository ‡πÅ‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á), ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö Interface ‡πÅ‡∏ó‡∏ô

‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡∏Ñ‡∏∑‡∏≠

- ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏î (loose coupling)
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô implementation ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å PostgreSQL ‚Üí MongoDB
- ‡∏ó‡∏≥ unit test ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ mock ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å interface

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ Dependency Inversion

```go
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Handler   ‚îÇ ‚Üê struct: CustomerHandler
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ depends on interface
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Service   ‚îÇ  ‚Üê interface: CustomerService
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ implemented by
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ServiceImp         ‚îÇ ‚Üê struct: customerService
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ depends on interface
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Repository ‚îÇ  ‚Üê interface: CustomerRepository
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ implemented by
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PostgresRepository ‚îÇ ‚Üê struct: customerRepository
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Repository Layer

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `repository/customer.go`

    ```go
    package repository
    
    // ...
    
    // --> Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á interface
    type CustomerRepository interface {
     Create(ctx context.Context, customer *model.Customer) error
     ExistsByEmail(ctx context.Context, email string) (bool, error)
     FindByID(ctx context.Context, id int64) (*model.Customer, error)
     UpdateCredit(ctx context.Context, customer *model.Customer) error
    }
    
    type customerRepository struct { // --> Step 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
     dbCtx transactor.DBTXContext
    }
    
    // --> Step 3: return ‡πÄ‡∏õ‡πá‡∏ô interface
    func NewCustomerRepository(dbCtx transactor.DBTXContext) CustomerRepository {
     return &customerRepository{ // --> Step 4: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
      dbCtx: dbCtx,
     }
    }
    
    // --> Step 5: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *customerRepository) Create(ctx context.Context, customer *model.Customer) error {
     // ...
    }
    
    // --> Step 6: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *customerRepository) ExistsByEmail(ctx context.Context, email string) (bool, error) {
     // ...
    }
    
    // --> Step 7: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *customerRepository) FindByID(ctx context.Context, id int64) (*model.Customer, error) {
     // ...
    }
    
    // --> Step 8: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *customerRepository) UpdateCredit(ctx context.Context, m *model.Customer) error {
     // ...
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `repository/order.go`

    ```go
    package repository
    
    // ...
    
    // --> Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á interface
    type OrderRepository interface {
     Create(ctx context.Context, order *model.Order) error
     FindByID(ctx context.Context, id int64) (*model.Order, error)
     Cancel(ctx context.Context, id int64) error
    }
    
    type orderRepository struct { // --> Step 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
     dbCtx transactor.DBTXContext
    }
    
    // --> Step 3: return ‡πÄ‡∏õ‡πá‡∏ô interface
    func NewOrderRepository(dbCtx transactor.DBTXContext) OrderRepository {
     return &orderRepository{ // --> Step 4: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
      dbCtx: dbCtx,
     }
    }
    
    // --> Step 5: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *orderRepository) Create(ctx context.Context, m *model.Order) error {
     // ...
    }
    
    // --> Step 6: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *orderRepository) FindByID(ctx context.Context, id int64) (*model.Order, error) {
     // ...
    }
    
    // --> Step 7: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (r *orderRepository) Cancel(ctx context.Context, id int64) error {
     // ...
    }
    ```

### Service Layer

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `service/notification.go`

    ```go
    package service
    
    import (
     "fmt"
     "go-mma/util/logger"
    )
    
    // --> Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á interface
    type NotificationService interface {
     SendEmail(to string, subject string, payload map[string]any) error
    }
    
    // --> Step 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    type notificationService struct {
    }
    
    // --> Step 3: return ‡πÄ‡∏õ‡πá‡∏ô interface
    func NewNotificationService() NotificationService {
     return &notificationService{} // --> Step 4: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    }
    
    // --> Step 5: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (s *notificationService) SendEmail(to string, subject string, payload map[string]any) error {
     // ...
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `service/customer.go`

    ```go
    package service
    
    // ...
    
    // --> Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á interface
    type CustomerService interface {
     CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error)
    }
    
    // --> Step 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    type customerService struct {
     transactor transactor.Transactor
     custRepo   repository.CustomerRepository // --> step 3: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     notiSvc    NotificationService // --> step 4: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
    }
    
    func NewCustomerService(
     transactor transactor.Transactor,
     custRepo repository.CustomerRepository, // --> step 5: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     notiSvc NotificationService, // --> step 6: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
    ) CustomerService {            // --> Step 7: return ‡πÄ‡∏õ‡πá‡∏ô interface
     return &customerService{     // --> Step 8: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
      transactor: transactor,
      custRepo:   custRepo,
      notiSvc:    notiSvc,
     }
    }
    
    // --> Step 9: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (s *customerService) CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error) {
     // ...
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `service/order.go`

    ```go
    package service
    
    // ...
    
    // --> Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á interface
    type OrderService interface {
     CreateOrder(ctx context.Context, req *dto.CreateOrderRequest) (*dto.CreateOrderResponse, error)
     CancelOrder(ctx context.Context, id int64) error
    }
    
    // --> Step 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    type orderService struct {
     transactor transactor.Transactor
     custRepo   repository.CustomerRepository // --> step 3: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     orderRepo  repository.OrderRepository // --> step 4: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     notiSvc    NotificationService // --> step 5: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
    }
    
    func NewOrderService(
     transactor transactor.Transactor,
     custRepo repository.CustomerRepository, // --> step 6: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     orderRepo repository.OrderRepository, // --> step 7: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     notiSvc NotificationService, // --> step 8: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     ) OrderService {            // --> Step 9: return ‡πÄ‡∏õ‡πá‡∏ô interface
     return &orderService{       // --> Step 10: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
      transactor: transactor,
      custRepo:   custRepo,
      orderRepo:  orderRepo,
      notiSvc:    notiSvc,
     }
    }
    
    // --> Step 11: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (s *orderService) CreateOrder(ctx context.Context, req *dto.CreateOrderRequest) (*dto.CreateOrderResponse, error) {
     // ...
    }
    
    // --> Step 12: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ struct ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å
    func (s *orderService) CancelOrder(ctx context.Context, id int) error {
     // ...
    }
    ```

### Presentation Layer

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö service ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô interface

    ```go
    package handler
    
    // ...
    
    type CustomerHandler struct {
     custService service.CustomerService // <-- Step1: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
    }
    
    func NewCustomerHandler(custService service.CustomerService, // <-- Step2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
     ) *CustomerHandler {
     return &CustomerHandler{
      custService: custService,
     }
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `handler/order.go` ‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö service ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô interface

    ```go
    package handler
    
    // ...
    
    type OrderHandler struct {
     orderSvc service.OrderService // <-- Step1: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
    }
    
    func NewOrderHandler(orderSvc service.OrderService, // <-- Step1: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å pointer ‡πÄ‡∏õ‡πá‡∏ô interface
    ) *OrderHandler {
     return &OrderHandler{orderSvc: orderSvc}
    }
    ```

## ‡πÅ‡∏õ‡∏•‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏õ‡∏™‡∏π‡πà Modular Architecture ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô

‡∏ñ‡∏±‡∏î‡∏°‡∏≤‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏°‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° "layer" (‡πÄ‡∏ä‡πà‡∏ô handler, service, repository) ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° "feature ‡∏´‡∏£‡∏∑‡∏≠ use case‚Äù ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á [Vertical Slice Architecture](https://somprasongd.work/blog/architecture/vertical-slice) ‡∏Ñ‡∏∑‡∏≠

- ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå ‡πÄ‡∏ä‡πà‡∏ô `customer`, `order`, `notification`
- ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏°‡∏µ‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô‡πÄ‡∏≠‡∏á: `handler`, `dto`, `service`, `model`, `repository`, `test`
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ ‡πÅ‡∏¢‡∏Å‡∏≠‡∏¥‡∏™‡∏£‡∏∞, ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏Ç‡πâ‡∏≤‡∏° slice, ‡πÄ‡∏û‡∏¥‡πà‡∏° modularity

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà

```bash
.
‚îú‚îÄ‚îÄ cmd
‚îÇ   ‚îî‚îÄ‚îÄ api
‚îÇ       ‚îî‚îÄ‚îÄ main.go         # bootstraps all modules
‚îú‚îÄ‚îÄ config
‚îÇ   ‚îî‚îÄ‚îÄ config.go
‚îú‚îÄ‚îÄ modules                 
‚îÇ   ‚îú‚îÄ‚îÄ customer
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ module.go       # wiring
‚îÇ   ‚îú‚îÄ‚îÄ notification
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ module.go 
‚îÇ   ‚îî‚îÄ‚îÄ order
‚îÇ       ‚îú‚îÄ‚îÄ handler
‚îÇ       ‚îú‚îÄ‚îÄ dto
‚îÇ       ‚îú‚îÄ‚îÄ model
‚îÇ       ‚îú‚îÄ‚îÄ repository
‚îÇ       ‚îú‚îÄ‚îÄ service
‚îÇ       ‚îî‚îÄ‚îÄ module.go
‚îú‚îÄ‚îÄ application
‚îÇ   ‚îú‚îÄ‚îÄ application.go      # register all modules
‚îÇ   ‚îú‚îÄ‚îÄ http.go             # remove register all routes
‚îÇ   ‚îî‚îÄ‚îÄ middleware
‚îÇ       ‚îú‚îÄ‚îÄ request_logger.go
‚îÇ       ‚îî‚îÄ‚îÄ response_error.go
‚îú‚îÄ‚îÄ migrations
‚îÇ   ‚îî‚îÄ‚îÄ ...sql
‚îú‚îÄ‚îÄ util
‚îÇ   ‚îú‚îÄ‚îÄ module              # new
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ module.go       # module interface
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ go.mod
```

### Notification Module

‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö notification ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/notification`

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `service/notification.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/notification/service/notification.go`

### Customer Module

‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö customer ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer`

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `model/customer.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/model/customer.go`
- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `dto/customer_*.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/dto/customer_*.go`
- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `repository/customer.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/repository/customer.go`

    ```go
    package repository
    
    import (
     "context"
     "database/sql"
     "fmt"
     "go-mma/modules/customer/model" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/util/errs"
     "go-mma/util/storage/sqldb/transactor"
     "time"
    )
    ```

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `service/customer.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/service/customer.go`

    ```go
    package service
    
    import (
     "context"
     "go-mma/modules/customer/dto"        // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/modules/customer/model"      // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/modules/customer/repository" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/util/errs"
     "go-mma/util/logger"
     "go-mma/util/storage/sqldb/transactor"
    
     notiService "go-mma/modules/notification/service" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
    )
    
    // ...
    
    type customerService struct {
     transactor transactor.Transactor
     custRepo   repository.CustomerRepository
     notiSvc    notiService.NotificationService // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
    }
    
    func NewCustomerService(
     transactor transactor.Transactor,
     custRepo repository.CustomerRepository,
     notiSvc notiService.NotificationService, // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
    ) CustomerService {
     // ...
    }
    ```

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `handler/customer.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/handler/customer.go`

    ```go
    package handler
    
    import (
     "go-mma/modules/customer/dto"     // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/modules/customer/service" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/util/errs"
     "strings"
    
     "github.com/gofiber/fiber/v3"
    )
    ```

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `tests/customer.http` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/test/customer.http`

### Order Module

‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö order ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/order`

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `model/order.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/model/order.go`
- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `dto/order*.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/dto/order*.go`
- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `repository/order.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/repository/order.go`

    ```go
    package repository
    
    import (
     "context"
     "database/sql"
     "fmt"
     "go-mma/modules/order/model" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/util/errs"
     "go-mma/util/storage/sqldb/transactor"
     "time"
    )
    ```

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `service/order.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/service/order.go`

    ```go
    package service
    
    import (
     "context"
     "go-mma/modules/order/dto"        // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/modules/order/model"      // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/modules/order/repository" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/util/errs"
     "go-mma/util/logger"
     "go-mma/util/storage/sqldb/transactor"
    
     custRepository "go-mma/modules/customer/repository" // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     notiService "go-mma/modules/notification/service"   // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
    )
    
    // ...
    
    type orderService struct {
     transactor transactor.Transactor
     custRepo   custRepository.CustomerRepository // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     orderRepo  repository.OrderRepository
     notiSvc    notiService.NotificationService   // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
    }
    
    func NewOrderService(
     transactor transactor.Transactor,
     custRepo custRepository.CustomerRepository,   // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     orderRepo repository.OrderRepository,
     notiSvc notiService.NotificationService       // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     ) OrderService {
     // ...
    }
    ```

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `handler/order.go` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/handler/order.go`

    ```go
    package handler
    
    import (
     "go-mma/modules/order/dto"      // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/modules/order/service"  // <-- ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
     "go-mma/util/errs"
     "strconv"
     "strings"
    
     "github.com/gofiber/fiber/v3"
    )
    ```

- ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå `tests/order.http` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `modules/customer/test/order.http`

### Feature-level constructor

‡∏Ñ‡∏∑‡∏≠ ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ *constructor function* ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "feature" ‡∏´‡∏£‡∏∑‡∏≠ "module" ‡∏´‡∏ô‡∏∂‡πà‡∏á ‡πÜ ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö dependencies ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á "feature" ‡∏´‡∏£‡∏∑‡∏≠ "module" ‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á interface ‡∏´‡∏£‡∏∑‡∏≠ struct ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô**

```go
// module/customer/module.go
func NewCustomerModule(mCtx *module.ModuleContext) module.Module {
 repo := repository.NewCustomerRepository(mCtx.DBCtx)
 svc := service.NewCustomerService(repo)
 hdl := handler.NewCustomerHandler(svc)

 return &customerModule{
  handler: hdl,
 }
}
```

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á**

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Module Interface

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/module/module.go`
    >

    ```go
    package module
    
    import (
     "go-mma/util/storage/sqldb/transactor"
    
     "github.com/gofiber/fiber/v3"
    )
    
    type Module interface {
     APIVersion() string
     RegisterRoutes(r fiber.Router)
    }
    
    type ModuleContext struct {
     Transactor transactor.Transactor
     DBCtx      transactor.DBTXContext
    }
    
    func NewModuleContext(transactor transactor.Transactor, dbCtx transactor.DBTXContext) *ModuleContext {
     return &ModuleContext{
      Transactor: transactor,
      DBCtx:      dbCtx,
     }
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Notification Module ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Factory pattern

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `modules/notification/module.go`
    >

    ```go
    package notification
    
    import (
     "go-mma/util/module"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx}
    }
    
    type moduleImp struct {
     mCtx *module.ModuleContext
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ routes
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Customer Module ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Factory pattern ‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ wiring component ‡∏ï‡πà‡∏≤‡∏á ‡πÜ (‡πÄ‡∏ä‡πà‡∏ô repository, service, handler) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö customer ‡∏à‡∏≤‡∏Å `application/http.go` ‡∏°‡∏≤‡πÉ‡∏™‡πà `RegisterRoutes()`

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `modules/customer/module.go`

    ```go
    package customer
    
    import (
     "go-mma/modules/customer/handler"
     "go-mma/modules/customer/repository"
     "go-mma/modules/customer/service"
     "go-mma/util/module"
    
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx}
    }
    
    type moduleImp struct {
     mCtx *module.ModuleContext
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // wiring dependencies
     repo := repository.NewCustomerRepository(m.mCtx.DBCtx)
     svcNoti := notiService.NewNotificationService()
     svc := service.NewCustomerService(m.mCtx.Transactor, repo, svcNoti)
     hdl := handler.NewCustomerHandler(svc)
    
     customers := router.Group("/customers")
     customers.Post("", hdl.CreateCustomer)
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Order Module ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Factory pattern ‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ wiring component ‡∏ï‡πà‡∏≤‡∏á ‡πÜ (‡πÄ‡∏ä‡πà‡∏ô repository, service, handler) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö order ‡∏à‡∏≤‡∏Å `application/http.go` ‡∏°‡∏≤‡πÉ‡∏™‡πà `RegisterRoutes()`

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `modules/order/module.go`

    ```go
    package order
    
    import (
     "go-mma/modules/order/handler"
     "go-mma/modules/order/repository"
     "go-mma/modules/order/service"
     "go-mma/util/module"
    
     custRepository "go-mma/modules/customer/repository"
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx}
    }
    
    type moduleImp struct {
     mCtx *module.ModuleContext
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // wiring dependencies
     repoCust := custRepository.NewCustomerRepository(m.mCtx.DBCtx)
     repoOrder := repository.NewOrderRepository(m.mCtx.DBCtx)
     svcNoti := notiService.NewNotificationService()
     svc := service.NewOrderService(m.mCtx.Transactor, repoCust, repoOrder, svcNoti)
     hdl := handler.NewOrderHandler(svc)
    
     orders := router.Group("/orders")
     orders.Post("", hdl.CreateOrder)
     orders.Delete("/:orderID", hdl.CancelOrder)
    }
    ```

- ‡∏•‡∏ö `RegisterRoutes()` ‡πÉ‡∏ô `application/http.go` ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ

    ```go
    type HTTPServer interface {
     Start()
     Shutdown() error
     Group(prefix string) fiber.Router  // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    }
    
    // ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á base url router ‡πÄ‡∏ä‡πà‡∏ô /api/v1
    func (s *httpServer) Group(prefix string) fiber.Router {
     return s.app.Group(prefix)
    }
    ```

- ‡∏•‡∏ö `RegisterRoutes()` ‡πÉ‡∏ô `application/application.go` ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° `RegisterModules()` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÅ‡∏ó‡∏ô

    ```go
    func (app *Application) RegisterModules(modules ...module.Module) error {
     for _, m := range modules {
      app.registerModuleRoutes(m)
     }
    
     return nil
    }
    
    // ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏≤‡∏° single-responsibility principle (SRP)
    func (app *Application) registerModuleRoutes(m module.Module) {
     prefix := app.buildGroupPrefix(m)
     group := app.httpServer.Group(prefix)
     m.RegisterRoutes(group)
    }
    
    func (app *Application) buildGroupPrefix(m module.Module) string {
     apiBase := "/api"
     version := m.APIVersion()
     if version != "" {
      return fmt.Sprintf("%s/%s", apiBase, version)
     }
     return apiBase
    }
    ```

- ‡∏•‡∏ö `app.RegisterRoutes()` ‡πÉ‡∏ô `cmd/api/main.go` ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•

    ```go
    package main
    
    import (
     "fmt"
     "go-mma/application"
     "go-mma/config"
     "go-mma/data/sqldb"
     "go-mma/modules/customer"
     "go-mma/modules/notification"
     "go-mma/modules/order"
     "go-mma/util/logger"
     "go-mma/util/module"
     "go-mma/util/transactor"
     "os"
     "os/signal"
     "syscall"
    )
    
    func main() {
     // log
     // config
     // db
    
     app := application.New(*config, dbCtx)
    
     transactor, dbtxCtx := transactor.New(dbCtx.DB())
     mCtx := module.NewModuleContext(transactor, dbtxCtx)
     app.RegisterModules(
      notification.NewModule(mCtx),
      customer.NewModule(mCtx),
      order.NewModule(mCtx),
     )
    
     app.Run()
    
     // ...
    }
    ```

## ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á Subdomain

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£ **‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ subdomain** (‡πÄ‡∏ä‡πà‡∏ô `Customer`, `Order`, `Notification`) ‡πÑ‡∏ß‡πâ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á **‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (Facade)**

**Facade** ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô "‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤" ‡πÉ‡∏´‡πâ module ‡∏≠‡∏∑‡πà‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô subdomain ‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏°‡∏µ‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏á

### ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏ô?

- ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ **‡πÅ‡∏ï‡πà‡∏•‡∏∞ module ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô** (Bounded Context)
- ‡∏•‡∏î‡∏Å‡∏≤‡∏£ **‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏ã‡∏∂‡πà‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á** ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á module
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á subdomain ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞ **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô**

<aside>
üí°

**‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡πâ‡∏ô ‡πÜ:** **Facade = ‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß** ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ module ‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å functionality ‡∏Ç‡∏≠‡∏á subdomain ‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢ **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô**

</aside>

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

‡∏Å‡πà‡∏≠‡∏ô: ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á

```
Order Handler
     ‚îÇ
     ‚ñº
Order Service
     ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Order Repository
     ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Customer Repository
```

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

```go
// OrderService ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å CustomerRepository ‡∏ï‡∏£‡∏á ‡πÜ
customer, err := customerRepo.FindByID(ctx, order.CustomerID)
if customer.Credit < order.Total {
    return errors.New("insufficient credit")
}
```

- `Order Service` ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏±‡πâ‡∏á `OrderRepo` ‡πÅ‡∏•‡∏∞ `CustomerRepo` ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á

‡∏´‡∏•‡∏±‡∏á: ‡πÉ‡∏ä‡πâ Encapsulation

```
Order Handler
     ‚îÇ
     ‚ñº
Order Service
     ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Order Repository
     ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Customer Service
                             ‚îÇ
                             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Customer Repository

```

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

```go
// OrderService ‡πÉ‡∏ä‡πâ CustomerFacade ‡πÅ‡∏ó‡∏ô
ok, err := customerService.HasSufficientCredit(ctx, order.CustomerID, order.Total)
if !ok {
    return errors.New("insufficient credit")
}
```

- `CustomerService`  ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢ logic ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô subdomain customer
- ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô facade ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ repository, validation, business rule ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏≠‡∏á

### ‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Ç‡∏≠‡∏á Customer

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô OrderService ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `model` ‡πÅ‡∏•‡∏∞ `repository` ‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏• customer ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏ó‡∏≥‡πÑ‡∏î‡πâ ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ customer ‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏à‡∏≤‡∏Å CustomerService ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å id

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `module/customer/dto/customer_info.go`
    >

    ```go
    package dto
    
    type CustomerInfo struct {
     ID     int64  `json:"id"`
     Email  string `json:"email"`
     Credit int    `json:"credit"`
    }
    
    func NewCustomerInfo(id int64, email string, credit int) *CustomerInfo {
     return &CustomerInfo{ID: id, Email: email, Credit: credit}
    }
    ```

- ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å id

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `module/customer/service/customer.go`
    >

    ```go
    var (
     ErrEmailExists      = errs.ConflictError("email already exists")
     ErrCustomerNotFound = errs.ResourceNotFoundError("the customer with given id was not found") // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    )
    
    type CustomerService interface {
     CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error)
     GetCustomerByID(ctx context.Context, id int64) (*dto.CustomerInfo, error) // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    }
    
    // ...
    
    // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    func (s *customerService) GetCustomerByID(ctx context.Context, id int64) (*dto.CustomerInfo, error) {
     customer, err := s.custRepo.FindByID(ctx, id)
     if err != nil {
      // error logging
      logger.Log.Error(err.Error())
      return nil, err
     }
    
     if customer == nil {
      return nil, ErrCustomerNotFound
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á DTO Response
     return dto.NewCustomerInfo(
      customer.ID, 
      customer.Email, 
      customer.Credit), nil
    }
    ```

- ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `module/customer/service/customer.go`
    >

    ```go
    var (
     ErrEmailExists                  = errs.ConflictError("email already exists")
     ErrCustomerNotFound             = errs.ResourceNotFoundError("the customer with given id was not found")
     ErrOrderTotalExceedsCreditLimit = errs.BusinessRuleError("order total exceeds credit limit") // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    )
    
    type CustomerService interface {
     // ...
     // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     ReserveCredit(ctx context.Context, id int64, amount int) error
     ReleaseCredit(ctx context.Context, id int64, amount int) error
    }
    
    // ...
    
    // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    func (s *customerService) ReserveCredit(ctx context.Context, id int64, amount int) error {
     err := s.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
      customer, err := s.custRepo.FindByID(ctx, id)
      if err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      if customer == nil {
       return ErrCustomerNotFound
      }
    
      if err := customer.ReserveCredit(amount); err != nil {
       return ErrOrderTotalExceedsCreditLimit
      }
    
      if err := s.custRepo.UpdateCredit(ctx, customer); err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      return nil
     })
     return err
    }
    
    func (s *customerService) ReleaseCredit(ctx context.Context, id int64, amount int) error {
     err := s.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
      customer, err := s.custRepo.FindByID(ctx, id)
      if err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      if customer == nil {
       return ErrCustomerNotFound
      }
    
      customer.ReleaseCredit(amount)
    
      if err := s.custRepo.UpdateCredit(ctx, customer); err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      return nil
     })
    
     return err
    }
    ```

### ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ CustomerService ‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏• Order

- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ `OrderService` ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô `CustomerService` ‡πÅ‡∏ó‡∏ô `CustomerRepository`

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `module/order/service/order.go`
    >

    ```go
    package service
    
    import (
     "context"
     "go-mma/modules/order/dto"
     "go-mma/modules/order/model"
     "go-mma/modules/order/repository"
     "go-mma/util/errs"
     "go-mma/util/logger"
     "go-mma/util/transactor"
    
     custService "go-mma/modules/customer/service" // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     notiService "go-mma/modules/notification/service"
    )
    
    var (
     ErrNoOrderID = errs.ResourceNotFoundError("the order with given id was not found") // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    )
    
    // ...
    
    type orderService struct {
     transactor transactor.Transactor
     custSvc    custService.CustomerService // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     orderRepo  repository.OrderRepository
     notiSvc    notiService.NotificationService
    }
    
    func NewOrderService(
     transactor transactor.Transactor,
     custSvc custService.CustomerService, // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     orderRepo repository.OrderRepository,
     notiSvc notiService.NotificationService) OrderService {
     // ...
    }
    
    func (s *orderService) CreateOrder(ctx context.Context, req *dto.CreateOrderRequest) (*dto.CreateOrderResponse, error) {
     // Business Logic Rule: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     customer, err := s.custSvc.GetCustomerByID(ctx, req.CustomerID)
     if err != nil {
      return nil, err
     }
     // ...
     // ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô WithinTransaction
     var order *model.Order
     err = s.transactor.WithinTransaction(ctx, func(ctx context.Context) error {
    
      // ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á customer
      // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      if err := s.custSvc.ReserveCredit(ctx, customer.ID, req.OrderTotal); err != nil { 
       return err
      }
    
      // ...
     })
    
     // ...
    }
    
    func (s *orderService) CancelOrder(ctx context.Context, id int64) error {
     // Business Logic Rule: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö order id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     order, err := s.orderRepo.FindByID(ctx, id)
     if err != nil {
      logger.Log.Error(err.Error())
      return err
     }
    
     if order == nil {
      return ErrNoOrderID
     }
    
     err = s.transactor.WithinTransaction(ctx, func(ctx context.Context) error {
    
      // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å order
      if err := s.orderRepo.Cancel(ctx, order.ID); err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      // Business Logic: ‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit
      // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      err = s.custSvc.ReleaseCredit(ctx, order.CustomerID, order.OrderTotal)
      if err != nil {
       return err
      }
    
      return nil
     })
    
     return err
    }
    ```

- ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏ô `RegisterRoutes` ‡∏™‡πà‡∏á `CustomerService` ‡πÑ‡∏õ‡πÅ‡∏ó‡∏ô `CustomerRepository`

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `module/order/module.go`
    >

    ```go
    package order
    
    import (
     "go-mma/modules/order/handler"
     "go-mma/modules/order/repository"
     "go-mma/modules/order/service"
     "go-mma/util/module"
    
     custRepository "go-mma/modules/customer/repository"
     custService "go-mma/modules/customer/service" // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    // ...
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // wiring dependencies
     svcNoti := notiService.NewNotificationService()
    
     repoCust := custRepository.NewCustomerRepository(m.mCtx.DBCtx)
     svcCust := custService.NewCustomerService(m.mCtx.Transactor, repoCust, svcNoti) // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    
     repoOrder := repository.NewOrderRepository(m.mCtx.DBCtx)
    
      // ‡∏™‡πà‡∏á svcCust ‡πÅ‡∏ó‡∏ô repoCust
     svc := service.NewOrderService(m.mCtx.Transactor, svcCust, repoOrder, svcNoti)
     hdl := handler.NewOrderHandler(svc)
    
     orders := router.Group("/orders")
     orders.Post("", hdl.CreateOrder)
     orders.Delete("/:orderID", hdl.CancelOrder)
    }
    
    ```

### Nested Transactions

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö error ‡∏ß‡πà‡∏≤

```go
HTTP/1.1 500 Internal Server Error
Date: Fri, 06 Jun 2025 03:50:32 GMT
Content-Type: application/json
Content-Length: 106
X-Request-Id: 771c27c3-7528-4b93-bc6d-e1696c4727ae
Connection: close

{
  "type": "operation_failed",
  "message": "failed to begin transaction: nested transactions are not supported"
}
```

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit ‡πÉ‡∏ô `CustomerService` ‡∏ô‡∏±‡πâ‡∏ô ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô transaction ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà ‡∏ã‡∏∂‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô transaction ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å `OrderService`

‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á `transactor` ‡πÉ‡∏ô `main.go` ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô nested transactions

```go
// src/app/cmd/api/main.go

func main() {
 // ...

 app := application.New(*config)

 transactor, dbCtx := transactor.New(
  db.DB(),
  // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô nested transaction strategy ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ Savepoints
  transactor.WithNestedTransactionStrategy(transactor.NestedTransactionsSavepoints))
 mCtx := module.NewModuleContext(transactor, dbCtx)
 
 // ...
}
```

## ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Service ‡πÉ‡∏ô Monolith ‡∏î‡πâ‡∏ß‡∏¢ Service Registry

‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÄ‡∏£‡∏≤‡∏°‡∏±‡∏Å‡∏à‡∏∞ **‡∏™‡∏£‡πâ‡∏≤‡∏á service ‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥ ‡πÜ** ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏• ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏£‡πâ‡∏≤‡∏á `NotificationService` ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏ó‡∏±‡πâ‡∏á `Customer` ‡πÅ‡∏•‡∏∞ `Order` ‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î **Service Registry** ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡∏Ñ‡∏•‡∏±‡∏á‡πÄ‡∏Å‡πá‡∏ö service‚Äù ‡πÑ‡∏ß‡πâ‡∏£‡∏ß‡∏° service ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

### **‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Service Registry**

- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á service ‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡∏µ‡πà
- ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ inject dependency
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ service ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Service Registry

Service Registry ‡∏Ñ‡∏∑‡∏≠ struct ‡∏´‡∏£‡∏∑‡∏≠ container ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà **‡πÄ‡∏Å‡πá‡∏ö instance ‡∏Ç‡∏≠‡∏á service ‡∏ï‡πà‡∏≤‡∏á ‡πÜ** ‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á new ‡∏ã‡πâ‡∏≥

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Service Registry

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/registry/service_registry.go`
    >

    ```go
    package registry
    
    import "fmt"
    
    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î key ‡∏Ç‡∏≠‡∏á service ‡∏ó‡∏µ‡πà‡∏à‡∏∞ export
    type ServiceKey string
    
    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö map key ‡∏Å‡∏±‡∏ö service ‡∏ó‡∏µ‡πà‡∏à‡∏∞ export
    type ProvidedService struct {
     Key   ServiceKey
     Value any
    }
    
    type ServiceRegistry interface {
     Register(key ServiceKey, svc any)
     Resolve(key ServiceKey) (any, error)
    }
    
    type serviceRegistry struct {
     services map[ServiceKey]any
    }
    
    func NewServiceRegistry() ServiceRegistry {
     return &serviceRegistry{
      services: make(map[ServiceKey]any),
     }
    }
    
    func (r *serviceRegistry) Register(key ServiceKey, svc any) {
     r.services[key] = svc
    }
    
    func (r *serviceRegistry) Resolve(key ServiceKey) (any, error) {
     svc, ok := r.services[key]
     if !ok {
      return nil, fmt.Errorf("service not found: %s", key)
     }
     return svc, nil
    }
    
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏õ‡∏•‡∏á Service ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `util/registry/helper.go`
    >

    ```go
    package registry
    
    import "fmt"
    
    func ResolveAs[T any](r ServiceRegistry, key ServiceKey) (T, error) {
     var zero T
     svc, err := r.Resolve(key)
     if err != nil {
      return zero, err
     }
     typedSvc, ok := svc.(T)
     if !ok {
      return zero, fmt.Errorf("service registered under key %s does not implement the expected type", key)
     }
     return typedSvc, nil
    }
    ```

### ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Module Interface

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ Module ‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡πÄ‡∏û‡∏¥‡πà‡∏° service ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Registry

> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `util/module/module.go`
>

```go
package module

import (
 "go-mma/util/registry"    // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
 "go-mma/util/transactor"

 "github.com/gofiber/fiber/v3"
)

type Module interface {
 APIVersion() string
 Init(reg registry.ServiceRegistry) error // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
 RegisterRoutes(r fiber.Router)
}

// <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
// ‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ß‡πà‡∏≤ ‡∏ö‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á export service
type ServiceProvider interface {
 Services() []registry.ProvidedService
}
```

### ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Application

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Application ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö service registry

> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `application/application.go`
>

```go
package application

import (
 "fmt"
 "go-mma/config"
 "go-mma/data/sqldb"
 "go-mma/util/logger"
 "go-mma/util/module"
 "go-mma/util/registry"  // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
)

type Application struct {
 config          config.Config
 httpServer      HTTPServer
 serviceRegistry registry.ServiceRegistry // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
}

func New(config config.Config, db sqldb.DBContext) *Application {
 return &Application{
  config:          config,
  httpServer:      newHTTPServer(config),
  serviceRegistry: registry.NewServiceRegistry(), // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
 }
}

// ...

func (app *Application) RegisterModules(modules ...module.Module) error {
 for _, m := range modules {
  // Initialize each module
  if err := app.initModule(m); err != nil {
   return fmt.Errorf("failed to init module [%T]: %w", m, err)
  }

  // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô ServiceProvider ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤ service ‡∏°‡∏≤‡∏•‡∏á registry
  if sp, ok := m.(module.ServiceProvider); ok {
   for _, p := range sp.Services() {
    app.serviceRegistry.Register(p.Key, p.Value)
   }
  }

  // Register routes for each module
  app.registerModuleRoutes(m)
 }

 return nil
}

func (app *Application) initModule(m module.Module) error {
 return m.Init(app.serviceRegistry)
}

// ...
```

### ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ Initialize ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•

‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏° `Init()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á service ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `modules/notification/module.go`

    ```go
    package notification
    
    import (
     "go-mma/modules/notification/service"
     "go-mma/util/module"
     "go-mma/util/registry"
    
     "github.com/gofiber/fiber/v3"
    )
    
    const (
     NotificationServiceKey registry.ServiceKey = "NotificationService"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx: mCtx}
    }
    
    type moduleImp struct {
     mCtx    *module.ModuleContext
     notiSvc service.NotificationService
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) Init(reg registry.ServiceRegistry) error {
     m.notiSvc = service.NewNotificationService()
    
     return nil
    }
    
    func (m *moduleImp) Services() []registry.ProvidedService {
     return []registry.ProvidedService{
      {Key: NotificationServiceKey, Value: m.notiSvc},
     }
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ routes
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `modules/customer/module.go`

    ```go
    package customer
    
    import (
     "go-mma/modules/customer/handler"
     "go-mma/modules/customer/repository"
     "go-mma/modules/customer/service"
     "go-mma/util/module"
     "go-mma/util/registry"
    
     notiModule "go-mma/modules/notification"
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    const (
     CustomerServiceKey registry.ServiceKey = "CustomerService"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx: mCtx}
    }
    
    type moduleImp struct {
     mCtx    *module.ModuleContext
     custSvc service.CustomerService
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) Init(reg registry.ServiceRegistry) error {
     // Resolve NotificationService from the registry
     notiSvc, err := registry.ResolveAs[notiService.NotificationService](reg, notiModule.NotificationServiceKey)
     if err != nil {
      return err
     }
    
     repo := repository.NewCustomerRepository(m.mCtx.DBCtx)
     m.custSvc = service.NewCustomerService(m.mCtx.Transactor, repo, notiSvc)
    
     return nil
    }
    
    func (m *moduleImp) Services() []registry.ProvidedService {
     return []registry.ProvidedService{
      {Key: CustomerServiceKey, Value: m.custSvc},
     }
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // wiring dependencies
     hdl := handler.NewCustomerHandler(m.custSvc)
    
     customers := router.Group("/customers")
     customers.Post("", hdl.CreateCustomer)
    }
    ```

    <aside>
    üí°

    ‡∏ó‡∏≥‡πÑ‡∏°‡∏ñ‡∏∂‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á handler ‡πÉ‡∏ô `RegisterRoutes`

  - ‡πÅ‡∏¢‡∏Å concern ‡∏ä‡∏±‡∏î: `RegisterRoutes` ‡∏î‡∏π‡πÅ‡∏• ‚Äútransport layer‚Äù ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
  - ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢: ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞ handler ‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  - ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß: ‡πÑ‡∏°‡πà‡∏°‡∏µ state ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô `moduleImp`
    </aside>

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `modules/order/module.go`

    ```go
    package order
    
    import (
     "go-mma/modules/order/handler"
     "go-mma/modules/order/repository"
     "go-mma/modules/order/service"
     "go-mma/util/module"
     "go-mma/util/registry"
    
     custModule "go-mma/modules/customer"
     custService "go-mma/modules/customer/service"
     notiModule "go-mma/modules/notification"
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx: mCtx}
    }
    
    type moduleImp struct {
     mCtx     *module.ModuleContext
     orderSvc service.OrderService
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) Init(reg registry.ServiceRegistry) error {
     // Resolve CustomerService from the registry
     custSvc, err := registry.ResolveAs[custService.CustomerService](reg, custModule.CustomerServiceKey)
     if err != nil {
      return err
     }
    
     // Resolve NotificationService from the registry
     notiSvc, err := registry.ResolveAs[notiService.NotificationService](reg, notiModule.NotificationServiceKey)
     if err != nil {
      return err
     }
    
     repo := repository.NewOrderRepository(m.mCtx.DBCtx)
     m.orderSvc = service.NewOrderService(m.mCtx.Transactor, custSvc, repo, notiSvc)
    
     return nil
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     // wiring dependencies
     hdl := handler.NewOrderHandler(m.orderSvc)
    
     orders := router.Group("/orders")
     orders.Post("", hdl.CreateOrder)
     orders.Delete("/:orderID", hdl.CancelOrder)
    }
    ```

## ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `internal`

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤ ‡πÅ‡∏¢‡∏Å‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ sub-domain (Encapsulation) ‡πÅ‡∏•‡πâ‡∏ß ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏∑‡∏≠ ‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏• order ‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ `import` `model` ‡∏´‡∏£‡∏∑‡∏≠ `repository` ‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏• customer ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏ô‡∏±‡πà‡∏ô‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï (boundary) ‡∏Ç‡∏≠‡∏á‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤ (coupling) ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏û‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤ Go ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà ‚Äú‡∏´‡πâ‡∏≤‡∏°‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‚Äù ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå **`internal`** ‡πÑ‡∏î‡πâ ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏≠‡∏°‡πÑ‡∏û‡πÄ‡∏•‡∏≠‡∏£‡πå‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ path ‡∏ô‡∏≠‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏°‡πà (root) ‡∏Ç‡∏≠‡∏á `internal` ‡∏ó‡∏≥ `import` ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢

```go
customer/
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ model/        // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞ customer
‚îÇ   ‚îî‚îÄ‚îÄ repository/   // DB logic ‡∏Ç‡∏≠‡∏á customer
‚îî‚îÄ‚îÄ service/          // business logic (export)
```

‡∏ñ‡πâ‡∏≤‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô ‡πÄ‡∏ä‡πà‡∏ô `order` ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° `import "go-mma/modules/customer/internal/repository"` ‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

```go
could not import go-mma/modules/customer/internal/repository (invalid use of internal package "go-mma/modules/customer/internal/repository")
```

## ‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Mono-Repository ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï ‡πÄ‡∏£‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏¢‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏ä‡πà‡∏ô `customer`, `order`, ‡πÅ‡∏•‡∏∞ `notification` ‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô **‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏¢‡πà‡∏≠‡∏¢ (submodule)** ‡πÇ‡∏î‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏à‡∏∞‡∏°‡∏µ `go.mod` ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á

‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Git repository ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ **Mono-Repository**

**‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÅ‡∏ö‡πà‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏™‡πà‡∏ß‡∏ô ‡∏´‡∏•‡∏±‡∏Å‡πÜ ‡∏Ñ‡∏∑‡∏≠**

- **app:** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡∏î‡∏π‡∏• ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°
- **modules:** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ï‡πà‡∏≤‡∏á‡πÜ
- **shared:** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà

```bash
.
‚îú‚îÄ‚îÄ docker-compose.dev.yml
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ go-mma.code-workspace
‚îú‚îÄ‚îÄ Makefile
‚îú‚îÄ‚îÄ migrations
‚îÇ   ‚îú‚îÄ‚îÄ 20250529103238_create_customer.down.sql
‚îÇ   ‚îú‚îÄ‚îÄ 20250529103238_create_customer.up.sql
‚îÇ   ‚îú‚îÄ‚îÄ 20250529103715_create_order.down.sql
‚îÇ   ‚îî‚îÄ‚îÄ 20250529103715_create_order.up.sql
‚îî‚îÄ‚îÄ src
    ‚îú‚îÄ‚îÄ app
    ‚îÇ   ‚îú‚îÄ‚îÄ application
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ application.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ http.go
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middleware.go
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ request_logger.go
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ response_error.go
    ‚îÇ   ‚îú‚îÄ‚îÄ cmd
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api
    ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ main.go
    ‚îÇ   ‚îú‚îÄ‚îÄ config
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.go
    ‚îÇ   ‚îú‚îÄ‚îÄ go.mod
    ‚îÇ   ‚îú‚îÄ‚îÄ go.sum
    ‚îÇ   ‚îî‚îÄ‚îÄ util
    ‚îÇ       ‚îî‚îÄ‚îÄ env
    ‚îÇ           ‚îî‚îÄ‚îÄ env.go
    ‚îú‚îÄ‚îÄ modules
    ‚îÇ   ‚îú‚îÄ‚îÄ customers
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dtos
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customer_request.go
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customer_response.go
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ internal
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repository
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ customer.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ module.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ customer.http
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ go.mod
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ go.sum
    ‚îÇ   ‚îú‚îÄ‚îÄ notifications
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ module.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notification.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ go.mod
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ go.sum
    ‚îÇ   ‚îî‚îÄ‚îÄ orders
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dtos
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ order_request.go
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ order_response.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ order.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ internal
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ order.go
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repository
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ order.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ module.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ order.go
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ order.http
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ go.mod
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ go.sum
    ‚îî‚îÄ‚îÄ shared
        ‚îî‚îÄ‚îÄcommon
            ‚îú‚îÄ‚îÄ errs
            ‚îÇ   ‚îú‚îÄ‚îÄ errs.go
            ‚îÇ   ‚îú‚îÄ‚îÄ helper.go
            ‚îÇ   ‚îî‚îÄ‚îÄ types.go
            ‚îú‚îÄ‚îÄ logger
            ‚îÇ   ‚îî‚îÄ‚îÄ logger.go
            ‚îú‚îÄ‚îÄ module
            ‚îÇ   ‚îî‚îÄ‚îÄ module.go
            ‚îú‚îÄ‚îÄ registry
            ‚îÇ   ‚îú‚îÄ‚îÄ helper.go
            ‚îÇ   ‚îî‚îÄ‚îÄ service_registry.go
            ‚îú‚îÄ‚îÄ storage
            ‚îÇ   ‚îî‚îÄ‚îÄ db
            ‚îÇ       ‚îú‚îÄ‚îÄ db.go
            ‚îÇ       ‚îî‚îÄ‚îÄ transactor
            ‚îÇ           ‚îú‚îÄ‚îÄ nested_transactions_none.go
            ‚îÇ           ‚îú‚îÄ‚îÄ nested_transactions_savepoints.go
            ‚îÇ           ‚îú‚îÄ‚îÄ transactor.go
            ‚îÇ           ‚îî‚îÄ‚îÄ types.go
            ‚îú‚îÄ‚îÄ go.mod
            ‚îî‚îÄ‚îÄ go.sum
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ**

- **‡πÅ‡∏¢‡∏Å‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô**: ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö‡∏≠‡∏¥‡∏™‡∏£‡∏∞
- **‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢**: ‡πÉ‡∏ä‡πâ `go.mod` ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ dependency ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•
- **‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£**: ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ Git ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô repo ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏¢‡∏Å‡∏´‡∏•‡∏≤‡∏¢ repo
- **‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô microservice ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï**: ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å deploy ‡πÑ‡∏î‡πâ‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

### ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Folder ‡πÉ‡∏´‡∏°‡πà ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

    ```bash
    # ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà root project
    mkdir -p src/app
    mkdir -p src/modules/customer
    mkdir -p src/modules/notification
    mkdir -p src/modules/order
    mkdir -p src/shared/common
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á app ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

    ```bash
    # ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà root project
    cd src/app
    go mod init go-mma
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á customer ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

    ```bash
    cd ../..
    # ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà root project
    cd src/modules/customer
    go mod init go-mma/modules/customer
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á notification ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

    ```bash
    cd ../../..
    # ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà root project
    cd src/modules/notification
    go mod init go-mma/modules/notification
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á order ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

    ```bash
    cd ../../..
    # ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà root project
    cd src/modules/order
    go mod init go-mma/modules/order
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á common ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ

    ```bash
    cd ../../..
    # ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà root project
    cd src/shared/common
    go mod init go-mma/shared/common
    ```

### ‡∏ó‡∏≥ L**ocal module replacement**

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏ö‡∏ö Monorepo ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πâ‡∏≤‡∏á‡∏ñ‡∏∂‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á publish ‡πÑ‡∏õ‡∏ó‡∏µ‡πà remote repo ‡πÉ‡∏ô Go ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `replace` ‡πÉ‡∏ô `go.mod`

- ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå notification ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô common

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `notification/go.mod`
    >

    ```bash
    module go-mma/modules/notification
    
    go 1.24.1
    
    replace go-mma/shared/common v0.0.0 => ../../shared/common
    ```

- ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå customer ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô common, notification

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `customer/go.mod`
    >

    ```bash
    module go-mma/modules/customer
    
    go 1.24.1
    
    replace go-mma/shared/common v0.0.0 => ../../shared/common
    
    replace go-mma/modules/notification v0.0.0 => ../../modules/notification
    ```

- ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå order ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô common, notification, customer

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `order/go.mod`
    >

    ```bash
    module go-mma/modules/order
    
    go 1.24.1
    
    replace go-mma/shared/common v0.0.0 => ../../shared/common
    
    replace go-mma/modules/notification v0.0.0 => ../../modules/notification
    
    replace go-mma/modules/customer v0.0.0 => ../../modules/customer
    ```

- ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå app ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô common, notification, customer, order

    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `app/go.mod`

    ```bash
    module go-mma
    
    go 1.24.1
    
    replace go-mma/shared/common v0.0.0 => ../shared/common
    
    replace go-mma/modules/notification v0.0.0 => ../modules/notification
    
    replace go-mma/modules/customer v0.0.0 => ../modules/customer
    
    replace go-mma/modules/order v0.0.0 => ../modules/order
    ```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á VS Code Workspace

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Mono-Repo ‡πÉ‡∏ô VS Code ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö Workspace ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `go-mma.code-workspace`

    ```bash
    {
     "folders": [
      {
       "path": "."
      },
      {
       "path": "src/app"
      },
      {
       "path": "src/modules/customer"
      },
      {
       "path": "src/modules/order"
      },
      {
       "path": "src/modules/notification"
      },
      {
       "path": "src/shared/common"
      }
     ],
     "settings": {}
    }
    ```

- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π File ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Open Workspace from file‚Ä¶
- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå `go-mma.code-workspace`
- ‡∏Å‡∏î Open
- ‡πÉ‡∏ô Explorer ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

    ```bash
    go-mma
    app
    customer
    order
    notification
    common
    ```

### ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå common

- ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô `util` ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô `env` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå `common`

    ```bash
    common
    ‚îú‚îÄ‚îÄ go.mod
    ‚îú‚îÄ‚îÄ errs
    ‚îÇ   ‚îú‚îÄ‚îÄ errs.go
    ‚îÇ   ‚îú‚îÄ‚îÄ helpers.go
    ‚îÇ   ‚îî‚îÄ‚îÄ types.go
    ‚îú‚îÄ‚îÄ idgen
    ‚îÇ   ‚îî‚îÄ‚îÄ idgen.go
    ‚îú‚îÄ‚îÄ logger
    ‚îÇ   ‚îî‚îÄ‚îÄ logger.go
    ‚îú‚îÄ‚îÄ module
    ‚îÇ   ‚îî‚îÄ‚îÄ module.go
    ‚îú‚îÄ‚îÄ registry
    ‚îÇ   ‚îú‚îÄ‚îÄ helper.go
    ‚îÇ   ‚îî‚îÄ‚îÄ service_registry.go
    ‚îî‚îÄ‚îÄ storage
        ‚îî‚îÄ‚îÄ sqldb
            ‚îú‚îÄ‚îÄ sqldb.go
            ‚îî‚îÄ‚îÄ transactor
                ‚îú‚îÄ‚îÄ nested_transactions_none.go
                ‚îú‚îÄ‚îÄ nested_transactions_savepoints.go
                ‚îú‚îÄ‚îÄ transactor.go
                ‚îî‚îÄ‚îÄ types.go
    ```

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy`

### ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå notification

- ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô `modules/notification` ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î  ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå `notification`

    ```bash
    notification
    ‚îú‚îÄ‚îÄ go.mod
    ‚îú‚îÄ‚îÄ go.sum
    ‚îú‚îÄ‚îÄ module.go
    ‚îî‚îÄ‚îÄ service
        ‚îî‚îÄ‚îÄ notification.go
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç path ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ `import` ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
  - `go-mma/util/logger` ‚Üí `go-mma/shared/common/logger`
- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy`

### ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå customer

- ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô `modules/customer` ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î  ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå `customer`

    ```bash
    customer
    ‚îú‚îÄ‚îÄ dto
    ‚îÇ   ‚îú‚îÄ‚îÄ customer_request.go
    ‚îÇ   ‚îú‚îÄ‚îÄ customer_response.go
    ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
    ‚îú‚îÄ‚îÄ go.mod
    ‚îú‚îÄ‚îÄ go.sum
    ‚îú‚îÄ‚îÄ handler
    ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
    ‚îú‚îÄ‚îÄ internal
    ‚îÇ   ‚îú‚îÄ‚îÄ model
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
    ‚îÇ   ‚îî‚îÄ‚îÄ repository
    ‚îÇ       ‚îî‚îÄ‚îÄ customer.go
    ‚îú‚îÄ‚îÄ module.go
    ‚îú‚îÄ‚îÄ service
    ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
    ‚îî‚îÄ‚îÄ test
        ‚îî‚îÄ‚îÄ customers.http
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç path ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ `import` ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
  - `go-mma/util/errs` ‚Üí `go-mma/shared/common/errs`
  - `go-mma/util/logger` ‚Üí `go-mma/shared/common/logger`
  - `go-mma/util/module` ‚Üí `go-mma/shared/common/module`
  - `go-mma/util/registry` ‚Üí `go-mma/shared/common/registry`
  - `go-mma/util/storage/sqldb/transactor` ‚Üí `go-mma/shared/common/storage/sqldb/transactor`
- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy`

### ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå order

- ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô `modules/order` ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î  ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå `order`

    ```bash
    order
    ‚îú‚îÄ‚îÄ dto
    ‚îÇ   ‚îú‚îÄ‚îÄ customer_request.go
    ‚îÇ   ‚îú‚îÄ‚îÄ customer_response.go
    ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
    ‚îú‚îÄ‚îÄ go.mod
    ‚îú‚îÄ‚îÄ go.sum
    ‚îú‚îÄ‚îÄ handler
    ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
    ‚îú‚îÄ‚îÄ internal
    ‚îÇ   ‚îú‚îÄ‚îÄ model
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
    ‚îÇ   ‚îî‚îÄ‚îÄ repository
    ‚îÇ       ‚îî‚îÄ‚îÄ customer.go
    ‚îú‚îÄ‚îÄ module.go
    ‚îú‚îÄ‚îÄ service
    ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
    ‚îî‚îÄ‚îÄ test
        ‚îî‚îÄ‚îÄ customers.http
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç path ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ `import` ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
  - `go-mma/util/errs` ‚Üí `go-mma/shared/common/errs`
  - `go-mma/util/logger` ‚Üí `go-mma/shared/common/logger`
  - `go-mma/util/module` ‚Üí `go-mma/shared/common/module`
  - `go-mma/util/registry` ‚Üí `go-mma/shared/common/registry`
  - `go-mma/util/storage/sqldb/transactor` ‚Üí `go-mma/shared/common/storage/sqldb/transactor`
- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy`

### ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå app

- ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô `application`, `cmd`, `config` ‡πÅ‡∏•‡∏∞ `util`   ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå `app`

    ```bash
    app
    ‚îú‚îÄ‚îÄ application
    ‚îÇ   ‚îú‚îÄ‚îÄ application.go
    ‚îÇ   ‚îú‚îÄ‚îÄ http.go
    ‚îÇ   ‚îî‚îÄ‚îÄ middleware
    ‚îÇ       ‚îú‚îÄ‚îÄ request_logger.go
    ‚îÇ       ‚îî‚îÄ‚îÄ response_error.go
    ‚îú‚îÄ‚îÄ cmd
    ‚îÇ   ‚îî‚îÄ‚îÄ api
    ‚îÇ       ‚îî‚îÄ‚îÄ main.go
    ‚îú‚îÄ‚îÄ config
    ‚îÇ   ‚îî‚îÄ‚îÄ config.go
    ‚îú‚îÄ‚îÄ go.mod
    ‚îú‚îÄ‚îÄ go.sum
    ‚îî‚îÄ‚îÄ util
        ‚îî‚îÄ‚îÄ env
            ‚îî‚îÄ‚îÄ env.go
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç path ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ `import` ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
  - `go-mma/util/errs` ‚Üí `go-mma/shared/common/errs`
  - `go-mma/util/logger` ‚Üí `go-mma/shared/common/logger`
  - `go-mma/util/module` ‚Üí `go-mma/shared/common/module`
  - `go-mma/util/registry` ‚Üí `go-mma/shared/common/registry`
  - `go-mma/util/storage/sqldb` ‚Üí `go-mma/shared/common/storage/sqldb`
  - `go-mma/util/storage/sqldb/transactor` ‚Üí `go-mma/shared/common/storage/sqldb/transactor`
- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy`

### ‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå `Makefile` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ path ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `main.go`
    >

    ```bash
    .PHONY: run
    run:
     cd src/app && \
     go run cmd/api/main.go
    ```

- ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°

    ```bash
    make run
    ```

### Build ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå `Makefile` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ path ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ build

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `main.go`

    ```bash
    .PHONY: build
    build:
        cd src/app && \
        go build -ldflags \
        "-s -w \
        -X 'go-mma/build.Version=${BUILD_VERSION}' \
        -X 'go-mma/build.Time=${BUILD_TIME}'" \
        -o ../../app cmd/api/main.go
    ```

- ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏£‡∏±‡∏ô build

    ```bash
    BUILD_VERSION=0.0.2 make build
    ```

### Build ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏õ‡πá‡∏ô Docker image

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå `Dockerfile` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ path ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ build

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `Dockerfile`

    ```docker
    # Builder stage
    FROM golang:1.24-alpine AS builder
    WORKDIR /app
    COPY . .
    RUN cd src/app && go mod download

    # ‡∏õ‡∏¥‡∏î cgo (CGO_ENABLED=0)

    ENV CGO_ENABLED=0 \
        GOOS=linux \
        GOARCH=amd64

    # ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ default ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö VERSION

    ARG VERSION=latest
    ENV IMAGE_VERSION=${VERSION}
    RUN echo "Build version: $IMAGE_VERSION"
    RUN cd src/app && \
    go build -ldflags \
    # strip debugging information ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å binary ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á
    "-s -w \
    -X 'go-mma/build.Version=${IMAGE_VERSION}' \
    -X 'go-mma/build.Time=$(date +"%Y-%m-%dT%H:%M:%S%z")'" \
    -o /app/app cmd/api/main.go

    # Final stage

    FROM alpine:3.22
    RUN apk add --no-cache ca-certificates tzdata && \
    # ‡∏™‡∏£‡πâ‡∏≤‡∏á non-root user
        addgroup -S appgroup && adduser -S appuser -G appgroup
    
    WORKDIR /app
    COPY --from=builder /app/app .
    USER appuser
    EXPOSE 8090
    ENV TZ=Asia/Bangkok

    # ‡πÉ‡∏ä‡πâ ENTRYPOINT ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏´‡∏ô
    ENTRYPOINT ["./app"]
    ```

- ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏£‡∏±‡∏ô build

    ```bash
    BUILD_VERSION=0.0.2 make image
    ```

## ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Public API Contract ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•

‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÇ‡∏°‡∏î‡∏π‡∏• `order` ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `CustomerService` ‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏• `customer` ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏ã‡∏∂‡πà‡∏á **‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°** ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏ß‡πà‡∏≤‡πÇ‡∏°‡∏î‡∏π‡∏• `order` ‡∏£‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á `customer` ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏Å‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤

‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ interface ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ Public API Contract ‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏µ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞ ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤ **‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á**
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î **‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ** (method, input, output)
- **‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô** (encapsulation)

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö

```bash
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ     customercontract       ‚îÇ
                        ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
                        ‚îÇ ‚îÇ  CreditManager         ‚îÇ ‚îÇ
                        ‚îÇ ‚îÇ                        ‚îÇ ‚îÇ
                        ‚îÇ ‚îÇ + ReserveCredit()      ‚îÇ ‚îÇ
                        ‚îÇ ‚îÇ + ReleaseCredit()      ‚îÇ ‚îÇ
                        ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ≤‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ
        implements                   ‚îÇ  depends on
                                     ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     uses      ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     customer       ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ       order        ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ                   ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ ‚îÇ CustomerService‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ OrderService    ‚îÇ‚îÇ
‚îÇ ‚îÇ (implements    ‚îÇ ‚îÇ                   ‚îÇ ‚îÇ (depends on     ‚îÇ‚îÇ
‚îÇ ‚îÇ  CreditManager)‚îÇ ‚îÇ                   ‚îÇ ‚îÇ  CreditManager) ‚îÇ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ                   ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Public API Contract

- ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (Loose Coupling)
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¥‡∏™‡∏£‡∏∞ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô (mock ‡πÑ‡∏î‡πâ)
- ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô microservice ‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Customer Contract

`customercontract` ‡πÄ‡∏õ‡πá‡∏ô ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏Å‡∏•‡∏≤‡∏á ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö public interfaces ‡πÄ‡∏ä‡πà‡∏ô `CreditManager` ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÉ‡∏ä‡πâ 2 ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ

1. **Interface Segregation Principle (ISP)** ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å interface ‡∏Ç‡∏≠‡∏á `CustomerService` ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô interface ‡∏¢‡πà‡∏≠‡∏¢‡πÜ
2. ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô mono-repo ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡∏à‡∏∞**‡∏™‡∏£‡πâ‡∏≤‡∏á contract ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÇ‡∏°‡∏î‡∏π‡∏• customer** ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ß‡πà‡∏≤
    - Low Coupling: `order` ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á import logic ‡∏´‡∏£‡∏∑‡∏≠ dependency ‡∏Ç‡∏≠‡∏á `customer` ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
    - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô implementation ‡πÑ‡∏î‡πâ‡∏≠‡∏¥‡∏™‡∏£‡∏∞: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô logic ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô `customer` ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö `order`
    - Encapsulation: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ import ‡πÇ‡∏Ñ‡πâ‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô customer ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢

‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á customer contract

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà

    ```bash
    mkdir -p src/shared/contract/customercontract
    cd src/shared/contract/customercontract
    go mod init go-mma/shared/contract/customercontract
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÄ‡∏Ç‡πâ‡∏≤ workspace

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `go-mma.code-workspace`
    >

    ```bash
    {
      "folders": [
        {
          "path": "."
        },
        {
          "path": "src/app"
        },
        {
          "path": "src/modules/customer"
        },
        {
          "path": "src/shared/contract/customercontract"
        },
        {
          "path": "src/modules/order"
        },
        {
          "path": "src/modules/notification"
        },
        {
          "path": "src/shared/common"
        }
      ],
      "settings": {}
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `go.mod`

    ```go
    module go-mma/shared/contract/customercontract
    
    go 1.24.1
    
    replace go-mma/shared/common v0.0.0 => ../../common
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á customer contract

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `contract/customercontract/contract.go`
    >

    ```go
    package customercontract
    
    import (
     "context"
     "go-mma/shared/common/registry"
    )
    
    const (
     CreditManagerKey registry.ServiceKey = "customer:contract:credit"
    )
    
    type CustomerInfo struct {
     ID     int64    `json:"id"`
     Email  string   `json:"email"`
     Credit int      `json:"credit"`
    }
    
    func NewCustomerInfo(id int64, email string, credit int) *CustomerInfo {
     return &CustomerInfo{ID: id, Email: email, Credit: credit}
    }
    
    type CustomerReader interface {
     GetCustomerByID(ctx context.Context, id int64) (*CustomerInfo, error)
    }
    
    type CreditManager interface {
     CustomerReader // embed ‡πÄ‡∏û‡∏∑‡πà‡∏≠ reuse
     ReserveCredit(ctx context.Context, id int64, amount int) error
     ReleaseCredit(ctx context.Context, id int64, amount int) error
    }
    ```

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy`

### ‡πÇ‡∏°‡∏î‡∏π‡∏• Customer

‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ `CustomerService` ‡∏°‡∏≤ implement `customercontract`

- ‡∏ó‡∏≥ module replacement

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `customer/go.mod`
    >

    ```go
    module go-mma/modules/customer
    
    go 1.24.1
    
    replace go-mma/shared/common v0.0.0 => ../../shared/common
    
    replace go-mma/modules/notification v0.0.0 => ../../modules/notification
    
    replace go-mma/shared/contract/customercontract v0.0.0 => ../../shared/contract/customercontract
    
    require (
     github.com/gofiber/fiber/v3 v3.0.0-beta.4
     go-mma/modules/notification v0.0.0
     go-mma/shared/common v0.0.0
     go-mma/shared/contract/customercontract v0.0.0
    )
    
    // ...
    ```

- ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ `CustomerService` ‡∏°‡∏≤ implement `customercontract`

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `src/modules/customer/service/customer.go`
    >

    ```go
    package service
    
    import (
     "context"
    
      "go-mma/modules/customer/dto"
     "go-mma/modules/customer/internal/model"
     "go-mma/modules/customer/internal/repository"
     "go-mma/shared/common/errs"
     "go-mma/shared/common/logger"
     "go-mma/shared/common/storage/sqldb/transactor"
     "go-mma/shared/contract/customercontract"  // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    
     notiService "go-mma/modules/notification/service"
    )
    
    // ...
    
    type CustomerService interface {
     CreateCustomer(ctx context.Context, req *dto.CreateCustomerRequest) (*dto.CreateCustomerResponse, error)
     customercontract.CreditManager   // <-- implement customercontract
    }
    
    // ...
    
    func (s *customerService) CreateCustomer(ctx context.Context, req *customercontract.CreateCustomerRequest) (*customercontract.CreateCustomerResponse, error) { // <-- ‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ return ‡πÄ‡∏õ‡πá‡∏ô contract ‡πÅ‡∏ó‡∏ô dto
     // ...
     
     // <-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á Response ‡∏à‡∏≤‡∏Å contract
     return customercontract.NewCustomerInfo(customer.ID, customer.Email, customer.Credit), nil
    }
    ```

- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å service ‡∏î‡πâ‡∏ß‡∏¢ key `customercontract.CreditManagerKey`

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `customer/module.go`
    >

    ```go
    // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    // const (
    //  CustomerServiceKey registry.ServiceKey = "CustomerService"
    // )
    
    func (m *moduleImp) Services() []registry.ProvidedService {
     return []registry.ProvidedService{
       // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô key ‡∏°‡∏≤‡∏à‡∏≤‡∏Å Contract ‡πÅ‡∏ó‡∏ô
      {Key: customercontract.CreditManagerKey, Value: m.custSvc},
     }
    }
    ```

### ‡πÇ‡∏°‡∏î‡∏π‡∏• Order

‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÅ‡∏Ñ‡πà interface `CreditManager` ‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å `customercontract`

- ‡∏ó‡∏≥ module replacement

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå  `order/go.mod`
    >

    ```go
    module go-mma/modules/order
    
    go 1.24.4
    
    replace go-mma/shared/common v0.0.0 => ../../shared/common
    
    replace go-mma/modules/notification v0.0.0 => ../../modules/notification
    
    replace go-mma/modules/customer v0.0.0 => ../../modules/customer
    
    replace go-mma/shared/contract/customercontract v0.0.0 => ../../shared/contract/customercontract
    
    // ...
    ```

- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `customercontract` ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ `CustomerService` ‡∏ï‡∏£‡∏á‡πÜ

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `order/service/order.go`
    >

    ```go
    package service
    
    import (
     "context"
     "go-mma/modules/order/dto"
     "go-mma/modules/order/internal/model"
     "go-mma/modules/order/internal/repository"
     "go-mma/shared/common/errs"
     "go-mma/shared/common/logger"
     "go-mma/shared/common/storage/sqldb/transactor"
     "go-mma/shared/contract/customercontract" // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    
     notiService "go-mma/modules/notification/service"
    )
    
    var (
     ErrNoOrderID = errs.ResourceNotFoundError("the order with given id was not found")
    )
    
    type OrderService interface {
     CreateOrder(ctx context.Context, req *dto.CreateOrderRequest) (*dto.CreateOrderResponse, error)
     CancelOrder(ctx context.Context, id int64) error
    }
    
    type orderService struct {
     transactor transactor.Transactor
     custSvc    customercontract.CreditManager // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     orderRepo  repository.OrderRepository
     notiSvc    notiService.NotificationService
    }
    
    func NewOrderService(
     transactor transactor.Transactor,
     custSvc customercontract.CreditManager, // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     orderRepo repository.OrderRepository,
     notiSvc notiService.NotificationService) OrderService {
     return &orderService{
      transactor: transactor,
      custSvc:    custSvc,
      orderRepo:  orderRepo,
      notiSvc:    notiSvc,
     }
    }
    
    // ...
    ```

    <aside>
    üí°

    ‡∏ñ‡πâ‡∏≤‡∏•‡∏≠‡∏á‡∏î‡∏π‡∏ó‡∏µ‡πà `custSvc` ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 3 methods ‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà contract ‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏ß‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

    </aside>

- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á Service ‡∏à‡∏≤‡∏Å registry ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô `customercontract.CreditManager` ‡πÅ‡∏ó‡∏ô `CustomerService`

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `src/modules/order/module.go`
    >

    ```go
    package order
    
    import (
     "go-mma/modules/order/handler"
     "go-mma/modules/order/internal/repository"
     "go-mma/modules/order/service"
     "go-mma/shared/common/module"
     "go-mma/shared/common/registry"
     "go-mma/shared/contract/customercontract" // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    
     notiModule "go-mma/modules/notification"
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    // ...
    
    func (m *moduleImp) Init(reg registry.ServiceRegistry) error {
     // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     // Resolve CustomerService as CreditManagerKey from the registry
     custSvc, err := registry.ResolveAs[customercontract.CreditManager](reg, customercontract.CreditManagerKey)
     if err != nil {
      return err
     }
      
      // ...
    }
    ```

### ‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°

‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå `app` ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å `customercontract`  ‡∏î‡πâ‡∏ß‡∏¢

- ‡∏ó‡∏≥ module replacement

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `src/app/go.mod`
    >

    ```go
    module go-mma
    
    go 1.24.1
    
    replace go-mma/shared/common v0.0.0 => ../shared/common
    
    replace go-mma/modules/notification v0.0.0 => ../modules/notification
    
    replace go-mma/modules/customer v0.0.0 => ../modules/customer
    
    replace go-mma/modules/order v0.0.0 => ../modules/order
    
    replace go-mma/shared/contract/customercontract v0.0.0 => ../shared/contract/customer-contract
    
    // ...
    ```

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy`
- ‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° `make run`

## ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏• (Data Isolation)

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡∏¥‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠ **‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏• ([Data Isolation](https://somprasongd.work/blog/architecture/modular-monolith-data-isolation))** ‡∏ã‡∏∂‡πà‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¥‡∏™‡∏£‡∏∞‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡∏Å‡πÅ‡∏ô‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏ß‡∏° (loosely coupled) ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ö‡∏ö Modular Monolith ‡∏°‡∏µ‡∏Å‡∏é‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:

- ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•
- ‡∏Å‡∏≤‡∏£ Join ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏≤‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡∏Å‡πÅ‡∏ô‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏ß‡∏° ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏ú‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏û‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

### ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Isolation Levels)

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡∏µ‡πà‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Modular Monoliths

- **Level 1 - Separate Table (‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)**

    ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÉ‡∏î

    ```bash
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ         Single Database         ‚îÇ
    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
    ‚îÇ ‚îÇ   Module A - Schema public  ‚îÇ ‚îÇ
    ‚îÇ ‚îÇ  Table A1  Table A2  ...    ‚îÇ ‚îÇ
    ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
    ‚îÇ ‚îÇ   Module B - Schema public  ‚îÇ ‚îÇ
    ‚îÇ ‚îÇ  Table B1  Table B2  ...    ‚îÇ ‚îÇ
    ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
    ‚îÇ ‚îÇ   Module B - Schema public  ‚îÇ ‚îÇ
    ‚îÇ ‚îÇ  Table C1  Table C2  ...    ‚îÇ ‚îÇ
    ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ```

- **Level 2 - Separate Schema (Logical Isolation)**

    ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ **Database Schemas** ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏°‡∏µ Schema ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏±‡πâ‡∏ô‡πÜ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÉ‡∏î

    ```bash
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ         Single Database         ‚îÇ
    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
    ‚îÇ ‚îÇ     Module A - Schema A     ‚îÇ ‚îÇ
    ‚îÇ ‚îÇ  Table A1  Table A2  ...    ‚îÇ ‚îÇ
    ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
    ‚îÇ ‚îÇ     Module B - Schema B     ‚îÇ ‚îÇ
    ‚îÇ ‚îÇ  Table B1  Table B2  ...    ‚îÇ ‚îÇ
    ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
    ‚îÇ ‚îÇ     Module C - Schema C     ‚îÇ ‚îÇ
    ‚îÇ ‚îÇ  Table C1  Table C2  ...    ‚îÇ ‚îÇ
    ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ```

- **Level 3 - Separate Database (Physical Isolation)**

    ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á **‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏ô** ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ Schema ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•

    ```bash
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Database A     ‚îÇ   ‚îÇ  Database B     ‚îÇ   ‚îÇ  Database C     ‚îÇ
    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ   ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ   ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
    ‚îÇ ‚îÇ Module A    ‚îÇ ‚îÇ   ‚îÇ ‚îÇ Module B    ‚îÇ ‚îÇ   ‚îÇ ‚îÇ Module C    ‚îÇ ‚îÇ
    ‚îÇ ‚îÇ Table A1    ‚îÇ ‚îÇ   ‚îÇ ‚îÇ Table B1    ‚îÇ ‚îÇ   ‚îÇ ‚îÇ Table C1    ‚îÇ ‚îÇ
    ‚îÇ ‚îÇ Table A2    ‚îÇ ‚îÇ   ‚îÇ ‚îÇ Table B2    ‚îÇ ‚îÇ   ‚îÇ ‚îÇ Table C2    ‚îÇ ‚îÇ
    ‚îÇ ‚îÇ     ...     ‚îÇ ‚îÇ   ‚îÇ ‚îÇ     ...     ‚îÇ ‚îÇ   ‚îÇ ‚îÇ     ...     ‚îÇ ‚îÇ
    ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ   ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ   ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ```

- **Level 4 - Different Persistence (Polyglot Persistence)**

    ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÑ‡∏Å‡∏•‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ **‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏• ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á

    ```bash
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Database A     ‚îÇ   ‚îÇ  Database B     ‚îÇ   ‚îÇ  Database C     ‚îÇ
    ‚îÇ (Relational DB) ‚îÇ   ‚îÇ (Document DB)   ‚îÇ   ‚îÇ (Graph DB)      ‚îÇ
    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ   ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ   ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
    ‚îÇ ‚îÇ Module A    ‚îÇ ‚îÇ   ‚îÇ ‚îÇ Module B    ‚îÇ ‚îÇ   ‚îÇ ‚îÇ Module C    ‚îÇ ‚îÇ
    ‚îÇ ‚îÇ Table A1    ‚îÇ ‚îÇ   ‚îÇ ‚îÇ Doc B1      ‚îÇ ‚îÇ   ‚îÇ ‚îÇ Node C1     ‚îÇ ‚îÇ
    ‚îÇ ‚îÇ Table A2    ‚îÇ ‚îÇ   ‚îÇ ‚îÇ Doc B2      ‚îÇ ‚îÇ   ‚îÇ ‚îÇ Edge C1     ‚îÇ ‚îÇ
    ‚îÇ ‚îÇ     ...     ‚îÇ ‚îÇ   ‚îÇ ‚îÇ     ...     ‚îÇ ‚îÇ   ‚îÇ ‚îÇ     ...     ‚îÇ ‚îÇ
    ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ   ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ   ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ```

### **Level 2 - Separate Schema (Logical Isolation)**

‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö Logical Isolation ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Schemas ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô (Separate Database) ‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏õ

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å schema**

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå migration ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å schema

    ```bash
    make mgc filename=separate_schema
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏¢‡∏Å schema

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `xxx_separate_schema.up.sql`
    >

    ```sql
    -- ‡∏™‡∏£‡πâ‡∏≤‡∏á schema ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
    CREATE SCHEMA customer;
    
    -- ‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á 'customers' ‡∏à‡∏≤‡∏Å schema 'public' ‡πÑ‡∏õ‡∏¢‡∏±‡∏á schema 'customer'
    ALTER TABLE public.customers SET SCHEMA customer;
    
    -- ‡∏™‡∏£‡πâ‡∏≤‡∏á schema ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
    CREATE SCHEMA sales;
    
    -- ‡∏•‡∏ö Foreign Key Constraint ‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    ALTER TABLE public.orders DROP CONSTRAINT IF EXISTS fk_customer;
    
    -- ‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á 'orders' ‡∏à‡∏≤‡∏Å schema 'public' ‡πÑ‡∏õ‡∏¢‡∏±‡∏á schema 'order'
    ALTER TABLE public.orders SET SCHEMA sales;
    
    -- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å Modular Monolith ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Foreign Key ‡∏Ç‡πâ‡∏≤‡∏°‡πÇ‡∏°‡∏î‡∏π‡∏•
    -- ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á customer_id ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `xxx_separate_schema.down.sql`
    >

    ```sql
    -- ‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á 'customers' ‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å schema 'customer' ‡πÑ‡∏õ‡∏¢‡∏±‡∏á 'public'
    ALTER TABLE customer.customers SET SCHEMA public;
    
    -- ‡∏•‡∏ö schema 'customer' (‡∏à‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠ schema ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤)
    DROP SCHEMA customer;
    
    -- ‡∏•‡∏ö Foreign Key Constraint ‡∏ö‡∏ô 'sales.orders' ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î)
    ALTER TABLE sales.orders DROP CONSTRAINT IF EXISTS fk_customer;
    
    -- ‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á 'orders' ‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å schema 'sales' ‡πÑ‡∏õ‡∏¢‡∏±‡∏á 'public'
    ALTER TABLE sales.orders SET SCHEMA public;
    
    -- ‡∏•‡∏ö schema 'sales' (‡∏à‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠ schema ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤)
    DROP SCHEMA sales;
    
    -- ‡πÄ‡∏û‡∏¥‡πà‡∏° Foreign Key Constraint ‡∏Å‡∏•‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏µ‡πà 'public.sales' ‡πÇ‡∏î‡∏¢‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á 'public.customers'
    ALTER TABLE public.orders
    ADD CONSTRAINT fk_customer FOREIGN KEY (customer_id) REFERENCES public.customers(id);
    ```

- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `make mgu` ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á schema ‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á
- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á `CustomerRepository` ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ schema ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á `public` ‚Üí `customer`

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `customer/internal/repository/customer.go`
    >

    ```go
    package repository
    
    // ...
    
    func (r *customerRepository) Create(ctx context.Context, customer *model.Customer) error {
     query := `
     INSERT INTO customer.customers (id, email, credit)
     VALUES ($1, $2, $3)
     RETURNING *
     `
    
     // ...
     return nil
    }
    
    func (r *customerRepository) ExistsByEmail(ctx context.Context, email string) (bool, error) {
     query := `SELECT 1 FROM customer.customers WHERE email = $1 LIMIT 1`
    
     // ...
     return true, nil
    }
    
    func (r *customerRepository) FindByID(ctx context.Context, id int64) (*model.Customer, error) {
     query := `
     SELECT *
     FROM customer.customers
     WHERE id = $1
    `
     // ...
     return &customer, nil
    }
    
    func (r *customerRepository) UpdateCredit(ctx context.Context, m *model.Customer) error {
     query := `
     UPDATE customer.customers
     SET credit = $2
     WHERE id = $1
     RETURNING *
    `
      // ...
     return nil
    }
    
    ```

- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á `OrderRepository` ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ schema ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á `public` ‚Üí `sales`

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `order/internal/repository/order.go`
    >

    ```go
    package repository
    
    // ...
    
    func (r *orderRepository) FindByID(ctx context.Context, id int64) (*model.Order, error) {
     query := `
     SELECT *
     FROM sales.orders
     WHERE id = $1
     AND canceled_at IS NULL -- ‡∏£‡∏≤‡∏¢‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
    `
     // ...
     return &order, nil
    }
    
    func (r *orderRepository) Cancel(ctx context.Context, id int64) error {
     query := `
     UPDATE sales.orders
     SET canceled_at = current_timestamp -- soft delete record
     WHERE id = $1
    `
     // ...
     return nil
    }
    
    ```

## ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ Feature-Based Structure ‡πÅ‡∏•‡∏∞ CQRS

‡πÉ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏° ‡πÇ‡∏°‡∏î‡∏π‡∏• `customer` ‡∏°‡∏±‡∏Å‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÑ‡∏ß‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô interface ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Ñ‡∏∑‡∏≠ `CustomerService` ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏ï‡∏Ç‡∏∂‡πâ‡∏ô ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏¢‡∏∏‡πà‡∏á‡πÄ‡∏´‡∏¢‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏Å‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏° *‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô* (modular) ‡πÅ‡∏•‡∏∞ *‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏¢‡∏≤‡∏¢‡∏á‡πà‡∏≤‡∏¢* ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

1. **CQRS (Command Query Responsibility Segregation)**

    ‡πÅ‡∏¢‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" (Command) ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å "‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" (Query) ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

    - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏≠‡∏á intent (‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô?)
    - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á performance ‡∏ù‡∏±‡πà‡∏á read ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ù‡∏±‡πà‡∏á write
    - ‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á / ‡∏Ç‡∏¢‡∏≤‡∏¢ / ‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÑ‡∏î‡πâ‡∏≠‡∏¥‡∏™‡∏£‡∏∞
2. **Mediator Pattern**

    ‡πÉ‡∏ä‡πâ Mediator (‡∏´‡∏£‡∏∑‡∏≠ Message Bus) ‡πÄ‡∏õ‡πá‡∏ô **‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á** ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á Command/Query ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Service ‡∏ï‡∏£‡∏á‡πÜ ‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á component (decoupling) ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö cross-cutting concerns ‡πÄ‡∏ä‡πà‡∏ô logging, transaction, validation

    **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô**

    ```go
    // customer/module.go
    
    // ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô feature handler ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö query `GetCustomerByID`
    // ‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡∏Å handler ‡∏Å‡∏±‡∏ö request type ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ mediator ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
    mediator.Register(getbyid.NewGetCustomerByIDQueryHandler(repo))
    ```

    ```go
    // order/internal/feature/create/command_handler.go
    
    // ‡πÉ‡∏ä‡πâ mediator ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å query `GetCustomerByIDQuery` ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î type ‡∏Ç‡∏≠‡∏á request ‡πÅ‡∏•‡∏∞ response
    customer, err := mediator.Send[*customercontract.GetCustomerByIDQuery, *customercontract.GetCustomerByIDQueryResult](
     ctx,
     &customercontract.GetCustomerByIDQuery{ID: cmd.CustomerID}, // ‡∏™‡πà‡∏á request ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• customer ID
    )
    ```

### **‡∏™‡∏£‡πâ‡∏≤‡∏á Mediator**

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ `Request/Response`¬†‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Command) ‡πÅ‡∏•‡∏∞ ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Query)

> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `common/mediator/mediator.go`
>

```go
package mediator

import (
 "context"
 "errors"
 "fmt"
 "reflect"
)

// ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ response ‡πÉ‡∏î ‡πÜ
type NoResponse struct{}

// Interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö handler ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö request ‡πÅ‡∏•‡∏∞ return response
type RequestHandler[TRequest any, TResponse any] interface {
 Handle(ctx context.Context, request TRequest) (TResponse, error)
}

// registry ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö handler ‡∏ï‡∏≤‡∏° type ‡∏Ç‡∏≠‡∏á request
var handlers = map[reflect.Type]func(ctx context.Context, req interface{}) (interface{}, error){}

// Register: ‡∏ú‡∏π‡∏Å handler ‡∏Å‡∏±‡∏ö type ‡∏Ç‡∏≠‡∏á request ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
func Register[TRequest any, TResponse any](handler RequestHandler[TRequest, TResponse]) {
 var req TRequest // ‡∏™‡∏£‡πâ‡∏≤‡∏á zero value ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡∏≤ type
 reqType := reflect.TypeOf(req)

 // wrap handler ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö interface{}
 handlers[reqType] = func(ctx context.Context, request interface{}) (interface{}, error) {
  typedReq, ok := request.(TRequest)
  if !ok {
   return nil, errors.New("invalid request type")
  }
  return handler.Handle(ctx, typedReq)
 }
}

// Send: dispatch request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á handler ‡∏ó‡∏µ‡πà match ‡∏Å‡∏±‡∏ö type ‡∏Ç‡∏≠‡∏á request
func Send[TRequest any, TResponse any](ctx context.Context, req TRequest) (TResponse, error) {
 reqType := reflect.TypeOf(req)
 handler, ok := handlers[reqType]
 if !ok {
  var empty TResponse
  return empty, fmt.Errorf("no handler for request %T", req)
 }

 result, err := handler(ctx, req)
 if err != nil {
  var empty TResponse
  return empty, err
 }

 // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö type ‡∏Ç‡∏≠‡∏á response ‡∏Å‡πà‡∏≠‡∏ô return
 typedRes, ok := result.(TResponse)
 if !ok {
  var empty TResponse
  return empty, errors.New("invalid response type")
 }

 return typedRes, nil
}
```

### ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏≤‡∏£‡∏∞‡∏´‡πå Customer Features

‡∏ô‡∏≥‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô interface `CustomerService` ‡πÄ‡∏î‡∏¥‡∏° ‡∏°‡∏≤‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô 1 ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå ‡πÑ‡∏î‡πâ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

1. **create**: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
2. **get-by-id**: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å ID
3. **reserve-credit**: ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit
4. **release-credit**: ‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit

**‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà**

```bash
customer
‚îú‚îÄ‚îÄ domainerrors
‚îÇ   ‚îî‚îÄ‚îÄ domainerrors.go             # ‡πÑ‡∏ß‡πâ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° error ‡∏ó‡∏±‡πâ‡πà‡∏á‡∏´‡∏°‡∏î ‡∏Ç‡∏≠‡∏á customer
‚îú‚îÄ‚îÄ internal
‚îÇ   ‚îú‚îÄ‚îÄ feature                     # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô internal ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ import
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto.go              # ‡∏¢‡πâ‡∏≤‡∏¢ dto ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ endpoint.go         # ‡∏¢‡πâ‡∏≤‡∏¢ http handler ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ command.go          # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á Request/Response ‡∏Ç‡∏≠‡∏á command
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ command_handler.go  # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ command handler
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ get-by-id
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ query_handler.go    # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ query handler
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ release-credit
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ command_handler.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reserve-credit
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ command_handler.go
‚îÇ   ‚îú‚îÄ‚îÄ model
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ customer.go
‚îÇ   ‚îî‚îÄ‚îÄ repository
‚îÇ       ‚îî‚îÄ‚îÄ customer.go
‚îú‚îÄ‚îÄ test
‚îÇ   ‚îî‚îÄ‚îÄ customers.http
‚îú‚îÄ‚îÄ module.go          # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å register service ‡πÄ‡∏õ‡πá‡∏ô command/query handler ‡πÅ‡∏ó‡∏ô
‚îú‚îÄ‚îÄ go.mod
‚îî‚îÄ‚îÄ go.sum
```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Customer Domain Error

‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° error ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å command handler, query handler ‡πÅ‡∏•‡∏∞ rich model ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Domain error ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå

> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customer/domainerrors/domainerrors.go`
>

```go
package domainerrors

import "go-mma/shared/common/errs"

var (
 ErrEmailExists        = errs.ConflictError("email already exists")
 ErrCustomerNotFound   = errs.ResourceNotFoundError("the customer with given id was not found")
 ErrInsufficientCredit = errs.BusinessRuleError("insufficient credit")
)
```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå **get-by-id**: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å ID

‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô Query ‡∏ï‡∏≤‡∏° CQRS ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏• order ‡∏î‡πâ‡∏ß‡∏¢ ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á contract ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô

<aside>
üí°

‡πÉ‡∏´‡πâ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå `customercontract/contract.go` ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å interface ‡∏Ç‡∏≠‡∏á public api contract ‡πÄ‡∏õ‡πá‡∏ô struct ‡∏Ç‡∏≠‡∏á command ‡∏Å‡∏±‡∏ö query ‡πÅ‡∏ó‡∏ô

</aside>

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customercontract/query_customer_by_id.go`

    ```go
    package customercontract
    
    type GetCustomerByIDQuery struct {
     ID int64 `json:"id"`
    }
    
    type GetCustomerByIDQueryResult struct {
     ID     int64    `json:"id"`
     Email  string   `json:"email"`
     Credit int      `json:"credit"`
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå get-by-id ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢ logic ‡∏à‡∏≤‡∏Å `CustomerService.GetCustomerByID(‚Ä¶)` ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `Handle(‚Ä¶)`

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customer/internal/feature/get-by-id/query_handler.go`
    >

    ```go
    package getbyid
    
    import (
     "context"
     "go-mma/modules/customer/domainerrors"
     "go-mma/modules/customer/internal/model"
     "go-mma/modules/customer/internal/repository"
     "go-mma/shared/contract/customercontract"
    )
    
    type getCustomerByIDQueryHandler struct {
     custRepo repository.CustomerRepository
    }
    
    func NewGetCustomerByIDQueryHandler(custRepo repository.CustomerRepository) *getCustomerByIDQueryHandler {
     return &getCustomerByIDQueryHandler{
      custRepo: custRepo,
     }
    }
    
    func (h *getCustomerByIDQueryHandler) Handle(ctx context.Context, query *customercontract.GetCustomerByIDQuery) (*customercontract.GetCustomerByIDQueryResult, error) {
     customer, err := h.custRepo.FindByID(ctx, query.ID)
     if err != nil {
      return nil, err
     }
     if customer == nil {
      return nil, domainerrors.ErrCustomerNotFound
     }
     return h.newGetCustomerByIDQueryResult(customer), nil
    }
    
    func (h *getCustomerByIDQueryHandler) newGetCustomerByIDQueryResult(customer *model.Customer) *customercontract.GetCustomerByIDQueryResult {
     return &customercontract.GetCustomerByIDQueryResult{
      ID:     customer.ID,
      Email:  customer.Email,
      Credit: customer.Credit,
     }
    }
    ```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå **reserve-credit**: ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit

‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πå‡∏ô‡∏µ‡πâ ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô Command ‡∏ï‡∏≤‡∏° CQRS ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏• order ‡∏î‡πâ‡∏ß‡∏¢ ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á contract ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customer-contract/command_reserve_credit.go`

    ```go
    package customercontract
    
    type ReserveCreditCommand struct {
     CustomerID   int64 `json:"customer_id"`
     CreditAmount int   `json:"credit_amount"`
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå reserve-credit ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢ logic ‡∏à‡∏≤‡∏Å `CustomerService.ReserveCredit(‚Ä¶)` ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `Handle(‚Ä¶)`

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customer/internal/feature/reserve-credit/command_handler.go`
    >

    ```go
    package reservecredit
    
    import (
     "context"
     "go-mma/modules/customer/domainerrors"
     "go-mma/modules/customer/internal/repository"
     "go-mma/shared/common/errs"
     "go-mma/shared/common/logger"
     "go-mma/shared/common/mediator"
     "go-mma/shared/common/storage/sqldb/transactor"
     "go-mma/shared/contract/customercontract"
    )
    
    type reserveCreditCommandHandler struct {
     transactor transactor.Transactor
     custRepo   repository.CustomerRepository
    }
    
    func NewReserveCreditCommandHandler(
     transactor transactor.Transactor,
     repo repository.CustomerRepository) *reserveCreditCommandHandler {
     return &reserveCreditCommandHandler{
      transactor: transactor,
      custRepo:   repo,
     }
    }
    
    func (h *reserveCreditCommandHandler) Handle(ctx context.Context, cmd *customercontract.ReserveCreditCommand) (*mediator.NoResponse, error) {
     err := h.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
      customer, err := h.custRepo.FindByID(ctx, cmd.CustomerID)
      if err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      if customer == nil {
       return domainerrors.ErrCustomerNotFound
      }
    
      if err := customer.ReserveCredit(cmd.CreditAmount); err != nil {
       return err
      }
    
      if err := h.custRepo.UpdateCredit(ctx, customer); err != nil {
       logger.Log.Error(err.Error())
       return errs.DatabaseFailureError(err.Error())
      }
    
      return nil
     })
    
     return nil, err
    }
    
    ```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå **release-credit**: ‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit

‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πå‡∏ô‡∏µ‡πâ ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î credit ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô Command ‡∏ï‡∏≤‡∏° CQRS ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏• order ‡∏î‡πâ‡∏ß‡∏¢ ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á contract ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customer-contract/command_release_credit.go`

    ```go
    package customercontract
    
    type ReleaseCreditCommand struct {
     CustomerID   int64 `json:"customer_id"`
     CreditAmount int   `json:"credit_amount"`
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå release-credit ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢ logic ‡∏à‡∏≤‡∏Å `CustomerService.ReleaseCredit(‚Ä¶)` ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `Handle(‚Ä¶)`

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customer/internal/feature/release-credit/command_handler.go`
    >

    ```go
    package releasecredit
    
    import (
     "context"
     "go-mma/modules/customer/domainerrors"
     "go-mma/modules/customer/internal/repository"
     "go-mma/shared/common/logger"
     "go-mma/shared/common/mediator"
     "go-mma/shared/common/storage/sqldb/transactor"
     "go-mma/shared/contract/customercontract"
    )
    
    type releaseCreditCommandHandler struct {
     transactor transactor.Transactor
     custRepo   repository.CustomerRepository
    }
    
    func NewReleaseCreditCommandHandler(
     transactor transactor.Transactor,
     repo repository.CustomerRepository) *releaseCreditCommandHandler {
     return &releaseCreditCommandHandler{
      transactor: transactor,
      custRepo:   repo,
     }
    }
    
    func (h *releaseCreditCommandHandler) Handle(ctx context.Context, cmd *customercontract.ReleaseCreditCommand) (*mediator.NoResponse, error) {
     err := h.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
      customer, err := h.custRepo.FindByID(ctx, cmd.CustomerID)
      if err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      if customer == nil {
       return domainerrors.ErrCustomerNotFound
      }
    
      customer.ReleaseCredit(cmd.CreditAmount)
    
      if err := h.custRepo.UpdateCredit(ctx, customer); err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      return nil
     })
    
     return nil, err
    }
    ```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå **create**: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà

‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πå‡∏ô‡∏µ‡πâ ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô Command ‡∏ï‡∏≤‡∏° CQRS ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô ‡∏à‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ contract

- ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô REST API ‡∏à‡∏∂‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ endpoint ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ request/response ‡∏î‡πâ‡∏ß‡∏¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏¢‡πâ‡∏≤‡∏¢ `dto` ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customer/internal/feature/create/dto.go`
    >

    ```go
    package create
    
    import (
     "errors"
     "net/mail"
    )
    
    type CreateCustomerRequest struct {
     Email  string `json:"email"`
     Credit int    `json:"credit"`
    }
    
    func (r *CreateCustomerRequest) Validate() error {
     var errs error
     if r.Email == "" {
      errs = errors.Join(errs, errors.New("email is required"))
     }
     if _, err := mail.ParseAddress(r.Email); err != nil {
      errs = errors.Join(errs, errors.New("email is invalid"))
     }
     if r.Credit <= 0 {
      errs = errors.Join(errs, errors.New("credit must be greater than 0"))
     }
     return errs
    }
    
    type CreateCustomerResponse struct {
     ID int64 `json:"id"`
    }
    ```

- ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Command ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå create

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customer/internal/feature/create/command.go`
    >

    ```go
    package create
    
    type CreateCustomerCommand struct {
     CreateCustomerRequest  // embeded type ‡∏°‡∏≤‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô
    }
    
    type CreateCustomerCommandResult struct {
     CreateCustomerResponse // embeded type ‡∏°‡∏≤‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á CreateCustomerCommandResult
    func NewCreateCustomerCommandResult(id int64) *CreateCustomerCommandResult {
     return &CreateCustomerCommandResult{
      CreateCustomerResponse{
       ID: id,
      },
     }
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå create

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customer/internal/feature/create/command_handler.go`
    >

    ```go
    package create
    
    import (
     "context"
     "go-mma/modules/customer/domainerrors"
     "go-mma/modules/customer/internal/model"
     "go-mma/modules/customer/internal/repository"
     "go-mma/shared/common/logger"
     "go-mma/shared/common/storage/sqldb/transactor"
    
     notiService "go-mma/modules/notification/service"
    )
    
    type createCustomerCommandHandler struct {
     transactor transactor.Transactor
     custRepo   repository.CustomerRepository
     notiSvc    notiService.NotificationService
    }
    
    func NewCreateCustomerCommandHandler(
     transactor transactor.Transactor,
     custRepo repository.CustomerRepository,
     notiSvc notiService.NotificationService) *createCustomerCommandHandler {
     return &createCustomerCommandHandler{
      transactor: transactor,
      custRepo:   custRepo,
      notiSvc:    notiSvc,
     }
    }
    
    func (h *createCustomerCommandHandler) Handle(ctx context.Context, cmd *CreateCustomerCommand) (*CreateCustomerCommandResult, error) {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö business rule/invariant
     if err := h.validateBusinessInvariant(ctx, cmd); err != nil {
      return nil, err
     }
    
     // ‡πÅ‡∏õ‡∏•‡∏á Command ‚Üí Model
     customer := model.NewCustomer(cmd.Email, cmd.Credit)
    
     // ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô WithinTransaction
     err := h.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
    
      // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Repository Layer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      if err := h.custRepo.Create(ctx, customer); err != nil {
       // error logging
       logger.Log.Error(err.Error())
       return err
      }
    
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô hook ‡πÅ‡∏ó‡∏ô ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      registerPostCommitHook(func(ctx context.Context) error {
       return h.notiSvc.SendEmail(customer.Email, "Welcome to our service!", map[string]any{
        "message": "Thank you for joining us! We are excited to have you as a member."})
      })
    
      return nil
     })
    
     if err != nil {
      return nil, err
     }
    
     return NewCreateCustomerCommandResult(customer.ID), nil
    }
    
    func (h *createCustomerCommandHandler) validateBusinessInvariant(ctx context.Context, cmd *CreateCustomerCommand) error {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö email ‡∏ã‡πâ‡∏≥
     exists, err := h.custRepo.ExistsByEmail(ctx, cmd.Email)
     if err != nil {
      // error logging
      logger.Log.Error(err.Error())
      return err
     }
    
     if exists {
      return domainerrors.ErrEmailExists
     }
     return nil
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á endpoint ‡∏Ç‡∏≠‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customer/internal/feature/create/endpoint.go`

    ```go
    package create
    
    import (
     "go-mma/shared/common/errs"
     "go-mma/shared/common/mediator"
     "strings"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func NewEndpoint(router fiber.Router, path string) {
     router.Post(path, createCustomerHTTPHandler)
    }
    
    func createCustomerHTTPHandler(c fiber.Ctx) error {
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> dto
     var req dto.CreateCustomerRequest
     if err := c.Bind().Body(&req); err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return errs.InputValidationError(err.Error())
     }
    
     logger.Log.Info(fmt.Sprintf("Received customer: %v", req))
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if err := req.Validate(); err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return errs.InputValidationError(err.Error())
     }
    
     // *** ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Command Handler ‡πÅ‡∏ó‡∏ô Service ***
     resp, err := mediator.Send[*CreateCustomerCommand, *CreateCustomerCommandResult](
      c.Context(),
      &CreateCustomerCommand{CreateCustomerRequest: req},
     )
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å feature ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return err
     }
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    ```

### ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡∏Å‡∏≤‡∏£ Init ‡πÇ‡∏°‡∏î‡∏π‡∏• Customer

‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô `customer/module.go` ‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î service ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡πâ‡∏≤‡∏á ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ(‡πÑ‡∏°‡πà‡∏°‡∏µ `CustomerService` ‡πÅ‡∏•‡πâ‡∏ß) ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÉ‡∏ä‡πâ mediator ‡∏°‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ó‡∏ô

```go
package customer

import (
 "go-mma/modules/customer/internal/feature/create"
 getbyid "go-mma/modules/customer/internal/feature/get-by-id"
 releasecredit "go-mma/modules/customer/internal/feature/release-credit"
 reservecredit "go-mma/modules/customer/internal/feature/reserve-credit"
 "go-mma/modules/customer/internal/repository"
 "go-mma/shared/common/mediator"
 "go-mma/shared/common/module"
 "go-mma/shared/common/registry"

 notiModule "go-mma/modules/notification"
 notiService "go-mma/modules/notification/service"

 "github.com/gofiber/fiber/v3"
)

func NewModule(mCtx *module.ModuleContext) module.Module {
 return &moduleImp{mCtx: mCtx}
}

type moduleImp struct {
 mCtx *module.ModuleContext
 // ‡πÄ‡∏≠‡∏≤ service ‡∏≠‡∏≠‡∏Å
}

func (m *moduleImp) APIVersion() string {
 return "v1"
}

func (m *moduleImp) Init(reg registry.ServiceRegistry) error {
 // Resolve NotificationService from the registry
 notiSvc, err := registry.ResolveAs[notiService.NotificationService](reg, notiModule.NotificationServiceKey)
 if err != nil {
  return err
 }

 repo := repository.NewCustomerRepository(m.mCtx.DBCtx)

  // <-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
  // ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ register handler ‡πÄ‡∏Ç‡πâ‡∏≤ mediator
 mediator.Register(create.NewCreateCustomerCommandHandler(m.mCtx.Transactor, repo, notiSvc))
 mediator.Register(getbyid.NewGetCustomerByIDQueryHandler(repo))
 mediator.Register(reservecredit.NewReserveCreditCommandHandler(m.mCtx.Transactor, repo))
 mediator.Register(releasecredit.NewReleaseCreditCommandHandler(m.mCtx.Transactor, repo))

 return nil
}

// ‡∏•‡∏ö Services() []registry.ProvidedService ‡∏≠‡∏≠‡∏Å

func (m *moduleImp) RegisterRoutes(router fiber.Router) {
 customers := router.Group("/customers")
 create.NewEndpoint(customers, "")
}
```

### ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÇ‡∏°‡∏î‡∏π‡∏• Order

‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏°‡∏î‡∏π‡∏• Order ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Command/Query ‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏• Customer ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å service

‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÅ‡∏¢‡∏Å `OrderService` ‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå

```bash
order
‚îú‚îÄ‚îÄ domainerrors
‚îÇ   ‚îî‚îÄ‚îÄ domainerrors.go             # ‡πÑ‡∏ß‡πâ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° error ‡∏ó‡∏±‡πâ‡πà‡∏á‡∏´‡∏°‡∏î ‡∏Ç‡∏≠‡∏á order
‚îú‚îÄ‚îÄ internal
‚îÇ   ‚îú‚îÄ‚îÄ feature                     # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô internal ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ import
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto.go              # ‡∏¢‡πâ‡∏≤‡∏¢ dto ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ endpoint.go         # ‡∏¢‡πâ‡∏≤‡∏¢ http handler ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ command.go          # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á Request/Response ‡∏Ç‡∏≠‡∏á command
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ command_handler.go  # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ command handler
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cancel
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ dto.go              # ‡∏¢‡πâ‡∏≤‡∏¢ dto ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ endpoint.go         # ‡∏¢‡πâ‡∏≤‡∏¢ http handler ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ command.go          # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á Request/Response ‡∏Ç‡∏≠‡∏á command
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ command_handler.go  # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ command handler
‚îÇ   ‚îú‚îÄ‚îÄ model
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ order.go
‚îÇ   ‚îî‚îÄ‚îÄ repository
‚îÇ       ‚îî‚îÄ‚îÄ order.go
‚îú‚îÄ‚îÄ test
‚îÇ   ‚îî‚îÄ‚îÄ orders.http
‚îú‚îÄ‚îÄ module.go                        # register command/query handler
‚îú‚îÄ‚îÄ go.mod
‚îî‚îÄ‚îÄ go.sum
```

- ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° error ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô feature ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `order/domainerrors/domainerrors.go`
    >

    ```go
    package domainerrors
    
    import "go-mma/shared/common/errs"
    
    var (
     ErrNoOrderID = errs.ResourceNotFoundError("the order with given id was not found")
    )
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå create ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô REST API

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `order/internal/feature/create/dto.go`
    >

    ```go
    package create
    
    import "fmt"
    
    type CreateOrderRequest struct {
     CustomerID int64 `json:"customer_id"`
     OrderTotal int   `json:"order_total"`
    }
    
    func (r *CreateOrderRequest) Validate() error {
     if r.CustomerID <= 0 {
      return fmt.Errorf("customer_id is required")
     }
     if r.OrderTotal <= 0 {
      return fmt.Errorf("order_total must be greater than 0")
     }
     return nil
    }
    
    type CreateOrderResponse struct {
     ID int64 `json:"id"`
    }
    ```

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `order/internal/feature/create/command.go`

    ```go
    package create
    
    type CreateOrderCommand struct {
     CreateOrderRequest
    }
    
    type CreateOrderCommandResult struct {
     CreateOrderResponse
    }
    
    func NewCreateOrderCommandResult(id int64) *CreateOrderCommandResult {
     return &CreateOrderCommandResult{
      CreateOrderResponse{ID: id},
     }
    }
    ```

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `order/internal/feature/create/command_handler.go`

    ```go
    package create
    
    import (
     "context"
     "go-mma/modules/order/internal/model"
     "go-mma/modules/order/internal/repository"
     "go-mma/shared/common/logger"
     "go-mma/shared/common/mediator"
     "go-mma/shared/common/storage/sqldb/transactor"
     "go-mma/shared/contract/customercontract"
    
     notiService "go-mma/modules/notification/service"
    )
    
    type createOrderCommandHandler struct {
     transactor transactor.Transactor
     orderRepo  repository.OrderRepository
     notiSvc    notiService.NotificationService
    }
    
    func NewCreateOrderCommandHandler(
     transactor transactor.Transactor,
     orderRepo repository.OrderRepository,
     notiSvc notiService.NotificationService) *createOrderCommandHandler {
     return &createOrderCommandHandler{
      transactor: transactor,
      orderRepo:  orderRepo,
      notiSvc:    notiSvc,
     }
    }
    
    func (h *createOrderCommandHandler) Handle(ctx context.Context, cmd *CreateOrderCommand) (*CreateOrderCommandResult, error) {
     // Business Logic Rule: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö customer id ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     customer, err := mediator.Send[*customercontract.GetCustomerByIDQuery, *customercontract.GetCustomerByIDQueryResult](
      ctx,
      &customercontract.GetCustomerByIDQuery{ID: cmd.CustomerID},
     )
     if err != nil {
      return nil, err
     }
    
     var order *model.Order
     err = h.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
    
      // Business Logic Rule: ‡∏ï‡∏±‡∏î‡∏¢‡∏≠‡∏î credit ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á customer
      if _, err := mediator.Send[*customercontract.ReserveCreditCommand, *mediator.NoResponse](
       ctx,
       &customercontract.ReserveCreditCommand{CustomerID: cmd.CustomerID, CreditAmount: cmd.OrderTotal},
      ); err != nil {
       return err
      }
    
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á order ‡πÉ‡∏´‡∏°‡πà DTO -> Model
      order = model.NewOrder(cmd.CustomerID, cmd.OrderTotal)
      
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      err := h.orderRepo.Create(ctx, order)
      if err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á commit
      registerPostCommitHook(func(ctx context.Context) error {
       return h.notiSvc.SendEmail(customer.Email, "Order Created", map[string]any{
        "order_id": order.ID,
        "total":    order.OrderTotal,
       })
      })
    
      return nil
     })
    
     if err != nil {
      return nil, err
     }
    
     return NewCreateOrderCommandResult(order.ID), nil
    }
    
    ```

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `order/internal/feature/create/endpoint.go`

    ```go
    package create
    
    import (
     "go-mma/shared/common/errs"
     "go-mma/shared/common/mediator"
     "strings"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func NewEndpoint(router fiber.Router, path string) {
     router.Post(path, createOrderHTTPHandler)
    }
    
    func createOrderHTTPHandler(c fiber.Ctx) error {
     // ‡πÅ‡∏õ‡∏•‡∏á request body -> struct
     var req CreateOrderRequest
     if err := c.Bind().Body(&req); err != nil {
       // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return errs.InputValidationError(err.Error())
     }
    
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö input fields (e.g., value, format, etc.)
     if err := req.Validate(); err != nil {
       // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return errs.InputValidationError(err.Error())
     }
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Command Handler
     resp, err := mediator.Send[*CreateOrderCommand, *CreateOrderCommandResult](
      c.Context(),
      &CreateOrderCommand{CreateOrderRequest: req},
     )
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å feature ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return err
     }
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 201 (created) ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
     return c.Status(fiber.StatusCreated).JSON(resp)
    }
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå cancel ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô REST API

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `order/internal/feature/cancel/command.go`

    ```go
    package cancel
    
    type CancelOrderCommand struct {
     ID int64 `json:"id"`
    }
    ```

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `order/internal/feature/cancel/command_handler.go`

    ```go
    package cancel
    
    import (
     "context"
     "go-mma/modules/order/domainerrors"
     "go-mma/modules/order/internal/repository"
     "go-mma/shared/common/logger"
     "go-mma/shared/common/mediator"
     "go-mma/shared/common/storage/sqldb/transactor"
     "go-mma/shared/contract/customercontract"
    )
    
    type cancelOrderCommandHandler struct {
     transactor transactor.Transactor
     orderRepo  repository.OrderRepository
    }
    
    func NewCancelOrderCommandHandler(
     transactor transactor.Transactor,
     orderRepo repository.OrderRepository) *cancelOrderCommandHandler {
     return &cancelOrderCommandHandler{
      transactor: transactor,
      orderRepo:  orderRepo,
     }
    }
    
    func (h *cancelOrderCommandHandler) Handle(ctx context.Context, cmd *CancelOrderCommand) (*mediator.NoResponse, error) {
     err := h.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
      // Business Logic Rule: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö order id
      order, err := h.orderRepo.FindByID(ctx, cmd.ID)
      if err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      if order == nil {
       return domainerrors.ErrNoOrderID
      }
    
      // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å order
      if err := h.orderRepo.Cancel(ctx, order.ID); err != nil {
       logger.Log.Error(err.Error())
       return err
      }
    
      // Business Logic Rule: ‡∏Ñ‡∏∑‡∏ô credit ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á customer
      if _, err := mediator.Send[*customercontract.ReleaseCreditCommand, *mediator.NoResponse](
       ctx,
       &customercontract.ReleaseCreditCommand{CustomerID: order.CustomerID, CreditAmount: order.OrderTotal},
      ); err != nil {
       return err
      }
    
      return nil
     })
    
     if err != nil {
      return nil, err
     }
    
     return nil, nil
    }
    ```

    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `order/internal/feature/cancel/endpoint.go`

    ```go
    package cancel
    
    import (
     "go-mma/shared/common/errs"
     "go-mma/shared/common/mediator"
     "strconv"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func NewEndpoint(router fiber.Router, path string) {
     router.Delete(path, cancelOrderHTTPHandler)
    }
    
    func cancelOrderHTTPHandler(c fiber.Ctx) error {
     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö orderID
     orderID, err := strconv.Atoi(c.Params("orderID"))
     if err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return errs.InputValidationError("invalid order id")
     }
    
     logger.Log.Info(fmt.Sprintf("Cancelling order: %v", orderID))
    
     // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Command Handler
     _, err = mediator.Send[*CancelOrderCommand, *mediator.NoResponse](
      c.Context(),
      &CancelOrderCommand{ID: int64(orderID)},
     )
    
     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏à‡∏≤‡∏Å feature ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
     if err != nil {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error response ‡∏ó‡∏µ‡πà middleware
      return err
     }
    
     // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ status code 204 (no content)
     return c.SendStatus(fiber.StatusNoContent)
    }
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ register command handlers ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÉ‡∏ô `order/module.go`

    ```go
    package order
    
    import (
     "go-mma/modules/order/internal/feature/cancel"
     "go-mma/modules/order/internal/feature/create"
     "go-mma/modules/order/internal/repository"
     "go-mma/shared/common/mediator"
     "go-mma/shared/common/module"
     "go-mma/shared/common/registry"
    
     notiModule "go-mma/modules/notification"
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    func NewModule(mCtx *module.ModuleContext) module.Module {
     return &moduleImp{mCtx: mCtx}
    }
    
    type moduleImp struct {
     mCtx *module.ModuleContext
    }
    
    func (m *moduleImp) APIVersion() string {
     return "v1"
    }
    
    func (m *moduleImp) Init(reg registry.ServiceRegistry) error {
    
     // Resolve NotificationService from the registry
     notiSvc, err := registry.ResolveAs[notiService.NotificationService](reg, notiModule.NotificationServiceKey)
     if err != nil {
      return err
     }
    
     repo := repository.NewOrderRepository(m.mCtx.DBCtx)
    
     mediator.Register(create.NewCreateOrderCommandHandler(m.mCtx.Transactor, repo, notiSvc))
     mediator.Register(cancel.NewCancelOrderCommandHandler(m.mCtx.Transactor, repo))
    
     return nil
    }
    
    func (m *moduleImp) RegisterRoutes(router fiber.Router) {
     orders := router.Group("/orders")
     create.NewEndpoint(orders, "")
     cancel.NewEndpoint(orders, "/:orderID")
    }
    ```

### ‡πÇ‡∏°‡∏î‡∏π‡∏• Notification

‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏• notification ‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô

## ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î Event-Driven Architecture

‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô `CreateCustomerCommandHandler` ‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏£‡∏≤‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö **Imperative Style** ‚Äî ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÄ‡∏ä‡πà‡∏ô

```go
h.notiSvc.SendEmail(...)
```

```bash
+-------------------------------+
| CreateCustomerCommandHandler  |
+-------------------------------+
           |
           | creates Customer
           v
+-------------------------------+
|  CustomerRepository           |
+-------------------------------+
           |
           | persists to DB
           v
+-------------------------------+
|  NotificationService          |
+-------------------------------+
           |
           | sends welcome email
           v
       External System
```

‡πÅ‡∏°‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å ‡πÅ‡∏ï‡πà‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î

- ‡∏ï‡∏±‡∏ß Handler ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö service ‡∏≠‡∏∑‡πà‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (tight coupling)
- ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° action ‡∏≠‡∏∑‡πà‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡πà‡∏á SMS ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å audit log ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°
- ‡∏Ç‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏Å Single Responsibility

### ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Event-Driven

‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞ ‚Äú‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‚Äù ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‚Üí ‡πÉ‡∏´‡πâ "‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå" ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏≤‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£

‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ô‡∏µ‡πâ

- **‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö ‡∏´‡∏•‡∏ß‡∏°‡∏ï‡∏±‡∏ß (loosely coupled):** Handler ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏ü‡∏±‡∏á event ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏Ñ‡∏£‡∏à‡∏∞‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£
- **‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢:** ‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° logic ‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏Ñ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° event handler ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ handler ‡πÄ‡∏î‡∏¥‡∏°
- **‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö scaling:** ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏¢‡∏Å‡∏ö‡∏≤‡∏á handler ‡πÑ‡∏õ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô async ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ message queue ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

### Domain Events

- ‡πÄ‡∏õ‡πá‡∏ô event ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô domain (bounded context)
- ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤ *"‡∏™‡∏¥‡πà‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß"* (‡πÄ‡∏ä‡πà‡∏ô `CustomerCreated`)
- ‡∏ñ‡∏π‡∏Å publish ‡πÅ‡∏•‡∏∞ consume *‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô* (in-process)
- ‡∏°‡∏±‡∏Å‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö business logic ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô

### Integration Events

- ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏° bounded context / microservice
- ‡πÉ‡∏ä‡πâ messaging system ‡πÄ‡∏ä‡πà‡∏ô Kafka, RabbitMQ
- ‡∏°‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å domain event ‡πÅ‡∏•‡πâ‡∏ß‡∏ñ‡∏π‡∏Å‡πÅ‡∏õ‡∏•‡∏á (map) ‡πÄ‡∏õ‡πá‡∏ô integration event
- ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö async

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° Domain Events ‡∏Å‡∏±‡∏ö Integration Events

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å logic ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Handler ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö asynchronous ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

```bash
+-------------------------------+
| CreateCustomerCommandHandler  |
+-------------------------------+
           |
           | creates Customer
           v
+-------------------------+
|  Customer Entity        |
|  + AddDomainEvent()     |
+-------------------------+
           |
           | emits domain event
           v
+-------------------------------+
| DomainEventDispatcher         |
| (in-process, synchronous)     |
+-------------------------------+
           |
           | calls domain handler
           v
+------------------------------------------+
| CustomerCreatedDomainEventHandler        |
| - Converts to Integration Event          |
| - Calls EventBus.Publish()               |
+------------------------------------------+
           |
           | emits async message (Kafka/Outbox)
           v
+------------------------------+
|  NotificationService         |
| (another module/microservice)|
+------------------------------+
           |
           | sends welcome email
           v
       External System
```

1. `CreateCustomerHandler` ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á Customer ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° `CustomerCreated` domain event
2. `DomainEventDispatcher` ‚Üí dispatch event ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ `CustomerCreatedDomainEventHandler`
3. Handler ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á `CustomerCreatedIntegrationEvent` ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô EventBus
4. ‡∏£‡∏∞‡∏ö‡∏ö‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å (‡πÄ‡∏ä‡πà‡∏ô Notification Module) consume ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Email

## Refactor ‡πÄ‡∏û‡∏¥‡πà‡∏° Domain Event

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Domain Event ‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ DDD (Domain-Driven Design) ‡πÅ‡∏•‡∏∞ Event-Driven Architecture ‡∏°‡∏µ‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

1. **Domain Event**
    - ‡πÄ‡∏õ‡πá‡∏ô struct ‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà ‚Äú‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß‚Äù ‡πÉ‡∏ô domain
    - ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô layer `domain` ‡∏´‡∏£‡∏∑‡∏≠ `internal/domain/event`
2. **Aggregate/Entity ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á Event**
    - Entity ‡πÄ‡∏ä‡πà‡∏ô `Customer` ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö domain events (‡πÄ‡∏ä‡πà‡∏ô slice `[]DomainEvent`)
    - ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå ‡πÉ‡∏´‡πâ `append()` ‡∏•‡∏á‡πÑ‡∏õ
3. **DomainEvent Interface**
    - ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô abstraction ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÄ‡∏ä‡πà‡∏ô: ‡∏°‡∏µ method `EventName()` ‡∏´‡∏£‡∏∑‡∏≠ `OccurredAt()`
4. **Event Dispatcher**
    - ‡∏î‡∏∂‡∏á events ‡∏à‡∏≤‡∏Å aggregate ‡πÅ‡∏•‡πâ‡∏ß dispatch ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (handler)
5. **Event Handler**
    - ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö event ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á
    - ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô layer `domain` ‡∏´‡∏£‡∏∑‡∏≠ `internal/domain/eventhandler`
6. **Trigger Point**
    - ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà pull domain events ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô dispatcher (‡∏°‡∏±‡∏Å‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏•‡∏±‡∏á transaction ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)
7. **Dispatch Events ‡∏°‡∏µ 2 ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å**
    - ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô transaction (immediate dispatch) ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö use case ‡∏ó‡∏µ‡πà event handler ‡πÅ‡∏Ñ‡πà‡∏õ‡∏£‡∏±‡∏ö state ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡πÄ‡∏ä‡πà‡∏ô update model ‡∏≠‡∏∑‡πà‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞ coupling ‡∏Å‡∏±‡∏ö transaction logic ‡∏ñ‡πâ‡∏≤ event handler fail ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á rollback transaction ‡∏î‡πâ‡∏ß‡∏¢
    - ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å commit ‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∑‡∏≠ ‡∏î‡∏∂‡∏á domain events ‚Üí ‡∏£‡∏≠ DB commit ‚Üí dispatch ‡πÄ‡∏ä‡πà‡∏ô post-commit hook ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö handler ‡∏ó‡∏µ‡πà‡∏°‡∏µ side-effect ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•, call external service ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡πÅ‡∏•‡∏∞ retry ‡πÄ‡∏≠‡∏á ‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å transaction logic

### DomainEvent Interface

‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô abstraction ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÄ‡∏ä‡πà‡∏ô: ‡∏°‡∏µ method `EventName()` ‡∏´‡∏£‡∏∑‡∏≠ `OccurredAt()`

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `common/domain/event.go`

    ```go
    package domain
    
    import "time"
    
    // EventName ‡∏Ñ‡∏∑‡∏≠ alias ‡∏Ç‡∏≠‡∏á string ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô‡∏ä‡∏∑‡πà‡∏≠ event ‡πÄ‡∏ä‡πà‡∏ô "CustomerCreated", "OrderPlaced" ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô
    type EventName string
    
    // DomainEvent ‡πÄ‡∏õ‡πá‡∏ô interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô domain (Domain Event ‡∏ï‡∏≤‡∏° DDD)
    // ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á event ‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
    type DomainEvent interface {
     EventName() EventName     // ‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∑‡πà‡∏≠ event
     OccurredAt() time.Time    // ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà event ‡πÄ‡∏Å‡∏¥‡∏î
    }
    
    // BaseDomainEvent ‡πÄ‡∏õ‡πá‡∏ô struct ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà implement DomainEvent
    // ‡πÉ‡∏ä‡πâ‡∏ù‡∏±‡∏á‡πÉ‡∏ô struct ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô event ‡πÄ‡∏û‡∏∑‡πà‡∏≠ reuse method ‡πÑ‡∏î‡πâ
    type BaseDomainEvent struct {
     Name EventName   // ‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á event ‡πÄ‡∏ä‡πà‡∏ô "UserRegistered"
     At   time.Time   // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà event ‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
    }
    
    // EventName ‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á event ‡∏ô‡∏µ‡πâ
    func (e BaseDomainEvent) EventName() EventName {
     return e.Name
    }
    
    // OccurredAt ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà event ‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
    // ‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö value receiver ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô
    func (e BaseDomainEvent) OccurredAt() time.Time {
     return e.At
    }
    
    ```

    <aside>
    üí°

    ‡πÉ‡∏ä‡πâ **value receiver** ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ struct ‡πÄ‡∏•‡πá‡∏Å ‡πÑ‡∏°‡πà‡∏°‡∏µ mutation ‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡πÄ‡∏ä‡∏¥‡∏á concurrent

    </aside>

### Aggregate

`Aggregate` ‡πÄ‡∏õ‡πá‡∏ô **‡∏ê‡∏≤‡∏ô‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö (base struct)** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö aggregate root ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß ‡πÄ‡∏ä‡πà‡∏ô `Customer`, `Order` ‡∏Ø‡∏•‡∏Ø ‡∏à‡∏∞‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà **‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô (Domain Events)** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ layer ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å (‡πÄ‡∏ä‡πà‡∏ô Application ‡∏´‡∏£‡∏∑‡∏≠ Infrastructure) ‡∏ô‡∏≥‡πÑ‡∏õ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ï‡πà‡∏≠

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `common/domain/aggregate.go`

    ```go
    package domain
    
    // Aggregate ‡πÄ‡∏õ‡πá‡∏ô struct ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö aggregate root ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô DDD
    // ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° domain events ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô aggregate
    type Aggregate struct {
     domainEvents []DomainEvent // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á event ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô aggregate ‡∏ô‡∏µ‡πâ
    }
    
    // AddDomainEvent ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏° domain event ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô aggregate
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏†‡∏≤‡∏¢‡πÉ‡∏ô method ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏Ç‡∏≠‡∏á aggregate ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ß‡πà‡∏≤ event ‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß
    func (a *Aggregate) AddDomainEvent(dv DomainEvent) {
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á slice ‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
     if a.domainEvents == nil {
      a.domainEvents = make([]DomainEvent, 0)
     }
    
     // ‡πÄ‡∏û‡∏¥‡πà‡∏° event ‡∏•‡∏á‡πÉ‡∏ô slice
     a.domainEvents = append(a.domainEvents, dv)
    }
    
    // PullDomainEvents ‡∏à‡∏∞‡∏î‡∏∂‡∏á domain events ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å aggregate
    // ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå events ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏≤‡∏Å memory (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ events ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß)
    // ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô layer ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ publish ‡∏´‡∏£‡∏∑‡∏≠ persist event
    func (a *Aggregate) PullDomainEvents() []DomainEvent {
     events := a.domainEvents    // ‡∏î‡∏∂‡∏á event ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
     a.domainEvents = nil        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå event list ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥
     return events
    }
    ```

### Event Dispatcher

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ register handler ‡πÅ‡∏•‡∏∞ dispatch ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (handler)

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `common/domain/event_dispatcher.go`

    ```go
    package domain
    
    import (
     "context"
     "fmt"
     "sync"
    )
    
    // Error ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á event
    var (
     ErrInvalidEvent = fmt.Errorf("invalid domain event")
    )
    
    // DomainEventHandler ‡∏Ñ‡∏∑‡∏≠ interface ‡∏ó‡∏µ‡πà‡∏ó‡∏∏‡∏Å handler ‡∏Ç‡∏≠‡∏á event ‡∏ï‡πâ‡∏≠‡∏á implement
    // ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏°‡∏µ method ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Ñ‡∏∑‡∏≠ Handle ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö event ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏° logic ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
    type DomainEventHandler interface {
     Handle(ctx context.Context, event DomainEvent) error
    }
    
    // DomainEventDispatcher ‡∏Ñ‡∏∑‡∏≠ interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢ (dispatch) event
    // ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ register handler ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ EventName ‡πÅ‡∏•‡∏∞ dispatch ‡∏´‡∏•‡∏≤‡∏¢ event ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ
    type DomainEventDispatcher interface {
     Register(eventType EventName, handler DomainEventHandler)
     Dispatch(ctx context.Context, events []DomainEvent) error
    }
    
    // simpleDomainEventDispatcher ‡πÄ‡∏õ‡πá‡∏ô implementation ‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡∏Ç‡∏≠‡∏á DomainEventDispatcher
    // ‡πÉ‡∏ä‡πâ map ‡πÄ‡∏Å‡πá‡∏ö handler ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° EventName
    type simpleDomainEventDispatcher struct {
     handlers map[EventName][]DomainEventHandler // ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á EventName ‡πÑ‡∏õ‡∏¢‡∏±‡∏á handler ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß
     mu       sync.RWMutex                       // ‡πÉ‡∏ä‡πâ mutex ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô concurrent read/write
    }
    
    // NewSimpleDomainEventDispatcher ‡∏™‡∏£‡πâ‡∏≤‡∏á instance ‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á dispatcher
    func NewSimpleDomainEventDispatcher() DomainEventDispatcher {
     return &simpleDomainEventDispatcher{
      handlers: make(map[EventName][]DomainEventHandler),
     }
    }
    
    // Register ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô handler ‡∏Å‡∏±‡∏ö EventName
    // Handler ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ event ‡∏ô‡∏±‡πâ‡∏ô ‡πÜ ‡∏ñ‡∏π‡∏Å dispatch
    func (d *simpleDomainEventDispatcher) Register(eventType EventName, handler DomainEventHandler) {
     d.mu.Lock()
     defer d.mu.Unlock()
    
     // ‡πÄ‡∏û‡∏¥‡πà‡∏° handler ‡πÑ‡∏õ‡∏¢‡∏±‡∏á slice ‡∏Ç‡∏≠‡∏á event ‡∏ô‡∏±‡πâ‡∏ô ‡πÜ
     d.handlers[eventType] = append(d.handlers[eventType], handler)
    }
    
    // Dispatch ‡∏£‡∏±‡∏ö slice ‡∏Ç‡∏≠‡∏á event ‡πÅ‡∏•‡πâ‡∏ß dispatch ‡πÑ‡∏õ‡∏¢‡∏±‡∏á handler ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ
    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ handler ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß
    func (d *simpleDomainEventDispatcher) Dispatch(ctx context.Context, events []DomainEvent) error {
     for _, event := range events {
      // ‡∏≠‡πà‡∏≤‡∏ô handler ‡∏Ç‡∏≠‡∏á event ‡∏ô‡∏µ‡πâ (copy slice ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô concurrent modification)
      d.mu.RLock()
      handlers := append([]DomainEventHandler(nil), d.handlers[event.EventName()]...)
      d.mu.RUnlock()
    
      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å handler ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß
      for _, handler := range handlers {
       err := func(h DomainEventHandler) error {
        // ‡∏´‡∏≤‡∏Å handler ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô error ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏∏ event ‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î
        err := h.Handle(ctx, event)
        if err != nil {
         return fmt.Errorf("error handling event %s: %w", event.EventName(), err)
        }
        return nil
       }(handler)
    
       // ‡∏´‡∏≤‡∏Å‡∏°‡∏µ error ‡∏à‡∏≤‡∏Å handler ‡πÉ‡∏î ‡πÜ ‡∏à‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞ return ‡πÄ‡∏•‡∏¢
       if err != nil {
        return err
       }
      }
     }
    
     // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ error ‡πÄ‡∏•‡∏¢ ‡∏™‡πà‡∏á nil ‡∏Å‡∏•‡∏±‡∏ö
     return nil
    }
    ```

### Domain Event

- ‡∏™‡∏£‡πâ‡∏≤‡∏á domain event ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

    > ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customer/internal/domain/event/customer_created.go`
    >

    ```go
    package event
    
    import (
     "go-mma/shared/common/domain"
     "time"
    )
    
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠ Event ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (EventName)
    // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡∏≠‡∏á Domain Event ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô "CustomerCreated"
    const (
     CustomerCreatedDomainEventType domain.EventName = "CustomerCreated"
    )
    
    // CustomerCreatedDomainEvent ‡∏Ñ‡∏∑‡∏≠ struct ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå
    // ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Customer ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
    type CustomerCreatedDomainEvent struct {
     domain.BaseDomainEvent // ‡∏ù‡∏±‡∏á BaseDomainEvent ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡∏¥‡∏î event
     CustomerID int64       // ID ‡∏Ç‡∏≠‡∏á Customer ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á
     Email      string      // Email ‡∏Ç‡∏≠‡∏á Customer ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á
    }
    
    // NewCustomerCreatedDomainEvent ‡∏™‡∏£‡πâ‡∏≤‡∏á instance ‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á CustomerCreatedDomainEvent
    // ‡πÇ‡∏î‡∏¢‡∏£‡∏±‡∏ö customer ID ‡πÅ‡∏•‡∏∞ email ‡πÄ‡∏õ‡πá‡∏ô input ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ event ‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    func NewCustomerCreatedDomainEvent(custID int64, email string) *CustomerCreatedDomainEvent {
     return &CustomerCreatedDomainEvent{
      BaseDomainEvent: domain.BaseDomainEvent{
       Name: CustomerCreatedDomainEventType, // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠ event
       At:   time.Now(),                      // ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡∏¥‡∏î event ‡∏ì ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      },
      CustomerID: custID, // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î customer ID
      Email:      email,  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î email
     }
    }
    ```

- ‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏• `Customer` ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô `Aggregate` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå  ‚ÄúCustomerCreated‚Äù ‡∏ì ‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `customer/internal/model/customer.go`
    >

    ```go
    package model
    
    import (
     "go-mma/modules/customer/internal/domain/event"
     "go-mma/shared/common/domain"
     "go-mma/shared/common/errs"
     "go-mma/shared/common/idgen"
     "time"
    )
    
    type Customer struct {
     ID        int64     `db:"id"` // tag db ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö StructScan() ‡∏Ç‡∏≠‡∏á sqlx
     Email     string    `db:"email"`
     Credit    int       `db:"credit"`
     CreatedAt time.Time `db:"created_at"`
     UpdatedAt time.Time `db:"updated_at"`
     domain.Aggregate    // embed: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô Aggregate ‡∏Ç‡∏≠‡∏á Customer
    }
    
    func NewCustomer(email string, credit int) *Customer {
     customer := &Customer{
      ID:     idgen.GenerateTimeRandomID(),
      Email:  email,
      Credit: credit,
     }
    
     // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå "CustomerCreated"
     customer.AddDomainEvent(event.NewCustomerCreatedDomainEvent(customer.ID, customer.Email))
    
     return customer
    }
    
    func (c *Customer) ReserveCredit(v int) error {
     // ...
    }
    
    func (c *Customer) ReleaseCredit(v int) {
     // ...
    }
    ```

### Domain Event Handler

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö event ‚Äú`CustomerCreated`‚Äù ‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠

> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `customer/internal/domain/eventhandler/customer_created_handler.go`
>

```go
package eventhandler

import (
 "context"
 "go-mma/modules/customer/internal/domain/event"
 notiService "go-mma/modules/notification/service"
 "go-mma/shared/common/domain"
)

// customerCreatedDomainEventHandler ‡∏Ñ‡∏∑‡∏≠ handler ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ event ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó CustomerCreatedDomainEvent
type customerCreatedDomainEventHandler struct {
 notiSvc notiService.NotificationService // service ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏µ‡πÄ‡∏°‡∏•)
}

// NewCustomerCreatedDomainEventHandler ‡∏Ñ‡∏∑‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á instance ‡∏Ç‡∏≠‡∏á handler ‡∏ô‡∏µ‡πâ
func NewCustomerCreatedDomainEventHandler(notiSvc notiService.NotificationService) domain.DomainEventHandler {
 return &customerCreatedDomainEventHandler{
  notiSvc: notiSvc,
 }
}

// Handle ‡∏Ñ‡∏∑‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ event ‡∏ñ‡∏π‡∏Å dispatch ‡∏°‡∏≤
func (h *customerCreatedDomainEventHandler) Handle(ctx context.Context, evt domain.DomainEvent) error {
 // ‡πÅ‡∏õ‡∏•‡∏á (type assert) event ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô pointer ‡∏Ç‡∏≠‡∏á CustomerCreatedDomainEvent
 e, ok := evt.(*event.CustomerCreatedDomainEvent)
 if !ok {
  // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà event ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏µ‡πâ ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á error ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ
  return domain.ErrInvalidEvent
 }

 // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ service ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
 if err := h.notiSvc.SendEmail(e.Email, "Welcome to our service!", map[string]any{
  "message": "Thank you for joining us! We are excited to have you as a member.",
 }); err != nil {
  // ‡∏´‡∏≤‡∏Å‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏™‡πà‡∏á error ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ
  return err
 }

 // ‡∏ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô nil (‡πÑ‡∏°‡πà‡∏°‡∏µ error)
 return nil
}
```

### Trigger Point

‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡πÄ‡∏≠‡∏≤ domain events ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å transaction logic ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ commit

> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `customer/internal/feature/create/handler.go`
>

```go
package create

// ...

func (h *createCustomerCommandHandler) Handle(ctx context.Context, cmd *CreateCustomerCommand) (*CreateCustomerCommandResult, error) {
 // ...
 err := h.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {

  // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Repository Layer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  if err := h.custRepo.Create(ctx, customer); err != nil {
   // error logging
   logger.Log.Error(err.Error())
   return err
  }
  
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß

  // ‡∏î‡∏∂‡∏á domain events ‡∏à‡∏≤‡∏Å customer model
  events := customer.PullDomainEvents()

  return nil
 })

 // ..
}
```

### Dispatch Events

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å domain event handler ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏°‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏µ side-effect ‡∏à‡∏∂‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÅ‡∏ö‡∏ö post-commit dispatch ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏≠‡πÉ‡∏´‡πâ DB commit ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏≠‡∏¢ dispatch

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `customer/internal/feature/create/handler.go`

    ```go
    package create
    
    import (
     "context"
     "go-mma/modules/customer/domainerrors"
     "go-mma/modules/customer/internal/model"
     "go-mma/modules/customer/internal/repository"
     "go-mma/shared/common/domain" // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     "go-mma/shared/common/logger"
     "go-mma/shared/common/storage/sqldb/transactor"
    )
    
    type createCustomerCommandHandler struct {
     transactor transactor.Transactor
     custRepo   repository.CustomerRepository
     dispatcher domain.DomainEventDispatcher // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ dispatcher
    }
    
    func NewCreateCustomerCommandHandler(
     transactor transactor.Transactor,
     custRepo repository.CustomerRepository,
     dispatcher domain.DomainEventDispatcher, // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    ) *createCustomerCommandHandler {
     return &createCustomerCommandHandler{
      transactor: transactor,
      custRepo:   custRepo,
      dispatcher: dispatcher, // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
     }
    }
    
    func (h *createCustomerCommandHandler) Handle(ctx context.Context, cmd *CreateCustomerCommand) (*CreateCustomerCommandResult, error) {
     // ...
     err := h.transactor.WithinTransaction(ctx, func(ctx context.Context, registerPostCommitHook func(transactor.PostCommitHook)) error {
      // ...
      // ‡∏î‡∏∂‡∏á domain events ‡∏à‡∏≤‡∏Å customer model
      events := customer.PullDomainEvents()
    
      // ‡πÉ‡∏´‡πâ dispatch ‡∏´‡∏•‡∏±‡∏á commit ‡πÅ‡∏•‡πâ‡∏ß
      registerPostCommitHook(func(ctx context.Context) error {
       return h.dispatcher.Dispatch(ctx, events)
      })
    
      return nil
     })
    
     // ..
    }
    ```

### Register domain event

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å domain events ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á dispatcher ‡πÅ‡∏¢‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `customer/module.go`

    ```go
    package customer
    
    import (
     "go-mma/modules/customer/internal/domain/event"         // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πà
     "go-mma/modules/customer/internal/domain/eventhandler"  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πà
     "go-mma/modules/customer/internal/feature/create"
     getbyid "go-mma/modules/customer/internal/feature/get-by-id"
     releasecredit "go-mma/modules/customer/internal/feature/release-credit"
     reservecredit "go-mma/modules/customer/internal/feature/reserve-credit"
     "go-mma/modules/customer/internal/repository"
     "go-mma/shared/common/domain"                           // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πà
     "go-mma/shared/common/mediator"
     "go-mma/shared/common/module"
     "go-mma/shared/common/registry"
    
     notiModule "go-mma/modules/notification"
     notiService "go-mma/modules/notification/service"
    
     "github.com/gofiber/fiber/v3"
    )
    
    // ...
    
    func (m *moduleImp) Init(reg registry.ServiceRegistry) error {
     // Resolve NotificationService from the registry
     // ...
    
     // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πà
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á Domain Event Dispatcher ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞
     // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ dispatcher ‡∏Å‡∏•‡∏≤‡∏á ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á dispatcher ‡πÅ‡∏¢‡∏Å‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÅ‡∏ó‡∏ô
     // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏±‡πâ‡∏ô‡πÜ ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ event handler ‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏¥‡∏™‡∏£‡∏∞
     dispatcher := domain.NewSimpleDomainEventDispatcher()
    
     // ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô handler ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event CustomerCreatedDomainEventType ‡πÉ‡∏ô dispatcher ‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏µ‡πâ
     dispatcher.Register(event.CustomerCreatedDomainEventType, eventhandler.NewCustomerCreatedDomainEventHandler(notiSvc))
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á repository ‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏µ‡πâ
     repo := repository.NewCustomerRepository(m.mCtx.DBCtx)
    
     // ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô command handler ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á dispatcher ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô handler ‡∏î‡πâ‡∏ß‡∏¢
     // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ handler ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ dispatch event ‡∏ú‡πà‡∏≤‡∏ô dispatcher ‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ
     mediator.Register(create.NewCreateCustomerCommandHandler(m.mCtx.Transactor, repo, dispatcher))
     
     // ...
    }
    ```

## Refactor ‡πÄ‡∏û‡∏¥‡πà‡∏° Integration Event

‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Integration Event ‡πÉ‡∏ô Event-Driven Architecture (EDA) ‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö (patterns) ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö, ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£ decouple, ‡πÅ‡∏•‡∏∞ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ö‡πà‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å ‡πÜ ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

1. **In-Memory Event Bus (Monolith)**

    **‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞**

    - Event ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö in-process (memory) ‡πÑ‡∏õ‡∏¢‡∏±‡∏á handler ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ‡πÉ‡∏ô runtime ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
    - ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö monolith ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏£‡∏±‡∏ô‡πÉ‡∏ô process ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

    **‡∏Ç‡πâ‡∏≠‡∏î‡∏µ**

    - ‡∏á‡πà‡∏≤‡∏¢
    - ‡πÄ‡∏£‡πá‡∏ß

    **‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢**

    - ‡πÑ‡∏°‡πà‡∏ó‡∏ô‡∏ï‡πà‡∏≠ crash
    - ‡∏ñ‡πâ‡∏≤ handler ‡∏û‡∏±‡∏á‡∏´‡∏£‡∏∑‡∏≠ panic ‚Üí ‡πÑ‡∏°‡πà‡∏°‡∏µ retry
    - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ scale ‡∏Ç‡πâ‡∏≤‡∏° service/process ‡πÑ‡∏î‡πâ
2. **Outbox Pattern (Reliable Messaging in Monolith / Microservices)**

    **‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞**

    - ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ event ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á business data + integration event ‡πÉ‡∏ô transaction ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
    - Event ‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô outbox table
    - Worker (‡∏´‡∏£‡∏∑‡∏≠ background process) ‡∏Ñ‡∏≠‡∏¢‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á message broker (Kafka, RabbitMQ)

    **‡∏Ç‡πâ‡∏≠‡∏î‡∏µ**

    - ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (atomic): business data + event commit ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
    - ‡∏ó‡∏ô‡∏ï‡πà‡∏≠ crash
    - Decouple services ‡πÑ‡∏î‡πâ (publish ‡πÑ‡∏õ Kafka)

    **‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢**

    - ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ worker ‡∏î‡∏∂‡∏á‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á
    - ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤ in-memory
3. **Change Data Capture (CDC)**

    **‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞**

    - ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á Debezium ‡∏´‡∏£‡∏∑‡∏≠ Kafka Connect ‡∏ü‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô DB (‡∏ú‡πà‡∏≤‡∏ô WAL ‡∏´‡∏£‡∏∑‡∏≠ binlog)
    - ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ insert/update ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô event ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ message broker

    **‡∏Ç‡πâ‡∏≠‡∏î‡∏µ**

    - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Worker (‡∏´‡∏£‡∏∑‡∏≠ background process) ‡∏Ñ‡∏≠‡∏¢‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á message broker
    - ‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

    **‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢**

    - ‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ schema evolution ‡πÅ‡∏•‡∏∞ data format ‡πÉ‡∏´‡πâ‡∏î‡∏µ

### In-Memory Event Bus (Monolith)

‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏ö‡∏ö In-Memory Event Bus ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡πá‡∏ô Monolith ‡πÅ‡∏•‡∏∞‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Integration Event ‡πÅ‡∏ö‡∏ö In-Memory Event Bus ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Monolith ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏• (bounded contexts) ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ messaging system ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å ‡πÄ‡∏ä‡πà‡∏ô Kafka ‡∏´‡∏£‡∏∑‡∏≠ RabbitMQ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÅ‡∏¢‡∏Å "Integration Event" ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å "Domain Event" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤ separation of concerns

‡∏°‡∏µ‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

1. **Integration Event**
    - ‡πÄ‡∏õ‡πá‡∏ô struct ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏°‡πÇ‡∏°‡∏î‡∏π‡∏• (context) ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
    - ‡∏°‡∏µ payload ‡∏ó‡∏µ‡πà module ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ ‡πÄ‡∏ä‡πà‡∏ô `CustomerCreatedIntegrationEvent`
2. **Integration Event Interface**
    - ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô abstraction ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÄ‡∏ä‡πà‡∏ô: ‡∏°‡∏µ method `EventID()`‡∏´‡∏£‡∏∑‡∏≠ `EventName()` ‡∏´‡∏£‡∏∑‡∏≠ `OccurredAt()`
3. **Event Bus (In-Memory Implementation)**
    - ‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ publish ‚Üí ‡πÑ‡∏õ‡∏¢‡∏±‡∏á handler ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ
    - ‡πÄ‡∏Å‡πá‡∏ö handler ‡πÄ‡∏õ‡πá‡∏ô map ‡∏à‡∏≤‡∏Å event name ‚Üí handler list
4. **Register / Subscribe**
    - Module ‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à event ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô handler ‡πÑ‡∏ß‡πâ‡∏Å‡∏±‡∏ö EventBus
5. **Publish**
    - ‡πÄ‡∏°‡∏∑‡πà‡∏≠ module ‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á event ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `eventBus.Publish(...)`
    - EventBus ‡∏à‡∏∞‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢ event ‡πÑ‡∏õ‡∏¢‡∏±‡∏á handler ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ
6. **Event Handlers**
    - ‡πÅ‡∏ï‡πà‡∏•‡∏∞ handler ‡∏°‡∏µ logic ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Integration Event Interface

- ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô abstraction ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÄ‡∏ä‡πà‡∏ô: ‡∏°‡∏µ method `EventID()`‡∏´‡∏£‡∏∑‡∏≠ `EventName()` ‡∏´‡∏£‡∏∑‡∏≠ `OccurredAt()`
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `common/eventbus/event.go`

    ```go
    package eventbus
    
    import (
     "time"
    )
    
    // EventName ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠ event
    type EventName string
    
    // Event ‡∏Ñ‡∏∑‡∏≠ interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
    // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ method ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ID, ‡∏ä‡∏∑‡πà‡∏≠ event, ‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î event
    type Event interface {
     EventID() string       // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ ID ‡∏Ç‡∏≠‡∏á event (‡πÄ‡∏ä‡πà‡∏ô UUID ‡∏´‡∏£‡∏∑‡∏≠ ULID)
     EventName() EventName  // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠ event ‡πÄ‡∏ä‡πà‡∏ô "CustomerCreated"
     OccurredAt() time.Time // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà event ‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
    }
    
    // BaseEvent ‡∏Ñ‡∏∑‡∏≠ struct ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• event ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
    // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡∏ù‡∏±‡∏á‡πÉ‡∏ô struct event ‡∏ó‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡πÑ‡∏î‡πâ
    type BaseEvent struct {
     ID   string    // ‡∏£‡∏´‡∏±‡∏™ event ‡πÅ‡∏ö‡∏ö unique (UUID/ULID)
     Name EventName // ‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á event ‡πÄ‡∏ä‡πà‡∏ô "CustomerCreated"
     At   time.Time // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà event ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
    }
    
    // EventID ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ ID ‡∏Ç‡∏≠‡∏á event
    func (e BaseEvent) EventID() string {
     return e.ID
    }
    
    // EventName ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á event
    func (e BaseEvent) EventName() EventName {
     return e.Name
    }
    
    // OccurredAt ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà event ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
    func (e BaseEvent) OccurredAt() time.Time {
     return e.At
    }
    ```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á EventBus (In-Memory Implementation)

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ publish ‚Üí ‡πÑ‡∏õ‡∏¢‡∏±‡∏á handler ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `common/eventbus/eventbus.go`

    ```go
    package eventbus
    
    import (
     "context"
    )
    
    // IntegrationEventHandler ‡∏Ñ‡∏∑‡∏≠ interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö handler ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Integration Event
    // ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ method Handle ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö context ‡πÅ‡∏•‡∏∞ event ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
    type IntegrationEventHandler interface {
     Handle(ctx context.Context, event Event) error
    }
    
    // EventBus ‡∏Ñ‡∏∑‡∏≠ interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö event bus ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ publish ‡πÅ‡∏•‡∏∞ subscribe event ‡∏ï‡πà‡∏≤‡∏á‡πÜ
    type EventBus interface {
     // Publish ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á event ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏∞‡∏ö‡∏ö event bus
     // ‡πÇ‡∏î‡∏¢‡∏£‡∏±‡∏ö context ‡πÅ‡∏•‡∏∞ event ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á
     Publish(ctx context.Context, event Event) error
    
     // Subscribe ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô handler ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠ eventName
     // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ event ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠ eventName ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ handler ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ
     Subscribe(eventName EventName, handler IntegrationEventHandler)
    }
    
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `common/eventbus/in_memory_eventbus.go`

    ```go
    package eventbus
    
    import (
     "context"
     "log"
     "sync"
    )
    
    // implementation ‡∏Ç‡∏≠‡∏á EventBus ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö subscriber ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô memory
    type inmemoryEventBus struct {
     subscribers map[EventName][]IntegrationEventHandler // ‡πÄ‡∏Å‡πá‡∏ö eventName ‡∏Å‡∏±‡∏ö list ‡∏Ç‡∏≠‡∏á handler
     mu          sync.RWMutex                            // mutex ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô concurrent access
    }
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á instance ‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á inmemoryEventBus ‡∏û‡∏£‡πâ‡∏≠‡∏° map subscribers ‡∏ß‡πà‡∏≤‡∏á ‡πÜ
    func NewInMemoryEventBus() EventBus {
     return &inmemoryEventBus{
      subscribers: make(map[EventName][]IntegrationEventHandler),
     }
    }
    
    // Subscribe ‡πÉ‡∏ä‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô handler ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠ eventName
    // ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° handler ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô map subscribers
    func (eb *inmemoryEventBus) Subscribe(eventName EventName, handler IntegrationEventHandler) {
     eb.mu.Lock()
     defer eb.mu.Unlock()
    
     // ‡πÄ‡∏û‡∏¥‡πà‡∏° handler ‡πÄ‡∏Ç‡πâ‡∏≤ slice ‡∏Ç‡∏≠‡∏á eventName ‡∏ô‡∏±‡πâ‡∏ô ‡πÜ
     eb.subscribers[eventName] = append(eb.subscribers[eventName], handler)
    }
    
    // Publish ‡∏™‡πà‡∏á event ‡πÑ‡∏õ‡∏¢‡∏±‡∏á handler ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà subscribe event ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
    func (eb *inmemoryEventBus) Publish(ctx context.Context, event Event) error {
     eb.mu.RLock()
     defer eb.mu.RUnlock()
    
     // ‡∏´‡∏≤ handler ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏±‡∏ö event ‡∏ô‡∏µ‡πâ
     handlers, ok := eb.subscribers[event.EventName()]
     if !ok {
      // ‡πÑ‡∏°‡πà‡∏°‡∏µ handler ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event ‡∏ô‡∏µ‡πâ ‡∏Å‡πá return nil
      return nil
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á context ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event bus
     busCtx := context.WithValue(ctx, "name", "context in event bus")
    
     // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å handler ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏ö‡∏ö asynchronous (goroutine) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
     for _, handler := range handlers {
      go func(h IntegrationEventHandler) {
       // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å handle event ‡πÅ‡∏•‡∏∞ log error ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
       err := h.Handle(busCtx, event)
       if err != nil {
        log.Printf("error handling event %s: %v", event.EventName(), err)
       }
      }(handler)
     }
     return nil
    }
    ```

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Integration Event

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å integration event ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÇ‡∏°‡∏î‡∏π‡∏• ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà‡∏ä‡∏∑‡πà‡∏≠ messaging ‡πÉ‡∏ô shared

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå `messaging`

    ```bash
    mkdir -p src/shared/messaging
    cd src/shared/messaging
    go mod init go-mma/shared/messaging
    ```

    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á workspace ‡∏î‡πâ‡∏ß‡∏¢

    ```go
    {
      "folders": [
        // ...,
        {
          "path": "src/shared/messaging"
        }
      ],
      "settings": {}
    }
    ```

    ‡πÄ‡∏û‡∏¥‡πà‡∏° module replace ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå `common`

    ```go
    module go-mma/shared/messaging
    
    go 1.24.1
    
    replace go-mma/shared/common v0.0.0 => ../common
    
    require go-mma/shared/common v0.0.0
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏° module replace ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå ‡πÅ‡∏•‡∏∞ `app`

    ```go
    // app
    replace go-mma/shared/messaging v0.0.0 => ../shared/messaging
    
    // customer
    replace go-mma/shared/messaging v0.0.0 => ../../shared/messaging
    
    // order
    replace go-mma/shared/messaging v0.0.0 => ../../shared/messaging
    
    // notification
    replace go-mma/shared/messaging v0.0.0 => ../../shared/messaging
    ```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `messaging/customer_created.go`

    ```go
    package messaging
    
    import (
     "go-mma/shared/common/eventbus"
     "go-mma/shared/common/idgen"
     "time"
    )
    
    const (
     CustomerCreatedIntegrationEventName eventbus.EventName = "CustomerCreated"
    )
    
    type CustomerCreatedIntegrationEvent struct {
     eventbus.BaseEvent
     CustomerID int64  `json:"customer_id"`
     Email      string `json:"email"`
    }
    
    func NewCustomerCreatedIntegrationEvent(customerID int64, email string) *CustomerCreatedIntegrationEvent {
     return &CustomerCreatedIntegrationEvent{
      BaseEvent: eventbus.BaseEvent{
       ID:   idgen.GenerateUUIDLikeID(),
       Name: CustomerCreatedIntegrationEventName,
       At:   time.Now(),
      },
      CustomerID: customerID,
      Email:      email,
     }
    }
    ```

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy`

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Integration Event Handler

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö event ‚Äú`CustomerCreated`‚Äù ‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠ ‡πÇ‡∏î‡∏¢‡πÉ‡∏¢‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡πÇ‡∏°‡∏î‡∏π‡∏• notification ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á welcome email

- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `notification/internal/integration/customer/welcome_email_handler.go` (‡∏™‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ integration ‡∏à‡∏≤‡∏Å‡πÇ‡∏°‡∏î‡∏π‡∏• customer)

    ```go
    package customer
    
    import (
     "context"
     "fmt"
     "go-mma/modules/notification/service"
     "go-mma/shared/common/eventbus"
     "go-mma/shared/messaging"
    )
    
    type welcomeEmailHandler struct {
     notiService service.NotificationService
    }
    
    func NewWelcomeEmailHandler(notiService service.NotificationService) *welcomeEmailHandler {
     return &welcomeEmailHandler{
      notiService: notiService,
     }
    }
    
    func (h *welcomeEmailHandler) Handle(ctx context.Context, evt eventbus.Event) error {
     e, ok := evt.(*messaging.CustomerCreatedIntegrationEvent) // ‡πÉ‡∏ä‡πâ pointer
     if !ok {
      return fmt.Errorf("invalid event type")
     }
    
     return h.notiService.SendEmail(e.Email, "Welcome to our service!", map[string]any{
      "message": "Thank you for joining us! We are excited to have you as a member.",
     })
    }
    ```

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy`

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Integration Event Publisher

‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô CustomerCreatedDomainEventHandler ‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å notiService ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡πà‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô integration event ‡πÅ‡∏ó‡∏ô

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå  `customer/internal/domain/eventhandler/customer_created_handler.go`

    ```go
    package eventhandler
    
    import (
     "context"
     "go-mma/modules/customer/internal/domain/event"
     "go-mma/shared/common/domain"
     "go-mma/shared/common/eventbus"
     "go-mma/shared/messaging"
    )
    
    type customerCreatedDomainEventHandler struct {
     eventBus eventbus.EventBus // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ eventbus
    }
    
    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ eventbus
    func NewCustomerCreatedDomainEventHandler(eventBus eventbus.EventBus) domain.DomainEventHandler {
     return &customerCreatedDomainEventHandler{
      eventBus: eventBus, // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ eventbus
     }
    }
    
    func (h *customerCreatedDomainEventHandler) Handle(ctx context.Context, evt domain.DomainEvent) error {
     e, ok := evt.(*event.CustomerCreatedDomainEvent) // ‡πÉ‡∏ä‡πâ pointer
    
     if !ok {
      return domain.ErrInvalidEvent
     }
    
     // ‡∏™‡∏£‡πâ‡∏≤‡∏á IntegrationEvent ‡∏à‡∏≤‡∏Å Domain Event
     integrationEvent := messaging.NewCustomerCreatedIntegrationEvent(
      e.CustomerID,
      e.Email,
     )
    
     return h.eventBus.Publish(ctx, integrationEvent)
    }
    ```

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy`
- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå  `common/module/module.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ `Init()` ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö event bus

    ```go
    type Module interface {
     APIVersion() string
     Init(reg registry.ServiceRegistry, eventBus eventbus.EventBus) error // ‡∏£‡∏±‡∏ö eventBus ‡πÄ‡∏û‡∏¥‡πà‡∏°
     RegisterRoutes(r fiber.Router)
    }
    ```

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå  `customer/module.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö notification service ‡∏≠‡∏≠‡∏Å

    ```go
    func (m *moduleImp) Init(reg registry.ServiceRegistry, eventBus eventbus.EventBus) error {
     // ‡πÄ‡∏≠‡∏≤ notiSvc ‡∏≠‡∏≠‡∏Å
     
     // Register domain event handler
     dispatcher := domain.NewSimpleDomainEventDispatcher()
     dispatcher.Register(event.CustomerCreatedDomainEventType, eventhandler.NewCustomerCreatedDomainEventHandler(eventBus)) // ‡∏™‡πà‡∏á eventBus ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÅ‡∏ó‡∏ô
    
     repo := repository.NewCustomerRepository(m.mCtx.DBCtx)
    
     mediator.Register(create.NewCreateCustomerCommandHandler(m.mCtx.Transactor, repo, dispatcher))
     mediator.Register(getbyid.NewGetCustomerByIDQueryHandler(repo))
     mediator.Register(reservecredit.NewReserveCreditCommandHandler(m.mCtx.Transactor, repo))
     mediator.Register(releasecredit.NewReleaseCreditCommandHandler(m.mCtx.Transactor, repo))
    
     return nil
    }
    ```

- ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `Init()` ‡∏ó‡∏µ‡πà‡πÇ‡∏°‡∏î‡∏π‡∏• `order` ‡∏Å‡∏±‡∏ö `notification` ‡∏î‡πâ‡∏ß‡∏¢
- ‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå `app/application/application.go` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á event bus ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ï‡∏≠‡∏ô init module

    ```go
    package application
    
    import (
      // ...
     "go-mma/shared/common/eventbus"
      // ...
    )
    
    type Application struct {
     config          config.Config
     httpServer      HTTPServer
     serviceRegistry registry.ServiceRegistry
     eventBus        eventbus.EventBus // ‡πÄ‡∏û‡πà‡∏¥‡∏°
    }
    
    func New(config config.Config) *Application {
     return &Application{
      config:          config,
      httpServer:      newHTTPServer(config),
      serviceRegistry: registry.NewServiceRegistry(),
      eventBus:        eventbus.NewInMemoryEventBus(), // ‡πÄ‡∏û‡πà‡∏¥‡∏°
     }
    }
    
    // ...
    
    func (app *Application) initModule(m module.Module) error {
     return m.Init(app.serviceRegistry, app.eventBus) // ‡πÄ‡∏û‡πà‡∏¥‡∏°‡∏™‡πà‡∏á eventBus
    }
    
    // ...
    ```

  - ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ `go mod tidy` ‡∏ó‡∏µ‡πà‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå `app`

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Register / Subscribe

‡πÉ‡∏´‡πâ‡πÇ‡∏°‡∏î‡∏π‡∏• notification ‡∏Ñ‡∏≠‡∏¢‡∏£‡∏±‡∏ö integration event

- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `notification/module.go`

    ```go
    func (m *moduleImp) Init(reg registry.ServiceRegistry, eventBus eventbus.EventBus) error {
     m.notiSvc = service.NewNotificationService()
    
     // subscribe to integration events
     eventBus.Subscribe(messaging.CustomerCreatedIntegrationEventName, customer.NewWelcomeEmailHandler(m.notiSvc))
    
     return nil
    }
    ```

‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Å‡πá‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ integration event ‡πÅ‡∏ö‡∏ö in-memory event bus ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏ß‡πà‡∏≤‡∏ß‡∏¥‡∏ò‡∏µ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏Ñ‡∏∑‡∏≠ ‡∏ñ‡πâ‡∏≤ handler ‡∏û‡∏±‡∏á‡∏´‡∏£‡∏∑‡∏≠ panic ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ retry ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î inconsistency ‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß (`INSERT INTO customers`) ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà

- ‡∏≠‡∏≤‡∏à‡πÄ‡∏û‡∏¥‡πà‡∏° retry logic ‡∏ï‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•
- ‡πÉ‡∏ä‡πâ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á Hybrid Approach ‡∏Ñ‡∏∑‡∏≠ ‡πÉ‡∏ä‡πâ Domain Event ‚Üí ‡πÅ‡∏õ‡∏•‡∏á (map) ‡πÄ‡∏õ‡πá‡∏ô Integration Event ‚Üí ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Outbox table (‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÉ‡∏ô transaction ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö business data)‚Üí ‡πÉ‡∏ä‡πâ CDC tools ‡∏™‡πà‡∏á event

---

## ‡∏™‡∏£‡∏∏‡∏õ

**Modular Monolith** ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡πÅ‡∏ï‡πà‡∏Å‡πá‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏™‡∏π‡πà **Microservices** ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏ö‡∏™‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤, ‡∏ó‡∏î‡∏™‡∏≠‡∏ö, ‡πÅ‡∏•‡∏∞ Deployment ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà Microservices ‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏à‡∏≠ ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡πá‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô **‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏≤‡∏£‡πå** ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ **‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•** ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ï‡πà‡∏≤‡∏á‡πÜ

‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏é‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ï‡∏ô‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á Modular Monolith ‡∏à‡∏∂‡∏á‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà **‡∏´‡∏•‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô** ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡πÜ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á

‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏≠‡∏á‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì **‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï** Modular Monolith ‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ï‡πâ‡∏ô‡πÜ ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö

---

## ‡∏ö‡∏ó‡πÄ‡∏™‡∏£‡∏¥‡∏°

## ‡∏™‡∏£‡πâ‡∏≤‡∏á API Document ‡∏î‡πâ‡∏ß‡∏¢ Swagger

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤ API Service ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠ **API Documentation** ‡∏ã‡∏∂‡πà‡∏á‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞ endpoint ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£ ‡∏£‡∏±‡∏ö request ‡πÅ‡∏ö‡∏ö‡πÉ‡∏î ‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö response ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô

‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°‡∏Ñ‡∏∑‡∏≠ **Swagger** ‡πÅ‡∏•‡∏∞‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤ Go ‡∏°‡∏±‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à [`swaggo/swag`](https://github.com/swaggo/swag) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö generate Swagger 2.0 documentation ‡∏à‡∏≤‡∏Å comment ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î

### ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö Fiber

‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏´‡∏≤‡∏Å‡πÉ‡∏ä‡πâ **Fiber v2** ‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ middleware [`fiber-swagger`](https://github.com/swaggo/fiber-swagger) ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ([‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà](https://somprasongd.work/blog/go/golang-api-p10-doc))

‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ **Fiber v3** ‡∏à‡∏∂‡∏á‡∏ï‡πâ‡∏≠‡∏á fork ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏á ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏ó‡∏ô

üëâ [`github.com/somprasongd/fiber-swagger`](https://github.com/somprasongd/fiber-swagger)

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö Mono Repository

‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö [Mono Repository](#‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô-mono-repository-‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö) ‡πÇ‡∏î‡∏¢

- ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏¢‡πà‡∏≠‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß (‡πÄ‡∏ä‡πà‡∏ô `customer`, `order`) ‡∏à‡∏∞‡∏£‡∏∞‡∏ö‡∏∏ API ‡∏î‡πâ‡∏ß‡∏¢ SWAG comment ‡πÑ‡∏ß‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
- ‡∏ï‡∏±‡∏ß‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å (`app`) ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `swag init` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

### ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô SWAG Comment

‡πÉ‡∏™‡πà comment ‡πÅ‡∏ö‡∏ö [Swagger annotations](https://github.com/swaggo/swag/tree/v2?tab=readme-ov-file#declarative-comments-format) ‡πÑ‡∏ß‡πâ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô handler ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- `/customers` ‚Äì Create Customer

    > ‡πÉ‡∏ô `customer/internal/feature/create/endpoint.go`
    >

    ```go
    // CreateCustomer godoc
    // @Summary  Create Customer
    // @Description Create Customer
    // @Tags   Customer
    // @Produce  json
    // @Param   customer body CreateCustomerRequest true "Create Data"
    // @Failure  401
    // @Failure  500
    // @Success  201 {object} CreateCustomerResponse
    // @Router   /customers [post]
    func createCustomerHTTPHandler(c fiber.Ctx) error {
      // ...
    }
    ```

- `/orders` ‚Äì Create Order

    > ‡πÉ‡∏ô `order/internal/feature/create/endpoint.go`
    >

    ```go
    // CreateOrder godoc
    // @Summary  Create Order
    // @Description Create Order
    // @Tags   Order
    // @Produce  json
    // @Param   order body CreateOrderRequest true "Create Data"
    // @Failure  401
    // @Failure  500
    // @Success  201 {object} CreateOrderResponse
    // @Router   /orders [post]
    func createOrderHTTPHandler(c fiber.Ctx) error {
      // ...
    }
    ```

- `/orders/{orderID}` ‚Äì Cancel Order

    > ‡πÉ‡∏ô `order/internal/feature/cancel/endpoint.go`
    >

    ```go
    // CancelOrder godoc
    // @Summary  Cancel Order
    // @Description Cancel Order By Order ID
    // @Tags   Order
    // @Produce  json
    // @Param   orderID path string true "order id"
    // @Failure  401
    // @Failure  404
    // @Failure  500
    // @Success  204
    // @Router   /orders/{orderID} [delete]
    func cancelOrderHTTPHandler(c fiber.Ctx) error {
      // ...
    }
    ```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ Generate Swagger Documentation

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á `swag` CLI

    ```bash
    go install github.com/swaggo/swag/v2/cmd/swag@latest
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏° Makefile ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö generate docs

    > ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `Makefile`
    >

    ```makefile
    .PHONY: doc
    doc:
     swag fmt -d src && \
     cd src/app && \
     swag init --parseDependency  --parseDependencyLevel 3 -g cmd/api/main.go -o docs
    ```

  - `swag fmt` : ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö comment ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
  - `--parseDependency  --parseDependencyLevel 3` : ‡πÉ‡∏´‡πâ `swag` ‡∏ï‡∏≤‡∏° dependency ‡∏•‡∏á‡∏•‡∏∂‡∏Å‡∏ñ‡∏∂‡∏á‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏¢‡πà‡∏≠‡∏¢
- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `make doc` ‡∏à‡∏∞‡πÑ‡∏î‡πâ `docs`¬†folder ‡∏Å‡∏±‡∏ö ¬†`docs/docs.go`
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå middleware ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Swagger UI

    > ‡πÉ‡∏ô `application/middleware/swagger.go`
    >

    ```go
    package middleware
    
    import (
     "fmt"
     "go-mma/build"
     "go-mma/config"
     "go-mma/docs"
     "strings"
    
     "github.com/gofiber/fiber/v3"
     fiberSwagger "github.com/somprasongd/fiber-swagger"
    )
    
    func APIDoc(config config.Config) fiber.Handler {
     //Swagger Doc details
     host := removeProtocol(config.GatewayHost)
     basePath := config.GatewayBasePath
     schemas := []string{"http", "https"}
    
     if len(host) == 0 {
      host = fmt.Sprintf("localhost:%d", config.HTTPPort)
     }
    
     if len(basePath) == 0 {
      basePath = "/api/v1"
     }
    
     docs.SwaggerInfo.Title = "Go MMA Example API"
     docs.SwaggerInfo.Description = "This is a sample server GO MMA server."
     docs.SwaggerInfo.Version = build.Version
     docs.SwaggerInfo.Host = host
     docs.SwaggerInfo.BasePath = basePath
     docs.SwaggerInfo.Schemes = schemas
    
     return fiberSwagger.WrapHandler
    }
    
    func removeProtocol(url string) string {
     url = strings.TrimPrefix(url, "http://")
     url = strings.TrimPrefix(url, "https://")
     return url
    }
    ```

- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï `config/config.go` ‡πÄ‡∏û‡∏¥‡πà‡∏° `GatewayHost` ‡πÅ‡∏•‡∏∞ `GatewayBasePath`

    ```go
    // ..
    
    type Config struct {
     HTTPPort        int
     GracefulTimeout time.Duration
     DSN             string
     GatewayHost     string // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°
     GatewayBasePath string // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°
    }
    
    func Load() (*Config, error) {
     config := &Config{
      HTTPPort:        env.GetIntDefault("HTTP_PORT", 8090),
      GracefulTimeout: env.GetDurationDefault("GRACEFUL_TIMEOUT", 5*time.Second),
      DSN:             env.Get("DB_DSN"),
      GatewayHost:     env.Get("GATEWAY_HOST"),  // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°
      GatewayBasePath: env.GetDefault("GATEWAY_BASEURL", "/api/v1"),  // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°
     }
     // ...
    }
    
    // ...
    ```

- ‡πÄ‡∏û‡∏¥‡πà‡∏° route ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Swagger UI

    > ‡πÉ‡∏ô `application/http.go`
    >

    ```go
    // ...
    
    func newHTTPServer(config config.Config) HTTPServer {
     return &httpServer{
      config: config,
      app:    newFiber(config), // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏á config
     }
    }
    
    func newFiber(config config.Config) *fiber.App { // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏±‡∏ö config
     app := fiber.New(fiber.Config{
      AppName: fmt.Sprintf("Go MMA version %s", build.Version),
     })
    
     // global middleware
      // ...
    
     app.Get("/docs/*", middleware.APIDoc(config)) // <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°
    
     app.Get("/", func(c fiber.Ctx) error {
      return c.JSON(map[string]string{"version": build.Version, "time": build.Time})
     })
    
     return app
    }
    
    // ...
    ```

- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `make run` ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î [http://localhost:8090/docs/](http://localhost:8090/docs/index.html) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π Swagger UI

> **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç SWAG comment ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô `make doc` ‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠ regenerate ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
>
